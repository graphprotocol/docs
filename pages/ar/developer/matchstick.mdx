---
title: ุงุฎุชุจุงุฑ ูุญุฏุฉ Framework
---

Matchstick ูู ุงุฎุชุจุงุฑ ูุญุฏุฉ framework ุ ุชู ุชุทููุฑู ุจูุงุณุทุฉ [ LimeChain ](https://limechain.tech/) ุ ูุงูุฐู ูุณูุญ ููุทูุฑู ุงูู subgraph ูู ุงุฎุชุจุงุฑ ููุทู ุงูู mapping ูู ุจูุฆุฉ sandboxed ููุดุฑ ุงูู subgraphs ุงูุฎุงุตุฉ ุจูู ุจุซูุฉ!

ุงุชุจุน [ ุฏููู ุชุซุจูุช Matchstick ](https://github.com/LimeChain/matchstick/blob/main/README.md#quick-start-) ููุชุซุจูุช. ุงูุขู ุ ููููู ุงูุงูุชูุงู ุฅูู ูุชุงุจุฉ ุฃูู ุงุฎุชุจุงุฑ ูุญุฏุฉ ุฎุงุตุฉ ุจู.

## ูุชุงุจุฉ ุงุฎุชุจุงุฑ ุงููุญุฏุฉ

ุฏุนููุง ูุฑู ููู ุณูุจุฏู ุงุฎุชุจุงุฑ ูุญุฏุฉ ุจุณูุทุฉุ ุจุงุณุชุฎุฏุงู Gravatar [ ูุซุงู ุนูู ุงูู Subgraph ](https://github.com/graphprotocol/example-subgraph).

ุจุงูุชุฑุงุถ ุฃู ูุฏููุง ุฏุงูุฉ ุงููุนุงูุฌ ุงูุชุงููุฉ (ุฌูุจุง ุฅูู ุฌูุจ ูุน ุฏุงูุชูู ูุณุงุนุฏุชูู ูุฌุนู ุญูุงุชูุง ุฃุณูู):

```javascript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress))
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```

ุนูููุง ุฃููุง ุฅูุดุงุก ููู ุงุฎุชุจุงุฑ ูู ูุดุฑูุนูุง. ููุฏ ุงุฎุชุฑูุง ุงูุงุณู ` gravity.test.ts `. ูู ุงูููู ุงูุฐู ุชู ุฅูุดุงุคู ุญุฏูุซุง ุ ูุญุชุงุฌ ุฅูู ุชุนุฑูู ุฏุงูุฉ ุจุงุณู ` ()runTests `. ูู ุงูููู ุฃู ูููู ููุฏุงูุฉ ูุฐุง ุงูุงุณู ุจุงูุถุจุท. ูุฐุง ูุซุงู ุนูู ุงูุดูู ุงูุฐู ูุฏ ูุจุฏู ุนููู ุงุฎุชุจุงุฑูุง:

```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

export function runTests(): void {
  test('Can call mappings with custom events', () => {
    // Initialise
    let gravatar = new Gravatar('gravatarId0')
    gravatar.save()

    // Call mappings
    let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

    let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

    handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

    assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
    assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
    assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

    clearStore()
  })

  test('Next test', () => {
    //...
  })
}
```

ูุฐุง ูุซูุฑ ููู ุงูุญุฒูุฉ! ุฃููุงู ุ ูู ุงูููู ููุงุญุธุฉ ุฃููุง ูุณุชูุฑุฏ ุฃุดูุงุก ูู ` matchstick-as ` ุ ูููุชุจุชูุง ุงููุณุงุนุฏุฉ AssemblyScript (ููุฒุนุฉ ููุญุฏุฉ npm). ููููู ุงูุนุซูุฑ ุนูู repository [ ููุง ](https://github.com/LimeChain/matchstick-as). ` matchstick-as ` ูููุฑ ููุง methods ุงุฎุชุจุงุฑ ูููุฏุฉ ููุนุฑู ุฃูุถุง ุฏุงูุฉ` ()test ` ุงูุชู ุณูุณุชุฎุฏููุง ูุจูุงุก ูุชู ุงูุงุฎุชุจุงุฑ ุงูุฎุงุตุฉ ุจูุง. ุงูุจุงูู ูุงุถุญ ููุจุงุดุฑ - ุฅููู ูุง ูุญุฏุซ:

- ูููู ุจุฅุนุฏุงุฏ ุญุงูุชูุง ุงูุฃูููุฉ ูุฅุถุงูุฉ ููุงู Gravatar ูุฎุตุต ุ;
- ูุนุฑู ูุงุฆูู ุญุฏุซ ` NewGravatar ` ุจุงูุฅุถุงูุฉ ูุจูุงูุงุชูู ุ ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `() createNewGravatarEvent`;
- ูุญู ูุณุชุฏุนู methods ุงููุนุงูุฌ ูุชูู ุงูุฃุญุฏุงุซ - ` () handleNewGravatars ` ูููุฑุฑ ููู ูุงุฆูุฉ ุฃุญุฏุงุซูุง ุงููุฎุตุตุฉ ุ;
- ูุคูุฏ ุญุงูุฉ ุงููุฎุฒู. ููู ูุนูู ูุฐุงุ - ููุฑุฑ ูุฌููุนุฉ ูุฑูุฏุฉ ูู ููุน Entity ู id. ุซู ูุชุญูู ูู ุญูู ูุนูู ูู ุฐูู ุงูู Entity ููุคูุฏ ุฃูู ูุญุชูู ุนูู ุงููููุฉ ุงูุชู ูุชููุนูุง. ูุญู ูููู ุจุฐูู ูููุง ุงูู Gravatar Entity ุงูุฃูููุฉ ุงูุฐู ุฃุถููุงู ุฅูู ุงููุฎุฒูุ ุจุงูุฅุถุงูุฉ ุฅูู ููุงููู Gravatar ุงููุฐุงู ุชูุช ุฅุถุงูุชููุง ุนูุฏ ุงุณุชุฏุนุงุก ุฏุงูุฉ ุงููุนุงูุฌ;
- ูุฃุฎูุฑุง - ูููู ุจุชูุธูู ุงููุฎุฒู ุจุงุณุชุฎุฏุงู ` () clearStore ` ุจุญูุซ ูููู ุฃู ูุจุฏุฃ ุงุฎุชุจุงุฑูุง ุงูุชุงูู ุจูุงุฆู ูุฎุฒู ุฌุฏูุฏ ููุงุฑุบ. ูููููุง ุชุนุฑูู ุงูุนุฏูุฏ ูู ูุชู ุงูุงุฎุชุจุงุฑ ููุง ูุฑูุฏ.

ูุง ูุญู ุฃูุดุฃูุง ุงุฎุชุจุงุฑูุง ุงูุฃูู! ๐

โ **ูุงู:** _ ููู ุชุนูู ุงูุงุฎุชุจุงุฑุงุช ุ ูุญุชุงุฌ ุฅูู ุชุตุฏูุฑ ุฏุงูุฉ ` runTests () ` ุชุนูู ูู ููู ุงูู mappings ุงูุฎุงุต ุจูุง. ูู ูุชู ุงุณุชุฎุฏุงูู ููุงู ุ ูููู ูุฌุจ ุฃู ุชููู ุนุจุงุฑุงุช ุงูุชุตุฏูุฑ ููุฌูุฏุฉ ุญุชู ูุชููู Rust ูู ุงูุชูุงุทู ูุงุญูุง ุนูุฏ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช. _

ููููู ุชุตุฏูุฑ ุฏุงูุฉ ุบูุงู ุงูุงุฎุชุจุงุฑุงุช ูู ููู ุงูู mappings ููุง ููู:

```
export { runTests } from "../tests/gravity.test.ts";
```

โ **ูุงู:** _ ุชูุฌุฏ ุญุงููุง ูุดููุฉ ูู ุงุณุชุฎุฏุงู Matchstick ุนูุฏ ูุดุฑ ุงูู subgraph ุงูุฎุงุต ุจู. ุงูุฑุฌุงุก ุงุณุชุฎุฏุงู Matchstick ููุงุฎุชุจุงุฑ ุงููุญูู ููุท ูุฅุฒุงูุฉ ูุฐุง ุงูุณุทุฑ ุจูุฌุฑุฏ ุงูุงูุชูุงุก. (`export { runTests } from "../tests/gravity.test.ts"`) ูุชููุน ุญู ูุฐู ุงููุดููุฉ ูุฑูุจุง ุ ูุฃุณู ููุฅุฒุนุงุฌ! _

_ุฅุฐุง ูู ุชูู ุจุฅุฒุงูุฉ ูุฐุง ุงูุณุทุฑ ุ ูุณุชุชููู ุฑุณุงูุฉ ุงูุฎุทุฃ ุงูุชุงููุฉ ุนูุฏ ูุญุงููุฉ ูุดุฑ ุงูู subgraph ุงูุฎุงุต ุจู:_

```
/...
Mapping terminated before handling trigger: oneshot canceled
.../
```

ุงูุขู ูุฅุฌุฑุงุก ุงุฎุชุจุงุฑูุงุ ุชุญุชุงุฌ ุจุจุณุงุทุฉ ุฅูู ุชุดุบูู ุงูุชุงูู ูู ูุฌูุฏ ุฌุฐุฑ ุงูู subgraph:

`graph test Gravity`

ูุฅุฐุง ุณุงุฑุช ุงูุฃููุฑ ุนูู ูุง ูุฑุงู ุ ูุฌุจ ุฃู ูุชู ุงูุชุฑุญูุจ ุจู ุจูุง ููู:

![Matchstick ูููู "ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุช!"](/img/matchstick-tests-passed.png)

## ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ุงูุดุงุฆุนุฉ

### Hydrating ุงููุฎุฒู ุจุญุงูุฉ ูุนููุฉ

ูููู ูููุณุชุฎุฏููู ุนูู hydrate ูููุฎุฒู ุจูุฌููุนุฉ ูุนุฑููุฉ ูู ุงูููุงูุงุช. ูููุง ููู ูุซุงู ูุชููุฆุฉ ุงููุฎุฒู ุจููุงู Gravatar:

```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```

### ุงุณุชุฏุนุงุก ุฏุงูุฉ mapping ูุน ุญุฏุซ

ูููู ูููุณุชุฎุฏู ุฅูุดุงุก ุญุฏุซ ูุฎุตุต ูุชูุฑูุฑู ุฅูู ุฏุงูุฉ mapping ูุฑุชุจุทุฉ ุจุงููุฎุฒู:

```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```

### ุงุณุชุฏุนุงุก ุฌููุน ุงูู mappings ูุน ุชุฑููุจุงุช ุงูุฃุญุฏุงุซ

ูููู ูููุณุชุฎุฏููู ุงุณุชุฏุนุงุก ุงูู mappings ูุน ุชุฑููุจุงุช ุงูุงุฎุชุจุงุฑ.

```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```

```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```

### ูุญุงูุงุฉ ุงุณุชุฏุนุงุก ุงูุนูุฏ

ูููู ูููุณุชุฎุฏููู ูุญุงูุงุฉ ุงุณุชุฏุนุงุก ุงูุนูุฏ:

```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```

ููุง ูู ููุถุญ ุ ูู ุฃุฌู ูุญุงูุงุฉ ุงุณุชุฏุนุงุก ุงูุนูุฏ ูุงูุชุดุฏูุฏ ุนูู ูููุฉ ุงูุฅุฑุฌุงุน ุ ูุฌุจ ุนูู ุงููุณุชุฎุฏู ุชูุฏูู ุนููุงู ุงูุนูุฏ ูุงุณู ุงูุฏุงูุฉ ูุชูููุน ุงูุฏุงูุฉ ููุตูููุฉ ูู ุงููุณุงุฆุท ุ ูุจุงูุทุจุน - ูููุฉ ุงูุฅุฑุฌุงุน.

ูููู ูููุณุชุฎุฏููู ุฃูุถูุง ูุญุงูุงุฉ ุฑุฌูุน ุงูุฏุงูุฉ:

```typescript
let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
  .withArgs([ethereum.Value.fromAddress(contractAddress)])
  .reverts()
```

### ุชุฃููุฏ ุญุงูุฉ ุงููุฎุฒู

ูููู ูููุณุชุฎุฏููู ุชุฃููุฏ ุงูุญุงูุฉ ุงูููุงุฆูุฉ (ุฃู ุงููุณุทู) ูููุฎุฒู ูู ุฎูุงู ุชุฃููุฏ ุงูููุงูุงุช. ููููุงู ุจุฐูู ุ ูุฌุจ ุนูู ุงููุณุชุฎุฏู ุชูููุฑ ููุน Entity ุ ู Entity ID ุ ูุงุณู ุญูู ูู ูุฐุง ุงูููุงู ุ ูุงููููุฉ ุงููุชููุนุฉ ููุญูู. ุฅููู ูุซุงู ุณุฑูุน:

```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```

ุณูุคุฏู ุชุดุบูู ุงูุฏุงูุฉ ()assert.fieldEquals ุฅูู ุงูุชุญูู ูู ุชุณุงูู ุงูุญูู ุงููุญุฏุฏ ูุน ุงููููุฉ ุงููุชููุนุฉ ุงููุญุฏุฏุฉ. ุณููุดู ุงูุงุฎุชุจุงุฑ ูุณูุชู ุฅุฎุฑุงุฌ ุฑุณุงูุฉ ุฎุทุฃ ุฅุฐุง ูุงูุช ุงูููู **ุบูุฑ** ูุชุณุงููุฉ. ูุฅูุง ูุฅู ุงูุงุฎุชุจุงุฑ ุณูู ููุฌุญ.

### ุงูุชูุงุนู ูุน ุงูุจูุงูุงุช ุงููุตููุฉ ููุญุฏุซ

ูููู ูููุณุชุฎุฏููู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุตููุฉ ุงูุงูุชุฑุงุถูุฉ ููุฅุฌุฑุงุกุงุช ุ ูุงูุชู ูููู ุฅุฑุฌุงุนูุง ูู ethereum.Event ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ `newMockEvent()` ุงููุซุงู ุงูุชุงูู ููุถุญ ููู ููููู ุงููุฑุงุกุฉ / ุงููุชุงุจุฉ ุฅูู ุชูู ุงูุญููู ูู ูุงุฆู ุงูุญุฏุซ:

```typescript
// Read
let logType = newGravatarEvent.logType

// Write
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```

### ุชุฃููุฏ ูุณุงูุงุฉ ุงููุชุบูุฑ

```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```

### ุงูุชุฃููุฏ ุนูู ุฃู ุงูููุงู **ููุณ** ูู ุงููุฎุฒู

ูููู ูููุณุชุฎุฏููู ุชุฃููุฏ ุนุฏู ูุฌูุฏ ููุงู ูู ุงููุฎุฒู. ุงูุฏุงูุฉ ุชุฃุฎุฐ ููุน ููุงู ูid. ุฅุฐุง ูุงู ุงูููุงู ููุฌูุฏุง ุจุงููุนู ูู ุงููุฎุฒูุ ูุณููุดู ุงูุงุฎุชุจุงุฑ ูุน ุธููุฑ ุฑุณุงูุฉ ุฎุทุฃ. ูููุง ููู ูุซุงู ุณุฑูุน ุนูู ููููุฉ ุงุณุชุฎุฏุงู ูุฐู ุงูุฏุงูุฉ:

```typescript
assert.notInStore('Gravatar', '23')
```

### ุงุฎุชุจุงุฑ ูุฏุฉ ููุช ุงูุชุดุบูู ูู ุฎุฑุฌ ุงูุณุฌู

ูุชุถูู ุฎุฑุฌ ุงูุณุฌู ูุฏุฉ ุชุดุบูู ุงูุงุฎุชุจุงุฑ. ูุฐุง ูุซุงู:

`Jul 09 14:54:42.420 INFO Program execution time: 10.06022ms`

## Feedback

ุฅุฐุง ูุงูุช ูุฏูู ุฃู ุฃุณุฆูุฉ ุฃู ุชุนูููุงุช ุฃู ุทูุจ ููุฒุงุช ุฃู ููุช ุชุฑุบุจ ููุท ูู ุงูุชูุงุตู ุ ูุฅู ุฃูุถู ููุงู ูู The Graph Discord ุญูุซ ูุฏููุง ููุงุฉ ูุฎุตุตุฉ ูู Matchstick ุ ุชุณูู ๐ฅ| unit-testing.
