---
title: ترحيل Subgraph موجود إلى شبكة The Graph
---

## مقدمة

هذا دليل حول كيفية ترحيل الـ subgraph الخاص بك من Hosted Service إلى شبكة The Graph. لقد نجح الترحيل إلى شبكة The Graph لمشاريع مثل Opyn و UMA و mStable و Audius و PoolTogether و Livepeer و RAI و Enzyme و DODO و Opyn و Pickle و BadgerDAO ، وكلها تعتمد على البيانات التي يقدمها المفهرسون على الشبكة. يوجد الآن أكثر من 200 subgraphs حي على شبكة The Graph، مولدة رسوم استعلام وفهرسة بيانات web3 بشكل نشط.

عملية الترحيل سريعة وسيستفيد الـ subgraphs الخاض بك إلى الأبد من الموثوقية والأداء اللذين يمكنك الحصول عليهما فقط على شبكة The Graph.

### متى لا تقوم بعملية الترحيل؟

إذا كان الـ subgraph الخاص بك:

- يفهرس [IPFS](https://ipfs.io/).
- يستخدم [حقل بحث عن نص-كامل](https://thegraph.com/docs/en/developer/create-subgraph-hosted/#defining-fulltext-search-fields).
- يفهرس السلاسل عدا Ethereum mainnet.

### ترحيل Subgraph موجود إلى شبكة The Graph

1. احصل على أحدث إصدار من graph-cli المثبت:

```sh
npm install -g @graphprotocol/graph-cli
```

```sh
yarn global add @graphprotocol/graph-cli
```

2. أنشئ subgraph على [ Subgraph Studio ](https://thegraph.com/studio/). يمكن العثور على أدلة حول كيفية القيام بذلك في [ مستندات Subgraph Studio ](/studio/subgraph-studio) وفي [ هذا الفيديو التعليمي ](https://www.youtube.com/watch؟ v = HfDgC2oNnwo).
3. داخل مستودع (repository) الـ subgraph للمشروع الرئيسي ، قم بمصادقة الـ subgraph للنشر والبناء على الاستوديو:

```sh
graph auth --studio <DEPLOY_KEY>
```

4. أنشئ الملفات وقم ببناء الـ subgraph:

```sh
graph codegen && graph build
```

5. انشر الـ subgraph في الاستوديو. يمكنك العثور على`<SUBGRAPH_SLUG>` الخاص بك في واجهة مستخدم الـ Studio ، والذي يعتمد على اسم الـ subgraph الخاص بك.

```sh
 graph deploy --studio <SUBGRAPH_SLUG>
```

6. قم باختبار الاستعلامات في Studio's playground. فيما يلي بعض الأمثلة لـ [Sushi - Mainnet Exchange Subgraph](https://thegraph.com/explorer/subgraph?id=0x4bb4c1b0745ef7b4642feeccd0740dec417ca0a0-0&view=Playground):

```sh
{
  users(first: 5) {
    id
    liquidityPositions {
      id
    }
  }
  bundles(first: 5) {
    id
    ethPrice
  }
}
```

7. املأ الوصف والتفاصيل الخاصة بالـ subgraph الخاص بك واختر ما يصل إلى 3 فئات. وقم برفع صورة المشروع في الاستوديو إذا كنت ترغب في ذلك.
8. انشر الـ subgraph على شبكة The Graph بالضغط على زر "Publish".

- تذكر أن النشر هو إجراء on-chain وسيتطلب دفع ثمن الغاز كـ Ethereum - انظر مثال لإجراء [ هنا ](https://etherscan.io/tx/0xd0c3fa0bc035703c9ba1ce40c1862559b9c5b6ea1198b3320871d535aa0de87b). الأسعار حوالي 0.0425 ETH عند 100 gwei.
- في أي وقت تحتاج فيه إلى ترقية الـ subgraph الخاص بك ، ستدفع رسوم الترقية. تذكر أن الترقية هي مجرد نشر إصدار آخر من subgraph on-chain موجود. ولأن هذا ينطوي على تكلفة ، فيوصى بشدة بنشر واختبار الـ subgraph الخاص بك على Rinkeby قبل النشر على mainnet. في بعض الحالات ، قد تتطلب أيضا بعض GRT إذا لم تكن هناك إشارة على هذا الـ subgraph. وفي حالة وجود إشارة / تنسيق في إصدار الـ subgraph هذا (باستخدام الترحيل التلقائي) ، سيتم تقسيم الضرائب.

وهذا كل شيء! بعد الانتهاء من النشر ، ستتمكن من رؤية الـ subgraphs الخاص بك على الشبكة عبر [The Graph Explorer](https://thegraph.com/explorer).

لا تتردد في الاستفادة من [ قناة Curators# ](https://discord.gg/rC8rBuRtbH) على Discord لإعلام المنسقين (Curators) بأن الـ subgraph الخاص بك جاهز للإشارة إليه. سيكون من المفيد أيضا أن تشارك حجم الاستعلام المتوقع معهم. لذلك ، يمكنهم تقدير مقدار GRT الذي يجب أن يشيروا إليه في الـ subgraph الخاص بك.

### ترقية Subgraph على الشبكة

إذا كنت ترغب في ترقية subgraph موجود على الشبكة ، فيمكنك القيام بذلك عن طريق نشر إصدار جديد من الـ subgraph الخاص بك على Subgraph Studio باستخدام Graph CLI.

1. قم بإجراء تغييرات على الـ subgraph الحالي الخاص بك. إنها لفكرة جيدة أن تقوم باختبار الإصلاحات الصغيرة في Subgraph Studio بالنشر على Rinkeby.
2. انشر ما يلي وحدد الإصدار الجديد في الأمر (مثل v0.0.1 ، v0.0.2 ، إلخ):

```sh
graph deploy --studio <SUBGRAPH_SLUG>
```

3. اختبر الإصدار الجديد في Subgraph Studio من خلال الاستعلام في الـ playground
4. انشر الإصدار الجديد على شبكة The Graph. تذكر أن هذا يتطلب غاز (كما هو موضح في القسم أعلاه).

### رسوم ترقية المالك

تتطلب الترقية ترحيل GRT من الإصدار القديم للـ subgraph إلى الإصدار الجديد. هذا يعني أنه لكل ترقية ، سيتم إنشاء منحنى ربط جديد (للمزيد عن منحنيات الترابط [ هنا ](/curating#bonding-curve-101)).

يفرض منحنى الترابط الجديد ضريبة تنسيق 2.5٪ على جميع GRT التي يتم ترحيلها إلى الإصدار الجديد. يجب على المالك دفع 50٪ من هذا أو 1.25٪. الـ 1.25٪ المتبقية يتم استحواذها من قبل جميع المنسقين كرسوم. تم وضع تصميم الحوافز هذا لمنع مالك الـ subgraph من استنزاف جميع أموال المنسقين من خلال استدعاءات الترقية المتكررة. إذا لم يكن هناك نشاط تنسيق ، فسيتعين عليك دفع 100 GRT كحد أدنى للإشارة إلى الـ subgraph الخاص بك.

كمثال على ذلك ، هذه هي الحالة فقط إذا كان الـ subgraph الخاص بك يتم تنسيقه بشكل نشط:

- تتم الإشارة بـ 100،000 GRT باستخدام الترحيل التلقائي في v1 لـ subgraph
- المالك يقوم بالترقية إلى v2. يتم ترحيل 100،000 GRT إلى منحنى ربط جديد ، حيث يتم وضع 97،500 GRT في المنحنى الجديد وحرق 2،500 GRT
- ثم قام المالك بحرق 1250 GRT لدفع نصف الرسوم. يجب أن يملك المالك ذلك في محفظته قبل الترقية ، وإلا فلن تنجح الترقية. يحدث هذا في نفس إجراء الترقية.

_بينما تتم هذه الآلية حاليا على الشبكة ، يناقش المجتمع حاليا طرقا لتقليل تكلفة الترقيات لمطوري الـ subgraph._

### Maintaining a Stable Version of a Subgraph

If you're making a lot of changes to your subgraph, it is not a good idea to continually upgrade it and front the upgrade costs. Maintaining a stable and consistent version of your subgraph is critical, not only from the cost perspective, but also so that Indexers can feel confident in their syncing times. Indexers should be flagged when you plan for an upgrade so that Indexer syncing times do not get impacted. Feel free to leverage the [#Indexers channel](https://discord.gg/rC8rBuRtbH) on Discord to let Indexers know when you're versioning your subgraphs.

Subgraphs are open APIs that external developers are leveraging. Open APIs need to follow strict standards so that they do not break external developers' applications. In The Graph Network, a subgraph developer must consider Indexers and how long it takes them to sync a new subgraph **as well as** other developers who are using their subgraphs.

### Updating the Metadata of a Subgraph

You can update the metadata of your subgraphs without having to publish a new version. The metadata includes the subgraph name, image, description, website URL, source code URL, and categories. Developers can do this by updating their subgraph details in the Subgraph Studio where you can edit all applicable fields.

Make sure **Update Subgraph Details in Explorer** is checked and click on **Save**. If this is checked, an on-chain transaction will be generated that updates subgraph details in the Explorer without having to publish a new version with a new deployment.

## Best Practices for Deploying a Subgraph to The Graph Network

1. Leveraging an ENS name for Subgraph Development:

- Set up your ENS: [https://app.ens.domains/](https://app.ens.domains/)
- Add your ENS name to your settings [here](https://thegraph.com/explorer/settings?view=display-name).

2. The more filled out your profiles are, the better the chances for your subgraphs to be indexed and curated.

## Deprecating a Subgraph on The Graph Network

Follow the steps [here](/developer/deprecating-a-subgraph) to deprecate your subgraph and remove it from The Graph Network.

## Querying a Subgraph + Billing on The Graph Network

The Hosted Service was set up to allow developers to deploy their subgraphs without any restrictions.

In order for The Graph Network to truly be decentralized, query fees have to be paid as a core part of the protocol's incentives. For more information on subscribing to APIs and paying the query fees, check out billing documentation [here](/studio/billing).

### Estimate Query Fees on the Network

While this is not a live feature in the product UI, you can set your maximum budget per query by taking the amount you're willing to pay per month and dividing it by your expected query volume.

While you get to decide on your query budget, there is no guarantee that an Indexer will be willing to serve queries at that price. If a Gateway can match you to an Indexer willing to serve a query at, or lower than, the price you are willing to pay, you will pay the delta/difference of your budget **and** their price. As a consequence, a lower query price reduces the pool of Indexers available to you, which may affect the quality of service you receive. It's beneficial to have high query fees, as that may attract curation and big-name Indexers to your subgraph.

Remember that it's a dynamic and growing market, but how you interact with it is in your control. There is no maximum or minimum price specified in the protocol or the Gateways. For example, you can look at the price paid by a few of the dapps on the network (on a per-week basis), below. See the last column, which shows query fees in GRT. For example, [Pickle Finance](https://www.pickle.finance/) has 8 requests per second and paid 2.4 GRT for one week.

![QueryFee](/img/QueryFee.png)

## Additional Resources

If you're still confused, fear not! Check out the following resources or watch our video guide on migrating subgraphs to the decentralized network below:

<figure className="video-container">
  <iframe
    className="video-iframe"
    src="https://www.youtube.com/embed/CzdQ3dFFrjo"
    title="مشغل فيديو يوتيوب"
    frameBorder="0"
    allowFullScreen
  ></iframe>
</figure>

- [The Graph Network Contracts](https://github.com/graphprotocol/contracts)
- [Curation Contract](https://github.com/graphprotocol/contracts/blob/dev/contracts/curation/Curation.sol) - the underlying contract that the GNS wraps around
  - Address - `0x8fe00a685bcb3b2cc296ff6ffeab10aca4ce1538`
- [Subgraph Studio documentation](/studio/subgraph-studio)
