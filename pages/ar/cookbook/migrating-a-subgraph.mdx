---
title: ترحيل Subgraph موجود إلى شبكة The Graph
---

## مقدمة

هذا دليل حول كيفية ترحيل الـ subgraph الخاص بك من Hosted Service إلى شبكة The Graph. لقد نجح الترحيل إلى شبكة The Graph لمشاريع مثل Opyn و UMA و mStable و Audius و PoolTogether و Livepeer و RAI و Enzyme و DODO و Opyn و Pickle و BadgerDAO ، وكلها تعتمد على البيانات التي يقدمها المفهرسون على الشبكة. ويوجد الآن أكثر من 200 subgraphs حي على شبكة The Graph، مولدة بذلك رسوم استعلام وفهرسة بيانات web3 بشكل نشط.

عملية الترحيل سريعة وسيستفيد الـ subgraphs الخاض بك إلى الأبد من الموثوقية والأداء اللذين يمكنك الحصول عليهما فقط على شبكة The Graph.

### متى لا تقوم بعملية الترحيل(Migration)؟

إذا كان الـ subgraph الخاص بك:

- يفهرس [IPFS](https://ipfs.io/).
- يستخدم [حقول بحث عن نص-كامل(full-text)](/developing/creating-a-subgraph/#defining-fulltext-search-fields).
- يفهرس(chains) السلاسل عدا Ethereum mainnet.

### ترحيل Subgraph موجود إلى شبكة The Graph

1. احصل على أحدث إصدار من graph-cli المثبت:

```sh
npm install -g @graphprotocol/graph-cli
```

```sh
yarn global add @graphprotocol/graph-cli
```

2. أنشئ subgraph على [ Subgraph Studio ](https://thegraph.com/studio/). يمكن العثور على شرح حول كيفية القيام بذلك في [ مستندات Subgraph Studio ](/deploying/subgraph-studio) وفي \[ هذا الفيديو التعليمي\](https://www. youtube. com/watch؟ v = HfDgC2oNnwo).
3. داخل مستودع (repository) الـ subgraph للمشروع الرئيسي ، قم بمصادقة الـ subgraph للنشر والبناء على الاستوديو:

```sh
graph auth --studio <DEPLOY_KEY>
```

4. أنشئ الملفات وقم ببناء الـ subgraph:

```sh
graph codegen && graph build
```

5. انشر الـ subgraph في الاستوديو. يمكنك العثور على`<SUBGRAPH_SLUG>` الخاص بك في واجهة مستخدم الـ Studio ، والذي يعتمد على اسم الـ subgraph الخاص بك.

```sh
 graph deploy --studio <SUBGRAPH_SLUG>
```

6. قم باختبار الاستعلامات في Studio's playground. فيما يلي بعض الأمثلة لـ [Sushi - Mainnet Exchange Subgraph](https://thegraph.com/explorer/subgraph?id=0x4bb4c1b0745ef7b4642feeccd0740dec417ca0a0-0&view=Playground):

```sh
{
  users(first: 5) {
    id
    liquidityPositions {
      id
    }
  }
  bundles(first: 5) {
    id
    ethPrice
  }
}
```

7. املأ الوصف والتفاصيل الخاصة بالـ subgraph الخاص بك واختر ما يصل إلى 3 فئات. وقم برفع صورة المشروع في الاستوديو إذا كنت ترغب في ذلك.
8. انشر الـ subgraph على شبكة The Graph بالضغط على زر "Publish".

- تذكر أن النشر هو إجراء on-chain وسيتطلب دفع ثمن الغاز كـ Ethereum - انظر مثال لإجراء [ هنا ](https://etherscan.io/tx/0xd0c3fa0bc035703c9ba1ce40c1862559b9c5b6ea1198b3320871d535aa0de87b). الأسعار حوالي 0.0425 ETH عند 100 gwei.
- في أي وقت تحتاج فيه إلى ترقية الـ subgraph الخاص بك ، ستدفع رسوم الترقية. تذكر أن الترقية هي مجرد نشر إصدار آخر من subgraph on-chain موجود. ولأن هذا ينطوي على تكلفة ، فيوصى بشدة بنشر واختبار الـ subgraph الخاص بك على Rinkeby قبل النشر على mainnet. في بعض الحالات ، قد تتطلب أيضا بعض GRT إذا لم تكن هناك إشارة على هذا الـ subgraph. وفي حالة وجود إشارة / تنسيق في إصدار هذا الـ subgraph (باستخدام الترحيل التلقائي) ، سيتم تقسيم الضرائب.

وهذا كل شيء! بعد الانتهاء من النشر ، ستتمكن من رؤية الـ subgraphs الخاص بك على الشبكة عبر [The Graph Explorer](https://thegraph.com/explorer).

لا تتردد في الاستفادة من [ قناة Curators# ](https://discord.gg/rC8rBuRtbH) على Discord لإعلام المنسقين (Curators) بأن الـ subgraph الخاص بك جاهز للإشارة إليه. وسيكون من المفيد أيضا أن تشارك حجم الاستعلام المتوقع معهم. بالتالي، يمكنهم تقدير مقدار GRT الذي يجب أن يشيروا إليه في الـ subgraph الخاص بك.

### ترقية Subgraph على الشبكة

إذا كنت ترغب في ترقية subgraph موجود على الشبكة ، فيمكنك القيام بذلك عن طريق نشر إصدار جديد من الـ subgraph الخاص بك على Subgraph Studio باستخدام Graph CLI.

1. قم بإجراء تغييرات على الـ subgraph الحالي الخاص بك. إنها لفكرة جيدة أن تقوم باختبار الإصلاحات الصغيرة في Subgraph Studio بالنشر على Rinkeby.
2. انشر ما يلي وحدد الإصدار الجديد في الأمر (مثل v0.0.1 ، v0.0.2 ، إلخ):

```sh
graph deploy --studio <SUBGRAPH_SLUG>
```

3. اختبر الإصدار الجديد في Subgraph Studio من خلال الاستعلام في الـ playground
4. انشر الإصدار الجديد على شبكة The Graph. تذكر أن هذا يتطلب غاز (كما هو موضح في القسم أعلاه).

### رسوم ترقية المالك

الترقية تتطلب ترحيل GRT من الإصدار القديم للـ subgraph إلى الإصدار الجديد. وهذا يعني أنه لكل ترقية ، سيتم إنشاء منحنى ربط جديد (للمزيد عن منحنيات الترابط [ هنا ](/network/curating#bonding-curve-101)).

يفرض منحنى الترابط الجديد ضريبة تنسيق 2.5٪ على جميع GRT التي يتم ترحيلها إلى الإصدار الجديد. يجب على المالك دفع 50٪ من هذا أو 1.25٪. علما أن 1.25٪ المتبقية يتم استحواذها من قبل جميع المنسقين كرسوم. وتم وضع هذا التصميم لمنع مالك الـ subgraph من استنزاف جميع أموال المنسقين من خلال استدعاءات الترقية المتكررة. إذا لم يكن هناك نشاط تنسيق ، فسيتعين عليك دفع 100 GRT كحد أدنى للإشارة إلى الـ subgraph الخاص بك.

كمثال على ذلك ، هذه هي الحالة فقط إذا كان الـ subgraph الخاص بك يتم تنسيقه بشكل نشط:

- تتم الإشارة بـ 100،000 GRT باستخدام الترحيل التلقائي في v1 لـ subgraph
- المالك يقوم بالترقية إلى v2. يتم ترحيل 100،000 GRT إلى منحنى ربط جديد ، حيث يتم وضع 97،500 GRT في المنحنى الجديد وحرق 2،500 GRT
- ثم قام المالك بحرق 1250 GRT لدفع نصف الرسوم. يجب أن يملك المالك ذلك في محفظته قبل الترقية ، وإلا فلن تنجح الترقية. يحدث هذا في نفس إجراء الترقية.

_بينما تتم هذه الآلية حاليا على الشبكة ، يناقش المجتمع حاليا طرقا لتقليل تكلفة الترقيات لمطوري الـ subgraph._

### الحفاظ على إصدار مستقر من Subgraph

إذا كنت تقوم بإجراء الكثير من التغييرات على الـ subgraph الخاص بك ، فليس من الجيد ترقيته باستمرار والتعرض لتكاليف الترقية. ويعد الاحتفاظ بإصدار مستقر من الـ subgraph أمرًا بالغ الأهمية ، ليس فقط من منظور التكلفة ، ولكن أيضًا حتى يشعر المفهرسون بالثقة في أوقات المزامنة. يجب وضع علامة (flag) على المفهرسين عندما تنوي الترقية بحيث لا تتأثر أوقات مزامنة المفهرس. لا تتردد في الاستفادة من قناة [ Indexers# ](https://discord.gg/rC8rBuRtbH) على Discord للسماح للمفهرسين بمعرفة متى تقوم بإنشاء إصدارات لـ subgraphs الخاص بك.

الـ Subgraphs عبارة عن APIs مفتوحة يستخدمها المطورون الخارجيون. تحتاج APIs المفتوحة إلى اتباع معايير صارمة حتى لا تتسبب في تعطيل تطبيقات المطورين الخارجيين. وفي شبكة The Graph ، يجب على مطور الـ subgraph أخذ المفهرسين بعين الاعتبار والوقت المستغرق لمزامنة الـ subgraph الجديد ** بالإضافة إلى ** المطورين الآخرين الذين يستخدمون الـ subgraphs الخاصة بهم.

### تحديث البيانات الوصفية (Metadata) لـ Subgraph

يمكنك تحديث البيانات الوصفية لـ subgraphs الخاص بك دون الحاجة إلى نشر إصدار جديد. تتضمن البيانات الوصفية اسم الـ subgraph والصورة والوصف و URL لموقع الويب و URL كود المصدر والفئات. يمكن للمطورين القيام بذلك عن طريق تحديث تفاصيل الـ subgraph الخاصة بهم في Subgraph Studio حيث يمكنك تعديل جميع الحقول الملائمة.

تأكد من تحديد **Update Subgraph Details in Explorer** وانقر على **Save**. إذا تم تحديد هذا الخيار ، فسيتم إنشاء إجراء on-chain والتي تقوم بتحديث تفاصيل الـ subgraph في Explorer دون الحاجة إلى نشر(publish) إصدار جديد عند قيامك بنشر(deployment) جديد.

## أفضل الممارسات لنشر Subgraph على شبكة The Graph

1. الاستفادة من اسم ENS لتطوير الـ Subgraph:

- قم بإعداد ENS الخاص بك [https://app.ens.domains/](https://app.ens.domains/)
- أضف اسم ENS الخاص بك إلى إعداداتك [هنا](https://thegraph.com/explorer/settings?view=display-name).

2. كلما تم ملء البروفايل الخاص بك ، كلما زادت فرص فهرسة الـ subgraphs الخاصة بك وتنسيقها.

## إيقاف Subgraph على شبكة The Graph

اتبع الخطوات [هنا](/managing/deprecating-a-subgraph) لإيقاف الـ subgraph الخاص بك وإزالته من شبكة The Graph.

## الاستعلام عن Subgraph + الفوترة على شبكة The Graph

تم إعداد الخدمة المستضافة (Hosted Service) للسماح للمطورين بنشر الـ subgraphs الخاصة بهم دون أي قيود.

لكي تصبح شبكة The Graph لا مركزية حقًا ، يجب دفع رسوم الاستعلام كجزء أساسي من حوافز البروتوكول. لمزيد من المعلومات حول الاشتراك في APIs ودفع رسوم الاستعلام ، راجع وثائق الفوترة [ هنا ](/querying/billing).

### تقدير رسوم الاستعلام على الشبكة

على الرغم من أن هذه ليست ميزة موجودة في واجهة مستخدم المنتج ، إلا أنه يمكنك تعيين الحد الأقصى لميزانيتك لكل استعلام وذلك عن طريق أخذ المبلغ الذي ترغب في دفعه شهريًا وتقسيمه على حجم الاستعلام المتوقع.

أثناء اتخاذ قرار بشأن ميزانية الاستعلام الخاصة بك ، ليس هناك ما يضمن أن المفهرس سيكون على استعداد لتقديم الاستعلامات بهذا السعر. إذا تمكن الـ Gateway من مطابقتك مع مفهرس يرغب في تقديم استعلام بالسعر الذي ترغب في دفعه أو أقل ، فستدفع الفرق بين ميزانيتك **و** سعرهم. ونتيجة لذلك ، فإن سعر الاستعلام المنخفض يقلل من عدد المفهرسين المتاحين لك ، مما قد يؤثر على جودة الخدمة التي تتلقاها. من المفيد أن يكون لديك رسوم استعلام مرتفع ، لأن ذلك قد يجذب التنسيق وأسماء كبيرة من المفهرسين إلى الـ subgraph الخاص بك.

تذكر أنه سوق ديناميكي ومتنامي ، ولكن كيفية تفاعلك معه هو تحت سيطرتك. لا يوجد حد أقصى أو أدنى للسعر في البروتوكول أو البوابات(Gateways). على سبيل المثال ، يمكنك إلقاء نظرة أدناه على السعر الذي دفعه عدد قليل من الـ dapps على الشبكة (على أساس أسبوعي). انظر للعمود الأخير ، والذي يعرض رسوم الاستعلام كـ GRT. على سبيل المثال ، [Pickle Finance](https://www.pickle.finance/) لديه 8 طلبات في الثانية ودفع 2.4 GRT لأسبوع واحد.

![رسوم الاستعلام](/img/QueryFee.png)

## مصادر إضافية

إذا كنت لا تزال في حيرة من أمرك ، فلا تخف! راجع المصادر التالية أو شاهد الفيديو الخاص بنا حول ترحيل الـ subgraphs إلى الشبكة اللامركزية أدناه:

<figure className="video-container">
  <iframe
    className="video-iframe"
    src="https://www.youtube.com/embed/CzdQ3dFFrjo"
    title="مشغل فيديو يوتيوب"
    frameBorder="0"
    allowFullScreen
  ></iframe>
</figure>

- [عقود شبكة The Graph](https://github.com/graphprotocol/contracts)
- [ عقد التنسيق](https://github.com/graphprotocol/contracts/blob/dev/contracts/curation/Curation.sol) - العقد الأساسي الذي تلتف حوله GNS
  - العنوان - `0x8fe00a685bcb3b2cc296ff6ffeab10aca4ce1538`
- [وثائق Subgraph Studio](/deploying/subgraph-studio)
