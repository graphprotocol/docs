---
title: å•å…ƒæµ‹è¯•æ¡†æ¶
---

Matchstickæ˜¯ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œç”±[LimeChain](https://limechain.tech/)å¼€å‘ï¼Œä½¿å­å›¾å¼€å‘è€…èƒ½å¤Ÿåœ¨æ²™ç›’ç¯å¢ƒä¸­æµ‹è¯•ä»–ä»¬çš„æ˜ å°„é€»è¾‘ï¼Œå¹¶æ”¾å¿ƒåœ°éƒ¨ç½²ä»–ä»¬çš„å­å›¾

æŒ‰ç…§

Matchstickå®‰è£…æŒ‡å—/a>å®‰è£…ï¼Œç°åœ¨ï¼Œä½ å¯ä»¥ç»§ç»­ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ªå•å…ƒæµ‹è¯•ã€‚</p> 



## ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•

è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„å•å…ƒæµ‹è¯•ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Œä½¿ç”¨Gravatar[å®ä¾‹å­å›¾](https://github.com/graphprotocol/example-subgraph)ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹å¤„ç†å‡½æ•°ï¼ˆè¿˜æœ‰ä¸¤ä¸ªè¾…åŠ©å‡½æ•°ï¼Œä½¿æˆ‘ä»¬çš„æ“ä½œæ›´å®¹æ˜“ï¼‰ã€‚



```javascript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress))
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```


æˆ‘ä»¬é¦–å…ˆè¦åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ã€‚æˆ‘ä»¬é€‰æ‹©çš„åå­—æ˜¯`gravity.test.ts`ã€‚åœ¨è¿™ä¸ªæ–°åˆ›å»ºçš„æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªåä¸º `runTests()`çš„å‡½æ•°ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°è¦æœ‰è¿™ä¸ªç¡®åˆ‡çš„åå­—ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜æˆ‘ä»¬çš„æµ‹è¯•å¯èƒ½çœ‹èµ·æ¥åƒä»€ä¹ˆã€‚



```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

export function runTests(): void {
  test('Can call mappings with custom events', () => {
    // Initialise
    let gravatar = new Gravatar('gravatarId0')
    gravatar.save()

    // Call mappings
    let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

    let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

    handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

    assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
    assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
    assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

    clearStore()
  })

  test('Next test', () => {
    //...
  })
}
```


è¿™æœ‰å¾ˆå¤šä¸œè¥¿è¦è§£å¼€! é¦–å…ˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä»`matchstick-as`å¯¼å…¥äº†ä¸€äº›ä¸œè¥¿ï¼Œ [è¿™](https://github.com/LimeChain/matchstick-as)æ˜¯æˆ‘ä»¬çš„AssemblyScriptè¾…åŠ©åº“ï¼ˆä»¥npmæ¨¡å—å½¢å¼å‘å¸ƒï¼‰ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è¿™ä¸ªåº“ã€‚ `matchstick-as`ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰ç”¨çš„æµ‹è¯•æ–¹æ³•ï¼Œè¿˜å®šä¹‰äº†</code>test()</code> å‡½æ•°ï¼Œæˆ‘ä»¬å°†ç”¨å®ƒæ¥æ„å»ºæˆ‘ä»¬çš„æµ‹è¯•å—ã€‚å…¶ä½™çš„éƒ¨åˆ†éå¸¸ç®€å•--ä¸‹é¢æ˜¯å‘ç”Ÿçš„æƒ…å†µã€‚

- æˆ‘ä»¬æ­£åœ¨è®¾ç½®æˆ‘ä»¬çš„åˆå§‹çŠ¶æ€å¹¶æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„Gravatarå®ä½“ã€‚
- æˆ‘ä»¬ä½¿ç”¨`createNewGravatarEvent()`å‡½æ•°å®šä¹‰äº†ä¸¤ä¸ª`NewGravatar`äº‹ä»¶å¯¹è±¡ä»¥åŠå®ƒä»¬çš„æ•°æ®ã€‚
- æˆ‘ä»¬æ­£åœ¨ä¸ºè¿™äº›äº‹ä»¶è°ƒç”¨å¤„ç†æ–¹æ³•-`-handleNewGravatars()`ï¼Œå¹¶ä¼ å…¥æˆ‘ä»¬çš„è‡ªå®šä¹‰äº‹ä»¶åˆ—è¡¨ã€‚
- æˆ‘ä»¬æ–­è¨€å•†åº—çš„çŠ¶æ€ã€‚é‚£æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ- æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå®ä½“ç±»å‹å’ŒIDçš„å”¯ä¸€ç»„åˆã€‚ç„¶åæˆ‘ä»¬æ£€æŸ¥è¯¥å®ä½“çš„ä¸€ä¸ªç‰¹å®šå­—æ®µï¼Œå¹¶æ–­è¨€å®ƒå…·æœ‰æˆ‘ä»¬æœŸæœ›çš„å€¼ã€‚æˆ‘ä»¬ä¸ºæˆ‘ä»¬æ·»åŠ åˆ°å•†åº—çš„åˆå§‹Gravatarå®ä½“ï¼Œä»¥åŠå½“å¤„ç†å‡½æ•°è¢«è°ƒç”¨æ—¶è¢«æ·»åŠ çš„ä¸¤ä¸ªGravatarå®ä½“éƒ½åšè¿™ä¸ªã€‚
- æœ€å--æˆ‘ä»¬ç”¨`clearStore()`æ¸…ç†å­˜å‚¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªæµ‹è¯•å°±å¯ä»¥ä»ä¸€ä¸ªæ–°é²œçš„ç©ºå­˜å‚¨å¯¹è±¡å¼€å§‹ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä»»æ„å¤šçš„æµ‹è¯•å—ã€‚

æˆ‘ä»¬å¼€å§‹å§--æˆ‘ä»¬å·²ç»åˆ›å»ºäº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•! ğŸ‘

â— **é‡è¦:** _ä¸ºäº†ä½¿æµ‹è¯•å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„æ˜ å°„æ–‡ä»¶ä¸­å¯¼å‡º`runTests()`å‡½æ•°ã€‚å®ƒä¸ä¼šåœ¨é‚£é‡Œè¢«ä½¿ç”¨ï¼Œä½†å¯¼å‡ºè¯­å¥å¿…é¡»åœ¨é‚£é‡Œï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åœ¨ä»¥åè¿è¡Œæµ‹è¯•æ—¶è¢«Rustæ¥æ”¶åˆ°ã€‚_

ä½ å¯ä»¥åƒè¿™æ ·åœ¨ä½ çš„æ˜ å°„æ–‡ä»¶ä¸­å¯¼å‡ºæµ‹è¯•åŒ…è£…å‡½æ•°ã€‚



```
export { runTests } from "../tests/gravity.test.ts";
```


â— **é‡è¦:** _ç›®å‰åœ¨éƒ¨ç½²å­å›¾æ—¶ä½¿ç”¨ Matchstick å­˜åœ¨é—®é¢˜ã€‚ è¯·ä»…ä½¿ç”¨ Matchstick è¿›è¡Œæœ¬åœ°æµ‹è¯•ï¼Œå¹¶åœ¨å®Œæˆååˆ é™¤/æ³¨é‡Šæ‰è¿™ä¸€è¡Œï¼ˆ`export { runTests } from "../tests/gravity.test.ts"`ï¼‰ã€‚ æˆ‘ä»¬å¸Œæœ›å°½å¿«è§£å†³æ­¤é—®é¢˜ï¼Œç»™æ‚¨å¸¦æ¥çš„ä¸ä¾¿æ•¬è¯·è°…è§£ï¼_

_å¦‚æœæ‚¨ä¸åˆ é™¤è¯¥è¡Œï¼Œæ‚¨å°†åœ¨å°è¯•éƒ¨ç½²å­å›¾æ—¶æ”¶åˆ°ä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼š_



```
/...
Mapping terminated before handling trigger: oneshot canceled
.../
```


ç°åœ¨ï¼Œä¸ºäº†è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ï¼Œæ‚¨åªéœ€åœ¨å­å›¾æ ¹æ–‡ä»¶å¤¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

`graph test Gravity`

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨åº”è¯¥ä¼šæ”¶åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š

![Matchstick saying â€œAll tests passed!â€](/img/matchstick-tests-passed.png)



## å¸¸è§çš„æµ‹è¯•åœºæ™¯



### ç”¨æŸç§çŠ¶æ€ç»™å•†åº—è¡¥å……

ç”¨æˆ·èƒ½å¤Ÿç”¨ä¸€ç»„å·²çŸ¥çš„å®ä½“æ¥ç»™å•†åº—æ³¨å…¥æ°´ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨Gravatarå®ä½“åˆå§‹åŒ–å•†åº—çš„ä¾‹å­ã€‚



```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```




### ç”¨ä¸€ä¸ªäº‹ä»¶è°ƒç”¨ä¸€ä¸ªæ˜ å°„å‡½æ•°

ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ä¸å•†åº—ç»‘å®šçš„æ˜ å°„å‡½æ•°ã€‚



```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```




### ç”¨äº‹ä»¶å¤¹å…·è°ƒç”¨æ‰€æœ‰çš„æ˜ å°„å…³ç³»

ç”¨æˆ·å¯ä»¥ç”¨æµ‹è¯•å¤¹å…·è°ƒç”¨è¿™äº›æ˜ å°„ã€‚



```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```




```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```




### æ¨¡æ‹Ÿåˆçº¦è°ƒç”¨

ç”¨æˆ·å¯ä»¥æ¨¡æ‹Ÿåˆçº¦è°ƒç”¨ï¼š



```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```


å¦‚å›¾æ‰€ç¤ºï¼Œä¸ºäº†æ¨¡æ‹Ÿåˆçº¦è°ƒç”¨å’Œç¡¬æ ¸è¿”å›å€¼ï¼Œç”¨æˆ·å¿…é¡»æä¾›åˆçº¦åœ°å€ã€å‡½æ•°åç§°ã€å‡½æ•°ç­¾åã€å‚æ•°æ•°ç»„ï¼Œå½“ç„¶è¿˜æœ‰è¿”å›å€¼ã€‚

Users can also mock function reverts:



```typescript
let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
  .withArgs([ethereum.Value.fromAddress(contractAddress)])
  .reverts()
```




### æ–­è¨€ store çš„çŠ¶æ€

ç”¨æˆ·å¯ä»¥é€šè¿‡æ–­è¨€å®ä½“æ–­è¨€å•†åº—çš„æœ€ç»ˆï¼ˆæˆ–ä¸­é—´ï¼‰çŠ¶æ€ã€‚ ä¸ºæ­¤ï¼Œç”¨æˆ·å¿…é¡»æä¾›å®ä½“ç±»å‹ã€å®ä½“çš„ç‰¹å®š IDã€å®ä½“ä¸Šçš„å­—æ®µåç§°ä»¥åŠå­—æ®µçš„é¢„æœŸå€¼ã€‚ è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š



```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```


è¿è¡Œ assert.fieldEquals() å‡½æ•°å°†æ£€æŸ¥ç»™å®šå­—æ®µä¸ç»™å®šé¢„æœŸå€¼çš„ç›¸ç­‰æ€§ã€‚ å¦‚æœå€¼**ä¸**ç›¸ç­‰ï¼Œæµ‹è¯•å°†å¤±è´¥å¹¶è¾“å‡ºé”™è¯¯æ¶ˆæ¯ã€‚ å¦åˆ™æµ‹è¯•å°†æˆåŠŸé€šè¿‡ã€‚



### ä¸äº‹ä»¶å…ƒæ•°æ®äº¤äº’

ç”¨æˆ·å¯ä»¥ä½¿ç”¨é»˜è®¤çš„äº¤æ˜“å…ƒæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ `newMockEvent()` å‡½æ•°å°†å…¶ä½œä¸º ethereum.Event è¿”å›ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•è¯»å–/å†™å…¥ Event å¯¹è±¡ä¸Šçš„è¿™äº›å­—æ®µï¼š



```typescript
// Read
let logType = newGravatarEvent.logType

// Write
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```




### æ–­è¨€å˜é‡ç›¸ç­‰



```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```




### æ–­è¨€å®ä½“**ä¸**åœ¨å•†åº—ä¸­

ç”¨æˆ·å¯ä»¥æ–­è¨€å•†åº—ä¸­ä¸å­˜åœ¨å®ä½“ã€‚ è¯¥å‡½æ•°é‡‡ç”¨å®ä½“ç±»å‹å’Œ idã€‚ å¦‚æœå®ä½“å®é™…ä¸Šåœ¨å•†åº—ä¸­ï¼Œåˆ™æµ‹è¯•å°†å¤±è´¥å¹¶æ˜¾ç¤ºç›¸å…³é”™è¯¯æ¶ˆæ¯ã€‚ ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨æ­¤åŠŸèƒ½çš„å¿«é€Ÿç¤ºä¾‹ï¼š



```typescript
assert.notInStore('Gravatar', '23')
```




### æ—¥å¿—è¾“å‡ºä¸­çš„æµ‹è¯•è¿è¡ŒæŒç»­æ—¶é—´

æ—¥å¿—è¾“å‡ºåŒ…æ‹¬æµ‹è¯•è¿è¡ŒæŒç»­æ—¶é—´ã€‚ è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

`Jul 09 14:54:42.420 INFO Program execution time: 10.06022ms`



## åé¦ˆ

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ã€åé¦ˆã€åŠŸèƒ½è¯·æ±‚æˆ–åªæ˜¯æƒ³ä¸æˆ‘ä»¬è”ç³»ï¼Œæœ€å¥½çš„åœ°æ–¹æ˜¯ The Graph Discordï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸“é—¨çš„ Matchstick é¢‘é“ï¼Œåä¸º ğŸ”¥| å•å…ƒæµ‹è¯•ã€‚
