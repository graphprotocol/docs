---
title: HÆ°á»›ng dáº«n Di chuyá»ƒn AssemblyScript
---

Cho Ä‘áº¿n nay, cÃ¡c subgraph Ä‘ang sá»­ dá»¥ng má»™t trong cÃ¡c [phiÃªn báº£n Ä‘áº§u tiÃªn cá»§a AssemblyScript](https://github.com/AssemblyScript/assemblyscript/tree/v0.6) (v0.6). Cuá»‘i cÃ¹ng, chÃºng tÃ´i Ä‘Ã£ thÃªm há»— trá»£ cho [báº£n má»›i nháº¥t hiá»‡n cÃ³](https://github.com/AssemblyScript/assemblyscript/tree/v0.19.10) (v0.19.10)! ğŸ‰

Äiá»u Ä‘Ã³ sáº½ cho phÃ©p cÃ¡c nhÃ  phÃ¡t triá»ƒn subgrap sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng má»›i hÆ¡n cá»§a ngÃ´n ngá»¯ AS vÃ  thÆ° viá»‡n chuáº©n.

HÆ°á»›ng dáº«n nÃ y cÃ³ thá»ƒ Ã¡p dá»¥ng cho báº¥t ká»³ ai sá»­ dá»¥ng `graph-cli`/`graph-ts` dÆ°á»›i phiÃªn báº£n `0.22.0`. Náº¿u báº¡n Ä‘Ã£ á»Ÿ phiÃªn báº£n cao hÆ¡n (hoáº·c báº±ng) vá»›i phiÃªn báº£n Ä‘Ã³, báº¡n Ä‘Ã£ sá»­ dá»¥ng phiÃªn báº£n`0.19.10` cá»§a AssemblyScript ğŸ™‚

> LÆ°u Ã½: Ká»ƒ tá»« `0.24.0`, `graph-node` cÃ³ thá»ƒ há»— trá»£ cáº£ hai phiÃªn báº£n, tÃ¹y thuá»™c vÃ o `apiVersion` Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong tá»‡p kÃª khai subgraph.

## CÃ¡c Ä‘áº·c Ä‘iá»ƒm

### Chá»©c nÄƒng má»›i

- `TypedArray`s bÃ¢y giá» cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ¢y dá»±ng tá»« `ArrayBuffer`s báº±ng cÃ¡ch sá»­ dá»¥ng [phÆ°Æ¡ng phÃ¡p tÄ©nh `wrap` má»›i](https://www.assemblyscript.org/stdlib/typedarray.html#static-members) ([v0.8.1](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.8.1))
- CÃ¡c chá»©c nÄƒng thÆ° viá»‡n tiÃªu chuáº©n má»›i: `String#toUpperCase`, `String#toLowerCase`, `String#localeCompare`and `TypedArray#set` ([v0.9.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.9.0))
- ÄÃ£ thÃªm há»— trá»£ cho x instanceof GenericClass ([v0.9.2](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.9.2))
- ÄÃ£ thÃªm `StaticArray<T>`, má»™t biáº¿n thá»ƒ máº£ng hiá»‡u quáº£ hÆ¡n ([v0.9.3](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.9.3))
- ÄÃ£ thÃªm `Array<T>#flat` ([v0.10.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.10.0))
- ÄÃ£ thá»±c hiá»‡n Ä‘á»‘i sá»‘ `radix` trÃªn `Number#toString` ([v0.10.1](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.10.1))
- ÄÃ£ thÃªm há»— trá»£ cho dáº¥u phÃ¢n cÃ¡ch trong cÃ¡c kÃ½ tá»± dáº¥u pháº©y Ä‘á»™ng ([v0.13.7](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.13.7))
- ÄÃ£ thÃªm há»— trá»£ cho cÃ¡c chá»©c nÄƒng háº¡ng nháº¥t ([v0.14.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.14.0))
- ThÃªm ná»™i trang: `i32/i64/f32/f64.add/sub/mul` ([v0.14.13](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.14.13))
- Thá»±c hiá»‡n `Array/TypedArray/String#at` ([v0.18.2](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.18.2))
- ÄÃ£ thÃªm há»— trá»£ cho chuá»—i kÃ½ tá»± máº«u ([v0.18.17](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.18.17))
- ThÃªm `encodeURI(Component)` vÃ  `decodeURI(Component)` ([v0.18.27](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.18.27))
- ThÃªm `toString`, `toDateString` vÃ  `toTimeString` vÃ o `Date` ([v0.18.29](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.18.29))
- ThÃªm `toUTCString` cho `Date` ([v0.18.30](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.18.30))
- ThÃªm loáº¡i ná»™i trang `nonnull/NonNullable` ([v0.19.2](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.19.2))

### Tá»‘i Æ°u hÃ³a

- CÃ¡c chá»©c nÄƒng `Math` nhÆ° `exp`, `exp2`, `log`, `log2` vÃ  `pow` Ä‘Ã£ Ä‘Æ°á»£c thay tháº¿ báº±ng cÃ¡c biáº¿n thá»ƒ nhanh hÆ¡n ([v0.9.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.9.0))
- Tá»‘i Æ°u hÃ³a má»™t chÃºt `Math.mod` ([v0.17.1](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.17.1))
- LÆ°u vÃ o bá»™ nhá»› cache cÃ¡c truy cáº­p trÆ°á»ng khÃ¡c trong std Map vÃ  Set ([v0.17.8](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.17.8))
- Tá»‘i Æ°u hÃ³a cho sá»©c máº¡nh cá»§a hai trong `ipow32/64` ([v0.18.2](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.18.2))

### KhÃ¡c

- Kiá»ƒu cá»§a má»™t kÃ½ tá»± máº£ng bÃ¢y giá» cÃ³ thá»ƒ Ä‘Æ°á»£c suy ra tá»« ná»™i dung cá»§a nÃ³ ([v0.9.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.9.0))
- ÄÃ£ cáº­p nháº­t stdlib thÃ nh Unicode 13.0.0 ([v0.10.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.10.0))

## LÃ m tháº¿ nÃ o Ä‘á»ƒ nÃ¢ng cáº¥p?

1. Thay Ä‘á»•i `apiVersion` Ã¡nh xáº¡ cá»§a báº¡n trong `subgraph.yaml` thÃ nh `0.0.6`:

```yaml
...
dataSources:
  ...
    mapping:
      ...
      apiVersion: 0.0.6
      ...
```

2. Cáº­p nháº­t `graph-cli` báº¡n Ä‘ang sá»­ dá»¥ng thÃ nh phiÃªn báº£n `latest` báº±ng cÃ¡ch cháº¡y:

```bash
# náº¿u báº¡n Ä‘Ã£ cÃ i Ä‘áº·t nÃ³ trÃªn toÃ n cáº§u
npm install --global @graphprotocol/graph-cli@latest

# hoáº·c trong subgraph cá»§a báº¡n náº¿u báº¡n cÃ³ nÃ³ nhÆ° má»™t phá»¥ thuá»™c cá»§a nhÃ  phÃ¡t triá»ƒn
npm install --save-dev @graphprotocol/graph-cli@latest
```

3. LÃ m tÆ°Æ¡ng tá»± Ä‘á»‘i vá»›i `graph-ts`, nhÆ°ng thay vÃ¬ cÃ i Ä‘áº·t trÃªn toÃ n cáº§u, hÃ£y lÆ°u nÃ³ trong cÃ¡c pháº§n phá»¥ thuá»™c chÃ­nh cá»§a báº¡n:

```bash
npm install --save @graphprotocol/graph-ts@latest
```

4. LÃ m theo pháº§n cÃ²n láº¡i cá»§a hÆ°á»›ng dáº«n Ä‘á»ƒ sá»­a cÃ¡c thay Ä‘á»•i vá» lá»—i ngÃ´n ngá»¯.
5. Cháº¡y `codegen` vÃ  `deploy` láº¡i.

## Thay Ä‘á»•i Ä‘á»™t phÃ¡

### VÃ´ hiá»‡u

TrÃªn phiÃªn báº£n AssemblyScript cÅ© hÆ¡n, báº¡n cÃ³ thá»ƒ táº¡o mÃ£ nhÆ° sau:

```typescript
function load(): Value | null { ... }

let maybeValue = load();
maybeValue.aMethod();
```

Tuy nhiÃªn, trÃªn phiÃªn báº£n má»›i hÆ¡n, vÃ¬ giÃ¡ trá»‹ lÃ  nullable, nÃ³ yÃªu cáº§u báº¡n kiá»ƒm tra, nhÆ° sau:

```typescript
let maybeValue = load()

if (maybeValue) {
  maybeValue.aMethod() // `maybeValue` is not null anymore
}
```

Hoáº·c buá»™c nÃ³ nhÆ° tháº¿ nÃ y:

```typescript
let maybeValue = load()! // breaks in runtime if value is null

maybeValue.aMethod()
```

Náº¿u báº¡n khÃ´ng cháº¯c nÃªn chá»n cÃ¡i nÃ o, chÃºng tÃ´i khuyÃªn báº¡n nÃªn luÃ´n sá»­ dá»¥ng phiÃªn báº£n an toÃ n. Náº¿u giÃ¡ trá»‹ khÃ´ng tá»“n táº¡i, báº¡n cÃ³ thá»ƒ chá»‰ muá»‘n thá»±c hiá»‡n cÃ¢u lá»‡nh if sá»›m vá»›i tráº£ vá» trong trÃ¬nh xá»­ lÃ½ subgraph cá»§a báº¡n.

### Variable Shadowing (Che khuáº¥t Biáº¿n)

TrÆ°á»›c khi báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n [che biáº¿n](https://en.wikipedia.org/wiki/Variable_shadowing) vÃ  mÃ£ nhÆ° tháº¿ nÃ y sáº½ hoáº¡t Ä‘á»™ng:

```typescript
let a = 10
let b = 20
let a = a + b
```

Tuy nhiÃªn, bÃ¢y giá» Ä‘iá»u nÃ y khÃ´ng cÃ²n kháº£ thi ná»¯a vÃ  trÃ¬nh biÃªn dá»‹ch tráº£ vá» lá»—i nÃ y:

```typescript
ERROR TS2451: Cannot redeclare block-scoped variable 'a'

 let a = a + b;
 ~~~~~~~~~~~~~
in assembly/index.ts(4,3)
```
Báº¡n sáº½ cáº§n Ä‘á»•i tÃªn cÃ¡c biáº¿n trÃ¹ng láº·p cá»§a mÃ¬nh náº¿u báº¡n cÃ³ che biáº¿n.
### So sÃ¡nh Null
Báº±ng cÃ¡ch thá»±c hiá»‡n nÃ¢ng cáº¥p trÃªn subgraph cá»§a báº¡n, Ä‘Ã´i khi báº¡n cÃ³ thá»ƒ gáº·p cÃ¡c lá»—i nhÆ° sau:

```typescript
ERROR TS2322: Type '~lib/@graphprotocol/graph-ts/common/numbers/BigInt | null' is not assignable to type '~lib/@graphprotocol/graph-ts/common/numbers/BigInt'.
     if (decimals == null) {
                     ~~~~
 in src/mappings/file.ts(41,21)
```
Äá»ƒ giáº£i quyáº¿t, báº¡n cÃ³ thá»ƒ chá»‰ cáº§n thay Ä‘á»•i cÃ¢u lá»‡nh `if` thÃ nh má»™t cÃ¡i gÃ¬ Ä‘Ã³ nhÆ° sau:

```typescript
  if (!decimals) {

  // or

  if (decimals === null) {
```

Äiá»u tÆ°Æ¡ng tá»± cÅ©ng Ã¡p dá»¥ng náº¿u báº¡n Ä‘ang lÃ m != Thay vÃ¬ ==.

### Ã‰p kiá»ƒu (Casting)

CÃ¡ch phá»• biáº¿n Ä‘á»ƒ thá»±c hiá»‡n Ã©p kiá»ƒu trÆ°á»›c Ä‘Ã¢y lÃ  chá»‰ sá»­ dá»¥ng tá»« khÃ³a `as`, nhÆ° sau:

```typescript
let byteArray = new ByteArray(10)
let uint8Array = byteArray as Uint8Array // equivalent to: <Uint8Array>byteArray
```

Tuy nhiÃªn, Ä‘iá»u nÃ y chá»‰ hoáº¡t Ä‘á»™ng trong hai trÆ°á»ng há»£p:

- Ã‰p kiá»ƒu nguyÃªn báº£n (giá»¯a cÃ¡c kiá»ƒu nhÆ° `u8`, `i32`, `bool`; vÃ­ dá»¥: `let b: isize = 10; b as usize`);
- Upcasting vá» káº¿ thá»«a lá»›p (lá»›p con â†’ lá»›p cha) (subclass â†’ superclass)

CÃ¡c vÃ­ dá»¥:

```typescript
// primitive casting (Ã©p kiá»ƒu nguyÃªn báº£n)
let a: usize = 10
let b: isize = 5
let c: usize = a + (b as usize)
```

```typescript
// upcasting on class inheritance
class Bytes extends Uint8Array {}

let bytes = new Bytes(2)
// <Uint8Array>bytes // same as: bytes as Uint8Array
```

CÃ³ hai trÆ°á»ng há»£p mÃ  báº¡n cÃ³ thá»ƒ muá»‘n Ã©p kiá»ƒu, nhÆ°ng viá»‡c sá»­ dá»¥ng `as`/`<T>var` **khÃ´ng an toÃ n**:

- Downcasting vá» káº¿ thá»«a lá»›p (lá»›p con â†’ lá»›p cha) (subclass â†’ superclass)
- Giá»¯a hai loáº¡i chia sáº» lá»›p cha

```typescript
// downcasting on class inheritance
class Bytes extends Uint8Array {}

let uint8Array = new Uint8Array(2)
// <Bytes>uint8Array // breaks in runtime :(
```

```typescript
// between two types that share a superclass
class Bytes extends Uint8Array {}
class ByteArray extends Uint8Array {}

let bytes = new Bytes(2)
// <ByteArray>bytes // breaks in runtime :(
```

Äá»‘i vá»›i nhá»¯ng trÆ°á»ng há»£p Ä‘Ã³, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng hÃ m `changetype<T>`:

```typescript
// downcasting vá» káº¿ thá»«a lá»›p
class Bytes extends Uint8Array {}

let uint8Array = new Uint8Array(2)
changetype<Bytes>(uint8Array) // works :)
```

```typescript
// giá»¯a hai loáº¡i chia sáº» lá»›p cha
class Bytes extends Uint8Array {}
class ByteArray extends Uint8Array {}

let bytes = new Bytes(2)
changetype<ByteArray>(bytes) // works :)
```

Náº¿u báº¡n chá»‰ muá»‘n loáº¡i bá» kháº£ nÄƒng vÃ´ hiá»‡u, báº¡n cÃ³ thá»ƒ tiáº¿p tá»¥c sá»­ dá»¥ng toÃ¡n tá»­ `as` (hoáº·c `<T>variable`), nhÆ°ng hÃ£y Ä‘áº£m báº£o ráº±ng báº¡n biáº¿t ráº±ng giÃ¡ trá»‹ khÃ´ng Ä‘Æ°á»£c rá»—ng (null), náº¿u khÃ´ng nÃ³ sáº½ bá»‹ vá»¡.

```typescript
// loáº¡i bá» kháº£ nÄƒng vÃ´ hiá»‡u
let previousBalance = AccountBalance.load(balanceId) // AccountBalance | null

if (previousBalance != null) {
  return previousBalance as AccountBalance // safe remove null
}

let newBalance = new AccountBalance(balanceId)
```

Äá»‘i vá»›i trÆ°á»ng há»£p vÃ´ hiá»‡u, chÃºng tÃ´i khuyÃªn báº¡n nÃªn xem xÃ©t [tÃ­nh nÄƒng kiá»ƒm tra kháº£ nÄƒng vÃ´ hiá»‡u](https://www.assemblyscript.org/basics.html#nullability-checks), nÃ³ sáº½ giÃºp mÃ£ cá»§a báº¡n sáº¡ch hÆ¡n ğŸ™‚

NgoÃ i ra, chÃºng tÃ´i Ä‘Ã£ thÃªm má»™t vÃ i phÆ°Æ¡ng thá»©c tÄ©nh trong má»™t sá»‘ kiá»ƒu Ä‘á»ƒ dá»… dÃ ng Ã©p kiá»ƒu, chÃºng lÃ :

- Bytes.fromByteArray
- Bytes.fromUint8Array
- BigInt.fromByteArray
- ByteArray.fromBigInt

### Kiá»ƒm tra tÃ­nh vÃ´ hiá»‡u vá»›i quyá»n truy cáº­p thuá»™c tÃ­nh

Äá»ƒ sá»­ dá»¥ng [tÃ­nh nÄƒng kiá»ƒm tra tÃ­nh vÃ´ hiá»‡u](https://www.assemblyscript.org/basics.html#nullability-checks), báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¢u lá»‡nh `if` hoáº·c cÃ¢u lá»‡nh ba toÃ¡n tá»­ (`?` and `:`) nhÆ° tháº¿ nÃ y:

```typescript
let something: string | null = 'data'

let somethingOrElse = something ? something : 'else'

// hoáº·c

let somethingOrElse

if (something) {
  somethingOrElse = something
} else {
  somethingOrElse = 'else'
}
```

Tuy nhiÃªn, Ä‘iá»u Ä‘Ã³ chá»‰ hoáº¡t Ä‘á»™ng khi báº¡n Ä‘ang thá»±c hiá»‡n `if` / ternary trÃªn má»™t biáº¿n, khÃ´ng pháº£i trÃªn quyá»n truy cáº­p thuá»™c tÃ­nh, nhÆ° sau:

```typescript
class Container {
  data: string | null
}

let container = new Container()
container.data = 'data'

let somethingOrElse: string = container.data ? container.data : 'else' // khÃ´ng biÃªn dá»‹ch
```

Äáº§u ra lá»—i nÃ y:

```typescript
ERROR TS2322: Type '~lib/string/String | null' is not assignable to type '~lib/string/String'.

   let somethingOrElse: string = container.data ? container.data : "else";
                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
```
Äá»ƒ kháº¯c phá»¥c sá»± cá»‘ nÃ y, báº¡n cÃ³ thá»ƒ táº¡o má»™t biáº¿n cho quyá»n truy cáº­p thuá»™c tÃ­nh Ä‘Ã³ Ä‘á»ƒ trÃ¬nh biÃªn dá»‹ch cÃ³ thá»ƒ thá»±c hiá»‡n phÃ©p thuáº­t kiá»ƒm tra tÃ­nh nullability:

```typescript
class Container {
  data: string | null
}

let container = new Container()
container.data = 'data'

let data = container.data

let somethingOrElse: string = data ? data : 'else' // biÃªn dá»‹ch tá»‘t :)
```

### QuÃ¡ táº£i toÃ¡n tá»­ vá»›i quyá»n truy cáº­p thuá»™c tÃ­nh

Náº¿u báº¡n cá»‘ gáº¯ng tÃ­nh tá»•ng (vÃ­ dá»¥) má»™t kiá»ƒu nullable (tá»« quyá»n truy cáº­p thuá»™c tÃ­nh) vá»›i má»™t kiá»ƒu khÃ´ng thá»ƒ nullable, trÃ¬nh biÃªn dá»‹ch AssemblyScript thay vÃ¬ Ä‘Æ°a ra cáº£nh bÃ¡o lá»—i thá»i gian biÃªn dá»‹ch ráº±ng má»™t trong cÃ¡c giÃ¡ trá»‹ lÃ  nullable, nÃ³ chá»‰ biÃªn dá»‹ch Ã¢m tháº§m, táº¡o cÆ¡ há»™i Ä‘á»ƒ mÃ£ bá»‹ phÃ¡ vá»¡ trong thá»i gian cháº¡y.

```typescript
class BigInt extends Uint8Array {
  @operator('+')
  plus(other: BigInt): BigInt {
    // ...
  }
}

class Wrapper {
  public constructor(public n: BigInt | null) {}
}

let x = BigInt.fromI32(2)
let y: BigInt | null = null

x + y // give compile time error about nullability

let wrapper = new Wrapper(y)

wrapper.n = wrapper.n + x // doesn't give compile time errors as it should
```

ChÃºng tÃ´i Ä‘Ã£ giáº£i quyáº¿t váº¥n Ä‘á» trÃªn trÃ¬nh biÃªn dá»‹ch AssemblyScript cho váº¥n Ä‘á» nÃ y, nhÆ°ng hiá»‡n táº¡i náº¿u báº¡n thá»±c hiá»‡n cÃ¡c loáº¡i hoáº¡t Ä‘á»™ng nÃ y trong Ã¡nh xáº¡ subgraph cá»§a mÃ¬nh, báº¡n nÃªn thay Ä‘á»•i chÃºng Ä‘á»ƒ thá»±c hiá»‡n kiá»ƒm tra rá»—ng trÆ°á»›c nÃ³.

```typescript
let wrapper = new Wrapper(y)

if (!wrapper.n) {
  wrapper.n = BigInt.fromI32(0)
}

wrapper.n = wrapper.n + x // now `n` is guaranteed to be a BigInt
```

### Khá»Ÿi táº¡o giÃ¡ trá»‹

Náº¿u báº¡n cÃ³ báº¥t ká»³ mÃ£ nÃ o nhÆ° tháº¿ nÃ y:

```typescript
var value: Type // null
value.x = 10
value.y = 'content'
```

NÃ³ sáº½ biÃªn dá»‹ch nhÆ°ng bá»‹ há»ng trong thá»i gian cháº¡y, Ä‘iá»u Ä‘Ã³ xáº£y ra vÃ¬ giÃ¡ trá»‹ chÆ°a Ä‘Æ°á»£c khá»Ÿi táº¡o, vÃ¬ váº­y hÃ£y Ä‘áº£m báº£o ráº±ng subgraph cá»§a báº¡n Ä‘Ã£ khá»Ÿi táº¡o cÃ¡c giÃ¡ trá»‹ cá»§a chÃºng, nhÆ° sau:

```typescript
var value = new Type() // initialized
value.x = 10
value.y = 'content'
```

NgoÃ i ra, náº¿u báº¡n cÃ³ thuá»™c tÃ­nh nullable trong thá»±c thá»ƒ GraphQL, nhÆ° sau:

```graphql
type Total @entity {
  id: ID!
  amount: BigInt
}
```

VÃ  báº¡n cÃ³ mÃ£ tÆ°Æ¡ng tá»± nhÆ° sau:

```typescript
let total = Total.load('latest')

if (total === null) {
  total = new Total('latest')
}

total.amount = total.amount + BigInt.fromI32(1)
```

Báº¡n cáº§n Ä‘áº£m báº£o khá»Ÿi táº¡o giÃ¡ trá»‹ `total.amount`, bá»Ÿi vÃ¬ náº¿u báº¡n cá»‘ gáº¯ng truy cáº­p nhÆ° á»Ÿ dÃ²ng cuá»‘i cÃ¹ng cho tá»•ng, nÃ³ sáº½ bá»‹ lá»—i. VÃ¬ váº­y, báº¡n cÃ³ thá»ƒ khá»Ÿi táº¡o nÃ³ trÆ°á»›c:

```typescript
let total = Total.load('latest')

if (total === null) {
  total = new Total('latest')
  total.amount = BigInt.fromI32(0)
}

total.tokens = total.tokens + BigInt.fromI32(1)
```

Hoáº·c báº¡n chá»‰ cÃ³ thá»ƒ thay Ä‘á»•i lÆ°á»£c Ä‘á»“ GraphQL cá»§a mÃ¬nh Ä‘á»ƒ khÃ´ng sá»­ dá»¥ng kiá»ƒu nullable cho thuá»™c tÃ­nh nÃ y, sau Ä‘Ã³ chÃºng tÃ´i sáº½ khá»Ÿi táº¡o nÃ³ báº±ng 0 á»Ÿ bÆ°á»›c `codegen` ğŸ˜‰

```graphql
type Total @entity {
  id: ID!
  amount: BigInt!
}
```

```typescript
let total = Total.load('latest')

if (total === null) {
  total = new Total('latest') // already initializes non-nullable properties
}

total.amount = total.amount + BigInt.fromI32(1)
```

### Khá»Ÿi táº¡o thuá»™c tÃ­nh lá»›p

Náº¿u báº¡n xuáº¥t báº¥t ká»³ lá»›p nÃ o cÃ³ thuá»™c tÃ­nh lÃ  cÃ¡c lá»›p khÃ¡c (do báº¡n hoáº·c thÆ° viá»‡n chuáº©n khai bÃ¡o) nhÆ° tháº¿ nÃ y:

```typescript
class Thing {}

export class Something {
  value: Thing
}
```

TrÃ¬nh biÃªn dá»‹ch sáº½ bá»‹ lá»—i vÃ¬ báº¡n cáº§n thÃªm bá»™ khá»Ÿi táº¡o cho cÃ¡c thuá»™c tÃ­nh lÃ  cÃ¡c lá»›p hoáº·c thÃªm toÃ¡n tá»­ `!`:

```typescript
export class Something {
  constructor(public value: Thing) {}
}

// or

export class Something {
  value: Thing

  constructor(value: Thing) {
    this.value = value
  }
}

// or

export class Something {
  value!: Thing
}
```

### LÆ°á»£c Ä‘á»“ GraphQL

ÄÃ¢y khÃ´ng pháº£i lÃ  thay Ä‘á»•i AssemblyScript trá»±c tiáº¿p, nhÆ°ng báº¡n cÃ³ thá»ƒ pháº£i cáº­p nháº­t tá»‡p `schema.graphql` cá»§a mÃ¬nh.

Giá» Ä‘Ã¢y, báº¡n khÃ´ng cÃ²n cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c trÆ°á»ng thuá»™c loáº¡i Non-Nullable Lists cá»§a mÃ¬nh ná»¯a. Náº¿u báº¡n cÃ³ má»™t lÆ°á»£c Ä‘á»“ nhÆ° tháº¿ nÃ y:

```graphql
type Something @entity {
  id: ID!
}

type MyEntity @entity {
  id: ID!
  invalidField: [Something]! # no longer valid
}
```

Báº¡n sáº½ pháº£i thÃªm `!` vÃ o thÃ nh viÃªn cá»§a loáº¡i List, nhÆ° sau:

```graphql
type Something @entity {
  id: ID!
}

type MyEntity @entity {
  id: ID!
  invalidField: [Something!]! # valid
}
```

Äiá»u nÃ y Ä‘Ã£ thay Ä‘á»•i do sá»± khÃ¡c biá»‡t vá» tÃ­nh nullability giá»¯a cÃ¡c phiÃªn báº£n AssemblyScript vÃ  nÃ³ liÃªn quan Ä‘áº¿n tá»‡p `src/generated/schema.ts` (Ä‘Æ°á»ng dáº«n máº·c Ä‘á»‹nh, báº¡n cÃ³ thá»ƒ Ä‘Ã£ thay Ä‘á»•i Ä‘iá»u nÃ y).

### KhÃ¡c

- CÄƒn chá»‰nh `Map#set` vÃ  `Set#add` vá»›i thÃ´ng sá»‘ ká»¹ thuáº­t, tráº£ vá» `this` ([v0.9.2](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.9.2))
- Arrays khÃ´ng cÃ²n káº¿ thá»«a tá»« ArrayBufferView ná»¯a, mÃ  bÃ¢y giá» lÃ  phÃ¢n biá»‡t ([v0.10.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.10.0))
- CÃ¡c lá»›p Ä‘Æ°á»£c khá»Ÿi táº¡o tá»« cÃ¡c kÃ½ tá»± Ä‘á»‘i tÆ°á»£ng khÃ´ng cÃ²n cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh má»™t phÆ°Æ¡ng thá»©c khá»Ÿi táº¡o ná»¯a ([v0.10.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.10.0))
- Káº¿t quáº£ cá»§a phÃ©p toÃ¡n nhá»‹ phÃ¢n `**` bÃ¢y giá» lÃ  sá»‘ nguyÃªn máº«u sá»‘ chung náº¿u cáº£ hai toÃ¡n háº¡ng Ä‘á»u lÃ  sá»‘ nguyÃªn. TrÆ°á»›c Ä‘Ã¢y, káº¿t quáº£ lÃ  má»™t float nhÆ° thá»ƒ Ä‘ang gá»i `Math/f.pow` ([v0.11.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.11.0))
- Ã‰p buá»™c `NaN` thÃ nh `false` khi Ã©p kiá»ƒu thÃ nh `bool` ([v0.14.9](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.14.9))
- Khi dá»‹ch chuyá»ƒn má»™t giÃ¡ trá»‹ sá»‘ nguyÃªn nhá» cá»§a kiá»ƒu `i8`/`u8` hoáº·c `i16`/`u16`, chá»‰ 3 bit tÆ°Æ¡ng á»©ng 4 bit Ã­t quan trá»ng nháº¥t cá»§a giÃ¡ trá»‹ RHS áº£nh hÆ°á»Ÿng Ä‘áº¿n káº¿t quáº£, tÆ°Æ¡ng tá»± nhÆ° káº¿t quáº£ cá»§a má»™t `i32.shl` chá»‰ bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi 5 bit Ã­t quan trá»ng nháº¥t cá»§a giÃ¡ trá»‹ RHS. VÃ­ dá»¥: `someI8 << 8` trÆ°á»›c Ä‘Ã¢y Ä‘Ã£ táº¡o ra giÃ¡ trá»‹ `0`, nhÆ°ng bÃ¢y giá» táº¡o ra`someI8` do che dáº¥u RHS lÃ  `8 & 7 = 0` (3 bits) ([v0.17.0](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.17.0))
- Sá»­a lá»—i so sÃ¡nh chuá»—i quan há»‡ khi kÃ­ch thÆ°á»›c khÃ¡c nhau ([v0.17.8](https://github.com/AssemblyScript/assemblyscript/releases/tag/v0.17.8))
