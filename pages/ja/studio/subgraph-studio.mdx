---
title: Subgraph Studioの使い方
---

新しいローンチパッドへようこそ 👩🏽‍🚀

Subgraph Studio は、サブグラフを構築・作成し、メタデータを追加して、新しい分散型エクスプローラーに公開するための場所です（詳細は[こちら](/explorer)）

Subgraph Studio でできること

- Studio UI によるサブグラフの作成
- CLI を使用したサブグラフのデプロイ
- Studio UI でサブグラフを公開する
- プレイグラウンドでのテスト
- クエリ URL を使用してステージングに統合する
- 特定のサブグラフ用の API キーの作成と管理

Subgraph Studio では、サブグラフを完全にコントロールすることができます。サブグラフを公開する前にテストできるだけでなく、API キーを特定のドメインに限定したり、特定のインデクサに API キーからのクエリを許可したりすることもできます。

サブグラフへのクエリはクエリフィーを発生させ、グラフネットワーク上の[インデクサー](/indexing)への報酬とします。dapp の開発者やサブグラフの開発者は、この Studio を利用することで、より優れたサブグラフを構築し、自分やコミュニティのクエリを強化することができます。Studio は 5 つの主要部分で構成されています。

- ユーザーアカウントの管理
- 作成したサブグラフのリスト
- 特定のサブグラフのステータスを管理、詳細表示、視覚化するセクション
- サブグラフのクエリに必要な API キーを管理するセクション
- 請求書を管理するためのセクション

## アカウントの作成方法

1. お使いのウォレットでサインインします - MetaMask または WalletConnect で行うことができます。
1. サインインすると、アカウントのホームページに固有のデプロイキーが表示されます。これにより、サブグラフの公開や API キーと課金の管理を行うことができます。固有のデプロイキーは、漏洩したと思われる場合に再生成することができます。

## Subgraph Studio でサブグラフを作成する方法

一番のポイントです - 最初にサブグラフを作成する際には、以下の項目を入力するように指示されます:

- サブグラフネーム
- 画像
- 説明
- カテゴリー
- ウェブサイト

## Subgraph と The Graph Network の互換性

The Graph Network は、Hosted Service で利用可能なデータソースや機能のすべてに対応しているわけではありません。ネットワーク上のインデクサでサポートされるためには、サブグラフは以下の条件を満たす必要があります。

- メインネット Ethereum のインデックス
- 以下の機能のいずれも使用してはいけません:
  - ipfs.cat & ipfs.map
  - Non-fatal errors
  - Grafting

The Graph Network の機能やネットワークは順次追加されていきます。

### サブグラフのライフサイクルフロー

![サブグラフのライフサイクル](/img/subgraph-lifecycle.png)

サブグラフを作成した後は、[CLI](https://github.com/graphprotocol/graph-cli)（コマンドライン・インターフェース）を使ってデプロイすることができます。CLI でサブグラフをデプロイすると、そのサブグラフが Studio にプッシュされ、プレイグラウンドを使ってサブグラフをテストすることができます。これにより、最終的には Graph Network への公開が可能になります。CLI セットアップの詳細については、[こちら](/developer/define-subgraph-hosted#install-the-graph-cli)をご覧ください（pst、デプロイキーが手元にあることを確認してください）。なお、デプロイと公開は**同じではありません**。サブグラフをデプロイすると、それをスタジオにプッシュしてテストすることができます。一方、サブグラフを公開する場合は、オンチェーンで公開します。

## Subgraph Studio でのサブグラフのテスト

ネットワークに公開する前にサブグラフをテストしたい場合、Subgraph **Playground**でこれを行うか、ログを見ることができます。Subgraph のログは、サブグラフが失敗した場合に、**どこで**失敗したかを教えてくれます。

## Subgraph Studio でサブグラフを公開する

ここまで来ました - おめでとうございます。サブグラフの公開とは、CLI 内でサブグラフを展開した際に IPFS ハッシュが生成され、ネットワークの Ethereum スマートコントラクトに保存されることを意味します。サブグラフの公開を成功させるためには、この[ブログ](https://thegraph.com/blog/building-with-subgraph-studio)で紹介している以下のステップを踏む必要があります。以下のビデオ概要もチェックしてみてください。

<figure className="video-container">
  <iframe
    className="video-iframe"
    src="https://www.youtube.com/embed/HfDgC2oNnwo"
    title="YouTube ビデオプレイヤー"
    frameBorder="0"
    allowFullScreen
></iframe>
</figure>

公開する際には、メインネットまたはテストネットである Rinkeby のどちらかに公開することができます。初めてサブグラフを開発される方は、まず Rinkeby への公開から始めることをお勧めします。これにより、サブグラフが The Graph Explorer でどのように動作するかを確認することができ、キュレーション要素をテストすることができます。

メインネットのデータをインデックス化しているサブグラフのみがネットワークに公開できるため、メインネットからのデータのみをインデックス化することができます（サブグラフがテストネットに公開されていたとしても）。これは、インデクサが特定のブロック・ハッシュの時点で必須の Proof of Indexing レコードを提出する必要があるためです。サブグラフの公開はオンチェーンで行われるアクションであるため、トランザクションの実行には最大で数分かかることを覚えておいてください。コントラクトの公開に使用したアドレスは、将来のバージョンを公開できる唯一のアドレスとなります。賢い選択をしましょう

キュレーションシグナルを持つサブグラフは、分散型ネットワーク上でインデックスを作成できるようにインデクサーに表示されます。サブグラフとシグナルを 1 つのトランザクションで公開できるので、サブグラフの最初のキュレーションシグナルをミントすることができ、ガス代を節約することができます。また、キュレーターが後から提供するシグナルに自分のシグナルを加えることで、自分のサブグラフが最終的にクエリを提供する確率が高くなります。

**サブグラフの公開が完了したところで、次にサブグラフの定期的な管理方法について説明します。**同期に失敗したサブグラフは、ネットワークに公開できないことに注意してください。これは通常、サブグラフにバグがあるためで、ログを見ればどこに問題があるかがわかります。

## CLI によるサブグラフのバージョン管理

開発者は、さまざまな理由でサブグラフを更新したい場合があります。このような場合、CLI を使用してスタジオにサブグラフの新バージョンをデプロイし（この時点ではプライベートのみ）、新しいデプロイメントを The Graph Explorer に公開することができます。これにより、サブグラフの新しいバージョンが作成され、キュレーターはシグナリングを開始することができ、インデクサはこの新しいバージョンにインデックスを付けることができます。

最近まで、開発者はサブグラフのメタデータを更新するために、サブグラフの新バージョンをデプロイして「The Graph Explorer」に公開する必要がありました。今回、開発者は**新バージョンを公開することなく\*\***、サブグラフのメタデータを更新できるようになりました。開発者は、スタジオで「Update Details in The Graph Explorer」というオプションをチェックすることで、自分のサブグラフの\*\*詳細（プロフィール画像、名前、説明など）を更新することができます。これがチェックされると、オンチェーンのトランザクションが生成され、新しいデプロイメントで新しいバージョンを公開しなくても、エクスプローラーのサブグラフの詳細が更新されます。

なお、サブグラフの新バージョンをネットワークに公開する際には、コストがかかります。トランザクション手数料に加えて、開発者は自動移行するシグナルにかかるキュレーション税の一部を賄う必要があります。キュレーターがシグナルを出していない場合、サブグラフの新バージョンを公開することはできません。キュレーションのリスクについて、詳しくは[こちら](/curating)をご覧ください。

### サブグラフのバージョンの自動アーカイブ

Subgraph Studio で新しいサブグラフのバージョンを展開すると、以前のバージョンがアーカイブされます。アーカイブされたバージョンはインデックス/同期されず、したがってクエリできません。Studio UI でサブグラフのアーカイブされたバージョンをアンアーカイブすることができます。スタジオにデプロイされた非公開のサブグラフの前のバージョンは、自動的にアーカイブされることに注意してください。

![Subgraph Studio - Unarchive](/img/Unarchive.png)

## API キーの管理

Dapp 開発者、サブグラフ開発者に関わらず、API キーを管理する必要があります。API キーは、アプリケーションサービス間の接続が有効で認証されていることを確認するため、サブグラフを照会できるようにするために重要です。これには、アプリケーションを使用するエンドユーザとデバイスの認証が含まれます。

スタジオでは、既存の API キーがリストアップされ、管理や削除が可能になります。

1. **Overview**セクションでは、以下のことができます:
   - キー名の編集
   - API キーの再生成
   - API キーの現在の使用状況を統計で表示:
     - クエリの数
     - 使用した GRT の量
2. Under **Security**, you’ll be able to opt into security settings depending on the level of control you’d like to have over your API keys. In this section, you can:
   - API キーの使用を許可されたドメイン名の表示と管理
   - API キーでクエリ可能なサブグラフの割り当て
3. Under **Indexer Preference**, you’ll be able to set different preferences for Indexers who are indexing subgraphs that your API key is used for. You can assign up to 5 points for each of these:
   - **Fastest Speed**: Time between the query and the response from an indexer. If you mark this as important we will optimize for fast indexers.
   - **Lowest Price**: The amount paid per query. If you mark this as important we will optimize for the less expensive indexers.
   - **Data Freshness**: How recent the latest block an indexer has processed for the subgraph you are querying. If you mark this as important we will optimize to find the indexers with the freshest data.
   - **Economic Security**: The amount of GRT an indexer can lose if they respond incorrectly to your query. If you mark this as important we will optimize for indexers with a large stake.
4. Under **Budget**, you’ll be able to update the maximum price per query. Note that we have a dynamic setting for that that's based on a volume discounting algorithm. **We strongly recommend using the default settings unless you are experiencing a specific problem.** Otherwise, you can update it under "Set a custom maximum budget". On this page you can also view different KPIs (in GRT and USD):
   - Average cost per query
   - Failed queries over max price
   - Most expensive query

## サブグラフの管理方法

API キー以外にも、サブグラフを管理するための様々なツールが用意されています。サブグラフは、**ステータス**や**カテゴリー**ごとに整理することができます。

- The **Status** tag allows you to pick between a variety of tags including `<created>`, `<deployed>`, `<published>`, `<archived>`, etc.
- Meanwhile, **Category** allows you to designate what category your subgraph falls into. Options include `<DeFi>`, `<NFTs>`, `<Governance>`, etc.
