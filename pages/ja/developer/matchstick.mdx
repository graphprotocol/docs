---
title: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
---

Matchstick ã¯[LimeChain](https://limechain.tech/)ãŒé–‹ç™ºã—ãŸãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€ã‚µãƒ–ã‚°ãƒ©ãƒ•ã®é–‹ç™ºè€…ãŒã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã—ã€è‡ªä¿¡ã‚’æŒã£ã¦ã‚µãƒ–ã‚°ãƒ©ãƒ•ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™!

[Matchstick installation guide](https://github.com/LimeChain/matchstick/blob/main/README.md#quick-start-)ã«å¾“ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã§ã€æœ€åˆã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä½œæˆã«ç§»ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ã

Gravatar ã®[Example Subgraph](https://github.com/graphprotocol/example-subgraph)ã‚’ä½¿ã£ã¦ã€ç°¡å˜ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ãŒã‚ã‚‹ã¨ã—ã¾ã™ï¼ˆã‚ˆã‚Šç°¡æ˜“åŒ–ã™ã‚‹ãŸã‚ã® 2 ã¤ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚‚ä¸€ç·’ã«ï¼‰ã€‚

```javascript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress))
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```

ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ãŒãã®ã‚ˆã†ãªä¾‹ã§ã™ï¼š

```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

test('Can call mappings with custom events', () => {
  // Create a test entity and save it in the store as initial state (optional)
  let gravatar = new Gravatar('gravatarId0')
  gravatar.save()

  // Create mock events
  let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')
  let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

  // Call mapping functions passing the events we just created
  handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

  // Assert the state of the store
  assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
  assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
  assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

  // Clear the store in order to start the next test off on a clean slate
  clearStore()
})

test('Next test', () => {
  //...
})

```

ã¾ãšé‡è¦ãªã®ã¯ã€`matchstick-as`ã¨ã„ã† AssemblyScript ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦é…å¸ƒ)ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªã¯[ã“ã“](https://github.com/LimeChain/matchstick-as)ã«ã‚ã‚Šã¾ã™ã€‚`matchstick-as` ã¯ä¾¿åˆ©ãªãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¦ãã‚Œã¾ã™ã—ã€ãƒ†ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã«ä½¿ã†`test()`é–¢æ•°ã‚‚å®šç¾©ã—ã¦ã„ã¾ã™ã€‚æ®‹ã‚Šã®éƒ¨åˆ†ã¯ã¨ã¦ã‚‚ç°¡å˜ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:

- åˆæœŸçŠ¶æ…‹ã‚’è¨­å®šã—ã€ã‚«ã‚¹ã‚¿ãƒ  Gravatar ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ 1 ã¤è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚
- `createNewGravatarEvent()`é–¢æ•°ã‚’ä½¿ã£ã¦ã€2 ã¤ã®`NewGravatar`ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãã®ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
- ã“ã‚Œã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰`handleNewGravatars()`ã‚’å‘¼ã³å‡ºã—ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚
- ã‚¹ãƒˆã‚¢ã®çŠ¶æ…‹ã‚’ã‚¢ã‚µãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã©ã®ã‚ˆã†ãªä»•çµ„ã¿ãªã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ- Entity ã‚¿ã‚¤ãƒ—ã¨ id ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªçµ„ã¿åˆã‚ã›ã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚ãã—ã¦ã€ãã® Entity ã®ç‰¹å®šã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€æœŸå¾…ã™ã‚‹å€¤ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ã‚¢ã‚µãƒ¼ãƒˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¹ãƒˆã‚¢ã«è¿½åŠ ã—ãŸæœ€åˆã® Gravatar Entity ã¨ã€ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã«è¿½åŠ ã•ã‚Œã‚‹ 2 ã¤ã® Gravatar Entity ã®ä¸¡æ–¹ã«å¯¾ã—ã¦è¡Œã£ã¦ã„ã¾ã™ã€‚
- æœ€å¾Œã«ã€`clearStore()`ã‚’ä½¿ã£ã¦ã‚¹ãƒˆã‚¢ã‚’æƒé™¤ã—ã€æ¬¡ã®ãƒ†ã‚¹ãƒˆãŒæ–°é®®ã§ç©ºã®ã‚¹ãƒˆã‚¢ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å§‹ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã¯å¿…è¦ã«å¿œã˜ã¦ã„ãã¤ã§ã‚‚å®šç¾©ã§ãã¾ã™ã€‚

ã“ã‚Œã§æœ€åˆã®ãƒ†ã‚¹ãƒˆãŒå®Œæˆã—ã¾ã—ãŸ! ğŸ‘

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ã‚µãƒ–ã‚°ãƒ©ãƒ•ã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

`gravityã®ãƒ†ã‚¹ãƒˆ`

ã™ã¹ã¦ãŒã†ã¾ãã„ãã¨ã€ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

![Matchstick saying â€œAll tests passed!â€](/img/matchstick-tests-passed.png)

## ä¸€èˆ¬çš„ãªãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### ç‰¹å®šã®çŠ¶æ…‹ã§ã‚¹ãƒˆã‚¢ã«ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€æ—¢çŸ¥ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚»ãƒƒãƒˆã§ã‚¹ãƒˆã‚¢ã‚’ãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã“ã§ã¯ã€Gravatarã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ã‚¹ãƒˆã‚¢ã‚’åˆæœŸåŒ–ã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š

```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```

### ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ã£ãŸãƒãƒƒãƒ”ãƒ³ã‚°é–¢æ•°ã®å‘¼ã³å‡ºã—

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œæˆã—ã€ãã‚Œã‚’ã‚¹ãƒˆã‚¢ã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚ŒãŸãƒãƒƒãƒ”ãƒ³ã‚°é–¢æ•°ã«æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ï¼š

```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã§ã™ã¹ã¦ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å‘¼ã³å‡ºã™

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã§ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```

```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```

### ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚³ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚³ãƒ¼ãƒ«ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```

ã“ã®ã‚ˆã†ã«ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å‘¼ã³å‡ºã—ã¨æˆ»ã‚Šå€¤ã‚’ãƒãƒ¼ãƒ‰ã‚³ã‚¢åŒ–ã™ã‚‹ãŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é–¢æ•°åã€é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ã€å¼•æ•°ã®é…åˆ—ã€ãã—ã¦ã‚‚ã¡ã‚ã‚“æˆ»ã‚Šå€¤ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€é–¢æ•°ã®æˆ»ã‚Šå€¤ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```typescript
let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
  .withArgs([ethereum.Value.fromAddress(contractAddress)])
  .reverts()
```

### ã‚¹ãƒˆã‚¢ã®çŠ¶æ…‹ã‚’ã‚¢ã‚µãƒ¼ãƒˆã™ã‚‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã‚¢ã‚µãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã€ã‚¹ãƒˆã‚¢ã®æœ€çµ‚çš„ãªçŠ¶æ…‹ï¼ˆã¾ãŸã¯é€”ä¸­ã®çŠ¶æ…‹ï¼‰ã‚’ã‚¢ã‚µãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ç‰¹å®šã® IDã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æœŸå¾…å€¤ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã«ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š

```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```

Assert.fieldEquals()é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæŒ‡å®šã•ã‚ŒãŸæœŸå¾…å€¤ã¨ç­‰ã—ã„ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚å€¤ãŒ**ç­‰ã—ããªã„** å ´åˆã¯ã€ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ãƒ†ã‚¹ãƒˆã¯æ­£å¸¸ã«é€šéã—ã¾ã™ã€‚

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã®ã‚„ã‚Šã¨ã‚Š

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€`newMockEvent()`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ ethereum.Eventã¨ã—ã¦è¿”ã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª­ã¿æ›¸ãã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼š

```typescript
// Read
let logType = newGravatarEvent.logType

// Write
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```

### å¤‰æ•°ã®ç­‰å€¤æ€§ã®ä¸»å¼µ

```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒã‚¹ãƒˆã‚¢ã«**ãªã„**ã“ã¨ã‚’ã‚¢ã‚µãƒ¼ãƒˆã™ã‚‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒã‚¹ãƒˆã‚¢ã«å­˜åœ¨ã—ãªã„ã“ã¨ã‚’ã‚¢ã‚µãƒ¼ãƒˆã§ãã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã¨ id ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒå®Ÿéš›ã«ã‚¹ãƒˆã‚¢å†…ã«ã‚ã‚‹å ´åˆã€ãƒ†ã‚¹ãƒˆã¯é–¢é€£ã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦å¤±æ•—ã—ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã‚’ä½¿ã£ãŸç°¡å˜ãªä¾‹ã‚’ã”ç´¹ä»‹ã—ã¾ã™ï¼š

```typescript
assert.notInStore('Gravatar', '23')
```

### ã‚¹ãƒˆã‚¢å…¨ä½“ã‚’å°åˆ·ã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

ã“ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ä½¿ã£ã¦ã€ã‚¹ãƒˆã‚¢å…¨ä½“ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```typescript
import { logStore } from "matchstick-as/assembly/store";

logStore();
```

### äºˆæƒ³ã•ã‚Œã‚‹ä¸å…·åˆ

Test() é–¢æ•°ã®shouldFailãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚¹ãƒˆã®å¤±æ•—ã‚’äºˆæƒ³ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```typescript
test("Should throw an error", () => {
  throw new Error();
}, true);
```

ShouldFail = true ã¨ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã‚‹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã€ãƒ†ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã¯å¤±æ•—ã—ã¾ã™ã€‚ã¾ãŸã€shouldFail = false (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŠ¶æ…‹) ã¨è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œè€…ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

### ãƒ­ã‚®ãƒ³ã‚°

ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã«ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°ã‚’æŒãŸã›ã‚‹ã“ã¨ã¯ã€ãƒãƒƒãƒ”ãƒ³ã‚°ã«ãƒ­ã‚°ã‚’æŒãŸã›ã‚‹ã“ã¨ã¨å…¨ãåŒã˜ã§ã™ã€‚é•ã„ã¯ã€ãƒ­ã‚°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’graph-tsã§ã¯ãªãmatchstick-asã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã§ã™ã€‚ä»¥ä¸‹ã¯ã€ã™ã¹ã¦ã®éé‡è¦ãªãƒ­ã‚°ã‚¿ã‚¤ãƒ—ã‚’ä½¿ã£ãŸç°¡å˜ãªä¾‹ã§ã™ï¼š

```typescript
import { test } from "matchstick-as/assembly/index";
import { log } from "matchstick-as/assembly/log";

test("Success", () => {
    log.success("Success!". []);
});
test("Error", () => {
    log.error("Error :( ", []);
});
test("Debug", () => {
    log.debug("Debugging...", []);
});
test("Info", () => {
    log.info("Info!", []);
});
test("Warning", () => {
    log.warning("Warning!", []);
});
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã“ã®ã‚ˆã†ã«è‡´å‘½çš„ãªå¤±æ•—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

```typescript
test("Blow everything up", () => {
    log.critical("Boom!");
});
```

ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¨ãƒ©ãƒ¼ã®ãƒ­ã‚°ã‚’å–ã‚‹ã¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡ŒãŒæ­¢ã¾ã‚Šã€ã™ã¹ã¦ãŒé£›ã‚“ã§ã—ã¾ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã«é‡è¦ãªãƒ­ã‚°ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã€ã‚‚ã—ç™ºç”Ÿã—ãŸå ´åˆã«ã¯ã™ãã«æ°—ä»˜ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### æ´¾ç”Ÿãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ†ã‚¹ãƒˆ

æ´¾ç”Ÿãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ†ã‚¹ãƒˆã¯ã€ï¼ˆä»¥ä¸‹ã®ä¾‹ã§ç¤ºã™ã‚ˆã†ã«ï¼‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®šã—ã€ãã‚ŒãŒæœ€åˆã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®1ã¤ã‚’æ´¾ç”Ÿã—ã¦ã„ã‚‹å ´åˆã€åˆ¥ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒè‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚é‡è¦ãªã®ã¯ã€è‡ªå‹•æ›´æ–°ã¯ASã‚³ãƒ¼ãƒ‰ãŒä¸å¯çŸ¥è«–ã§ã‚ã‚‹éŒ†ã®ã‚¹ãƒˆã‚¢å†…ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€æœ€åˆã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯å†ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã§ã™ã€‚

```typescript
test("Derived fields example test", () => {
    let mainAccount = new GraphAccount("12")
    mainAccount.save()
    let operatedAccount = new GraphAccount("1")
    operatedAccount.operators = ["12"]
    operatedAccount.save()
    let nst = new NameSignalTransaction("1234")
    nst.signer = "12";
    nst.save()

    assert.assertNull(mainAccount.get("nameSignalTransactions"))
    assert.assertNull(mainAccount.get("operatorOf"))

    mainAccount = GraphAccount.load("12")!

    assert.i32Equals(1, mainAccount.nameSignalTransactions.length)
    assert.stringEquals("1", mainAccount.operatorOf[0])
})
```

### å‹•çš„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

å‹•çš„ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã¯ã€dataSource namespaceã® context(), address(), network() é–¢æ•°ã®æˆ»ã‚Šå€¤ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚context - ç©ºã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ (DataSourceContext) ã‚’è¿”ã—ã€address - "0x0000000000000000000000" ã‚’è¿”ã—ã€network - "mainnet" ã‚’è¿”ã—ã¾ã™ã€‚create(...) ã¨ createWithContext(...) é–¢æ•°ã¯ä½•ã‚‚ã—ãªã„ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ†ã‚¹ãƒˆã®ä¸­ã§å‘¼ã³å‡ºã™å¿…è¦ã¯å…¨ãã‚ã‚Šã¾ã›ã‚“ã€‚æˆ»ã‚Šå€¤ã®å¤‰æ›´ã¯ matchstick-as (version 0.3.0+) ã® dataSourceMock namespaceã®é–¢æ•°ã§è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯ãã®ä¾‹ã§ã™ï¼šã¾ãšã€æ¬¡ã®ã‚ˆã†ãªã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãŒã‚ã‚Šã¾ã™ (ã“ã‚Œã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ãƒ¢ãƒƒã‚¯ã‚’ç´¹ä»‹ã™ã‚‹ãŸã‚ã«æ„å›³çš„ã«å†åˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™)ï¼š

```typescript
export function handleApproveTokenDestinations(event: ApproveTokenDestinations): void {
  let tokenLockWallet = TokenLockWallet.load(dataSource.address().toHexString())!
  if (dataSource.network() == "rinkeby") {
    tokenLockWallet.tokenDestinationsApproved = true
  }
  let context = dataSource.context()
  if (context.get("contextVal")!.toI32() > 0) {
    tokenLockWallet.setBigInt("tokensReleased", BigInt.fromI32(context.get("contextVal")!.toI32()))
  }
  tokenLockWallet.save()
}
```

ãã—ã¦ã€dataSourceMock namespaceã®ãƒ¡ã‚½ãƒƒãƒ‰ã®1ã¤ã‚’ä½¿ç”¨ã—ã¦ã€ã™ã¹ã¦ã®dataSourceé–¢æ•°ã«æ–°ã—ã„æˆ»ã‚Šå€¤ã‚’è¨­å®šã™ã‚‹ãƒ†ã‚¹ãƒˆãŒã‚ã‚Šã¾ã™ï¼š

```typescript
import { assert, test, newMockEvent, dataSourceMock } from "matchstick-as/assembly/index"
import { BigInt, DataSourceContext, Value } from "@graphprotocol/graph-ts"

import { handleApproveTokenDestinations } from "../../src/token-lock-wallet"
import { ApproveTokenDestinations } from "../../generated/templates/GraphTokenLockWallet/GraphTokenLockWallet"
import { TokenLockWallet } from "../../generated/schema"

test("Data source simple mocking example", () => {
    let addressString = "0xA16081F360e3847006dB660bae1c6d1b2e17eC2A"
    let address = Address.fromString(addressString)

    let wallet = new TokenLockWallet(address.toHexString())
    wallet.save()
    let context = new DataSourceContext()
    context.set("contextVal", Value.fromI32(325))
    dataSourceMock.setReturnValues(addressString, "rinkeby", context)
    let event = changetype<ApproveTokenDestinations>(newMockEvent())

    assert.assertTrue(!wallet.tokenDestinationsApproved)

    handleApproveTokenDestinations(event)

    wallet = TokenLockWallet.load(address.toHexString())!
    assert.assertTrue(wallet.tokenDestinationsApproved)
    assert.bigIntEquals(wallet.tokensReleased, BigInt.fromI32(325))

    dataSourceMock.resetValues()
})
```

æœ€å¾Œã«dataSourceMock.resetValues()ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€å€¤ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨è¨˜æ†¶ã•ã‚Œã‚‹ãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å€¤ã«æˆ»ã—ãŸã„å ´åˆã¯ãƒªã‚»ãƒƒãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚

### ãƒ­ã‚°å‡ºåŠ›ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®è¡¨ç¤º

ãƒ­ã‚°å‡ºåŠ›ã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ãŒå«ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä»¥ä¸‹ã¯ãã®ä¾‹ã§ã™ï¼š

`Jul 09 14:54:42.420 INFO Program execution time: 10.06022ms`

## ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

è³ªå•ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãªã©ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€The Graph Discordã«Matchstickå°‚ç”¨ã®ãƒãƒ£ãƒ³ãƒãƒ«ğŸ”¥| unit-testing ãŒã‚ã‚Šã¾ã™ã®ã§ã€ãã¡ã‚‰ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
