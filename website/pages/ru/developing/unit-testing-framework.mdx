---
title: –§—Ä–µ–π–º–≤–æ—Ä–∫ –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
---

Matchstick - —ç—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–æ–º–ø–∞–Ω–∏–µ–π [LimeChain](https://limechain.tech/), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Å—É–±–≥—Ä–∞—Ñ–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –º—ç–ø–ø–∏–Ω–≥–∞ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—Ç—å —Å–≤–æ–∏ —Å—É–±–≥—Ä–∞—Ñ—ã!

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã, –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```sh
yarn add --dev matchstick-as
```

‚ùó `graph-node` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PostgreSQL, –ø–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ —É –í–∞—Å –µ–≥–æ –µ—â–µ –Ω–µ—Ç, –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. –ú—ã –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–µ –Ω–∏–∂–µ –∫–æ–º–∞–Ω–¥—ã, —Ç–∞–∫ –∫–∞–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Ö –ª—é–±—ã–º –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–º –æ—à–∏–±–∫–∞–º!

#### MacOS

–ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Postgres:

```sh
brew install postgresql
```

–°–æ–∑–¥–∞–π—Ç–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é libpq.5.lib _–í–æ–∑–º–æ–∂–Ω–æ, —Å–Ω–∞—á–∞–ª–∞ –í–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —ç—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥_ `/usr/local/opt/postgresql/lib/`

```sh
ln -sf /usr/local/opt/postgresql@14/lib/postgresql@14/libpq.5.dylib /usr/local/opt/postgresql/lib/libpq.5.dylib
```

#### Linux

–ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Postgres (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—à–µ–≥–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞):

```sh
sudo apt install postgresql
```

### WSL (Windows Subsystem for Linux)

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Matchstick –≤ WSL –∫–∞–∫ —Å –ø–æ–º–æ—â—å—é –ø–æ–¥—Ö–æ–¥–∞ Docker, —Ç–∞–∫ –∏ —Å –ø–æ–º–æ—â—å—é –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞. –ü–æ—Å–∫–æ–ª—å–∫—É WSL –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–æ–π –∑–∞–¥–∞—á–µ–π, –≤–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–µ—Ç–æ–≤ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –í—ã —Å—Ç–æ–ª–∫–Ω–µ—Ç–µ—Å—å —Å —Ç–∞–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –∫–∞–∫

```
static BYTES = Symbol("Bytes") SyntaxError: Unexpected token =
```

–∏–ª–∏

```
<PROJECT_PATH>/node_modules/gluegun/build/index.js:13 throw up;
```

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –±–æ–ª–µ–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é Node.js. graph-cli –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **v10.19.0** –∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —è–≤–ª—è–µ—Ç—Å—è –≤–µ—Ä—Å–∏–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤ Ubuntu –Ω–∞ WSL. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ Matchstick —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ WALL —Å **v18.1.0**. –í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω–µ–≥–æ –ª–∏–±–æ —á–µ—Ä–µ–∑ **nvm**, –ª–∏–±–æ, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –≥–ª–æ–±–∞–ª—å–Ω—ã–π Node.js. –ù–µ –∑–∞–±—É–¥—å—Ç–µ —É–¥–∞–ª–∏—Ç—å `node_modules` –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `npm install` –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è nodejs! –ó–∞—Ç–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –í–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ **libpq**. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –∑–∞–ø—É—Å—Ç–∏–≤

```
sudo apt-get install libpq-dev
```

–ò, –Ω–∞–∫–æ–Ω–µ—Ü, –Ω–µ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ `graph test` (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –í–∞—à—É –≥–ª–æ–±–∞–ª—å–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É graph-cli –∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ WSL). –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ `yarn test` –∏–ª–∏ `npm run test` (–∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä graph-cli –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ). –î–ª—è —ç—Ç–æ–≥–æ –í–∞–º, –∫–æ–Ω–µ—á–Ω–æ, –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–∫—Ä–∏–ø—Ç `"test"` –≤ —Ñ–∞–π–ª–µ `package.json`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–º, –Ω–∞–ø—Ä–∏–º–µ—Ä

```json
{
  "name": "demo-subgraph",
  "version": "0.1.0",
  "scripts": {
    "test": "graph test",
    ...
  },
  "dependencies": {
    "@graphprotocol/graph-cli": "^0.30.0",
    "@graphprotocol/graph-ts": "^0.27.0",
    "matchstick-as": "^0.5.0"
  }
}
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Matchstick** –≤ —Å–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ subgraph, –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É —Å–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `graph test [options] <datasource>` - –æ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–≤–æ–∏—á–Ω—ã–π —Ñ–∞–π–ª **Matchstick** –∏ –∑–∞–ø—É—Å—Ç–∏—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –ø–∞–ø–∫–µ (–∏–ª–∏ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã, –µ—Å–ª–∏ —Ñ–ª–∞–≥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–∫–∞–∑–∞–Ω).

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã CLI

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –ø–∞–ø–∫–µ:

```sh
graph test
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç —Å –∏–º–µ–Ω–µ–º gravity.test.ts –∏/–∏–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ —Å –∏–º–µ–Ω–µ–º gravity:

```sh
graph test gravity
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª:

```sh
graph test path/to/file.test.ts
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```sh
-c, --coverage                –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –ø–æ–∫—Ä—ã—Ç–∏—è
-d, --docker                –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –≤ docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ —Å—É–±–≥—Ä–∞—Ñ–∞)
-f, --force                Binary: –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–≤–æ–∏—á–Ω—ã–π —Ñ–∞–π–ª. Docker: –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª Docker –∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑ docker
-h, --help                –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
-l, --logs                –í—ã–≤–æ–¥–∏—Ç –Ω–∞ –∫–æ–Ω—Å–æ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ, –º–æ–¥–µ–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏ URL-–∞–¥—Ä–µ—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–≤ —Ü–µ–ª—è—Ö –æ—Ç–ª–∞–¥–∫–∏)
-r, --recompile                –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã
-v, --version <tag>                –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ rust, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
```

### Docker

–ò–∑ `graph-cli 0.25.2` –∫–æ–º–∞–Ω–¥–∞ `graph test` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ `matchstick` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ docker —Å —Ñ–ª–∞–≥–æ–º `-d`. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [bind mount](https://docs.docker.com/storage/bind-mounts /), —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ–±—Ä–∞–∑ docker –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `graph test -d`. –í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –í—ã –º–æ–∂–µ—Ç–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è [matchstick](https://github.com/LimeChain/matchstick#docker-) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ docker –≤—Ä—É—á–Ω—É—é.

‚ùó –ï—Å–ª–∏ –í—ã —Ä–∞–Ω–µ–µ –∑–∞–ø—É—Å–∫–∞–ª–∏ `graph test`, –í—ã –º–æ–∂–µ—Ç–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –æ—à–∏–±–∫–æ–π –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ docker:

```sh
  error from sender: failed to xattr node_modules/binary-install-raw/bin/binary-<platform>: permission denied
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–æ–∑–¥–∞–π—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ `.dockerignore` –∏ –¥–æ–±–∞–≤—å—Ç–µ `node_modules/binary-install-raw/bin`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

Matchstick –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤, –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ –ø—É—Ç–∏ –∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç—É —á–µ—Ä–µ–∑ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `matchstick.yaml`:

```yaml
testsFolder: path/to/tests
libsFolder: path/to/libs
manifestPath: path/to/subgraph.yaml
```

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—É–±–≥—Ä–∞—Ñ

–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏ –ø–æ–∏–≥—Ä–∞—Ç—å —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞, –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–≤ [–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å—É–±–≥—Ä–∞—Ñ–æ–≤](https://github.com/LimeChain/demo-subgraph)

### –í–∏–¥–µ–æ—É—Ä–æ–∫–∏

–¢–∞–∫–∂–µ –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–µ—Ä–∏—é –≤–∏–¥–µ–æ—Ä–æ–ª–∏–∫–æ–≤ [>"–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Matchstick –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –í–∞—à–∏—Ö —Å—É–±–≥—Ä–∞—Ñ–æ–≤"](https://www.youtube.com/playlist?list=PLTqyKgxaGF3SNakGQwczpSGVjS_xvOv3h)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ (>=0.5.0)

_**–í–ê–ñ–ù–û: –¢—Ä–µ–±—É–µ—Ç—Å—è matchstick-as >=0.5.0**_

### describe()

`describe(name: String , () => {})` - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –≥—Ä—É–ø–ø—É.

**_–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:_**

- _–û–ø–∏—Å–∞–Ω–∏—è –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏. –í—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å test() –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ, –≤–Ω–µ –±–ª–æ–∫–æ–≤ describe()_

–ü—Ä–∏–º–µ—Ä:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Gravatar entity", () => {
    ...
  })
})
```

–ü—Ä–∏–º–µ—Ä –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `describe()`:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar } from "../../src/gravity"

describe("handleUpdatedGravatar()", () => {
  describe("When entity exists", () => {
    test("updates the entity", () => {
      ...
    })
  })

  describe("When entity does not exists", () => {
    test("it creates a new entity", () => {
      ...
    })
  })
})
```

---

### test()

`test(name: String, () =>, should_fail: bool)` - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å test() –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–æ–≤ describe() –∏–ª–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.

–ü—Ä–∏–º–µ—Ä:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Entity", () => {
    ...
  })
})
```

–∏–ª–∏

```typescript
test("handleNewGravatar() should create a new entity", () => {
  ...
})


```

---

### beforeAll()

–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–ª–æ–∫ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –ª—é–±—ã–º –∏–∑ —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ. –ï—Å–ª–∏ `beforeAll` –æ–±—ä—è–≤–ª–µ–Ω –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `describe`, –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ `describe`.

–ü—Ä–∏–º–µ—Ä—ã:

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `beforeAll` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ _–≤—Å–µ–º–∏_ —Ç–µ—Å—Ç–∞–º–∏ –≤ —Ñ–∞–π–ª–µ.

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

beforeAll(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = ‚ÄúFirst Gravatar‚Äù
  gravatar.save()
  ...
})

describe("When the entity does not exist", () => {
  test("it should create a new Gravatar with id 0x1", () => {
    ...
  })
})

describe("When entity already exists", () => {
  test("it should update the Gravatar with id 0x0", () => {
    ...
  })
})
```

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `beforeAll` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ —Ç–µ—Å—Ç–∞–º–∏ –≤ –ø–µ—Ä–≤–æ–º –±–ª–æ–∫–µ –æ–ø–∏—Å–∞–Ω–∏—è

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

describe("handleUpdatedGravatar()", () => {
  beforeAll(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = ‚ÄúFirst Gravatar‚Äù
    gravatar.save()
    ...
  })

  test("updates Gravatar with id 0x0", () => {
    ...
  })

  test("creates new Gravatar with id 0x1", () => {
    ...
  })
})
```

---

### afterAll()

–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–ª–æ–∫ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ. –ï—Å–ª–∏ `afterAll` –æ–±—ä—è–≤–ª–µ–Ω –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `describe`, –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ `describe`.

–ü—Ä–∏–º–µ—Ä:

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `afterAll` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ _–≤—Å–µ—Ö_ —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ.

```typescript
import { describe, test, afterAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { store } from "@graphprotocol/graph-ts"

afterAll(() => {
  store.remove("Gravatar", "0x0")
  ...
})

describe("handleNewGravatar, () => {
  test("creates Gravatar with id 0x0", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `afterAll` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ –ø–µ—Ä–≤–æ–º –±–ª–æ–∫–µ –æ–ø–∏—Å–∞–Ω–∏—è

```typescript
import { describe, test, afterAll, clearStore } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
    afterAll(() => {
    store.remove("Gravatar", "0x1")
    ...
    })

  test("It creates a new entity with Id 0x0", () => {
    ...
  })

  test("It creates a new entity with Id 0x1", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

---

### beforeEach()

–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–ª–æ–∫ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º. –ï—Å–ª–∏ `beforeEach` –æ–±—ä—è–≤–ª–µ–Ω –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `describe`, –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ `describe`.

–ü—Ä–∏–º–µ—Ä—ã: –ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `beforeEach` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

```typescript
import { describe, test, beforeEach, clearStore } from "matchstick-as/assembly/index"
import { handleNewGravatars } from "./utils"

beforeEach(() => {
  clearStore() // <-- clear the store before each test in the file
})

describe("handleNewGravatars, () => {
  test("A test that requires a clean store", () => {
    ...
  })

  test("Second that requires a clean store", () => {
    ...
  })
})

 ...
```

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `beforeEach` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º –≤ –æ–ø–∏—Å–∞–Ω–∏–∏

```typescript
import { describe, test, beforeEach } from 'matchstick-as/assembly/index'
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe('handleUpdatedGravatars', () => {
  beforeEach(() => {
    let gravatar = new Gravatar('0x0')
    gravatar.displayName = 'First Gravatar'
    gravatar.imageUrl = ''
    gravatar.save()
  })

  test('Upates the displayName', () => {
    assert.fieldEquals('Gravatar', '0x0', 'displayName', 'First Gravatar')

    // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å displayName –¥–æ 1-–≥–æ Gravatar

    assert.fieldEquals('Gravatar', '0x0', 'displayName', '1st Gravatar')
    store.remove('Gravatar', '0x0')
  })

  test('Updates the imageUrl', () => {
    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', '')

    // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å imageUrl –Ω–∞ https://www.gravatar.com/avatar/0x0

    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', 'https://www.gravatar.com/avatar/0x0')
    store.remove('Gravatar', '0x0')
  })
})
```

---

### afterEach()

–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–ª–æ–∫ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞. –ï—Å–ª–∏ `afterEach` –æ–±—ä—è–≤–ª–µ–Ω –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `describe`, –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ `describe`.

–ü—Ä–∏–º–µ—Ä—ã:

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `afterEach` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞.

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

beforeEach(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = ‚ÄúFirst Gravatar‚Äù
  gravatar.save()
})

afterEach(() => {
  store.remove("Gravatar", "0x0")
})

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å displayName –¥–æ 1-–≥–æ Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å imageUrl –Ω–∞ https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

–ö–æ–¥ –≤–Ω—É—Ç—Ä–∏ `afterEach` –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤ —ç—Ç–æ–º –æ–ø–∏—Å–∞–Ω–∏–∏

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  beforeEach(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = "First Gravatar"
    gravatar.imageUrl = ""
    gravatar.save()
  })

  afterEach(() => {
    store.remove("Gravatar", "0x0")
  })

  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å displayName –¥–æ 1-–≥–æ Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å imageUrl –Ω–∞ https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

## –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

```typescript
fieldEquals(entityType: string, id: string, fieldName: string, expectedVal: string)

equals(expected: ethereum.Value, actual: ethereum.Value)

notInStore(entityType: string, id: string)

addressEquals(address1: Address, address2: Address)

bytesEquals(bytes1: Bytes, bytes2: Bytes)

i32Equals(number1: i32, number2: i32)

bigIntEquals(bigInt1: BigInt, bigInt2: BigInt)

booleanEquals(bool1: boolean, bool2: boolean)

stringEquals(string1: string, string2: string)

arrayEquals(array1: Array<ethereum.Value>, array2: Array<ethereum.Value>)

tupleEquals(tuple1: ethereum.Tuple, tuple2: ethereum.Tuple)

assertTrue(value: boolean)

assertNull<T>(value: T)

assertNotNull<T>(value: T)

entityCount(entityType: string, expectedCount: i32)
```

## –ù–∞–ø–∏—à–∏—Ç–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–æ—Å—Ç–æ–π —é–Ω–∏—Ç-—Ç–µ—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–º–µ—Ä—ã Gravatar –≤ [–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Å—É–±–≥—Ä–∞—Ñ–µ](https://github.com/LimeChain/demo-subgraph/blob/main/src/gravity.ts).

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–Ω–∞—Ä—è–¥—É —Å –¥–≤—É–º—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –æ–±–ª–µ–≥—á–∞—é—â–∏–º–∏ –Ω–∞—à—É –∂–∏–∑–Ω—å):

```typescript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string,
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters,
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress)),
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```

–°–Ω–∞—á–∞–ª–∞ –º—ã –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ. –í–æ—Ç –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–æ –º–æ–≥–ª–æ –±—ã –≤—ã–≥–ª—è–¥–µ—Ç—å:

```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

test('Can call mappings with custom events', () => {
  // –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  let gravatar = new Gravatar('gravatarId0')
  gravatar.save()

  // –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
  let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')
  let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

  // –í—ã–∑–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º—ç–ø–ø–∏–Ω–≥–∞, –ø–µ—Ä–µ–¥–∞—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–ª–∏
  handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

  // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
  assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
  assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

  // –û—á–∏—Å—Ç–∏—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
  clearStore()
})

test('Next test', () => {
  //...
})
```

–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å! –ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ, –≤–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –º—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ `matchstick-as`, –Ω–∞—à–µ–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ AssemblyScript (—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º–æ–π –∫–∞–∫ –º–æ–¥—É–ª—å npm). –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ [–∑–¥–µ—Å—å](https://github.com/LimeChain/matchstick-as). `matchstick-as` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–º –ø–æ–ª–µ–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `test()`, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤. –í –æ—Å—Ç–∞–ª—å–Ω–æ–º –≤—Å–µ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ - –≤–æ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- –ú—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞—à–µ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–±—ä–µ–∫—Ç Gravatar;
- –ú—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Å–æ–±—ã—Ç–∏—è `NewGravatar` –≤–º–µ—Å—Ç–µ —Å –∏—Ö –¥–∞–Ω–Ω—ã–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é `create New Gravatar Event()`;
- –ú—ã –≤—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥—ã-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —ç—Ç–∏—Ö —Å–æ–±—ã—Ç–∏–π - `–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ Gravatars()` –∏ –ø–µ—Ä–µ–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π;
- –ú—ã —É—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ö–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? - –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞. –ó–∞—Ç–µ–º –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ –≤ —ç—Ç–æ–º –æ–±—ä–µ–∫—Ç–µ –∏ —É—Ç–≤–µ—Ä–∂–¥–∞–µ–º, —á—Ç–æ –æ–Ω–æ –∏–º–µ–µ—Ç —Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –æ–∂–∏–¥–∞–µ–º –æ—Ç –Ω–µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å. –ú—ã –¥–µ–ª–∞–µ–º —ç—Ç–æ –∫–∞–∫ –¥–ª—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ Gravatar, –∫–æ—Ç–æ—Ä—ã–π –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Ç–∞–∫ –∏ –¥–ª—è –¥–≤—É—Ö –æ–±—ä–µ–∫—Ç–æ–≤ Gravatar, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞;
- –ò, –Ω–∞–∫–æ–Ω–µ—Ü, –º—ã –æ—á–∏—â–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –ø–æ–º–æ—â—å—é `clear Store()`, —á—Ç–æ–±—ã –Ω–∞—à —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞—á–∞—Ç—å —Å –Ω–æ–≤–æ–≥–æ –∏ –ø—É—Å—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ú—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤, —Å–∫–æ–ª—å–∫–æ –∑–∞—Ö–æ—Ç–∏–º.

–í–æ—Ç –∏ –≤—Å–µ - –º—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞—à –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç! üëè

–¢–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞—à–∏ —Ç–µ—Å—Ç—ã, –í–∞–º –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ —Å–≤–æ–µ–≥–æ —Å—É–±–≥—Ä–∞—Ñ–∞ —Å–ª–µ–¥—É—é—â–µ–µ:

`graph test Gravity`

–ò –µ—Å–ª–∏ –≤—Å–µ –ø–æ–π–¥–µ—Ç —Ö–æ—Ä–æ—à–æ, –í—ã —É–≤–∏–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:

![Matchstick saying ‚ÄúAll tests passed!‚Äù](/img/matchstick-tests-passed.png)

## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –Ω–∞–ø–æ–ª–Ω—è—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –æ–±—ä–µ–∫—Ç–æ–≤. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –ø–æ–º–æ—â—å—é –æ–±—ä–µ–∫—Ç–∞ Gravatar:

```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```

### –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –º—ç–ø–ø–∏–Ω–≥–∞ —Å –ø–æ–º–æ—â—å—é —Å–æ–±—ã—Ç–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–∏ –º—ç–ø–ø–∏–Ω–≥–∞, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É:

```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```

### –í—ã–∑–æ–≤ –≤—Å–µ—Ö –º—ç–ø–ø–∏–Ω–≥–æ–≤ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –º—ç–ø–ø–∏–Ω–≥–∏ —Å –ø–æ–º–æ—â—å—é —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```

```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```

### –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:

```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```

–ö–∞–∫ –±—ã–ª–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ, –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏ —Ö–∞—Ä–¥–∫–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏, —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏, –º–∞—Å—Å–∏–≤ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç —Ñ—É–Ω–∫—Ü–∏–π:

```typescript
let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
  .withArgs([ethereum.Value.fromAddress(contractAddress)])
  .reverts()
```

### –ò–º–∏—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ IPFS (–∏–∑ matchstick 0.4.1)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã IPFS —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `mockIpfsFile(hash, filePath)`. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞, –ø–µ—Ä–≤—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö - —Ö—ç—à/–ø—É—Ç—å –∫ —Ñ–∞–π–ª—É IPFS, –∞ –≤—Ç–æ—Ä–æ–π - –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É.

–ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ `ipfs.map/ipfs.mapJSON` —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã matchstck –º–æ–≥ –µ–µ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å, –ø–æ–¥–æ–±–Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ `processGravatar()` –≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –Ω–∏–∂–µ –ø—Ä–∏–º–µ—Ä–µ —Ç–µ—Å—Ç–∞:

–§–∞–π–ª `.test.ts`:

```typescript
import { assert, test, mockIpfsFile } from 'matchstick-as/assembly/index'
import { ipfs } from '@graphprotocol/graph-ts'
import { gravatarFromIpfs } from './utils'

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ ipfs.map(), —á—Ç–æ–±—ã matchstick –º–æ–≥ –µ–≥–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å
export { processGravatar } from './utils'

test('ipfs.cat', () => {
  mockIpfsFile('ipfsCatfileHash', 'tests/ipfs/cat.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  gravatarFromIpfs()

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 1)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'imageUrl', 'https://i.ytimg.com/vi/MELP46s8Cic/maxresdefault.jpg')

  clearStore()
})

test('ipfs.map', () => {
  mockIpfsFile('ipfsMapfileHash', 'tests/ipfs/map.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  ipfs.map('ipfsMapfileHash', 'processGravatar', Value.fromString('Gravatar'), ['json'])

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 3)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'displayName', 'Gravatar1')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '2', 'displayName', 'Gravatar2')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '3', 'displayName', 'Gravatar3')
})
```

–§–∞–π–ª `utils.ts`:

```typescript
import { Address, ethereum, JSONValue, Value, ipfs, json, Bytes } from "@graphprotocol/graph-ts"
import { Gravatar } from "../../generated/schema"

...

// –æ–±—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ ipfs.map
export function processGravatar(value: JSONValue, userData: Value): void {
  // –°–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ JsonValue –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–±–æ—Ç–µ
  // —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ JSON
  let obj = value.toObject()
  let id = obj.get('id')

  if (!id) {
    return
  }

  // –û–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã
  let gravatar = new Gravatar(id.toString())
  gravatar.displayName = userData.toString() + id.toString()
  gravatar.save()
}

// —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç ipfs.cat
export function gravatarFromIpfs(): void {
  let rawData = ipfs.cat("ipfsCatfileHash")

  if (!rawData) {
    return
  }

  let jsonData = json.fromBytes(rawData as Bytes).toObject()

  let id = jsonData.get('id')
  let url = jsonData.get("imageUrl")

  if (!id || !url) {
    return
  }

  let gravatar = new Gravatar(id.toString())
  gravatar.imageUrl = url.toString()
  gravatar.save()
}
```

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –∫–æ–Ω–µ—á–Ω–æ–µ (–∏–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ) —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –ø–æ–º–æ—â—å—é —É—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞, –∏–º—è –ø–æ–ª—è —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏ –æ–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è. –í–æ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–º–µ—Ä:

```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```

–ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ assert.field Equals() –ø—Ä–æ–≤–µ—Ä–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –∑–∞–¥–∞–Ω–Ω–æ–º—É –æ–∂–∏–¥–∞–µ–º–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é. –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –Ω–µ—É–¥–∞—á–µ–π, –∏ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è **–ù–ï** —Ä–∞–≤–Ω—ã. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ.

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –≤ –≤–∏–¥–µ ethereum.Event —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `new MockEvent()`. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ –º–æ–∂–Ω–æ —Å—á–∏—Ç—ã–≤–∞—Ç—å/–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–∏ –ø–æ–ª—è –æ–±—ä–µ–∫—Ç–∞ Event:

```typescript
// –ß—Ç–µ–Ω–∏–µ
let logType = newGravatarEvent.logType

// –ó–∞–ø–∏—Å—å
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```

### –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```

### –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –æ–±—ä–µ–∫—Ç **–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å, —á—Ç–æ –æ–±—ä–µ–∫—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –Ω–µ—É–¥–∞—á–µ–π —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ. –í–æ—Ç –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:

```typescript
assert.notInStore('Gravatar', '23')
```

### –†–∞—Å–ø–µ—á–∞—Ç–∫–∞ –≤—Å–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–≤ —Ü–µ–ª—è—Ö –æ—Ç–ª–∞–¥–∫–∏)

–° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –≤—Å—ë —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ –∫–æ–Ω—Å–æ–ª—å:

```typescript
import { logStore } from 'matchstick-as/assembly/store'

logStore()
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Å–±–æ–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–∂–∏–¥–∞—Ç—å —Å–±–æ–µ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–ª–∞–≥ shouldFail –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö test():

```typescript
test(
  'Should throw an error',
  () => {
    throw new Error()
  },
  true,
)
```

–ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ shouldFail = true, –Ω–æ –ù–ï –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–µ–π, —ç—Ç–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö, –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –Ω–µ—É–¥–∞—á–µ–π. –¢–∞–∫–∂–µ, –µ—Å–ª–∏ –æ–Ω –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ shouldFail = false (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å–±–æ–π —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–µ–¥–µ–Ω–∏–µ –∂—É—Ä–Ω–∞–ª–æ–≤)

–ù–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ª–æ–≥–æ–≤ –≤ –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö - —ç—Ç–æ —Ç–æ—á–Ω–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –º—ç–ø–ø–∏–Ω–≥–∞—Ö. –†–∞–∑–Ω–∏—Ü–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –æ–±—ä–µ–∫—Ç –ª–æ–≥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ matchstick-as, –∞ –Ω–µ –∏–∑ graph-ts. –í–æ—Ç –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Å–æ –≤—Å–µ–º–∏ –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏ –ª–æ–≥–æ–≤:

```typescript
import { test } from "matchstick-as/assembly/index";
import { log } from "matchstick-as/assembly/log";

test("Success", () => {
    log.success("Success!". []);
});
test("Error", () => {
    log.error("Error :( ", []);
});
test("Debug", () => {
    log.debug("Debugging...", []);
});
test("Info", () => {
    log.info("Info!", []);
});
test("Warning", () => {
    log.warning("Warning!", []);
});
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫:

```typescript
test('Blow everything up', () => {
  log.critical('Boom!')
})
```

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –≤—Å–µ –∏—Å–ø–æ—Ä—Ç–∏—Ç. –í –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤, –º—ã —Ö–æ—Ç–∏–º –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –í–∞—à –∫–æ–¥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ª–æ–≥–æ–≤ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏, –∏ –í—ã —Å—Ä–∞–∑—É –∑–∞–º–µ—Ç–∏—Ç–µ, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –ø–æ–ª–µ–π

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –ø–æ–ª–µ–π - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è (–∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–¥–∞—Ç—å –ø–æ–ª–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç, –µ—Å–ª–∏ –æ–Ω –∏–∑–≤–ª–µ–∫–∞–µ—Ç –æ–¥–Ω–æ –∏–∑ —Å–≤–æ–∏—Ö –ø–æ–ª–µ–π –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞. –í–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ rust, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–æ–¥ AS –Ω–µ –∑–∞–≤–∏—Å–∏—Ç.

```typescript
test('Derived fields example test', () => {
  let mainAccount = new GraphAccount('12')
  mainAccount.save()
  let operatedAccount = new GraphAccount('1')
  operatedAccount.operators = ['12']
  operatedAccount.save()
  let nst = new NameSignalTransaction('1234')
  nst.signer = '12'
  nst.save()

  assert.assertNull(mainAccount.get('nameSignalTransactions'))
  assert.assertNull(mainAccount.get('operatorOf'))

  mainAccount = GraphAccount.load('12')!

  assert.i32Equals(1, mainAccount.nameSignalTransactions.length)
  assert.stringEquals('1', mainAccount.operatorOf[0])
})
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—É—Ç–µ–º –∏–º–∏—Ç–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π `context()`, `address()` –∏ `network()` –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω dataSource. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å–ª–µ–¥—É—é—â–µ–µ: `context()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç (DataSourceContext), `address()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `0x0000000000000000000000000000000000000000` `network()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `mainnet`. –§—É–Ω–∫—Ü–∏–∏ `create(...)` –∏ `createWithContext(...)` –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω—ã —Ç–∞–∫, —á—Ç–æ –æ–Ω–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ—ç—Ç–æ–º—É –∏—Ö –≤–æ–æ–±—â–µ –Ω–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω `dataSourceMock` –≤ `matchstick-as` (–≤–µ—Ä—Å–∏—è 0.3.0+).

–ü—Ä–∏–º–µ—Ä –Ω–∏–∂–µ:

–í–æ-–ø–µ—Ä–≤—ã—Ö, —É –Ω–∞—Å –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π (–∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏—Å–∫–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö):

```typescript
export function handleApproveTokenDestinations(event: ApproveTokenDestinations): void {
  let tokenLockWallet = TokenLockWallet.load(dataSource.address().toHexString())!
  if (dataSource.network() == 'rinkeby') {
    tokenLockWallet.tokenDestinationsApproved = true
  }
  let context = dataSource.context()
  if (context.get('contextVal')!.toI32() > 0) {
    tokenLockWallet.setBigInt('tokensReleased', BigInt.fromI32(context.get('contextVal')!.toI32()))
  }
  tokenLockWallet.save()
}
```

–í–æ-–≤—Ç–æ—Ä—ã—Ö, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–µ—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –æ–¥–∏–Ω –∏–∑ –º–µ—Ç–æ–¥–æ–≤ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –∏–º—ë–Ω dataSourceMock –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π dataSource:

```typescript
import { assert, test, newMockEvent, dataSourceMock } from 'matchstick-as/assembly/index'
import { BigInt, DataSourceContext, Value } from '@graphprotocol/graph-ts'

import { handleApproveTokenDestinations } from '../../src/token-lock-wallet'
import { ApproveTokenDestinations } from '../../generated/templates/GraphTokenLockWallet/GraphTokenLockWallet'
import { TokenLockWallet } from '../../generated/schema'

test('Data source simple mocking example', () => {
  let addressString = '0xA16081F360e3847006dB660bae1c6d1b2e17eC2A'
  let address = Address.fromString(addressString)

  let wallet = new TokenLockWallet(address.toHexString())
  wallet.save()
  let context = new DataSourceContext()
  context.set('contextVal', Value.fromI32(325))
  dataSourceMock.setReturnValues(addressString, 'rinkeby', context)
  let event = changetype<ApproveTokenDestinations>(newMockEvent())

  assert.assertTrue(!wallet.tokenDestinationsApproved)

  handleApproveTokenDestinations(event)

  wallet = TokenLockWallet.load(address.toHexString())!
  assert.assertTrue(wallet.tokenDestinationsApproved)
  assert.bigIntEquals(wallet.tokensReleased, BigInt.fromI32(325))

  dataSourceMock.resetValues()
})
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è DataSource Mock.resetValues() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–∏, –∏ –∏—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–±—Ä–æ—Å–∏—Ç—å, –µ—Å–ª–∏ –í—ã —Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

## –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

–ò—Å–ø–æ–ª—å–∑—É—è **Matchstick**, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—É–±–≥—Ä–∞—Ñ–æ–≤ –º–æ–≥—É—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—á–∏—Å–ª–∏—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –±–µ—Ä–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–≤–æ–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã `wasm` –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏—Ö –≤ —Ñ–∞–π–ª—ã `wat`, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ç–µ–º –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª–∏ –ª–∏ –≤—ã–∑–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ `subgraph.yaml`. –ü–æ—Å–∫–æ–ª—å–∫—É –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ü–µ–ª–æ–º) –≤ AssemblyScript –∏ WebAssembly –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –æ—á–µ–Ω—å —Ä–∞–Ω–Ω–∏—Ö —Å—Ç–∞–¥–∏—è—Ö, **Matchstick** –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ –≤–µ—Ç–≤–µ–π. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –ø–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ –±—ã–ª –≤—ã–∑–≤–∞–Ω –¥–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, —Ç–æ —Å–æ–±—ã—Ç–∏–µ/—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–µ–≥–æ –±—ã–ª–∏ –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω—ã.

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –≤ **Matchstick**, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—â–µ–π:

#### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã **Matchstick** –º–æ–≥ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—É—â–µ–Ω—ã, —ç—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ **—Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞**. –¢–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ñ–∞–π–ª–µ gravity.test.ts –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

```typescript
import { handleNewGravatar } from '../../src/gravity'
```

–ß—Ç–æ–±—ã —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—ã–ª–∞ –≤–∏–¥–∏–º–æ–π (—á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Ñ–∞–π–ª `wat` **–ø–æ–¥ –∏–º–µ–Ω–µ–º**), –Ω–∞–º –Ω—É–∂–Ω–æ —Ç–∞–∫–∂–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫:

```typescript
export { handleNewGravatar }
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

Once that's all set up, to run the test coverage tool, simply run:

```sh
graph test -- -c
```

You could also add a custom `coverage` command to your `package.json` file, like so:

```typescript
 "scripts": {
    /.../
    "coverage": "graph test -- -c"
  },
```

That will execute the coverage tool and you should see something like this in the terminal:

```sh
$ graph test -c
Skipping download/install step because binary already exists at /Users/petko/work/demo-subgraph/node_modules/binary-install-raw/bin/0.4.0

___  ___      _       _         _   _      _
|  \/  |     | |     | |       | | (_)    | |
| .  . | __ _| |_ ___| |__  ___| |_ _  ___| | __
| |\/| |/ _` | __/ __| '_ \/ __| __| |/ __| |/ /
| |  | | (_| | || (__| | | \__ \ |_| | (__|   <
\_|  |_/\__,_|\__\___|_| |_|___/\__|_|\___|_|\_\

Compiling...

Running in coverage report mode.
 Ô∏è
Reading generated test modules... üîéÔ∏è

Generating coverage report üìù

Handlers for source 'Gravity':
Handler 'handleNewGravatar' is tested.
Handler 'handleUpdatedGravatar' is not tested.
Handler 'handleCreateGravatar' is tested.
Test coverage: 66.7% (2/3 handlers).

Handlers for source 'GraphTokenLockWallet':
Handler 'handleTokensReleased' is not tested.
Handler 'handleTokensWithdrawn' is not tested.
Handler 'handleTokensRevoked' is not tested.
Handler 'handleManagerUpdated' is not tested.
Handler 'handleApproveTokenDestinations' is not tested.
Handler 'handleRevokeTokenDestinations' is not tested.
Test coverage: 0.0% (0/6 handlers).

Global test coverage: 22.2% (2/9 handlers).
```

### Test run time duration in the log output

The log output includes the test run duration. Here's an example:

`[Thu, 31 Mar 2022 13:54:54 +0300] Program executed in: 42.270ms.`

## Common compiler errors

> Critical: Could not create WasmInstance from valid module with context: unknown import: wasi_snapshot_preview1::fd_write has not been defined

This means you have used `console.log` in your code, which is not supported by AssemblyScript. Please consider using the [Logging API](/developing/assemblyscript-api/#logging-api)

> ERROR TS2554: Expected ? arguments, but got ?.
> 
> return new ethereum.Block(defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultAddress, defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(18,12)
> 
> ERROR TS2554: Expected ? arguments, but got ?.
> 
> return new ethereum.Transaction(defaultAddressBytes, defaultBigInt, defaultAddress, defaultAddress, defaultBigInt, defaultBigInt, defaultBigInt, defaultAddressBytes, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(24,12)

The mismatch in arguments is caused by mismatch in `graph-ts` and `matchstick-as`. The best way to fix issues like this one is to update everything to the latest released version.

## Feedback

If you have any questions, feedback, feature requests or just want to reach out, the best place would be The Graph Discord where we have a dedicated channel for Matchstick, called üî•| unit-testing.
