---
title: ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹Ù†Ú¯ ÙØ±ÛŒÙ… ÙˆØ±Ú©
---

Matchstick Ø§ÛŒÚ© ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹Ù†Ú¯ ÙØ±ÛŒÙ… ÙˆØ±Ú© ÛÛ’ØŒ Ø¬Ø³Û’ [LimeChain](https://limechain.tech/) Ù†Û’ ØªÛŒØ§Ø± Ú©ÛŒØ§ ÛÛ’ØŒ Ø¬Ùˆ Ø³Ø¨ Ú¯Ø±Ø§Ù ÚˆÙˆÛŒÙ„Ù¾Ø±Ø² Ú©Ùˆ Ø§Ø³ Ù‚Ø§Ø¨Ù„ Ø¨Ù†Ø§ØªØ§ ÛÛ’ Ú©Û ÙˆÛ Ø³ÛŒÙ†Úˆ Ø¨Ø§Ú©Ø³ ÙˆØ§Ù„Û’ Ù…Ø§Ø­ÙˆÙ„ Ù…ÛŒÚº Ø§Ù¾Ù†ÛŒ Ù…ÛŒÙ¾Ù†Ú¯ Ù…Ù†Ø·Ù‚ Ú©ÛŒ Ø¬Ø§Ù†Ú† Ú©Ø± Ø³Ú©ÛŒÚº Ø§ÙˆØ± Ø§Ù¾Ù†Û’ Ø³Ø¨ Ú¯Ø±Ø§Ù Ú©Ùˆ Ø§Ø¹ØªÙ…Ø§Ø¯ Ú©Û’ Ø³Ø§ØªÚ¾ ØªØ¹ÛŒÙ†Ø§Øª Ú©Ø± Ø³Ú©ÛŒÚº!

## Ø´Ø±ÙˆØ¹ ÛÙˆØ§ Ú†Ø§ÛØªØ§ ÛÛ’

### Ø§Ù†Ø­ØµØ§Ø± Ø§Ù†Ø³Ù¹Ø§Ù„ Ú©Ø±ÛŒÚº

Ù¹ÛŒØ³Ù¹ Ù…Ø¯Ø¯Ú¯Ø§Ø± Ø·Ø±ÛŒÙ‚ÙˆÚº Ú©Ùˆ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ø§ÙˆØ± Ù¹ÛŒØ³Ù¹ Ú†Ù„Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ØŒ Ø¢Ù¾ Ú©Ùˆ Ø¯Ø±Ø¬ Ø°ÛŒÙ„ Ø§Ù†Ø­ØµØ§Ø± Ú©Ùˆ Ø§Ù†Ø³Ù¹Ø§Ù„ Ú©Ø±Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÙˆÚ¯ÛŒ:

```sh
yarn add --dev matchstick-as
```

â— `graph-node` PostgreSQL Ù¾Ø± Ù…Ù†Ø­ØµØ± ÛÛ’ØŒ Ù„ÛØ°Ø§ Ø§Ú¯Ø± Ø¢Ù¾ Ú©Û’ Ù¾Ø§Ø³ ÛŒÛ Ù¾ÛÙ„Û’ Ø³Û’ Ù†ÛÛŒÚº ÛÛ’ØŒ ØªÙˆ Ø¢Ù¾ Ú©Ùˆ Ø§Ø³Û’ Ø§Ù†Ø³Ù¹Ø§Ù„ Ú©Ø±Ù†Ø§ ÛÙˆÚ¯Ø§Û” ÛÙ… Ù†ÛŒÚ†Û’ Ø¯ÛŒÛ’ Ú¯Ø¦Û’ Ú©Ù…Ø§Ù†ÚˆØ² Ú©Ùˆ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Ø§ Ù…Ø´ÙˆØ±Û Ø¯ÛŒØªÛ’ ÛÛŒÚº Ú©ÛŒÙˆÙ†Ú©Û Ø§Ø³Û’ Ú©Ø³ÛŒ Ø§ÙˆØ± Ø·Ø±ÛŒÙ‚Û’ Ø³Û’ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Û’ Ø³Û’ ØºÛŒØ± Ù…ØªÙˆÙ‚Ø¹ ØºÙ„Ø·ÛŒ ÛÙˆ Ø³Ú©ØªÛŒ ÛÛ’!

#### MacOS

Postgres Ø§Ù†Ø³Ù¹Ø§Ù„ÛŒØ´Ù† Ú©Ù…Ø§Ù†Úˆ:

```sh
brew install postgresql
```

ØªØ§Ø²Û ØªØ±ÛŒÙ† libpq.5.lib Ú©Ø§ Ø§ÛŒÚ© Ø³Ù…Ù„Ù†Ú© Ø¨Ù†Ø§Ø¦ÛŒÚº _Ø¢Ù¾ Ú©Ùˆ Ù¾ÛÙ„Û’ ÛŒÛ ÚˆØ§Ø¦Ø± Ø¨Ù†Ø§Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª Ù¾Ú‘Ø³Ú©ØªÛŒ ÛÛ’_ `/usr/local/opt/postgresql/lib/`

```sh
ln -sf /usr/local/opt/postgresql@14/lib/postgresql@14/libpq.5.dylib /usr/local/opt/postgresql/lib/libpq.5.dylib
```

#### Linux

Postgres Ø§Ù†Ø³Ù¹Ø§Ù„ÛŒØ´Ù† Ú©Ù…Ø§Ù†Úˆ (Ø¢Ù¾ Ú©Û’ ÚˆØ³Ù¹Ø±Ùˆ Ù¾Ø± Ù…Ù†Ø­ØµØ± ÛÛ’):

```sh
sudo apt install postgresql
```

### WSL (Ù„ÛŒ Ù†Ú©Ø³ Ú©Û’ Ù„ÛŒÛ’ ÙˆÙ†ÚˆÙˆØ² Ø³Ø¨ Ø³Ø³Ù¹Ù…)

Ø¢Ù¾ ÚˆÙˆÚ©Ø± Ø§Ù¾Ø±ÙˆÚ† Ø§ÙˆØ± Ø¨Ø§Ø¦Ù†Ø±ÛŒ Ø§Ù¾Ø±ÙˆÚ† Ø¯ÙˆÙ†ÙˆÚº Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ WSL Ù¾Ø± Matchstick Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ” Ø¬ÛŒØ³Ø§ Ú©Û WSL ØªÚ¾ÙˆÚ‘Ø§ Ù…Ø´Ú©Ù„ ÛÙˆØ³Ú©ØªØ§ ÛÛ’ØŒ Ø§Ú¯Ø± Ø¢Ù¾ Ú©Ùˆ Ø§Ø³ Ø·Ø±Ø­ Ú©Û’ Ù…Ø³Ø§Ø¦Ù„ Ú©Ø§ Ø³Ø§Ù…Ù†Ø§ Ú©Ø±Ù†Ø§ Ù¾Ú‘ØªØ§ ÛÛ’ ØªÙˆ ÛŒÛØ§Úº Ú©Ú†Ú¾ ØªØ¬Ø§ÙˆÛŒØ² ÛÛŒÚº

```
static BYTES = Symbol("Bytes") SyntaxError: Unexpected token =
```

ÛŒØ§

```
<PROJECT_PATH>/node_modules/gluegun/build/index.js:13 throw up;
```

Ø¨Ø±Ø§Û Ú©Ø±Ù… ÛŒÙ‚ÛŒÙ†ÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº Ú©Û Ø¢Ù¾ Node.js graph-cli Ú©Û’ Ù†Ø¦Û’ ÙˆØ±Ú˜Ù† Ù¾Ø± ÛÛŒÚº Ø§Ø¨ **v10.19.0** Ú©Ùˆ Ø³Ù¾ÙˆØ±Ù¹ Ù†ÛÛŒÚº Ú©Ø±ØªØ§ ÛÛ’ØŒ Ø§ÙˆØ± ÛŒÛ Ø§Ø¨ Ø¨Ú¾ÛŒ Ù†Ø¦Û’ Ubuntu Ú©Ø§ ÚˆÛŒÙØ§Ù„Ù¹ ÙˆØ±Ú˜Ù† ÛÛ’Û” WSL Ù¾Ø± ØªØµØ§ÙˆÛŒØ±Û” Ù…Ø«Ø§Ù„ Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ù…ÛŒÚ† Ø§Ø³Ù¹Ú© Ú©Û’ WSL Ù¾Ø± **v18.1.0** Ú©Û’ Ø³Ø§ØªÚ¾ Ú©Ø§Ù… Ú©Ø±Ù†Û’ Ú©ÛŒ ØªØµØ¯ÛŒÙ‚ ÛÙˆØ¦ÛŒ ÛÛ’ØŒ Ø¢Ù¾ **nvm** Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø§Ø³ Ù¾Ø± Ø³ÙˆØ¦Ú† Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ” > ÛŒØ§ Ø§Ú¯Ø± Ø¢Ù¾ Ø§Ù¾Ù†Û’ Ø¹Ø§Ù„Ù…ÛŒ Node.js Ú©Ùˆ Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø±ØªÛ’ ÛÛŒÚºÛ” `node_modules` Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ø§ÙˆØ± nodejs Ú©Ùˆ Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø±Ù†Û’ Ú©Û’ Ø¨Ø¹Ø¯ Ø¯ÙˆØ¨Ø§Ø±Û `npm install` Ú†Ù„Ø§Ù†Ø§ Ù†Û Ø¨Ú¾ÙˆÙ„ÛŒÚº! Ù¾Ú¾Ø±ØŒ ÛŒÙ‚ÛŒÙ†ÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº Ú©Û Ø¢Ù¾ Ù†Û’ **libpq** Ø§Ù†Ø³Ù¹Ø§Ù„ Ú©Ø± Ø±Ú©Ú¾Ø§ ÛÛ’ØŒ Ø¢Ù¾ Ø§Ø³Û’ Ú†Ù„Ø§ Ú©Ø± Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº

```
sudo apt-get install libpq-dev
```

Ø§ÙˆØ± Ø¢Ø®Ø± Ù…ÛŒÚºØŒ `graph test` Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ù†Û Ú©Ø±ÛŒÚº (Ø¬Ùˆ Ø¢Ù¾ Ú©Û’ graph-cli Ú©ÛŒ Ø¹Ø§Ù„Ù…ÛŒ ØªÙ†ØµÛŒØ¨ Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªØ§ ÛÛ’ Ø§ÙˆØ± Ú©Ø³ÛŒ ÙˆØ¬Û Ø³Û’ Ø§ÛŒØ³Ø§ Ù„Ú¯ØªØ§ ÛÛ’ Ú©Û ÛŒÛ ÙÛŒ Ø§Ù„Ø­Ø§Ù„ WSL Ù¾Ø± Ù¹ÙˆÙ¹ Ú¯ÛŒØ§ ÛÛ’)ØŒ Ø§Ø³ Ú©Û’ Ø¨Ø¬Ø§Ø¦Û’ `yarn test` Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ” ÛŒØ§ `npm run test` (Ø¬Ùˆ graph-cli Ú©ÛŒ Ù…Ù‚Ø§Ù…ÛŒØŒ Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ù„ÛŒÙˆÙ„ Ù…Ø«Ø§Ù„ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Û’ Ú¯Ø§ØŒ Ø¬Ùˆ Ø§ÛŒÚ© Ø¯Ù„Ú©Ø´ Ú©ÛŒ Ø·Ø±Ø­ Ú©Ø§Ù… Ú©Ø±ØªØ§ ÛÛ’)Û” Ø§Ø³ Ú©Û’ Ù„ÛŒÛ’ ÛŒÙ‚ÛŒÙ†Ø§Ù‹ Ø¢Ù¾ Ú©Ùˆ Ø§Ù¾Ù†ÛŒ `package.json` ÙØ§Ø¦Ù„ Ù…ÛŒÚº Ø§ÛŒÚ© `"test"` Ø§Ø³Ú©Ø±Ù¾Ù¹ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÙˆÚ¯ÛŒ Ø¬Ùˆ Ø§ØªÙ†ÛŒ ÛÛŒ Ø¢Ø³Ø§Ù† ÛÙˆØ³Ú©ØªÛŒ ÛÛ’

```json
{
  "name": "demo-subgraph",
  "version": "0.1.0",
  "scripts": {
    "test": "graph test",
    ...
  },
  "dependencies": {
    "@graphprotocol/graph-cli": "^0.30.0",
    "@graphprotocol/graph-ts": "^0.27.0",
    "matchstick-as": "^0.5.0"
  }
}
```

### Ø§Ø³ØªØ¹Ù…Ø§Ù„

Ø§Ù¾Ù†Û’ Ø³Ø¨ Ú¯Ø±Ø§Ù Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ù…ÛŒÚº **Matchstick** Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¨Ø³ Ø§ÛŒÚ© Ù¹Ø±Ù…ÛŒÙ†Ù„ Ú©Ú¾ÙˆÙ„ÛŒÚºØŒ Ø§Ù¾Ù†Û’ Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ú©Û’ Ø±ÙˆÙ¹ ÙÙˆÙ„ÚˆØ± Ù¾Ø± Ø¬Ø§Ø¦ÛŒÚº Ø§ÙˆØ± Ø¨Ø³ `graph test [options] <datasource> ` - ÛŒÛ ØªØ§Ø²Û ØªØ±ÛŒÙ† **Matchstick** Ø¨Ø§Ø¦Ù†Ø±ÛŒ ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ØªØ§ ÛÛ’ Ø§ÙˆØ± Ù…Ø®ØµÙˆØµ Ù¹ÛŒØ³Ù¹ ÛŒØ§ Ù¹ÛŒØ³Ù¹ ÙÙˆÙ„ÚˆØ± Ù…ÛŒÚº ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹ Ú†Ù„Ø§ØªØ§ ÛÛ’ (ÛŒØ§ ØªÙ…Ø§Ù… Ù…ÙˆØ¬ÙˆØ¯Û Ù¹ÛŒØ³Ù¹ Ø§Ú¯Ø± Ú©ÙˆØ¦ÛŒ ÚˆÛŒÙ¹Ø§ Ø³ÙˆØ±Ø³ Ù¾Ø±Ú†Ù… Ù…ØªØ¹ÛŒÙ† Ù†ÛÛŒÚº ÛÛ’).

### CLI Ú©Û’ Ø§Ø®ØªÛŒØ§Ø±Ø§Øª

ÛŒÛ ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹Ø³ Ú©Ùˆ Ù¹ÛŒØ³Ù¹ ÙÙˆÙ„ÚˆØ± Ù…ÛŒÚº Ú†Ù„Ø§Û“ Ú¯Ø§:

```sh
graph test
```

ÛŒÛ gravity.test.ts Ù†Ø§Ù…ÛŒ Ù¹ÛŒØ³Ù¹ Ø§ÙˆØ±/ÛŒØ§ Ú©Ø´Ø´ Ø«Ù‚Ù„ Ù†Ø§Ù…ÛŒ ÙÙˆÙ„ÚˆØ± Ú©Û’ Ø§Ù†Ø¯Ø± ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹ Ú†Ù„Ø§Ø¦Û’ Ú¯Ø§:

```sh
graph test gravity
```

ÛŒÛ ØµØ±Ù Ù…Ø®ØµÙˆØµ Ù¹ÛŒØ³Ù¹ ÙØ§Ø¦Ù„ Ú©Ùˆ Ú†Ù„Ø§Û“ Ú¯Ø§:

```sh
graph test path/to/file.test.ts
```

**Ø§Ø®ØªÛŒØ§Ø±Ø§Øª:**

```sh
-c, --coverage                Run the tests in coverage mode
-d, --docker                  Run the tests in a docker container (Note: Please execute from the root folder of the subgraph)
-f, --force                   Binary: Redownloads the binary. Docker: Redownloads the Dockerfile and rebuilds the docker image.
-h, --help                    Show usage information
-l, --logs                    Logs to the console information about the OS, CPU model and download url (debugging purposes)
-r, --recompile               Forces tests to be recompiled
-v, --version <tag>           Choose the version of the rust binary that you want to be downloaded/used
```

### ÚˆÙˆÚ©Ø±

`graph-cli 0.25.2` Ø³Û’ØŒ `graph test` Ú©Ù…Ø§Ù†Úˆ `-d` ÙÙ„ÛŒÚ¯ Ú©Û’ Ø³Ø§ØªÚ¾ ÚˆÙˆÚ©Ø± Ú©Ù†Ù¹ÛŒÙ†Ø± Ù…ÛŒÚº `matchstick` Ú†Ù„Ø§Ù†Û’ Ú©ÛŒ Ø­Ù…Ø§ÛŒØª Ú©Ø±ØªÛŒ ÛÛ’Û” ÚˆÙˆÚ©Ø± Ú©Ø§ Ù†ÙØ§Ø° [Ø¨Ø§Ø¦Ù†Úˆ Ù…Ø§Ø¤Ù†Ù¹](https://docs.docker.com/storage/bind-mounts/) Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªØ§ ÛÛ’ Ù„ÛØ°Ø§ Ø¬Ø¨ Ø¨Ú¾ÛŒ `graph test -d` Ú©Ù…Ø§Ù†Úˆ Ù¾Ø± Ø¹Ù…Ù„ ÛÙˆØªØ§ ÛÛ’ Ø§Ø³Û’ ÚˆÙˆÚ©Ø± Ø§Ù…ÛŒØ¬ Ú©Ùˆ Ø¯ÙˆØ¨Ø§Ø±Û Ø¨Ù†Ø§Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª Ù†ÛÛŒÚº ÛÛ’Û” Ù…ØªØ¨Ø§Ø¯Ù„ Ø·ÙˆØ± Ù¾Ø± Ø¢Ù¾ ÚˆÙˆÚ©Ø± Ú©Ùˆ Ø¯Ø³ØªÛŒ Ø·ÙˆØ± Ù¾Ø± Ú†Ù„Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ [matchstick](https://github.com/LimeChain/matchstick#docker-) Ø±ÛŒÙ¾ÙˆØ²Ù¹Ø±ÛŒ Ú©ÛŒ ÛØ¯Ø§ÛŒØ§Øª Ù¾Ø± Ø¹Ù…Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº.

â— Ø§Ú¯Ø± Ø¢Ù¾ Ù†Û’ Ù¾ÛÙ„Û’ `graph test` Ú†Ù„Ø§ÛŒØ§ ÛÛ’ ØªÙˆ Ø¢Ù¾ Ú©Ùˆ ÚˆÙˆÚ©Ø± Ú©ÛŒ ØªØ¹Ù…ÛŒØ± Ú©Û’ Ø¯ÙˆØ±Ø§Ù† Ø¯Ø±Ø¬ Ø°ÛŒÙ„ Ø®Ø±Ø§Ø¨ÛŒ Ú©Ø§ Ø³Ø§Ù…Ù†Ø§ Ú©Ø±Ù†Ø§ Ù¾Ú‘ Ø³Ú©ØªØ§ ÛÛ’:

```sh
  error from sender: failed to xattr node_modules/binary-install-raw/bin/binary-<platform>: permission denied
```

Ø§Ø³ ØµÙˆØ±Øª Ù…ÛŒÚº Ø±ÙˆÙ¹ ÙÙˆÙ„ÚˆØ± Ù…ÛŒÚº Ø§ÛŒÚ© `.dockerignore` Ø¨Ù†Ø§Ø¦ÛŒÚº Ø§ÙˆØ± `node_modules/binary-install-raw/bin` Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº

### Ú©Ù†ÙÛŒÚ¯Ø±ÛŒØ´Ù†

Matchstick Ú©Ùˆ `matchstick.yaml` Ú©Ù†ÙÚ¯ ÙØ§Ø¦Ù„ Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø§Ù¾Ù†ÛŒ Ù…Ø±Ø¶ÛŒ Ú©Û’ Ù¹ÛŒØ³Ù¹ØŒ libs Ø§ÙˆØ± Ù…ÛŒÙ†ÛŒ ÙÛŒØ³Ù¹ Ù¾Ø§ØªÚ¾ Ú©Ùˆ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ú©Ù†ÙÛŒÚ¯Ø± Ú©ÛŒØ§ Ø¬Ø§ Ø³Ú©ØªØ§ ÛÛ’:

```yaml
testsFolder: path/to/tests
libsFolder: path/to/libs
manifestPath: path/to/subgraph.yaml
```

### ÚˆÛŒÙ…Ùˆ Ø³Ø¨ Ú¯Ø±Ø§Ù

Ø¢Ù¾ [ÚˆÛŒÙ…Ùˆ Ø³Ø¨ Ú¯Ø±Ø§Ù Ø±ÛŒÙ¾Ùˆ](https://github.com/LimeChain/demo-subgraph) Ú©Ùˆ Ú©Ù„ÙˆÙ† Ú©Ø±Ú©Û’ Ø§Ø³ Ú¯Ø§Ø¦ÛŒÚˆ Ø³Û’ Ù…Ø«Ø§Ù„ÛŒÚº Ø¢Ø²Ù…Ø§ Ø³Ú©ØªÛ’ ÛÛŒÚº Ø§ÙˆØ± Ú©Ú¾ÛŒÙ„ Ø³Ú©ØªÛ’ ÛÛŒÚº

### ÙˆÛŒÚˆÛŒÙˆ Ù¹ÛŒÙˆÙ¹ÙˆØ±ÛŒÙ„Ø²

Ø§Ø³ Ú©Û’ Ø¹Ù„Ø§ÙˆÛ Ø¢Ù¾ ["Ø§Ù¾Ù†Û’ Ø³Ø¨ Ú¯Ø±Ø§ÙØ³ Ú©Û’ ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹ Ù„Ú©Ú¾Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Matchstick Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©ÛŒØ³Û’ Ú©Ø±ÛŒÚº"](https://www.youtube.com/playlist?list=PLTqyKgxaGF3SNakGQwczpSGVjS_xvOv3h) Ù¾Ø± ÙˆÛŒÚˆÛŒÙˆ Ø³ÛŒØ±ÛŒØ² Ø¨Ú¾ÛŒ Ø¯ÛŒÚ©Ú¾ Ø³Ú©ØªÛ’ ÛÛŒÚº

## Ù¹ÛŒØ³Ù¹ Ú©Ø§ ÚˆÚ¾Ø§Ù†Ú†Û (>=0.5.0)

_**Ø§ÛÙ…: Ù…ÛŒÚ† Ø§Ø³Ù¹Ú© Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’Û” >=0.5.0**_

### describe()

`describe(name: String , () => {})` - Ù¹ÛŒØ³Ù¹ Ú¯Ø±ÙˆÙ¾ Ú©ÛŒ ÙˆØ¶Ø§Ø­Øª Ú©Ø±ØªØ§ ÛÛ’.

**_Ù†ÙˆÙ¹Ø³:_**

- _Ø¨ÛŒØ§Ù†Ø§Øª Ù„Ø§Ø²Ù…ÛŒ Ù†ÛÛŒÚº ÛÛŒÚºÛ” Ø¢Ù¾ describe() Ø¨Ù„Ø§Ú©Ø³ Ú©Û’ Ø¨Ø§ÛØ± Ø§Ø¨ Ø¨Ú¾ÛŒ test() Ù¾Ø±Ø§Ù†Ø§ Ø·Ø±ÛŒÙ‚Û Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº_

Ù…Ø«Ø§Ù„:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Gravatar entity", () => {
    ...
  })
})
```

Ù†ÛŒØ³Ù¹Úˆ `describe()` Ù…Ø«Ø§Ù„:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar } from "../../src/gravity"

describe("handleUpdatedGravatar()", () => {
  describe("When entity exists", () => {
    test("updates the entity", () => {
      ...
    })
  })

  describe("When entity does not exists", () => {
    test("it creates a new entity", () => {
      ...
    })
  })
})
```

---

### test()

`test(name: String, () =>, should_fail: bool)` - Ù¹ÛŒØ³Ù¹ Ú©ÛŒØ³ Ú©ÛŒ ÙˆØ¶Ø§Ø­Øª Ú©Ø±ØªØ§ ÛÛ’Û” Ø¢Ù¾ test() Ú©Ùˆ describe() Ø¨Ù„Ø§Ú©Ø³ Ú©Û’ Ø§Ù†Ø¯Ø± ÛŒØ§ Ø¢Ø²Ø§Ø¯Ø§Ù†Û Ø·ÙˆØ± Ù¾Ø± Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº.

Ù…Ø«Ø§Ù„:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Entity", () => {
    ...
  })
})
```

ÛŒØ§

```typescript
test("handleNewGravatar() should create a new entity", () => {
  ...
})


```

---

### beforeAll()

ÙØ§Ø¦Ù„ Ù…ÛŒÚº Ú©Ø³ÛŒ Ø¨Ú¾ÛŒ Ù¹ÛŒØ³Ù¹ Ø³Û’ Ù¾ÛÙ„Û’ Ø§ÛŒÚ© Ú©ÙˆÚˆ Ø¨Ù„Ø§Ú© Ú†Ù„Ø§ØªØ§ ÛÛ’Û” Ø§Ú¯Ø± `beforeAll` Ú©Ùˆ `describe` Ø¨Ù„Ø§Ú© Ú©Û’ Ø§Ù†Ø¯Ø± Ø§Ø¹Ù„Ø§Ù† Ú©ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’ØŒ ØªÙˆ ÛŒÛ Ø§Ø³ `describe` Ø¨Ù„Ø§Ú© Ú©Û’ Ø´Ø±ÙˆØ¹ Ù…ÛŒÚº Ú†Ù„ØªØ§ ÛÛ’.

Ù…Ø«Ø§Ù„ÛŒÚº:

`foreAll` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©Ø§ Ú©ÙˆÚˆ ÙØ§Ø¦Ù„ Ù…ÛŒÚº _ØªÙ…Ø§Ù…_ Ù¹ÛŒØ³Ù¹ÙˆÚº Ø³Û’ Ù¾ÛÙ„Û’ Ø§ÛŒÚ© Ø¨Ø§Ø± Ø¹Ù…Ù„ Ù…ÛŒÚº Ø¢Ø¦Û’ Ú¯Ø§.

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

beforeAll(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = â€œFirst Gravatarâ€
  gravatar.save()
  ...
})

describe("When the entity does not exist", () => {
  test("it should create a new Gravatar with id 0x1", () => {
    ...
  })
})

describe("When entity already exists", () => {
  test("it should update the Gravatar with id 0x0", () => {
    ...
  })
})
```

`beforeAll` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©Ø§ Ú©ÙˆÚˆ Ù¾ÛÙ„Û’ ÙˆØ¶Ø§Ø­ØªÛŒ Ø¨Ù„Ø§Ú© Ù…ÛŒÚº ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹ÙˆÚº Ø³Û’ Ù¾ÛÙ„Û’ Ø§ÛŒÚ© Ø¨Ø§Ø± Ø¹Ù…Ù„ Ù…ÛŒÚº Ø¢Ø¦Û’ Ú¯Ø§

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

describe("handleUpdatedGravatar()", () => {
  beforeAll(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = â€œFirst Gravatarâ€
    gravatar.save()
    ...
  })

  test("updates Gravatar with id 0x0", () => {
    ...
  })

  test("creates new Gravatar with id 0x1", () => {
    ...
  })
})
```

---

### afterAll()

ÙØ§Ø¦Ù„ Ù…ÛŒÚº ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹ÙˆÚº Ú©Û’ Ø¨Ø¹Ø¯ Ø§ÛŒÚ© Ú©ÙˆÚˆ Ø¨Ù„Ø§Ú© Ú†Ù„Ø§ØªØ§ ÛÛ’Û” Ø§Ú¯Ø± `AfterAll` Ú©Ùˆ `describe` Ø¨Ù„Ø§Ú© Ú©Û’ Ø§Ù†Ø¯Ø± Ø§Ø¹Ù„Ø§Ù† Ú©ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’ØŒ ØªÙˆ ÛŒÛ Ø§Ø³ `describe` Ø¨Ù„Ø§Ú© Ú©Û’ Ø¢Ø®Ø± Ù…ÛŒÚº Ú†Ù„ØªØ§ ÛÛ’.

Ù…Ø«Ø§Ù„:

`afterAll` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©Ø§ Ú©ÙˆÚˆ ÙØ§Ø¦Ù„ Ù…ÛŒÚº _ØªÙ…Ø§Ù…_ Ù¹ÛŒØ³Ù¹ÙˆÚº Ú©Û’ Ø¨Ø¹Ø¯ Ø§ÛŒÚ© Ø¨Ø§Ø± Ø¹Ù…Ù„ Ù…ÛŒÚº Ø¢Ø¦Û’ Ú¯Ø§.

```typescript
import { describe, test, afterAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { store } from "@graphprotocol/graph-ts"

afterAll(() => {
  store.remove("Gravatar", "0x0")
  ...
})

describe("handleNewGravatar, () => {
  test("creates Gravatar with id 0x0", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

`AfterAll` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©ÙˆÚˆ Ù¾ÛÙ„Û’ ÙˆØ¶Ø§Ø­ØªÛŒ Ø¨Ù„Ø§Ú© Ù…ÛŒÚº ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹ÙˆÚº Ú©Û’ Ø¨Ø¹Ø¯ Ø§ÛŒÚ© Ø¨Ø§Ø± Ø¹Ù…Ù„ Ù…ÛŒÚº Ø¢Ø¦Û’ Ú¯Ø§

```typescript
import { describe, test, afterAll, clearStore } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
    afterAll(() => {
    store.remove("Gravatar", "0x1")
    ...
    })

  test("It creates a new entity with Id 0x0", () => {
    ...
  })

  test("It creates a new entity with Id 0x1", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

---

### beforeEach()

ÛØ± Ù¹ÛŒØ³Ù¹ Ø³Û’ Ù¾ÛÙ„Û’ Ø§ÛŒÚ© Ú©ÙˆÚˆ Ø¨Ù„Ø§Ú© Ú†Ù„Ø§ØªØ§ ÛÛ’Û” Ø§Ú¯Ø± `beforeEach` Ú©Ùˆ `describe` Ø¨Ù„Ø§Ú© Ú©Û’ Ø§Ù†Ø¯Ø± Ù‚Ø±Ø§Ø± Ø¯ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’ØŒ ØªÙˆ ÛŒÛ Ø§Ø³ `describe` Ø¨Ù„Ø§Ú© Ù…ÛŒÚº ÛØ± Ù¹ÛŒØ³Ù¹ Ø³Û’ Ù¾ÛÙ„Û’ Ú†Ù„ØªØ§ ÛÛ’.

Ù…Ø«Ø§Ù„ÛŒÚº: `beforeEach` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©ÙˆÚˆ ÛØ± Ù¹ÛŒØ³Ù¹ Ø³Û’ Ù¾ÛÙ„Û’ Ø¹Ù…Ù„ Ù…ÛŒÚº Ø¢Ø¦Û’ Ú¯Ø§.

```typescript
import { describe, test, beforeEach, clearStore } from "matchstick-as/assembly/index"
import { handleNewGravatars } from "./utils"

beforeEach(() => {
  clearStore() // <-- clear the store before each test in the file
})

describe("handleNewGravatars, () => {
  test("A test that requires a clean store", () => {
    ...
  })

  test("Second that requires a clean store", () => {
    ...
  })
})

 ...
```

`beforeEach` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©Ø§ Ú©ÙˆÚˆ ØµØ±Ù ÛØ± Ù¹ÛŒØ³Ù¹ Ø³Û’ Ù¾ÛÙ„Û’ Ø§Ø³ Ú©ÛŒ ÙˆØ¶Ø§Ø­Øª Ú©Ø±Û’ Ú¯Ø§

```typescript
import { describe, test, beforeEach } from 'matchstick-as/assembly/index'
import { handleUpdatedGravatar, handleNewGravatar } from '../../src/gravity'

describe('handleUpdatedGravatars', () => {
  beforeEach(() => {
    let gravatar = new Gravatar('0x0')
    gravatar.displayName = 'First Gravatar'
    gravatar.imageUrl = ''
    gravatar.save()
  })

  test('Upates the displayName', () => {
    assert.fieldEquals('Gravatar', '0x0', 'displayName', 'First Gravatar')

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals('Gravatar', '0x0', 'displayName', '1st Gravatar')
    store.remove('Gravatar', '0x0')
  })

  test('Updates the imageUrl', () => {
    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', '')

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', 'https://www.gravatar.com/avatar/0x0')
    store.remove('Gravatar', '0x0')
  })
})
```

---

### afterEach()

ÛØ± Ù¹ÛŒØ³Ù¹ Ú©Û’ Ø¨Ø¹Ø¯ Ú©ÙˆÚˆ Ø¨Ù„Ø§Ú© Ú†Ù„Ø§ØªØ§ ÛÛ’Û” Ø§Ú¯Ø± `afterEach` Ú©Ùˆ `describe` Ø¨Ù„Ø§Ú© Ú©Û’ Ø§Ù†Ø¯Ø± Ù‚Ø±Ø§Ø± Ø¯ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’ØŒ ØªÙˆ ÛŒÛ Ø§Ø³ `describe` Ø¨Ù„Ø§Ú© Ù…ÛŒÚº ÛØ± Ù¹ÛŒØ³Ù¹ Ú©Û’ Ø¨Ø¹Ø¯ Ú†Ù„ØªØ§ ÛÛ’.

Ù…Ø«Ø§Ù„ÛŒÚº:

`afterEach`b Ú©Û’ Ø§Ù†Ø¯Ø± Ú©Ø§ Ú©ÙˆÚˆ ÛØ± Ù¹ÛŒØ³Ù¹ Ú©Û’ Ø¨Ø¹Ø¯ Ú†Ù„Û’ Ú¯Ø§.

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

beforeEach(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = â€œFirst Gravatarâ€
  gravatar.save()
})

afterEach(() => {
  store.remove("Gravatar", "0x0")
})

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

`afterEach` Ú©Û’ Ø§Ù†Ø¯Ø± Ú©Ø§ Ú©ÙˆÚˆ ÛØ± Ù¹ÛŒØ³Ù¹ Ú©Û’ Ø¨Ø¹Ø¯ describe Ù…ÛŒÚº Ú†Ù„Û’ Ú¯Ø§

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  beforeEach(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = "First Gravatar"
    gravatar.imageUrl = ""
    gravatar.save()
  })

  afterEach(() => {
    store.remove("Gravatar", "0x0")
  })

  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

## Asserts

```typescript
fieldEquals(entityType: string, id: string, fieldName: string, expectedVal: string)

equals(expected: ethereum.Value, actual: ethereum.Value)

notInStore(entityType: string, id: string)

addressEquals(address1: Address, address2: Address)

bytesEquals(bytes1: Bytes, bytes2: Bytes)

i32Equals(number1: i32, number2: i32)

bigIntEquals(bigInt1: BigInt, bigInt2: BigInt)

booleanEquals(bool1: boolean, bool2: boolean)

stringEquals(string1: string, string2: string)

arrayEquals(array1: Array<ethereum.Value>, array2: Array<ethereum.Value>)

tupleEquals(tuple1: ethereum.Tuple, tuple2: ethereum.Tuple)

assertTrue(value: boolean)

assertNull<T>(value: T)

assertNotNull<T>(value: T)

entityCount(entityType: string, expectedCount: i32)
```

## ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹ Ù„Ú©Ú¾ÛŒÚº

Ø¢Ø¦ÛŒÛ’ Ø¯ÛŒÚ©Ú¾ØªÛ’ ÛÛŒÚº Ú©Û [ÚˆÛŒÙ…Ùˆ Ø³Ø¨ Ú¯Ø±Ø§Ù](https://github.com/LimeChain/demo-subgraph/blob/main/src/gravity.ts) Ù…ÛŒÚº Gravatar Ú©ÛŒ Ù…Ø«Ø§Ù„ÙˆÚº Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ Ø§ÛŒÚ© Ø³Ø§Ø¯Û ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹ Ú©ÛŒØ³Ø§ Ù„Ú¯Û’ Ú¯Ø§.

ÛŒÛ ÙØ±Ø¶ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ Ú©Û ÛÙ…Ø§Ø±Û’ Ù¾Ø§Ø³ Ù…Ù†Ø¯Ø±Ø¬Û Ø°ÛŒÙ„ ÛÛŒÙ†ÚˆÙ„Ø± ÙÙ†Ú©Ø´Ù† ÛÛ’ (ÛÙ…Ø§Ø±ÛŒ Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ùˆ Ø¢Ø³Ø§Ù† Ø¨Ù†Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¯Ùˆ Ù…Ø¯Ø¯Ú¯Ø§Ø± Ø§ÙØ¹Ø§Ù„ Ú©Û’ Ø³Ø§ØªÚ¾):

```typescript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string,
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters,
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress)),
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```

ÛÙ…ÛŒÚº Ù¾ÛÙ„Û’ Ø§Ù¾Ù†Û’ Ù¾Ø±ÙˆØ¬ÛŒÚ©Ù¹ Ù…ÛŒÚº Ø§ÛŒÚ© Ù¹ÛŒØ³Ù¹ ÙØ§Ø¦Ù„ Ø¨Ù†Ø§Ù†Ø§ ÛÙˆÚ¯ÛŒÛ” ÛŒÛ Ø§Ø³ Ú©ÛŒ Ø§ÛŒÚ© Ù…Ø«Ø§Ù„ ÛÛ’ Ú©Û ÛŒÛ Ú©Ø³ Ø·Ø±Ø­ Ù†Ø¸Ø± Ø¢Ø³Ú©ØªØ§ ÛÛ’:

```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

test('Can call mappings with custom events', () => {
  // Create a test entity and save it in the store as initial state (optional)
  let gravatar = new Gravatar('gravatarId0')
  gravatar.save()

  // Create mock events
  let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')
  let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

  // Call mapping functions passing the events we just created
  handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

  // Assert the state of the store
  assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
  assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
  assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

  // Clear the store in order to start the next test off on a clean slate
  clearStore()
})

test('Next test', () => {
  //...
})
```

ÛŒÛ Ù¾ÛŒÚ© Ú©Ú¾ÙˆÙ„Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¨ÛØª Ú©Ú†Ú¾ ÛÛ’! Ø³Ø¨ Ø³Û’ Ù¾ÛÙ„Û’ØŒ Ø§ÛŒÚ© Ø§ÛÙ… Ú†ÛŒØ² Ø¬Ø³ Ú©Ø§ Ù†ÙˆÙ¹Ø³ Ù„ÛŒØ§ Ø¬Ø§Ø¦Û’ ÙˆÛ ÛŒÛ ÛÛ’ Ú©Û ÛÙ… Ø§Ù¾Ù†ÛŒ Ø§Ø³Ù…Ø¨Ù„ÛŒ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ù…Ø¯Ø¯Ú¯Ø§Ø± Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ (npm Ù…Ø§ÚˆÛŒÙˆÙ„ Ú©Û’ Ø·ÙˆØ± Ù¾Ø± ØªÙ‚Ø³ÛŒÙ… Ú©Ø±Ø¯Û) `matchstick-as` Ø³Û’ Ú†ÛŒØ²ÛŒÚº Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚºÛ” Ø¢Ù¾ Ø±ÛŒÙ¾ÙˆØ²Ù¹Ø±ÛŒ Ú©Ùˆ [ÛŒÛØ§Úº](https://github.com/LimeChain/matchstick-as) ØªÙ„Ø§Ø´ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ” `matchstick-as` ÛÙ…ÛŒÚº Ù…ÙÛŒØ¯ Ø¬Ø§Ù†Ú† Ú©Û’ Ø·Ø±ÛŒÙ‚Û’ ÙØ±Ø§ÛÙ… Ú©Ø±ØªØ§ ÛÛ’ Ø§ÙˆØ± `test()` ÙÙ†Ú©Ø´Ù† Ú©ÛŒ Ø¨Ú¾ÛŒ ÙˆØ¶Ø§Ø­Øª Ú©Ø±ØªØ§ ÛÛ’ Ø¬Ø³Û’ ÛÙ… Ø§Ù¾Ù†Û’ Ù¹ÛŒØ³Ù¹ Ø¨Ù„Ø§Ú©Ø³ Ø¨Ù†Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº Ú¯Û’Û” Ø§Ø³ Ú©Ø§ Ø¨Ø§Ù‚ÛŒ Ø­ØµÛ Ø¨Ø§Ù„Ú©Ù„ Ø³ÛŒØ¯Ú¾Ø§ ÛÛ’ - ÛŒÛØ§Úº Ú©ÛŒØ§ ÛÙˆØªØ§ ÛÛ’:

- ÛÙ… Ø§Ù¾Ù†ÛŒ Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ Ø­Ø§Ù„Øª Ù‚Ø§Ø¦Ù… Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº Ø§ÙˆØ± Ø§ÛŒÚ© Ø­Ø³Ø¨ Ø¶Ø±ÙˆØ±Øª Gravatar ÛØ³ØªÛŒ Ø´Ø§Ù…Ù„ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº;
- ÛÙ… `createNewGravatarEvent()` ÙÙ†Ú©Ø´Ù† Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ØŒ Ø§Ù† Ú©Û’ ÚˆÛŒÙ¹Ø§ Ú©Û’ Ø³Ø§ØªÚ¾ Ø¯Ùˆ `NewGravatar` Ø§ÛŒÙˆÙ†Ù¹ Ø¢Ø¨Ø¬ÛŒÚ©Ù¹ Ú©ÛŒ ÙˆØ¶Ø§Ø­Øª Ú©Ø±ØªÛ’ ÛÛŒÚº;
- ÛÙ… Ø§Ù† ÙˆØ§Ù‚Ø¹Ø§Øª Ú©Û’ Ù„ÛŒÛ’ ÛÛŒÙ†ÚˆÙ„Ø± Ú©Û’ Ø·Ø±ÛŒÙ‚Û’ Ø¨ØªØ§ Ø±ÛÛ’ ÛÛŒÚº - `handleNewGravatars()` Ø§ÙˆØ± ÛÙ…Ø§Ø±Û’ Ø­Ø³Ø¨ Ø¶Ø±ÙˆØ±Øª Ø§ÛŒÙˆÙ†Ù¹Ø³ Ú©ÛŒ ÙÛØ±Ø³Øª Ù…ÛŒÚº Ú¯Ø²Ø± Ø±ÛÛ’ ÛÛŒÚº;
- ÛÙ… Ø§Ø³Ù¹ÙˆØ± Ú©ÛŒ Ø­Ø§Ù„Øª Ù¾Ø± Ø²ÙˆØ± Ø¯ÛŒØªÛ’ ÛÛŒÚºÛ” ÛŒÛ Ú©ÛŒØ³Û’ Ú©Ø§Ù… Ú©Ø±ØªØ§ ÛÛ’ØŸ - ÛÙ… ÛØ³ØªÛŒ Ú©ÛŒ Ù‚Ø³Ù… Ø§ÙˆØ± Ø¢Ø¦ÛŒ ÚˆÛŒ Ú©Ø§ Ø§ÛŒÚ© Ø§Ù†ÙˆÚ©Ú¾Ø§ Ø§Ù…ØªØ²Ø§Ø¬ Ù¾Ø§Ø³ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚºÛ” Ù¾Ú¾Ø± ÛÙ… Ø§Ø³ ÛØ³ØªÛŒ Ù¾Ø± Ø§ÛŒÚ© Ù…Ø®ØµÙˆØµ ÙÛŒÙ„Úˆ Ú©Ùˆ Ú†ÛŒÚ© Ú©Ø±ØªÛ’ ÛÛŒÚº Ø§ÙˆØ± Ø§Ø³ Ø¨Ø§Øª Ù¾Ø± Ø²ÙˆØ± Ø¯ÛŒØªÛ’ ÛÛŒÚº Ú©Û Ø§Ø³ Ú©ÛŒ ÙˆÛ Ù‚Ø¯Ø± ÛÛ’ Ø¬Ø³ Ú©ÛŒ ÛÙ… Ø§Ø³ Ø³Û’ ØªÙˆÙ‚Ø¹ Ø±Ú©Ú¾ØªÛ’ ÛÛŒÚºÛ” ÛÙ… ÛŒÛ Ø¯ÙˆÙ†ÙˆÚº Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ Gravatar ÛØ³ØªÛŒ Ú©Û’ Ù„ÛŒÛ’ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº Ø¬Ø³Û’ ÛÙ… Ù†Û’ Ø³Ù¹ÙˆØ± Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©ÛŒØ§ ÛÛ’ØŒ Ø§ÙˆØ± Ø³Ø§ØªÚ¾ ÛÛŒ ÙˆÛ Ø¯Ùˆ Gravatar Ø§Ø¯Ø§Ø±ÙˆÚº Ú©Û’ Ù„ÛŒÛ’ Ø¬Ùˆ ÛÛŒÙ†ÚˆÙ„Ø± ÙÙ†Ú©Ø´Ù† Ú©Ùˆ Ú©Ø§Ù„ Ú©Ø±Ù†Û’ Ù¾Ø± Ø´Ø§Ù…Ù„ ÛÙˆ Ø¬Ø§ØªÛŒ ÛÛŒÚº;
- Ø§ÙˆØ± Ø¢Ø®Ø± Ù…ÛŒÚº - ÛÙ… `clearStore()` Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ Ø³Ù¹ÙˆØ± Ú©ÛŒ ØµÙØ§Ø¦ÛŒ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº ØªØ§Ú©Û ÛÙ…Ø§Ø±Ø§ Ø§Ú¯Ù„Ø§ Ù¹ÛŒØ³Ù¹ Ø§ÛŒÚ© ØªØ§Ø²Û Ø§ÙˆØ± Ø®Ø§Ù„ÛŒ Ø³Ù¹ÙˆØ± Ø¢Ø¨Ø¬ÛŒÚ©Ù¹ Ú©Û’ Ø³Ø§ØªÚ¾ Ø´Ø±ÙˆØ¹ ÛÙˆ Ø³Ú©Û’Û” ÛÙ… Ø¬ØªÙ†Û’ Ú†Ø§ÛÛŒÚº Ù¹ÛŒØ³Ù¹ Ø¨Ù„Ø§Ú©Ø³ Ú©ÛŒ ÙˆØ¶Ø§Ø­Øª Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº.

ÛÙ… ÙˆÛØ§Úº Ø¬Ø§ØªÛ’ ÛÛŒÚº - ÛÙ… Ù†Û’ Ø§Ù¾Ù†Ø§ Ù¾ÛÙ„Ø§ Ù¹ÛŒØ³Ù¹ Ø¨Ù†Ø§ÛŒØ§ ÛÛ’! ğŸ‘

Ø§Ø¨ ÛÙ…Ø§Ø±Û’ Ù¹ÛŒØ³Ù¹ Ú†Ù„Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¢Ù¾ Ú©Ùˆ Ø§Ù¾Ù†Û’ Ø³Ø¨ Ú¯Ø±Ø§Ù Ø±ÙˆÙ¹ ÙÙˆÙ„ÚˆØ± Ù…ÛŒÚº Ø¯Ø±Ø¬ Ø°ÛŒÙ„ Ú©Ùˆ Ú†Ù„Ø§Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’:

`Ú¯Ø±Ø§Ù Ù¹ÛŒØ³Ù¹ Ú¯Ø±ÛŒÙˆÙ¹ÛŒ`

Ø§ÙˆØ± Ø§Ú¯Ø± Ø³Ø¨ Ú©Ú†Ú¾ Ù¹Ú¾ÛŒÚ© Ø±ÛØ§ ØªÙˆ Ø¢Ù¾ Ú©Ùˆ Ø¯Ø±Ø¬ Ø°ÛŒÙ„ Ú©Û’ Ø³Ø§ØªÚ¾ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ú©ÛØ§ Ø¬Ø§Ù†Ø§ Ú†Ø§ÛØ¦Û’:

![Matchstick Ú©ÛÛ Ø±ÛÛŒ ÛÛ’ "ØªÙ…Ø§Ù… Ù¹ÛŒØ³Ù¹ Ù¾Ø§Ø³ ÛÙˆ Ú¯Ø¦Û’!"](/img/matchstick-tests-passed.png)

## Ø¹Ø§Ù… Ù¹ÛŒØ³Ù¹ Ú©Û’ Ù…Ù†Ø¸Ø±Ù†Ø§Ù…Û’

### Ø§ÛŒÚ© Ù…Ø®ØµÙˆØµ Ø­Ø§Ù„Øª Ú©Û’ Ø³Ø§ØªÚ¾ Ø§Ø³Ù¹ÙˆØ± Ú©Ùˆ ÛØ§Ø¦ÛŒÚˆØ±ÛŒÙ¹ Ú©Ø±Ù†Ø§

ØµØ§Ø±ÙÛŒÙ† Ù…Ø¹Ù„ÙˆÙ… ÛØ³ØªÛŒÙˆÚº Ú©Û’ Ø§ÛŒÚ© Ø³ÛŒÙ¹ Ú©Û’ Ø³Ø§ØªÚ¾ Ø§Ø³Ù¹ÙˆØ± Ú©Ùˆ ÛØ§Ø¦ÛŒÚˆØ±ÛŒÙ¹ Ú©Ø±Ù†Û’ Ú©Û’ Ù‚Ø§Ø¨Ù„ ÛÛŒÚºÛ” Gravatar ÛØ³ØªÛŒ Ú©Û’ Ø³Ø§ØªÚ¾ Ø§Ø³Ù¹ÙˆØ± Ú©Ùˆ Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ú©ÛŒ Ø§ÛŒÚ© Ù…Ø«Ø§Ù„ ÛŒÛ ÛÛ’:

```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```

### Ù…ÛŒÙ¾Ù†Ú¯ ÙÙ†Ú©Ø´Ù† Ú©Ùˆ Ø§ÛŒÙˆÙ†Ù¹ Ø³Û’ Ú©Ø§Ù„ Ú©Ø±Ù†Ø§

ØµØ§Ø±Ù Ø§ÛŒÚ© Ø­Ø³Ø¨ Ø¶Ø±ÙˆØ±Øª Ø§ÛŒÙˆÙ†Ù¹ Ø¨Ù†Ø§ Ø³Ú©ØªØ§ ÛÛ’ Ø§ÙˆØ± Ø§Ø³Û’ Ø§ÛŒÚ© Ù…ÛŒÙ¾Ù†Ú¯ ÙÙ†Ú©Ø´Ù† Ù…ÛŒÚº Ù…Ù†ØªÙ‚Ù„ Ú©Ø± Ø³Ú©ØªØ§ ÛÛ’ Ø¬Ùˆ Ø§Ø³Ù¹ÙˆØ± Ø³Û’ Ù…Ù†Ø³Ù„Ú© ÛÛ’:

```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```

### Ø§ÛŒÙˆÙ†Ù¹ Ú©Û’ ÙÚ©Ø³Ú†Ø± Ú©Û’ Ø³Ø§ØªÚ¾ ØªÙ…Ø§Ù… Ù†Ù‚Ø´ÙˆÚº Ú©Ùˆ Ú©Ø§Ù„ Ú©Ø±Ù†Ø§

ØµØ§Ø±Ù Ù…ÛŒÙ¾Ù†Ú¯ Ú©Ùˆ Ù¹ÛŒØ³Ù¹ ÙÚ©Ø³Ú†Ø± Ú©Û’ Ø³Ø§ØªÚ¾ Ú©Ø§Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº.

```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```

```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```

### Ú©Ù†Ù¹Ø±ÛŒÚ©Ù¹ Ú©Ø§Ù„Ø² Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø±Ù†Ø§

ØµØ§Ø±ÙÛŒÙ† Ú©Ù†Ù¹Ø±ÛŒÚ©Ù¹ Ú©Ø§Ù„Ø³ Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº:

```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```

Ø¬ÛŒØ³Ø§ Ú©Û Ø¯Ú©Ú¾Ø§ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’ØŒ Ú©Ù†Ù¹Ø±ÛŒÚ©Ù¹ Ú©Ø§Ù„ Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø±Ù†Û’ Ú©Û’ Ù„Û“ Ø§ÙˆØ± ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ ÙˆÛŒÙ„ÛŒÙˆ Ú©Ùˆ Ø³Ø®Øª Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ØŒ ØµØ§Ø±Ù Ú©Ùˆ Ú©Ù†Ù¹Ø±ÛŒÚ©Ù¹ Ø§ÛŒÚˆØ±ÛŒØ³ØŒ ÙÙ†Ú©Ø´Ù† Ú©Ø§ Ù†Ø§Ù…ØŒ ÙÙ†Ú©Ø´Ù† Ú©Û’ Ø¯Ø³ØªØ®Ø·ØŒ Ø¯Ù„Ø§Ø¦Ù„ Ú©ÛŒ Ø§ÛŒÚ© ØµÙØŒ Ø§ÙˆØ± ÛŒÙ‚ÛŒÙ†Ø§Ù‹ - ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ Ù‚ÛŒÙ…Øª ÙØ±Ø§ÛÙ… Ú©Ø±Ù†ÛŒ Ú†Ø§ÛÛŒÛ’.

ØµØ§Ø±ÙÛŒÙ† ÙÙ†Ú©Ø´Ù† Ø±ÛŒÙˆØ±Ù¹Ø³ Ú©Ùˆ Ø¨Ú¾ÛŒ Ù…ÙˆÚ© Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº:

```typescript
let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
  .withArgs([ethereum.Value.fromAddress(contractAddress)])
  .reverts()
```

### IPFS files Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø±Ù†Ø§ (from matchstick 0.4.1)

ØµØ§Ø±Ù `mockIpfsFile(hash, filePath)` ÙÙ†Ú©Ø´Ù† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ú©Û’ IPFS ÙØ§Ø¦Ù„ÙˆÚº Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ” ÙÙ†Ú©Ø´Ù† Ø¯Ùˆ Ø¯Ù„Ø§Ø¦Ù„ Ú©Ùˆ Ù‚Ø¨ÙˆÙ„ Ú©Ø±ØªØ§ ÛÛ’ØŒ Ù¾ÛÙ„Ø§ IPFS ÙØ§Ø¦Ù„ ÛÛŒØ´/Ù¾Ø§ØªÚ¾ ÛÛ’ Ø§ÙˆØ± Ø¯ÙˆØ³Ø±Ø§ Ù…Ù‚Ø§Ù…ÛŒ ÙØ§Ø¦Ù„ Ú©Ø§ Ø±Ø§Ø³ØªÛ ÛÛ’.

Ù†ÙˆÙ¹: `ipfs.map/ipfs.mapJSON` Ú©ÛŒ Ø¬Ø§Ù†Ú† Ú©Ø±ØªÛ’ ÙˆÙ‚ØªØŒ Ú©Ø§Ù„ Ø¨ÛŒÚ© ÙÙ†Ú©Ø´Ù† Ú©Ùˆ Ù¹ÛŒØ³Ù¹ ÙØ§Ø¦Ù„ Ø³Û’ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©ÛŒØ§ Ø¬Ø§Ù†Ø§ Ú†Ø§ÛÛŒÛ’ ØªØ§Ú©Û Ù…ÛŒÚ†Ø³Ù¹Ú© Ø§Ø³ Ú©Ø§ Ù¾ØªÛ Ù„Ú¯Ø§ Ø³Ú©Û’ØŒ Ø¬ÛŒØ³Û’ Ú©Û `processGravatar()` ÙÙ†Ú©Ø´Ù† Ø°ÛŒÙ„ Ù…ÛŒÚº Ù¹ÛŒØ³Ù¹ Ú©ÛŒ Ù…Ø«Ø§Ù„ Ù…ÛŒÚº:

`.test.ts` ÙØ§Ø¦Ù„:

```typescript
import { assert, test, mockIpfsFile } from 'matchstick-as/assembly/index'
import { ipfs } from '@graphprotocol/graph-ts'
import { gravatarFromIpfs } from './utils'

// Export ipfs.map() callback in order for matchstck to detect it
export { processGravatar } from './utils'

test('ipfs.cat', () => {
  mockIpfsFile('ipfsCatfileHash', 'tests/ipfs/cat.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  gravatarFromIpfs()

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 1)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'imageUrl', 'https://i.ytimg.com/vi/MELP46s8Cic/maxresdefault.jpg')

  clearStore()
})

test('ipfs.map', () => {
  mockIpfsFile('ipfsMapfileHash', 'tests/ipfs/map.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  ipfs.map('ipfsMapfileHash', 'processGravatar', Value.fromString('Gravatar'), ['json'])

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 3)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'displayName', 'Gravatar1')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '2', 'displayName', 'Gravatar2')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '3', 'displayName', 'Gravatar3')
})
```

`utils.ts` ÙØ§Ø¦Ù„:

```typescript
import { Address, ethereum, JSONValue, Value, ipfs, json, Bytes } from "@graphprotocol/graph-ts"
import { Gravatar } from "../../generated/schema"

...

// ipfs.map callback
export function processGravatar(value: JSONValue, userData: Value): void {
  // See the JSONValue documentation for details on dealing
  // with JSON values
  let obj = value.toObject()
  let id = obj.get('id')

  if (!id) {
    return
  }

  // Callbacks can also created entities
  let gravatar = new Gravatar(id.toString())
  gravatar.displayName = userData.toString() + id.toString()
  gravatar.save()
}

// function that calls ipfs.cat
export function gravatarFromIpfs(): void {
  let rawData = ipfs.cat("ipfsCatfileHash")

  if (!rawData) {
    return
  }

  let jsonData = json.fromBytes(rawData as Bytes).toObject()

  let id = jsonData.get('id')
  let url = jsonData.get("imageUrl")

  if (!id || !url) {
    return
  }

  let gravatar = new Gravatar(id.toString())
  gravatar.imageUrl = url.toString()
  gravatar.save()
}
```

### Ø§Ø³Ù¹ÙˆØ± Ú©ÛŒ Ø­Ø§Ù„Øª Ú©Ø§ Ø¯Ø¹ÙˆÛŒÙ°

ØµØ§Ø±ÙÛŒÙ† Ø¯Ø¹ÙˆÛŒÙ° Ú©Ø±Ù†Û’ ÙˆØ§Ù„Û’ Ø§Ø¯Ø§Ø±ÙˆÚº Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø§Ø³Ù¹ÙˆØ± Ú©ÛŒ Ø­ØªÙ…ÛŒ (ÛŒØ§ ÙˆØ³Ø· Ù…ÛŒÚº) Ø­Ø§Ù„Øª Ú©Ø§ Ø¯Ø¹ÙˆÛŒÙ° Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ” Ø§ÛŒØ³Ø§ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ØŒ ØµØ§Ø±Ù Ú©Ùˆ Ø§ÛŒÚ© ÛØ³ØªÛŒ Ú©ÛŒ Ù‚Ø³Ù…ØŒ Ú©Ø³ÛŒ ÛØ³ØªÛŒ Ú©ÛŒ Ù…Ø®ØµÙˆØµ IDØŒ Ø§Ø³ ÛØ³ØªÛŒ Ù¾Ø± Ù…ÙˆØ¬ÙˆØ¯ Ú©Ø³ÛŒ ÙÛŒÙ„Úˆ Ú©Ø§ Ù†Ø§Ù…ØŒ Ø§ÙˆØ± ÙÛŒÙ„Úˆ Ú©ÛŒ Ù…ØªÙˆÙ‚Ø¹ Ù‚ÛŒÙ…Øª ÙØ±Ø§ÛÙ… Ú©Ø±Ù†ÛŒ ÛÙˆÚ¯ÛŒÛ” ÛŒÛØ§Úº Ø§ÛŒÚ© ÙÙˆØ±ÛŒ Ù…Ø«Ø§Ù„ ÛÛ’:

```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```

Assert.fieldEquals() ÙÙ†Ú©Ø´Ù† Ú©Ùˆ Ú†Ù„Ø§Ù†Û’ Ø³Û’ Ø¯ÛŒ Ú¯Ø¦ÛŒ ÙÛŒÙ„Úˆ Ú©ÛŒ Ø¯ÛŒ Ú¯Ø¦ÛŒ Ù…ØªÙˆÙ‚Ø¹ Ù‚Ø¯Ø± Ú©Û’ Ù…Ù‚Ø§Ø¨Ù„Û’ Ù…ÛŒÚº Ø¨Ø±Ø§Ø¨Ø±ÛŒ Ú©ÛŒ Ø¬Ø§Ù†Ú† ÛÙˆÚ¯ÛŒÛ” Ù¹ÛŒØ³Ù¹ Ù†Ø§Ú©Ø§Ù… ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§ Ø§ÙˆØ± Ø§Ú¯Ø± Ù‚Ø¯Ø±ÛŒÚº **NOT** Ø¨Ø±Ø§Ø¨Ø± ÛÙˆÚº Ú¯ÛŒ ØªÙˆ Ø§ÛŒÚ© Ø®Ø±Ø§Ø¨ÛŒ Ú©Ø§ Ù¾ÛŒØºØ§Ù… Ù†Ú©Ù„Û’ Ú¯Ø§Û” ÙˆØ±Ù†Û Ø§Ù…ØªØ­Ø§Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ú¯Ø²Ø± Ø¬Ø§Ø¦Û’ Ú¯Ø§.

### Ø§ÛŒÙˆÙ†Ù¹ Ù…ÛŒÙ¹Ø§ ÚˆÛŒÙ¹Ø§ Ú©Û’ Ø³Ø§ØªÚ¾ ØªØ¹Ø§Ù…Ù„ Ú©Ø±Ù†Ø§

ØµØ§Ø±ÙÛŒÙ† ÚˆÛŒÙØ§Ù„Ù¹ Ù¹Ø±Ø§Ù†Ø²ÛŒÚ©Ø´Ù† Ù…ÛŒÙ¹Ø§ ÚˆÛŒÙ¹Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºØŒ Ø¬Ø³Û’ Ø§ÛŒØªÚ¾Ø±ÛŒÙ… Ú©Û’ Ø·ÙˆØ± Ù¾Ø± ÙˆØ§Ù¾Ø³ Ú©ÛŒØ§ Ø¬Ø§ Ø³Ú©ØªØ§ ÛÛ’`newMockEvent()` Ø§ÛŒÙˆÙ†Ù¹ Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ ÛÙˆÛ“ Û” Ø¯Ø±Ø¬ Ø°ÛŒÙ„ Ù…Ø«Ø§Ù„ Ø³Û’ Ù¾ØªÛ Ú†Ù„ØªØ§ ÛÛ’ Ú©Û Ø¢Ù¾ Ø§ÛŒÙˆÙ†Ù¹ Ø¢Ø¨Ø¬ÛŒÚ©Ù¹ Ù¾Ø± Ø§Ù† ÙÛŒÙ„ÚˆØ² Ú©Ùˆ Ú©ÛŒØ³Û’ Ù¾Ú‘Ú¾/Ù„Ú©Ú¾ Ø³Ú©ØªÛ’ ÛÛŒÚº:

```typescript
// Read
let logType = newGravatarEvent.logType

// Write
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```

### Ù…ØªØºÛŒØ± Ù…Ø³Ø§ÙˆØ§Øª Ù¾Ø± Ø²ÙˆØ± Ø¯ÛŒÙ†Ø§

```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```

### ÛŒÛ Ø¯Ø¹ÙˆÛŒÙ° Ú©Ø±Ù†Ø§ Ú©Û Ú©ÙˆØ¦ÛŒ ÛØ³ØªÛŒ Ø§Ø³Ù¹ÙˆØ± Ù…ÛŒÚº **Ù†ÛÛŒÚº** ÛÛ’

ØµØ§Ø±ÙÛŒÙ† Ø§Ø³ Ø¨Ø§Øª Ù¾Ø± Ø²ÙˆØ± Ø¯Û’ Ø³Ú©ØªÛ’ ÛÛŒÚº Ú©Û Ø§Ø³Ù¹ÙˆØ± Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ ÛØ³ØªÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û” ÙÙ†Ú©Ø´Ù† Ø§ÛŒÚ© ÛØ³ØªÛŒ Ú©ÛŒ Ù‚Ø³Ù… Ø§ÙˆØ± Ø§ÛŒÚ© Ø´Ù†Ø§Ø®Øª Ù„ÛŒØªØ§ ÛÛ’Û” Ø§Ú¯Ø± ÛØ³ØªÛŒ Ø­Ù‚ÛŒÙ‚Øª Ù…ÛŒÚº Ø§Ø³Ù¹ÙˆØ± Ù…ÛŒÚº ÛÛ’ ØªÙˆØŒ Ù…ØªØ¹Ù„Ù‚Û Ø®Ø±Ø§Ø¨ÛŒ Ú©Û’ Ù¾ÛŒØºØ§Ù… Ú©Û’ Ø³Ø§ØªÚ¾ Ù¹ÛŒØ³Ù¹ Ù†Ø§Ú©Ø§Ù… ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û” Ø§Ø³ ÙØ¹Ø§Ù„ÛŒØª Ú©Ùˆ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Û’ Ø·Ø±ÛŒÙ‚Û’ Ú©ÛŒ Ø§ÛŒÚ© ÙÙˆØ±ÛŒ Ù…Ø«Ø§Ù„ ÛŒÛ ÛÛ’:

```typescript
assert.notInStore('Gravatar', '23')
```

### Ù¾ÙˆØ±Û’ Ø§Ø³Ù¹ÙˆØ± Ú©Ùˆ Ù¾Ø±Ù†Ù¹ Ú©Ø±Ù†Ø§ (ÚˆÛŒØ¨Ú¯ Ù…Ù‚Ø§ØµØ¯ Ú©Û’ Ù„ÛŒÛ’)

Ø¢Ù¾ Ø§Ø³ Ù…Ø¯Ø¯Ú¯Ø§Ø± ÙÙ†Ú©Ø´Ù† Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ú©Û’ Ù¾ÙˆØ±Û’ Ø§Ø³Ù¹ÙˆØ± Ú©Ùˆ Ú©Ù†Ø³ÙˆÙ„ Ù¾Ø± Ù¾Ø±Ù†Ù¹ Ú©Ø±Ø³Ú©ØªÛ’ ÛÛŒÚº:

```typescript
import { logStore } from 'matchstick-as/assembly/store'

logStore()
```

### Ù…ØªÙˆÙ‚Ø¹ Ù†Ø§Ú©Ø§Ù…ÛŒ

Test() ÙÙ†Ú©Ø´Ù†Ø² Ù¾Ø± shouldFail Ù¾Ø±Ú†Ù… Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ØŒ ØµØ§Ø±ÙÛŒÙ† Ú©Ùˆ Ù¹ÛŒØ³Ù¹ Ù…ÛŒÚº Ù†Ø§Ú©Ø§Ù…ÛŒ Ú©ÛŒ ØªÙˆÙ‚Ø¹ ÛÙˆ Ø³Ú©ØªÛŒ ÛÛ’:

```typescript
test(
  'Should throw an error',
  () => {
    throw new Error()
  },
  true,
)
```

Ø§Ú¯Ø± Ù¹ÛŒØ³Ù¹ Ú©Ùˆ shouldFail = true Ú©Û’ Ø³Ø§ØªÚ¾ Ù†Ø´Ø§Ù† Ø²Ø¯ Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’ Ù„ÛŒÚ©Ù† Ù†Ø§Ú©Ø§Ù… Ù†ÛÛŒÚº ÛÙˆØªØ§ ÛÛ’ØŒ ØªÙˆ ÛŒÛ Ù„Ø§Ú¯Ø² Ù…ÛŒÚº Ø§ÛŒÚ© ØºÙ„Ø·ÛŒ Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ø¸Ø§ÛØ± ÛÙˆÚ¯Ø§ Ø§ÙˆØ± Ù¹ÛŒØ³Ù¹ Ø¨Ù„Ø§Ú© Ù†Ø§Ú©Ø§Ù… ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û” Ø§Ø³ Ú©Û’ Ø¹Ù„Ø§ÙˆÛØŒ Ø§Ú¯Ø± Ø§Ø³Û’ shouldFail = false (Ù¾ÛÙ„Û’ Ø³Û’ Ø·Û’ Ø´Ø¯Û Ø­Ø§Ù„Øª) Ø³Û’ Ù†Ø´Ø§Ù† Ø²Ø¯ Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’ØŒ ØªÙˆ Ù¹ÛŒØ³Ù¹ Ø§ÛŒÚ¯Ø²ÛŒÚ©ÛŒÙˆÙ¹Ø± Ú©Ø±ÛŒØ´ ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§.

### Ù„Ø§Ú¯Ù†Ú¯

ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹ Ù…ÛŒÚº Ø­Ø³Ø¨ Ø¶Ø±ÙˆØ±Øª Ù„Ø§Ú¯Ø² Ú©Ø§ ÛÙˆÙ†Ø§ Ø¨Ø§Ù„Ú©Ù„ ÙˆÛŒØ³Ø§ ÛÛŒ ÛÛ’ Ø¬ÛŒØ³Ø§ Ú©Û Ù…ÛŒÙ¾Ù†Ú¯ Ù…ÛŒÚº Ù„Ø§Ú¯ Ø§Ù† Ú©Ø±Ù†Ø§ ÛÛ’Û” ÙØ±Ù‚ ÛŒÛ ÛÛ’ Ú©Û Ù„Ø§Ú¯ Ø¢Ø¨Ø¬ÛŒÚ©Ù¹ Ú©Ùˆ graph-ts Ú©ÛŒ Ø¨Ø¬Ø§Ø¦Û’ matchstick-as Ø³Û’ Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø±Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’Û” ÛŒÛØ§Úº ØªÙ…Ø§Ù… ØºÛŒØ± Ø§ÛÙ… Ù„Ø§Ú¯ Ø§Ù‚Ø³Ø§Ù… Ú©Û’ Ø³Ø§ØªÚ¾ Ø§ÛŒÚ© Ø³Ø§Ø¯Û Ù…Ø«Ø§Ù„ ÛÛ’:

```typescript
import { test } from "matchstick-as/assembly/index";
import { log } from "matchstick-as/assembly/log";

test("Success", () => {
    log.success("Success!". []);
});
test("Error", () => {
    log.error("Error :( ", []);
});
test("Debug", () => {
    log.debug("Debugging...", []);
});
test("Info", () => {
    log.info("Info!", []);
});
test("Warning", () => {
    log.warning("Warning!", []);
});
```

ØµØ§Ø±Ù Ø§ÛŒÚ© Ø§ÛÙ… Ù†Ø§Ú©Ø§Ù…ÛŒ Ú©ÛŒ Ù†Ù‚Ù„ Ø¨Ú¾ÛŒ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºØŒ Ø¬ÛŒØ³Û’:

```typescript
test('Blow everything up', () => {
  log.critical('Boom!')
})
```

Ø§ÛÙ… ØºÙ„Ø·ÛŒÙˆÚº Ú©Ùˆ Ù„Ø§Ú¯ Ú©Ø±Ù†Ø§ Ù¹ÛŒØ³Ù¹ÙˆÚº Ù¾Ø± Ø¹Ù…Ù„ Ø¯Ø±Ø¢Ù…Ø¯ Ø±ÙˆÚ© Ø¯Û’ Ú¯Ø§ Ø§ÙˆØ± Ø³Ø¨ Ú©Ú†Ú¾ Ø§Ú‘Ø§ Ø¯Û’ Ú¯Ø§Û” Ø¢Ø®Ø± Ú©Ø§Ø± - ÛÙ… ÛŒÛ ÛŒÙ‚ÛŒÙ†ÛŒ Ø¨Ù†Ø§Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚº Ú©Û Ø¢Ù¾ Ú©Û’ Ú©ÙˆÚˆ Ù…ÛŒÚº ØªØ¹ÛŒÙ†Ø§ØªÛŒ Ù…ÛŒÚº Ø§ÛÙ… Ù„Ø§Ú¯Ø² Ù†ÛÛŒÚº ÛÛŒÚºØŒ Ø§ÙˆØ± Ø§Ú¯Ø± Ø§ÛŒØ³Ø§ ÛÙˆÙ†Ø§ ØªÚ¾Ø§ ØªÙˆ Ø¢Ù¾ Ú©Ùˆ ÙÙˆØ±Ø§Ù‹ Ù†ÙˆÙ¹Ø³ Ù„ÛŒÙ†Ø§ Ú†Ø§ÛÛŒÛ’.

### Ù…Ø§Ø®ÙˆØ° ÙÛŒÙ„ÚˆØ² Ú©ÛŒ Ø¬Ø§Ù†Ú† Ú©Ø±Ù†Ø§

Ù…Ø§Ø®ÙˆØ° ÙÛŒÙ„ÚˆØ² Ú©ÛŒ Ø¬Ø§Ù†Ú† Ú©Ø±Ù†Ø§ Ø§ÛŒÚ© Ø§ÛŒØ³ÛŒ Ø®ØµÙˆØµÛŒØª ÛÛ’ Ø¬Ùˆ (Ø¬ÛŒØ³Ø§ Ú©Û Ø°ÛŒÙ„ Ú©ÛŒ Ù…Ø«Ø§Ù„ Ø¯Ú©Ú¾Ø§ØªÛŒ ÛÛ’) ØµØ§Ø±Ù Ú©Ùˆ Ø§ÛŒÚ© Ù…Ø®ØµÙˆØµ ÛØ³ØªÛŒ Ù…ÛŒÚº ÙÛŒÙ„Úˆ Ø³ÛŒÙ¹ Ú©Ø±Ù†Û’ Ú©ÛŒ Ø§Ø¬Ø§Ø²Øª Ø¯ÛŒØªÛŒ ÛÛ’ Ø§ÙˆØ± Ø§Ú¯Ø± ÙˆÛ Ù¾ÛÙ„ÛŒ ÛØ³ØªÛŒ Ø³Û’ Ø§Ù¾Ù†ÛŒ ÙÛŒÙ„ÚˆØ² Ù…ÛŒÚº Ø³Û’ Ú©Ø³ÛŒ Ø§ÛŒÚ© Ú©Ùˆ Ø­Ø§ØµÙ„ Ú©Ø±ØªØ§ ÛÛ’ ØªÙˆ Ø§Ø³Û’ Ø®ÙˆØ¯ Ø¨Ø®ÙˆØ¯ Ø§Ù¾ ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’Û” Ù†ÙˆÙ¹ Ú©Ø±Ù†Û’ ÙˆØ§Ù„ÛŒ Ø§ÛÙ… Ø¨Ø§Øª ÛŒÛ ÛÛ’ Ú©Û Ù¾ÛÙ„ÛŒ ÛØ³ØªÛŒ Ú©Ùˆ Ø¯ÙˆØ¨Ø§Ø±Û Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’ Ú©ÛŒÙˆÙ†Ú©Û Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù¾ ÚˆÛŒÙ¹ Ø§Ø³Ù¹ÙˆØ± Ù…ÛŒÚº ÛÙˆØªØ§ ÛÛ’ Ø¬Ø³ Ù…ÛŒÚº AS Ú©ÙˆÚˆ Ø§Ø¬Ù†Ø§Ø³Ù¹Ú© ÛÛ’.

```typescript
test('Derived fields example test', () => {
  let mainAccount = new GraphAccount('12')
  mainAccount.save()
  let operatedAccount = new GraphAccount('1')
  operatedAccount.operators = ['12']
  operatedAccount.save()
  let nst = new NameSignalTransaction('1234')
  nst.signer = '12'
  nst.save()

  assert.assertNull(mainAccount.get('nameSignalTransactions'))
  assert.assertNull(mainAccount.get('operatorOf'))

  mainAccount = GraphAccount.load('12')!

  assert.i32Equals(1, mainAccount.nameSignalTransactions.length)
  assert.stringEquals('1', mainAccount.operatorOf[0])
})
```

### Ù…ØªØ­Ø±Ú© ÚˆÛŒÙ¹Ø§ Ú©Û’ Ø°Ø±Ø§Ø¦Ø¹ Ú©ÛŒ Ø¬Ø§Ù†Ú† Ú©Ø±Ù†Ø§

Ù…ØªØ­Ø±Ú© ÚˆÛŒÙ¹Ø§ Ú©Û’ Ø°Ø±Ø§Ø¦Ø¹ Ú©ÛŒ Ø¬Ø§Ù†Ú† `context()`ØŒ `address()` Ø§ÙˆØ± `network()` ÙÙ†Ú©Ø´Ù†Ø² Ú©ÛŒ ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ ÙˆÛŒÙ„ÛŒÙˆ Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø±ØªÛ’ ÛÙˆÛ“ Ú©ÛŒ Ø¬Ø§ Ø³Ú©ØªÛŒ ÛÛ’Û” ÚˆÛŒÙ¹Ø§ Ø³ÙˆØ±Ø³ Ù†Ø§Ù… Ú©ÛŒ Ø¬Ú¯ÛÛ” ÛŒÛ ÙÙ†Ú©Ø´Ù†Ø² ÙÛŒ Ø§Ù„Ø­Ø§Ù„ Ø¯Ø±Ø¬ Ø°ÛŒÙ„ Ú©Ùˆ Ù„ÙˆÙ¹Ø§ØªØ§ ÛÛ’: `context()` - Ø§ÛŒÚ© Ø®Ø§Ù„ÛŒ ÛØ³ØªÛŒ (DataSourceContext) ÙˆØ§Ù¾Ø³ Ú©Ø±ØªØ§ ÛÛ’ØŒ `address()` - `0x0000000000000000000000000000000000000000000000000000000000000` Ù„ÙˆÙ¹Ø§ØªØ§ ÛÛ’, `network()` - `mainnet` Ù„ÙˆÙ¹Ø§ØªØ§ ÛÛ’Û” `create(...)` Ø§ÙˆØ± `createWithContext(...)` ÙÙ†Ú©Ø´Ù†Ø² Ú©Ùˆ Ù…ÙˆÚ© Ú©ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’ Ú©Û ÙˆÛ Ú©Ú†Ú¾ Ù†Û Ú©Ø±ÛŒÚº Ø§Ø³ Ù„ÛŒÛ’ Ø§Ù†ÛÛŒÚº Ù¹ÛŒØ³Ù¹ÙˆÚº Ù…ÛŒÚº Ø¨Ù„Ø§Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª Ù†ÛÛŒÚº ÛÛ’Û” ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ ÙˆÛŒÙ„ÛŒÙˆØ³ Ù…ÛŒÚº ØªØ¨Ø¯ÛŒÙ„ÛŒØ§Úº `matchstick-as` (ÙˆØ±Ú˜Ù† 0.3.0+) Ù…ÛŒÚº `dataSourceMock` Ù†Ø§Ù… Ú©ÛŒ Ø¬Ú¯Û Ú©Û’ ÙÙ†Ú©Ø´Ù†Ø² Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ú©ÛŒ Ø¬Ø§ Ø³Ú©ØªÛŒ ÛÛŒÚº.

Ø°ÛŒÙ„ Ú©ÛŒ Ù…Ø«Ø§Ù„:

Ø³Ø¨ Ø³Û’ Ù¾ÛÙ„Û’ ÛÙ…Ø§Ø±Û’ Ù¾Ø§Ø³ Ù…Ù†Ø¯Ø±Ø¬Û Ø°ÛŒÙ„ Ø§ÛŒÙˆÙ†Ù¹ ÛÛŒÙ†ÚˆÙ„Ø± ÛÛ’ (Ø¬Ùˆ Ø¬Ø§Ù† Ø¨ÙˆØ¬Ú¾ Ú©Ø± ÚˆÛŒÙ¹Ø§ Ø³ÙˆØ±Ø³ Ú©Ùˆ Ù…ÙˆÚ© Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ“ Ø¯ÙˆØ¨Ø§Ø±Û ØªÛŒØ§Ø± Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’):

```typescript
export function handleApproveTokenDestinations(event: ApproveTokenDestinations): void {
  let tokenLockWallet = TokenLockWallet.load(dataSource.address().toHexString())!
  if (dataSource.network() == 'rinkeby') {
    tokenLockWallet.tokenDestinationsApproved = true
  }
  let context = dataSource.context()
  if (context.get('contextVal')!.toI32() > 0) {
    tokenLockWallet.setBigInt('tokensReleased', BigInt.fromI32(context.get('contextVal')!.toI32()))
  }
  tokenLockWallet.save()
}
```

Ø§ÙˆØ± Ù¾Ú¾Ø± ÛÙ…Ø§Ø±Û’ Ù¾Ø§Ø³ ÚˆÛŒÙ¹Ø§ Ø³ÙˆØ±Ø³ Ù…ÙˆÚ© Ù†Ø§Ù… Ú©ÛŒ Ø¬Ú¯Û Ú©Û’ Ø·Ø±ÛŒÙ‚ÙˆÚº Ù…ÛŒÚº Ø³Û’ Ø§ÛŒÚ© Ú©Ø§ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ØªÛ’ ÛÙˆØ¦Û’ ÚˆÛŒÙ¹Ø§ Ø³ÙˆØ±Ø³ Ú©Û’ ØªÙ…Ø§Ù… Ø§ÙØ¹Ø§Ù„ Ú©Û’ Ù„ÛŒÛ’ Ø§ÛŒÚ© Ù†Ø¦ÛŒ ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ Ù‚ÛŒÙ…Øª Ù…Ù‚Ø±Ø± Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ù¹ÛŒØ³Ù¹ ÛÛ’:

```typescript
import { assert, test, newMockEvent, dataSourceMock } from 'matchstick-as/assembly/index'
import { BigInt, DataSourceContext, Value } from '@graphprotocol/graph-ts'

import { handleApproveTokenDestinations } from '../../src/token-lock-wallet'
import { ApproveTokenDestinations } from '../../generated/templates/GraphTokenLockWallet/GraphTokenLockWallet'
import { TokenLockWallet } from '../../generated/schema'

test('Data source simple mocking example', () => {
  let addressString = '0xA16081F360e3847006dB660bae1c6d1b2e17eC2A'
  let address = Address.fromString(addressString)

  let wallet = new TokenLockWallet(address.toHexString())
  wallet.save()
  let context = new DataSourceContext()
  context.set('contextVal', Value.fromI32(325))
  dataSourceMock.setReturnValues(addressString, 'rinkeby', context)
  let event = changetype<ApproveTokenDestinations>(newMockEvent())

  assert.assertTrue(!wallet.tokenDestinationsApproved)

  handleApproveTokenDestinations(event)

  wallet = TokenLockWallet.load(address.toHexString())!
  assert.assertTrue(wallet.tokenDestinationsApproved)
  assert.bigIntEquals(wallet.tokensReleased, BigInt.fromI32(325))

  dataSourceMock.resetValues()
})
```

Ù†ÙˆÙ¹ Ú©Ø±ÛŒÚº Ú©Û dataSourceMock.resetValues() Ú©Ùˆ Ø¢Ø®Ø± Ù…ÛŒÚº Ø¨Ù„Ø§ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û” Ø§Ø³ Ú©ÛŒ ÙˆØ¬Û ÛŒÛ ÛÛ’ Ú©Û Ø¬Ø¨ Ø§Ù‚Ø¯Ø§Ø± Ú©Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ú©ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’ ØªÙˆ Ø§Ù†ÛÛŒÚº ÛŒØ§Ø¯ Ø±Ú©Ú¾Ø§ Ø¬Ø§ØªØ§ ÛÛ’ Ø§ÙˆØ± Ø§Ú¯Ø± Ø¢Ù¾ Ù¾ÛÙ„Û’ Ø³Û’ Ø·Û’ Ø´Ø¯Û Ø§Ù‚Ø¯Ø§Ø± Ù¾Ø± ÙˆØ§Ù¾Ø³ Ø¬Ø§Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚº ØªÙˆ Ø§Ù†ÛÛŒÚº Ø¯ÙˆØ¨Ø§Ø±Û ØªØ±ØªÛŒØ¨ Ø¯ÛŒÙ†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’.

## Ù¹ÛŒØ³Ù¹ Ú©ÙˆØ±ÛŒØ¬

Using **Matchstick**, subgraph developers are able to run a script that will calculate the test coverage of the written unit tests.

The test coverage tool takes the compiled test `wasm` binaries and converts them to `wat` files, which can then be easily inspected to see whether or not the handlers defined in `subgraph.yaml` have been called. Since code coverage (and testing as whole) is in very early stages in AssemblyScript and WebAssembly, **Matchstick** cannot check for branch coverage. Instead we rely on the assertion that if a given handler has been called, the event/function for it have been properly mocked.

### Ø´Ø±Ø·ÛŒÚº

**Matchstick** Ù…ÛŒÚº ÙØ±Ø§ÛÙ… Ú©Ø±Ø¯Û Ù¹ÛŒØ³Ù¹ Ú©ÙˆØ±ÛŒØ¬ Ú©ÛŒ ÙØ¹Ø§Ù„ÛŒØª Ú©Ùˆ Ú†Ù„Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ØŒ Ø¢Ù¾ Ú©Ùˆ Ù¾ÛÙ„Û’ Ø³Û’ Ú©Ú†Ú¾ Ú†ÛŒØ²ÛŒÚº ØªÛŒØ§Ø± Ú©Ø±Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’:

#### Ø§Ù¾Ù†Û’ ÛÛŒÙ†ÚˆÙ„Ø±Ø² Ú©Ùˆ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº

**Matchstick** Ú©Ùˆ Ú†ÛŒÚ© Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ú©Û Ú©ÙˆÙ† Ø³Û’ ÛÛŒÙ†ÚˆÙ„Ø±Ø² Ú†Ù„Ø§Ø¦Û’ Ø¬Ø§ Ø±ÛÛ’ ÛÛŒÚºØŒ Ø§Ù† ÛÛŒÙ†ÚˆÙ„Ø±Ø² Ú©Ùˆ **Ù¹ÛŒØ³Ù¹ ÙØ§Ø¦Ù„** Ø³Û’ Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±Ù†Û’ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’Û”. ØªÙˆ Ù…Ø«Ø§Ù„ Ú©Û’ Ø·ÙˆØ± Ù¾Ø±ØŒ ÛÙ…Ø§Ø±ÛŒ gravity.test.ts ÙØ§Ø¦Ù„ Ù…ÛŒÚº ÛÙ…Ø§Ø±Û’ Ù¾Ø§Ø³ Ø¯Ø±Ø¬ Ø°ÛŒÙ„ ÛÛŒÙ†ÚˆÙ„Ø± Ø¯Ø±Ø¢Ù…Ø¯ Ú©ÛŒØ§ Ø¬Ø§ Ø±ÛØ§ ÛÛ’:

```typescript
import { handleNewGravatar } from '../../src/gravity'
```

Ø§Ø³ ÙÙ†Ú©Ø´Ù† Ú©Ùˆ Ù†Ø¸Ø± Ø¢Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ (Ø§Ø³Û’ `wat` ÙØ§Ø¦Ù„ Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’ **Ù†Ø§Ù… Ø³Û’**) ÛÙ…ÛŒÚº Ø§Ø³Û’ Ø¨Ø±Ø¢Ù…Ø¯ Ø¨Ú¾ÛŒ Ú©Ø±Ù†Ø§ ÛÙˆÚ¯Ø§ØŒ Ø¬ÛŒØ³Û’ ÛŒÛ:

```typescript
export { handleNewGravatar }
```

### Ø§Ø³ØªØ¹Ù…Ø§Ù„

Ø§ÛŒÚ© Ø¨Ø§Ø± Ø¬Ø¨ ÛŒÛ Ø³Ø¨ Ø³ÛŒÙ¹ ÛÙˆ Ø¬Ø§Ø¦Û’ ØªÙˆØŒ Ù¹ÛŒØ³Ù¹ Ú©ÙˆØ±ÛŒØ¬ Ù¹ÙˆÙ„ Ú©Ùˆ Ú†Ù„Ø§Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ØŒ Ø¨Ø³ Ú†Ù„Ø§Ø¦ÛŒÚº:

```sh
graph test -- -c
```

Ø¢Ù¾ Ø§Ù¾Ù†ÛŒ `package.json` ÙØ§Ø¦Ù„ Ù…ÛŒÚº Ø­Ø³Ø¨ Ø¶Ø±ÙˆØ±Øª `Ú©ÙˆØ±ÛŒØ¬` Ú©Ù…Ø§Ù†Úˆ Ø¨Ú¾ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±Ø³Ú©ØªÛ’ ÛÛŒÚºØŒ Ø¬ÛŒØ³Û’:

```typescript
 "scripts": {
    /.../
    "coverage": "graph test -- -c"
  },
```

That will execute the coverage tool and you should see something like this in the terminal:

```sh
$ graph test -c
Skipping download/install step because binary already exists at /Users/petko/work/demo-subgraph/node_modules/binary-install-raw/bin/0.4.0

___  ___      _       _         _   _      _
|  \/  |     | |     | |       | | (_)    | |
| .  . | __ _| |_ ___| |__  ___| |_ _  ___| | __
| |\/| |/ _` | __/ __| '_ \/ __| __| |/ __| |/ /
| |  | | (_| | || (__| | | \__ \ |_| | (__|   <
\_|  |_/\__,_|\__\___|_| |_|___/\__|_|\___|_|\_\

Compiling...

Running in coverage report mode.
 ï¸
Reading generated test modules... ğŸ”ï¸

Generating coverage report ğŸ“

Handlers for source 'Gravity':
Handler 'handleNewGravatar' is tested.
Handler 'handleUpdatedGravatar' is not tested.
Handler 'handleCreateGravatar' is tested.
Test coverage: 66.7% (2/3 handlers).

Handlers for source 'GraphTokenLockWallet':
Handler 'handleTokensReleased' is not tested.
Handler 'handleTokensWithdrawn' is not tested.
Handler 'handleTokensRevoked' is not tested.
Handler 'handleManagerUpdated' is not tested.
Handler 'handleApproveTokenDestinations' is not tested.
Handler 'handleRevokeTokenDestinations' is not tested.
Test coverage: 0.0% (0/6 handlers).

Global test coverage: 22.2% (2/9 handlers).
```

### Ù„Ø§Ú¯ Ø¢Ø¤Ù¹ Ù¾Ù¹ Ù…ÛŒÚº Ù¹ÛŒØ³Ù¹ Ø±Ù† Ù¹Ø§Ø¦Ù… Ø¯ÙˆØ±Ø§Ù†ÛŒÛ

Ù„Ø§Ú¯ Ø¢Ø¤Ù¹ Ù¾Ù¹ Ù…ÛŒÚº Ù¹ÛŒØ³Ù¹ Ø±Ù† Ú©Ø§ Ø¯ÙˆØ±Ø§Ù†ÛŒÛ Ø´Ø§Ù…Ù„ ÛÙˆØªØ§ ÛÛ’Û” ÛŒÛØ§Úº Ø§ÛŒÚ© Ù…Ø«Ø§Ù„ ÛÛ’:

`[Thu, 31 Mar 2022 13:54:54 +0300] Program executed in: 42.270ms.`

## Ú©Ù…Ù¾Ø§Ø¦Ù„Ø± Ú©ÛŒ Ø¹Ø§Ù… ØºÙ„Ø·ÛŒØ§Úº

> Critical: Could not create WasmInstance from valid module with context: unknown import: wasi_snapshot_preview1::fd_write has not been defined

Ø§Ø³ Ú©Ø§ Ù…Ø·Ù„Ø¨ ÛÛ’ Ú©Û Ø¢Ù¾ Ù†Û’ Ø§Ù¾Ù†Û’ Ú©ÙˆÚˆ Ù…ÛŒÚº `console.log` Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©ÛŒØ§ ÛÛ’ØŒ Ø¬Ùˆ Ø§Ø³Ù…Ø¨Ù„ÛŒ Ø§Ø³Ú©Ø±Ù¾Ù¹ Ø³Û’ ØªØ¹Ø§ÙˆÙ† ÛŒØ§ÙØªÛ Ù†ÛÛŒÚº ÛÛ’Û” Ø¨Ø±Ø§Û Ú©Ø±Ù… [Ù„Ø§Ú¯Ù†Ú¯ API](/developing/assemblyscript-api/#logging-api) Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ù¾Ø± ØºÙˆØ± Ú©Ø±ÛŒÚº

> ERROR TS2554: Expected ? arguments, but got ?.
> 
> return new ethereum.Block(defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultAddress, defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(18,12)
> 
> ERROR TS2554: Expected ? arguments, but got ?.
> 
> return new ethereum.Transaction(defaultAddressBytes, defaultBigInt, defaultAddress, defaultAddress, defaultBigInt, defaultBigInt, defaultBigInt, defaultAddressBytes, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(24,12)

Ø¯Ù„Ø§Ø¦Ù„ Ù…ÛŒÚº Ø¹Ø¯Ù… Ù…Ù…Ø§Ø«Ù„Øª `graph-ts` Ø§ÙˆØ± `matchstick-as` Ù…ÛŒÚº Ø¹Ø¯Ù… Ù…Ù…Ø§Ø«Ù„Øª Ú©ÛŒ ÙˆØ¬Û Ø³Û’ ÛÙˆØªÛŒ ÛÛ’Û” Ø§Ø³ Ø·Ø±Ø­ Ú©Û’ Ù…Ø³Ø§Ø¦Ù„ Ú©Ùˆ Ø­Ù„ Ú©Ø±Ù†Û’ Ú©Ø§ Ø¨ÛØªØ±ÛŒÙ† Ø·Ø±ÛŒÙ‚Û ÛŒÛ ÛÛ’ Ú©Û ÛØ± Ú†ÛŒØ² Ú©Ùˆ ØªØ§Ø²Û ØªØ±ÛŒÙ† Ø¬Ø§Ø±ÛŒ Ú©Ø±Ø¯Û ÙˆØ±Ú˜Ù† Ù…ÛŒÚº Ø§Ù¾ ÚˆÛŒÙ¹ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’.

## ØªØ§Ø«Ø±Ø§Øª

Ø§Ú¯Ø± Ø¢Ù¾ Ú©Û’ Ù¾Ø§Ø³ Ú©ÙˆØ¦ÛŒ Ø³ÙˆØ§Ù„ØŒ ØªØ§Ø«Ø±Ø§ØªØŒ ÙÛŒÚ†Ø± Ú©ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒÚº ÛÛŒÚº ÛŒØ§ Ø¢Ù¾ ØµØ±Ù Ø±Ø§Ø¨Ø·Û Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŒ ØªÙˆ Ø¨ÛØªØ±ÛŒÙ† Ø¬Ú¯Û Ú¯Ø±Ø§Ù ÚˆØ³Ú©ÙˆØ±Úˆ ÛÙˆÚ¯ÛŒ Ø¬ÛØ§Úº ÛÙ…Ø§Ø±Û’ Ù¾Ø§Ø³ Matchstick Ú©Û’ Ù„ÛŒÛ’ Ø§ÛŒÚ© Ø³Ø±Ø´Ø§Ø± Ú†ÛŒÙ†Ù„ ÛÛ’ØŒ Ø¬Ø³Û’ ğŸ”¥| ÛŒÙˆÙ†Ù¹ Ù¹ÛŒØ³Ù¹Ù†Ú¯ Ø¨Ù„Ø§ÛŒØ§ Ø¬Ø§ØªØ§ ÛÛ’.
