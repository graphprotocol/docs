---
title: 快速开始
---

本指南将快速带您了解如何初始化、创建子图并将子图部署到子图工作室。

确保您的子图将从一个[受支持的网络](/developing/supported-networks)中索引数据。

本指南是在假设您具备以下条件的情况下编写的：

- 一个加密钱包
- 您选择的网络上的智能合约地址

## 1. 在子图工作室中创建子图

跳转到[子图工作室](https://thegraph.com/studio/)并连接您的钱包。

钱包连接后，您可以通过单击“Create a Subgraph”开始创建。建议用“子图名 链名”来命名子图。

## 2. 安装 Graph CLI

Graph CLI 是用 TypeScript 编写的，需要安装 node 和 npm 或 yarn 才能使用它。检查是否安装了最新的 CLI 版本。

在本地计算机上，运行以下命令之一：

使用 [npm](https://www.npmjs.com/):

```sh
npm install -g @graphprotocol/graph-cli@latest
```

使用 [yarn](https://yarnpkg.com/):

```sh
yarn global add @graphprotocol/graph-cli
```

## 3. 从现有的合约初始化子图

通过运行初始化命令，从现有合约初始化子图

```sh
graph init --studio <SUBGRAPH_SLUG>
```

> 您可以在[子图工作室](https://thegraph.com/studio/)的子图页面找到针对您特定子图的命令。

初始化子图时，CLI 工具会要求您提供以下信息：

- 协议：选择子图索引数据的协议
- 子图段塞：为您的子图创建一个名称。您的子图段塞是子图的标识符。
- 创建子图的目录：选择您的本地目录
- 以太坊网络（可选）：您可能需要指定子图将从哪个 EVM 兼容网络索引数据
- 合约地址：找到要查询数据的智能合约地址
- ABI：如果ABI不是自动填充的，则需要将其手动输入为 JSON 文件
- 起始区块：建议您在子图索引区块链数据时输入起始区块以节省时间。您可以通过查找部署合约区块来定位起始区块。
- 合约名称：输入您的合约名称
- 将合约事件作为实体进行索引：建议您将其设置为 true，因为它将自动为每个发出的事件向子图添加映射
- 添加其他合约（可选）：您可以添加其他合约

请参阅下面的屏幕截图，以获取初始化子图时所需的示例：

![Subgraph command](/img/subgraph-init-example.png)

## 4. 编写子图

前面的命令创建了一个原始子图，可以将其用作构建子图的起点。当对子图进行更改时，将主要使用三个文件:

- 清单（`subgraph.yaml`）--清单定义子图将索引哪些数据源。
- 模式（`schema.graphql`）--GraphQL 模式定义从子图中检索到的数据。
- AssemblyScript 映射（`mapping.ts`）--将数据源中的数据转换为模式中定义的实体的代码。

想了解更多如何编写子图的信息，请参阅[创建子图](/developing/creating-a-subgraph)。

## 5. 部署到子图工作室

一旦您的子图被编写好，请运行以下命令：

```sh
$ graph codegen
$ graph build
```

- 认证并部署子图。部署密钥可以在子图工作室的子图页面上找到。

```sh
$ graph auth --studio <DEPLOY_KEY>
$ graph deploy --studio <SUBGRAPH_SLUG>
```

您将被要求输入一个版本标签。强烈建议使用（语义化版本）[semver](https://semver.org/) 进行版本控制，如`0.0.1`。尽管如此，您可以自由选择任何字符串作为版本，比如：`v1`，`version1`，`asdf`。

## 6. 测试子图

在子图工作室的 playground 环境中，您可以通过进行示例查询来测试子图。

日志会告诉你你的子图是否有任何错误。操作子图的日志如下所示：

![Subgraph logs](/img/subgraph-logs-image.png)

如果子图失败了，可以通过使用 GraphiQL Playground 查询子图的健康状况。注意，你可以利用下面的查询，输入你的子图的部署 ID。在这种情况下，`Qm...` 是部署 ID（可以在子图页面的详细信息下找到）。下面的查询会提示，当一个子图失败时，则可进行相应调试。

```graphql
{
  indexingStatuses(subgraphs: ["Qm..."]) {
    node
    synced
    health
    fatalError {
      message
      block {
        number
        hash
      }
      handler
    }
    nonFatalErrors {
      message
      block {
        number
        hash
      }
      handler
    }
    chains {
      network
      chainHeadBlock {
        number
      }
      earliestBlock {
        number
      }
      latestBlock {
        number
      }
      lastHealthyBlock {
        number
      }
    }
    entityCount
  }
}
```

## 7. 将你的子图发布到 Graph 的去中心化网络

一旦你的子图被部署到子图工作室，你已经测试了它，并准备把它投入生产，你就可以把它发布到去中心化的网络。

在子图工作室中，您可以单击子图页面右上角的发布按钮。

选择您希望发布子图的网络。建议将子图发布到 Arbitrum One，以利用[更快的交易速度和更低的 Gas 费用](/arbitrum/arbitrum-faq)。

无论子图策划如何，(升级索引人)[/sunrise/#about-the-upgrade-indexer]都将开始在您的子图上提供查询，它将为您提供每月 100,000 个免费查询。

要获得更高的服务质量和更强的冗余，您可以策展子图以吸引更多的索引器。在撰写本文时，建议您使用至少 3,000 GRT 策展自己的子图，以确保 3-5 个其他索引器开始在子图上提供查询。

为了节省gas成本，您可以在将子图发布到Graph的去中心化网络时选择此按钮，在发布子图的同一交易中策展子图：

![Subgraph publish](/img/publish-and-signal-tx.png)

## 8. 查询子图

现在，您可以通过将 GraphQL 查询发送到子图的查询 URL 来查询子图，您可以单击查询按钮找到该查询URL。

如果您没有 API 密钥，你可以通过免费的、速率有限的临时查询 URL 进行查询，该 URL 可用于开发和暂存。

想了解更多从子图查询数据的信息，请查看[这里](/querying/querying-the-graph/)。
