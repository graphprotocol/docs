---
title: इंडेक्सिंग
---

इंडेक्सर्स द ग्राफ नेटवर्क में नोड ऑपरेटर हैं जो इंडेक्सिंग और क्वेरी प्रोसेसिंग सेवाएं प्रदान करने के लिए ग्राफ टोकन (जीआरटी) को दांव पर लगाते हैं। इंडेक्सर्स अपनी सेवाओं के लिए क्वेरी फीस और इंडेक्सिंग पुरस्कार अर्जित करते हैं। वे एक रिबेट पूल से भी कमाते हैं जो कॉब-डगलस रिबेट फंक्शन के बाद उनके काम के अनुपात में सभी नेटवर्क योगदानकर्ताओं के साथ साझा किया जाता है।

जीआरटी जो प्रोटोकॉल में दांव पर लगा है, विगलन अवधि के अधीन है और यदि अनुक्रमणिका दुर्भावनापूर्ण हैं और अनुप्रयोगों को गलत डेटा प्रदान करते हैं या यदि वे गलत तरीके से अनुक्रमणित करते हैं तो इसे घटाया जा सकता है। इंडेक्सर्स नेटवर्क में योगदान करने के लिए डेलीगेटर्स से प्रत्यायोजित हिस्सेदारी के लिए पुरस्कार भी अर्जित करते हैं।

इंडेक्सर्स सबग्राफ के क्यूरेशन सिग्नल के आधार पर इंडेक्स के लिए सबग्राफ का चयन करते हैं, जहां क्यूरेटर GRT को यह इंगित करने के लिए दांव पर लगाते हैं कि कौन से सबग्राफ उच्च-गुणवत्ता वाले हैं और उन्हें प्राथमिकता दी जानी चाहिए। उपभोक्ता (उदाहरण के लिए अनुप्रयोग) पैरामीटर भी सेट कर सकते हैं जिसके लिए इंडेक्सर्स अपने सबग्राफ के लिए प्रश्नों को प्रोसेस करते हैं और क्वेरी शुल्क मूल्य निर्धारण के लिए वरीयताएँ निर्धारित करते हैं।

<Difficulty level="ADVANCED" />

## सामान्य प्रश्न

### नेटवर्क पर इंडेक्सर बनने के लिए आवश्यक न्यूनतम हिस्सेदारी क्या है?

इंडेक्सर के लिए न्यूनतम हिस्सेदारी वर्तमान में 100K GRT पर सेट है।

### एक इंडेक्सर के लिए राजस्व धाराएं क्या हैं?

**प्रश्न शुल्क में छूट** - नेटवर्क पर प्रश्न प्रस्तुत करने के लिए भुगतान। ये भुगतान एक इंडेक्सर और गेटवे के बीच राज्य चैनलों के माध्यम से मध्यस्थ होते हैं। गेटवे से प्रत्येक क्वेरी अनुरोध में भुगतान होता है और संबंधित प्रतिक्रिया क्वेरी परिणाम वैधता का प्रमाण होती है।

**इंडेक्सिंग रिवार्ड्स** - 3% वार्षिक प्रोटोकॉल व्यापक मुद्रास्फीति के माध्यम से उत्पन्न, इंडेक्सिंग पुरस्कार उन इंडेक्सर्स को वितरित किए जाते हैं जो नेटवर्क के लिए सबग्राफ तैनाती को इंडेक्स कर रहे हैं।

### इंडेक्सिंग पुरस्कार कैसे वितरित किए जाते हैं?

अनुक्रमण पुरस्कार प्रोटोकॉल मुद्रास्फीति से आते हैं जो 3% वार्षिक जारी करने के लिए निर्धारित है। उन्हें प्रत्येक पर सभी क्यूरेशन सिग्नल के अनुपात के आधार पर सबग्राफ में वितरित किया जाता है, फिर उस सबग्राफ पर उनकी आवंटित हिस्सेदारी के आधार पर इंडेक्सर्स को आनुपातिक रूप से वितरित किया जाता है। **अनुक्रमण के एक वैध प्रमाण (POI) के साथ एक आवंटन बंद होना चाहिए जो पुरस्कारों के योग्य होने के लिए मध्यस्थता चार्टर द्वारा निर्धारित मानकों को पूरा करता है।**

पुरस्कारों की गणना के लिए समुदाय द्वारा कई उपकरण बनाए गए हैं; आपको उनका एक संग्रह [समुदाय गाइड संग्रह](https://www.notion.so/Community-Guides-abbb10f4dba040d5ba81648ca093e70c) में व्यवस्थित मिलेगा। आप [डिस्कॉर्ड सर्वर](https://discord.gg/vtvv7FP) पर #Delegators और #Indexers चैनल में टूल की अप टू डेट सूची भी पा सकते हैं। यहां हम अनुक्रमणिका सॉफ़्टवेयर स्टैक के साथ एकीकृत [अनुशंसित आवंटन अनुकूलक](https://github.com/graphprotocol/AllocationOpt.jl) को लिंक करते हैं।

### इंडेक्सिंग (पीओआई) का सबूत क्या है?

पीओआई का उपयोग नेटवर्क में यह सत्यापित करने के लिए किया जाता है कि एक इंडेक्सर उनके द्वारा आवंटित उपग्राफों को अनुक्रमित कर रहा है। इंडेक्सिंग पुरस्कारों के लिए पात्र होने के लिए उस आवंटन के आवंटन को बंद करते समय वर्तमान युग के पहले ब्लॉक के लिए एक पीओआई जमा किया जाना चाहिए। एक ब्लॉक के लिए एक पीओआई उस ब्लॉक तक और उस सहित एक विशिष्ट सबग्राफ परिनियोजन के लिए सभी एंटिटी स्टोर लेनदेन के लिए डाइजेस्ट है।

### अनुक्रमण पुरस्कार कब वितरित किए जाते हैं?

आवंटन लगातार पुरस्कार अर्जित कर रहे हैं जबकि वे सक्रिय हैं और 28 युगों के भीतर आवंटित किए गए हैं। इंडेक्सर्स द्वारा पुरस्कार एकत्र किए जाते हैं, और जब भी उनका आवंटन बंद हो जाता है, वितरित किया जाता है। यह या तो मैन्युअल रूप से होता है, जब भी इंडेक्सर उन्हें बंद करना चाहता है, या 28 युगों के बाद एक प्रतिनिधि इंडेक्सर के आवंटन को बंद कर सकता है, लेकिन इसका परिणाम कोई पुरस्कार नहीं होता है। 28 युग अधिकतम आवंटन जीवनकाल है (अभी, एक युग ~ 24h तक रहता है)।

### क्या लंबित अनुक्रमण पुरस्कारों की निगरानी की जा सकती है?

RewardsManager अनुबंध में केवल पढ़ने के लिए [getRewards](https://github.com/graphprotocol/contracts/blob/master/contracts/rewards/RewardsManager.sol#L317) फ़ंक्शन है जिसका उपयोग किया जा सकता है किसी विशिष्ट आवंटन के लिए लंबित पुरस्कारों की जांच करने के लिए।

कई समुदाय-निर्मित डैशबोर्ड में लंबित पुरस्कार मान शामिल हैं और इन चरणों का पालन करके उन्हें आसानी से मैन्युअल रूप से चेक किया जा सकता है:

1. सभी सक्रिय आवंटनों के लिए आईडी प्राप्त करने के लिए [मेननेट सबग्राफ](https://thegraph.com/hosted-service/subgraph/graphprotocol/graph-network-mainnet) को क्वेरी करें:

```graphql
query indexerAllocations {
  indexer(id: "<INDEXER_ADDRESS>") {
    allocations {
      activeForIndexer {
        allocations {
          id
        }
      }
    }
  }
}
```

`getRewards()` को कॉल करने के लिए इथरस्कैन का उपयोग करें:

- [इथरस्कैन इंटरफ़ेस टू रिवॉर्ड्स कॉन्ट्रैक्ट](https://etherscan.io/address/0x9Ac758AB77733b4150A901ebd659cbF8cB93ED66#readProxyContract) पर नेविगेट करें

* कॉल करने के लिए `getRewards()`:
  - **10 को विस्तृत करें। getRewards** ड्रॉपडाउन।
  - इनपुट में **allocationID** दर्ज करें।
  - **क्वेरी** बटन क्लिक करें.

### विवाद क्या हैं और मैं उन्हें कहां देख सकता हूं?

विवाद की अवधि के दौरान इंडेक्सर की पूछताछ और आवंटन दोनों को ग्राफ़ पर विवादित किया जा सकता है। विवाद के प्रकार के आधार पर विवाद की अवधि अलग-अलग होती है। प्रश्न/सत्यापन में 7 युग विवाद विंडो हैं, जबकि आवंटन में 56 युग हैं। इन अवधियों के बीत जाने के बाद, आवंटन या प्रश्नों में से किसी के विरुद्ध विवाद नहीं खोला जा सकता है। जब कोई विवाद खोला जाता है, तो मछुआरों द्वारा न्यूनतम 10,000 जीआरटी की जमा राशि की आवश्यकता होती है, जो विवाद को अंतिम रूप देने और समाधान दिए जाने तक बंद रहेगा। मछुआरे कोई भी नेटवर्क प्रतिभागी हैं जो विवाद खोलते हैं।

विवादों के **तीन** संभावित परिणाम होते हैं, वैसे ही मछुआरों की जमा राशि भी होती है।

- यदि विवाद को खारिज कर दिया जाता है, तो मछुआरों द्वारा जमा किए गए जीआरटी को जला दिया जाएगा और विवादित इंडेक्सर को नहीं काटा जाएगा।
- यदि विवाद ड्रा के रूप में सुलझाया जाता है, तो मछुआरों की जमा राशि वापस कर दी जाएगी, और विवादित इंडेक्सर को नहीं काटा जाएगा।
- यदि विवाद स्वीकार किया जाता है, तो मछुआरों द्वारा जमा किया गया जीआरटी वापस कर दिया जाएगा, विवादित इंडेक्सर को घटा दिया जाएगा और मछुआरे घटे हुए जीआरटी का 50% अर्जित करेंगे।

`विवाद` टैब के अंतर्गत इंडेक्सर के प्रोफ़ाइल पृष्ठ में UI में विवादों को देखा जा सकता है।

### प्रश्न शुल्क छूट क्या हैं और वे कब वितरित की जाती हैं?

जब भी आवंटन बंद हो जाता है और सबग्राफ के क्वेरी शुल्क रिबेट पूल में जमा हो जाता है तो क्वेरी शुल्क गेटवे द्वारा एकत्र किया जाता है। रिबेट पूल को इंडेक्सर्स को प्रोत्साहित करने के लिए डिज़ाइन किया गया है कि वे नेटवर्क के लिए कमाए जाने वाले क्वेरी शुल्क की राशि के मोटे अनुपात में हिस्सेदारी आवंटित करें। पूल में क्वेरी फीस का हिस्सा जो एक विशेष इंडेक्सर को आवंटित किया जाता है, कोब-डगलस प्रोडक्शन फंक्शन का उपयोग करके गणना की जाती है; प्रति इंडेक्सर वितरित राशि पूल में उनके योगदान और सबग्राफ पर हिस्सेदारी के आवंटन का एक कार्य है।

एक बार जब आवंटन बंद हो जाता है और विवाद की अवधि बीत जाती है तो इंडेक्सर द्वारा दावा किए जाने के लिए छूट उपलब्ध होती है। दावा करने पर, क्वेरी शुल्क कटौती क्वेरी शुल्क कटौती और प्रतिनिधिमंडल पूल अनुपात के आधार पर इंडेक्सर और उनके प्रतिनिधियों को क्वेरी शुल्क छूट वितरित की जाती है।

### क्वेरी फी कट और इंडेक्सिंग रिवॉर्ड कट क्या है?

`queryFeeCut` और `indexingRewardCut` मान डेलिगेशन पैरामीटर हैं जिन्हें इंडेक्सर और उनके डेलीगेटर्स के बीच GRT के वितरण को नियंत्रित करने के लिए इंडेक्सर cooldownBlocks के साथ सेट कर सकता है। प्रतिनिधिमंडल पैरामीटर सेट करने के निर्देशों के लिए [प्रोटोकॉल में स्टेकिंग](/network/indexing#stake-in-the-protocol) में अंतिम चरण देखें।

- **queryFeeCut** - क्वेरी शुल्क का % सबग्राफ पर संचित छूट का % होता है जिसे इंडेक्सर को वितरित किया जाएगा। यदि इसे 95% पर सेट किया जाता है, तो इंडेक्सर को क्वेरी शुल्क रिबेट पूल का 95% प्राप्त होगा जब एक आवंटन का दावा किया जाता है और अन्य 5% प्रतिनिधियों के पास जाता है।

- **indexingRewardCut** - एक सबग्राफ पर संचित इंडेक्सिंग पुरस्कारों का % जो इंडेक्सर को वितरित किया जाएगा। यदि इसे 95% पर सेट किया जाता है, तो आवंटन बंद होने पर इंडेक्सर को इंडेक्सिंग पुरस्कार पूल का 95% प्राप्त होगा और प्रतिनिधि अन्य 5% को विभाजित कर देंगे।

### इंडेक्सर्स कैसे जानते हैं कि इंडेक्स करने के लिए कौन से सबग्राफ हैं?

इंडेक्सर्स सबग्राफ इंडेक्सिंग निर्णय लेने के लिए उन्नत तकनीकों को लागू करके खुद को अलग कर सकते हैं लेकिन एक सामान्य विचार देने के लिए हम नेटवर्क में सबग्राफ का मूल्यांकन करने के लिए उपयोग की जाने वाली कई प्रमुख मीट्रिक पर चर्चा करेंगे:

- **क्यूरेशन सिग्नल** - किसी विशेष सबग्राफ पर लागू नेटवर्क क्यूरेशन सिग्नल का अनुपात उस सबग्राफ में रुचि का एक अच्छा संकेतक है, विशेष रूप से बूटस्ट्रैप चरण के दौरान जब क्वेरी वॉल्यूमिंग बढ़ रही है.

- **एकत्रित क्वेरी शुल्क** - किसी विशिष्ट सबग्राफ के लिए एकत्र किए गए क्वेरी शुल्क की मात्रा का ऐतिहासिक डेटा भविष्य की मांग का एक अच्छा संकेतक है।

- **दांव की गई राशि** - अन्य इंडेक्सर्स के व्यवहार की निगरानी करना या विशिष्ट सबग्राफ के लिए आवंटित कुल हिस्सेदारी के अनुपात को देखने से एक इंडेक्सर को सबग्राफ की पहचान करने के लिए सबग्राफ प्रश्नों के लिए आपूर्ति पक्ष की निगरानी करने की अनुमति मिल सकती है नेटवर्क विश्वास दिखा रहा है या सबग्राफ जो अधिक आपूर्ति की आवश्यकता दिखा सकता है।

- **बिना इंडेक्सिंग रिवार्ड वाले सबग्राफ** - कुछ सबग्राफ इंडेक्सिंग रिवार्ड्स उत्पन्न नहीं करते हैं, क्योंकि वे मुख्य रूप से IPFS जैसी असमर्थित सुविधाओं का उपयोग कर रहे हैं या क्योंकि वे मेननेट के बाहर किसी अन्य नेटवर्क से पूछताछ कर रहे हैं। यदि यह इंडेक्सिंग पुरस्कार उत्पन्न नहीं कर रहा है तो आपको सबग्राफ पर एक संदेश दिखाई देगा।

### हार्डवेयर आवश्यकताएँ क्या हैं?

- **छोटा** - कई सबग्राफ का अनुक्रमण शुरू करने के लिए पर्याप्त है, संभवतः इसे विस्तारित करने की आवश्यकता होगी।
- **मानक** - डिफ़ॉल्ट सेटअप, उदाहरण k8s/terraform परिनियोजन मेनिफेस्ट में इसका उपयोग किया जाता है।
- **माध्यम** - प्रोडक्शन इंडेक्सर प्रति सेकंड 100 सबग्राफ और 200-500 अनुरोधों का समर्थन करता है।
- **बड़ा** - वर्तमान में उपयोग किए जाने वाले सभी सबग्राफ को अनुक्रमित करने और संबंधित ट्रैफ़िक के अनुरोधों को पूरा करने के लिए तैयार है।

| Setup    | Postgres<br />(CPUs) | Postgres<br />(memory in GBs) | Postgres<br />(disk in TBs) | VMs<br />(CPUs) | VMs<br />(memory in GBs) |
| -------- |:--------------------------:|:-----------------------------------:|:---------------------------------:|:---------------------:|:------------------------------:|
| Small    |             4              |                  8                  |                 1                 |           4           |               16               |
| Standard |             8              |                 30                  |                 1                 |          12           |               48               |
| Medium   |             16             |                 64                  |                 2                 |          32           |               64               |
| Large    |             72             |                 468                 |                3.5                |          48           |              184               |

### एक इंडेक्सर को कौन सी बुनियादी सुरक्षा सावधानियां बरतनी चाहिए?

- **ऑपरेटर वॉलेट** - ऑपरेटर वॉलेट सेट करना एक महत्वपूर्ण एहतियात है क्योंकि यह एक इंडेक्सर को उनकी चाबियों के बीच अलगाव बनाए रखने की अनुमति देता है जो हिस्सेदारी को नियंत्रित करती हैं और जो दिन-प्रतिदिन के संचालन को नियंत्रित करती हैं। निर्देशों के लिए [प्रोटोकॉल में हिस्सेदारी](/network/indexing#stake-in-the-protocol) देखें।

- **फ़ायरवॉल** - केवल इंडेक्सर सेवा को सार्वजनिक रूप से प्रदर्शित करने की आवश्यकता है और एडमिन पोर्ट और डेटाबेस एक्सेस को लॉक करने पर विशेष ध्यान दिया जाना चाहिए: ग्राफ़ नोड JSON-RPC समापन बिंदु (डिफ़ॉल्ट पोर्ट): 8030), इंडेक्सर मैनेजमेंट एपीआई एंडपॉइंट (डिफ़ॉल्ट पोर्ट: 18000), और पोस्टग्रेज डेटाबेस एंडपॉइंट (डिफ़ॉल्ट पोर्ट: 5432) को उजागर नहीं किया जाना चाहिए।

## आधारभूत संरचना

एक इंडेक्सर के बुनियादी ढांचे के केंद्र में ग्राफ नोड है जो एथेरियम की निगरानी करता है, एक सबग्राफ परिभाषा के अनुसार डेटा निकालता है और लोड करता है और इसे [GraphQL API](/about/#how-the-graph-works) के रूप में कार्य करता है। ग्राफ़ नोड को डेटा सोर्सिंग के लिए एथेरियम ईवीएम नोड एंडपॉइंट्स और आईपीएफएस नोड से कनेक्ट करने की आवश्यकता है; इसके स्टोर के लिए एक PostgreSQL डेटाबेस; और इंडेक्सर घटक जो नेटवर्क के साथ अपनी बातचीत की सुविधा प्रदान करते हैं।

- **PostgreSQL डेटाबेस** - ग्राफ नोड के लिए मुख्य स्टोर, यह वह जगह है जहां सबग्राफ डेटा संग्रहीत किया जाता है। इंडेक्सर सेवा और एजेंट राज्य चैनल डेटा, लागत मॉडल, अनुक्रमण नियम और आवंटन क्रियाओं को संग्रहीत करने के लिए डेटाबेस का भी उपयोग करते हैं।

- **Ethereum endpoint** - एक समापन बिंदु जो एक Ethereum JSON-RPC API को उजागर करता है। यह एकल एथेरियम क्लाइंट का रूप ले सकता है या यह एक अधिक जटिल सेटअप हो सकता है जो कई में संतुलन को लोड करता है। यह जानना महत्वपूर्ण है कि कुछ उप-अनुच्छेदों के लिए विशेष एथेरियम क्लाइंट क्षमताओं की आवश्यकता होगी जैसे कि आर्काइव मोड और ट्रेसिंग एपीआई।

- **IPFS नोड (5 से कम संस्करण)** - सबग्राफ परिनियोजन मेटाडेटा IPFS नेटवर्क पर संग्रहीत है। सबग्राफ मैनिफ़ेस्ट और सभी लिंक की गई फ़ाइलों को लाने के लिए सबग्राफ़ परिनियोजन के दौरान ग्राफ़ नोड मुख्य रूप से IPFS नोड तक पहुँचता है। नेटवर्क इंडेक्सर्स को अपने स्वयं के IPFS नोड को होस्ट करने की आवश्यकता नहीं है, नेटवर्क के लिए एक IPFS नोड https://ipfs.network.thegraph.com पर होस्ट किया गया है।

- **इंडेक्सर सेवा** - नेटवर्क के साथ सभी आवश्यक बाहरी संचार को संभालती है। शेयर लागत मॉडल और अनुक्रमण स्थिति, गेटवे से ग्राफ़ नोड पर क्वेरी अनुरोधों को पास करता है, और गेटवे के साथ राज्य चैनलों के माध्यम से क्वेरी भुगतान का प्रबंधन करता है।

- **इंडेक्सर एजेंट** - नेटवर्क पर पंजीकरण, इसके ग्राफ नोड/एस पर सबग्राफ परिनियोजन प्रबंधित करने और आवंटन प्रबंधित करने सहित श्रृंखला पर इंडेक्सर्स इंटरैक्शन की सुविधा प्रदान करता है।

- **प्रोमेथियस मेट्रिक्स सर्वर** - ग्राफ नोड और इंडेक्सर घटक अपने मेट्रिक्स को मेट्रिक्स सर्वर पर लॉग करते हैं।

नोट: फुर्तीली स्केलिंग का समर्थन करने के लिए, यह अनुशंसा की जाती है कि क्वेरी और इंडेक्सिंग चिंताओं को नोड्स के विभिन्न सेटों के बीच अलग किया जाए: क्वेरी नोड्स और इंडेक्स नोड्स।

### Ports overview

> **महत्वपूर्ण**: बंदरगाहों को सार्वजनिक रूप से उजागर करने के बारे में सावधान रहें - **प्रशासन बंदरगाहों** को बंद रखा जाना चाहिए। इसमें ग्राफ़ नोड JSON-RPC और अनुक्रमणिका प्रबंधन समापन बिंदु शामिल हैं जिनका विवरण नीचे दिया गया है।

#### ग्राफ नोड

| Port | Purpose                                                  | Routes                                               | CLI Argument      | Environment Variable |
| ---- | -------------------------------------------------------- | ---------------------------------------------------- | ----------------- | -------------------- |
| 8000 | GraphQL HTTP server<br />(सबग्राफ प्रश्नों के लिए) | /subgraphs/id/...<br />/subgraphs/name/.../... | --http-port       | -                    |
| 8001 | GraphQL WS<br />(सबग्राफ सब्सक्रिप्शन के लिए)      | /subgraphs/id/...<br />/subgraphs/name/.../... | --ws-port         | -                    |
| 8020 | JSON-RPC<br />(तैनाती के प्रबंधन के लिए)           | /                                                    | --admin-port      | -                    |
| 8030 | Subgraph indexing status API                             | /graphql                                             | --index-node-port | -                    |
| 8040 | Prometheus metrics                                       | /metrics                                             | --metrics-port    | -                    |

#### Indexer Service

| Port | Purpose                                                  | Routes                                                                  | CLI Argument   | Environment Variable   |
| ---- | -------------------------------------------------------- | ----------------------------------------------------------------------- | -------------- | ---------------------- |
| 7600 | GraphQL HTTP server<br />(सबग्राफ प्रश्नों के लिए) | /subgraphs/id/...<br />/status<br />/channel-messages-inbox | --port         | `INDEXER_SERVICE_PORT` |
| 7300 | Prometheus metrics                                       | /metrics                                                                | --metrics-port | -                      |

#### Indexer Agent

| Port | Purpose                | Routes | CLI Argument              | Environment Variable                    |
| ---- | ---------------------- | ------ | ------------------------- | --------------------------------------- |
| 8000 | Indexer management API | /      | --indexer-management-port | `INDEXER_AGENT_INDEXER_MANAGEMENT_PORT` |

### Google क्लाउड पर टेराफॉर्म का उपयोग करके सर्वर इंफ्रास्ट्रक्चर सेटअप करें

> नोट: इंडेक्सर वैकल्पिक रूप से AWS, Microsoft Azure, या अलीबाबा का उपयोग कर सकते हैं।

#### Install prerequisites

- Google Cloud SDK
- Kubectl command line tool
- Terraform

#### एक Google क्लाउड प्रोजेक्ट बनाएं

- Clone or navigate to the Indexer repository.

- ./terraform निर्देशिका पर नेविगेट करें, यह वह जगह है जहां सभी आदेशों को क्रियान्वित किया जाना चाहिए।

```sh
cd terraform
```

- Google क्लाउड से प्रमाणित करें और एक नया प्रोजेक्ट बनाएं।

```sh
gcloud auth login
project=<PROJECT_NAME>
gcloud projects create --enable-cloud-apis $project
```

- नए प्रोजेक्ट के लिए बिलिंग सक्षम करने के लिए Google क्लाउड कंसोल के बिलिंग पृष्ठ का उपयोग करें।

- Create a Google Cloud configuration.

```sh
proj_id=$(gcloud projects list --format='get(project_id)' --filter="name=$project")
gcloud config configurations create $project
gcloud config set project "$proj_id"
gcloud config set compute/region us-central1
gcloud config set compute/zone us-central1-a
```

- आवश्यक Google क्लाउड एपीआई सक्षम करें।

```sh
gcloud services enable compute.googleapis.com
gcloud services enable container.googleapis.com
gcloud services enable servicenetworking.googleapis.com
gcloud services enable sqladmin.googleapis.com
```

- एक सेवा खाता बनाएँ।

```sh
svc_name=<SERVICE_ACCOUNT_NAME>
gcloud iam service-accounts create $svc_name \
  --description="Service account for Terraform" \
  --display-name="$svc_name"
gcloud iam service-accounts list
# Get the email of the service account from the list
svc=$(gcloud iam service-accounts list --format='get(email)'
--filter="displayName=$svc_name")
gcloud iam service-accounts keys create .gcloud-credentials.json \
  --iam-account="$svc"
gcloud projects add-iam-policy-binding $proj_id \
  --member serviceAccount:$svc \
  --role roles/editor
```

- डेटाबेस और Kubernetes क्लस्टर के बीच पियरिंग सक्षम करें जो अगले चरण में बनाया जाएगा।

```sh
gcloud compute addresses create google-managed-services-default \
  --prefix-length=20 \
  --purpose=VPC_PEERING \
  --network default \
  --global \
  --description 'IP Range for peer networks.'
gcloud services vpc-peerings connect \
  --network=default \
  --ranges=google-managed-services-default
```

- न्यूनतम टेराफ़ॉर्म कॉन्फ़िगरेशन फ़ाइल बनाएँ (आवश्यकतानुसार अद्यतन करें)।

```sh
indexer=<INDEXER_NAME>
cat > terraform.tfvars <<EOF
project = "$proj_id"
indexer = "$indexer"
database_password = "<database passowrd>"
EOF
```

#### इंफ्रास्ट्रक्चर बनाने के लिए टेराफॉर्म का इस्तेमाल करें

कोई भी आदेश चलाने से पहले, [variables.tf](https://github.com/graphprotocol/indexer/blob/main/terraform/variables.tf) को पढ़ें और `terraform फ़ाइल बनाएं.tfvars` इस निर्देशिका में (या जिसे हमने अंतिम चरण में बनाया था उसे संशोधित करें)। प्रत्येक वेरिएबल के लिए जहां आप डिफ़ॉल्ट को ओवरराइड करना चाहते हैं, या जहां आपको मान सेट करने की आवश्यकता है, `terraform.tfvars` में एक सेटिंग दर्ज करें।

- इन्फ्रास्ट्रक्चर बनाने के लिए निम्नलिखित कमांड चलाएँ।

```sh
# Install required plugins
terraform init

# View plan for resources to be created
terraform plan

# Create the resources (expect it to take up to 30 minutes)
terraform apply
```

नए क्लस्टर के लिए `~/.kube/config` में क्रेडेंशियल्स डाउनलोड करें और इसे अपने डिफ़ॉल्ट संदर्भ के रूप में सेट करें।

```sh
gcloud container clusters get-credentials $indexer
kubectl config use-context $(kubectl config get-contexts --output='name'
| grep $indexer)
```

#### इंडेक्सर के लिए कुबेरनेट्स घटक बनाना

- निर्देशिका `k8s/overlays` को एक नई निर्देशिका `$dir,` में कॉपी करें और `bases` प्रविष्टि को `$dir/kustomization.yaml< में समायोजित करें /code> ताकि यह <code>k8s/base` निर्देशिका को इंगित करे।

- `$dir` में सभी फाइलों को पढ़ें और टिप्पणियों में बताए अनुसार किसी भी मान को समायोजित करें।

`kubectl apply -k $dir` के साथ सभी संसाधन परिनियोजित करें।

### ग्राफ नोड

[ग्राफ नोड](https://github.com/graphprotocol/graph-node) एक ओपन सोर्स रस्ट इम्प्लीमेंटेशन है, जो इवेंट सोर्स एथेरियम ब्लॉकचैन को डेटा स्टोर को निश्चित रूप से अपडेट करने के लिए देता है, जिसे ग्राफक्लाइन एंडपॉइंट के माध्यम से क्वेरी किया जा सकता है। डेवलपर्स अपने स्कीमा को परिभाषित करने के लिए सबग्राफ का उपयोग करते हैं, और ब्लॉक श्रृंखला से प्राप्त डेटा को बदलने के लिए मैपिंग का एक सेट और ग्राफ नोड पूरी श्रृंखला को सिंक करने, नए ब्लॉकों की निगरानी करने और इसे एक ग्राफक्यूएल समापन बिंदु के माध्यम से सेवा देने का काम करता है।

#### स्रोत से प्रारंभ करना

#### Install prerequisites

- **Rust**

- **PostgreSQL**

- **IPFS**

- **उबंटू उपयोगकर्ताओं के लिए अतिरिक्त आवश्यकताएं** - उबंटू पर ग्राफ नोड चलाने के लिए कुछ अतिरिक्त पैकेजों की आवश्यकता हो सकती है।

```sh
sudo apt-get install -y clang libpg-dev libssl-dev pkg-config
```

#### Setup

1. एक PostgreSQL डेटाबेस सर्वर प्रारंभ करें

```sh
initdb -D .postgres
pg_ctl -D .postgres -l logfile start
createdb graph-node
```

2. [ग्राफ़ नोड](https://github.com/graphprotocol/graph-node) रेपो क्लोन करें और `cargo build` चलाकर स्रोत बनाएं

3. अब जब सभी निर्भरताएँ स्थापित हो गई हैं, तो ग्राफ़ नोड प्रारंभ करें:

```sh
cargo run -p graph-node --release -- \
  --postgres-url postgresql://[USERNAME]:[PASSWORD]@localhost:5432/graph-node \
  --ethereum-rpc [NETWORK_NAME]:[URL] \
  --ipfs https://ipfs.network.thegraph.com
```

#### डॉकर का उपयोग शुरू करना

#### आवश्यक शर्तें

- **एथेरियम नोड** - डिफ़ॉल्ट रूप से, डॉकर कंपोज़ सेटअप मेननेट का उपयोग करेगा: [http://host.docker.internal:8545](http://host.docker.internal:8545) आपके होस्ट मशीन पर एथेरियम नोड से कनेक्ट करने के लिए। `docker-compose.yaml` को अपडेट करके आप इस नेटवर्क नाम और url को बदल सकते हैं।

#### Setup

1. क्लोन ग्राफ़ नोड और डॉकर निर्देशिका पर नेविगेट करें:

```sh
git clone http://github.com/graphprotocol/graph-node
cd graph-node/docker
```

2. केवल Linux उपयोगकर्ताओं के लिए - शामिल स्क्रिप्ट का उपयोग करके `host.docker.internal` के बजाय `docker-compose.yaml` में होस्ट IP पते का उपयोग करें:

```sh
./setup.sh
```

3. एक स्थानीय ग्राफ़ नोड प्रारंभ करें जो आपके एथेरियम समापन बिंदु से जुड़ जाएगा:

```sh
docker-compose up
```

### Indexer components

नेटवर्क में सफलतापूर्वक भाग लेने के लिए लगभग निरंतर निगरानी और सहभागिता की आवश्यकता होती है, इसलिए हमने इंडेक्सर्स नेटवर्क भागीदारी को सुविधाजनक बनाने के लिए टाइपस्क्रिप्ट एप्लिकेशन का एक सूट बनाया है। तीन इंडेक्सर घटक हैं:

- **इंडेक्सर एजेंट** - एजेंट नेटवर्क और इंडेक्सर के अपने इंफ्रास्ट्रक्चर की निगरानी करता है और प्रबंधित करता है कि कौन से सबग्राफ परिनियोजन अनुक्रमित हैं और चेन पर आवंटित किए गए हैं और प्रत्येक के लिए कितना आवंटित किया गया है।

- **इंडेक्सर सेवा** - एकमात्र घटक जिसे बाहरी रूप से प्रदर्शित करने की आवश्यकता होती है, सेवा ग्राफ नोड को सबग्राफ क्वेरी भेजती है, क्वेरी भुगतान के लिए राज्य चैनल प्रबंधित करती है, महत्वपूर्ण निर्णय लेने की जानकारी साझा करती है गेटवे जैसे ग्राहकों के लिए।

- **इंडेक्सर सीएलआई** - इंडेक्सर एजेंट को प्रबंधित करने के लिए कमांड लाइन इंटरफ़ेस। यह इंडेक्सर्स को लागत मॉडल, मैन्युअल आवंटन, एक्शन क्यू और इंडेक्सिंग नियमों को प्रबंधित करने की अनुमति देता है।

#### शुरू करना

इंडेक्सर एजेंट और इंडेक्सर सेवा को आपके ग्राफ नोड इंफ्रास्ट्रक्चर के साथ सह-स्थित होना चाहिए। आपके इंडेक्सर घटकों के लिए आभासी निष्पादन वातावरण स्थापित करने के कई तरीके हैं; यहां हम बताएंगे कि एनपीएम पैकेज या स्रोत का उपयोग करके या Google क्लाउड कुबेरनेट इंजन पर कुबेरनेट्स और डॉकटर के माध्यम से उन्हें नंगे धातु पर कैसे चलाना है। यदि ये सेटअप उदाहरण आपके बुनियादी ढांचे में अच्छी तरह से अनुवाद नहीं करते हैं, तो संभवतः संदर्भ के लिए एक सामुदायिक मार्गदर्शिका होगी, आइए [Discord](https://thegraph.com/discord) पर नमस्ते कहें! अपने इंडेक्सर घटकों को शुरू करने से पहले [प्रोटोकॉल में हिस्सेदारी](/network/indexing#stake-in-the-protocol) याद रखें!

#### From NPM packages

```sh
npm install -g @graphprotocol/indexer-service
npm install -g @graphprotocol/indexer-agent

# Indexer CLI is a plugin for Graph CLI, so both need to be installed:
npm install -g @graphprotocol/graph-cli
npm install -g @graphprotocol/indexer-cli

# Indexer service
graph-indexer-service start ...

# Indexer agent
graph-indexer-agent start ...

# Indexer CLI
#Forward the port of your agent pod if using Kubernetes
kubectl port-forward pod/POD_ID 18000:8000
graph indexer connect http://localhost:18000/
graph indexer ...
```

#### From source

```sh
# From Repo root directory
yarn

# Indexer Service
cd packages/indexer-service
./bin/graph-indexer-service start ...

# Indexer agent
cd packages/indexer-agent
./bin/graph-indexer-service start ...

# Indexer CLI
cd packages/indexer-cli
./bin/graph-indexer-cli indexer connect http://localhost:18000/
./bin/graph-indexer-cli indexer ...
```

#### Using docker

- रजिस्ट्री से चित्र खींचे

```sh
docker pull ghcr.io/graphprotocol/indexer-service:latest
docker pull ghcr.io/graphprotocol/indexer-agent:latest
```

या स्रोत से स्थानीय रूप से छवियां बनाएं

```sh
# Indexer service
docker build \
  --build-arg NPM_TOKEN=<npm-token> \
  -f Dockerfile.indexer-service \
  -t indexer-service:latest \
# Indexer agent
docker build \
  --build-arg NPM_TOKEN=<npm-token> \
  -f Dockerfile.indexer-agent \
  -t indexer-agent:latest \
```

- घटकों को चलाएँ

```sh
docker run -p 7600:7600 -it indexer-service:latest ...
docker run -p 18000:8000 -it indexer-agent:latest ...
```

**ध्यान दें**: कंटेनर शुरू करने के बाद, अनुक्रमणिका सेवा [http://localhost:7600](http://localhost:7600) पर पहुंच योग्य होनी चाहिए और अनुक्रमणिका एजेंट को [http://localhost:18000/](http://localhost:18000/) पर अनुक्रमणिका प्रबंधन API को प्रदर्शित करना चाहिए।

#### K8s और टेराफॉर्म का उपयोग करना

[Google क्लाउड पर Terraform का उपयोग करके सेटअप सर्वर इन्फ्रास्ट्रक्चर](/network/indexing#setup-server-infrastructure-using-terraform-on-google-cloud) अनुभाग देखें

#### प्रयोग

> **ध्यान दें**: सभी रनटाइम कॉन्फ़िगरेशन चर या तो स्टार्टअप पर कमांड के पैरामीटर के रूप में या `COMPONENT_NAME_VARIABLE_NAME`(उदा. `INDEXER_AGENT_ETHEREUM`) प्रारूप के पर्यावरण चर का उपयोग करके लागू किए जा सकते हैं).

#### इंडेक्सर एजेंट

```sh
graph-indexer-agent start \
  --ethereum <MAINNET_ETH_ENDPOINT> \
  --ethereum-network mainnet \
  --mnemonic <MNEMONIC> \
  --indexer-address <INDEXER_ADDRESS> \
  --graph-node-query-endpoint http://localhost:8000/ \
  --graph-node-status-endpoint http://localhost:8030/graphql \
  --graph-node-admin-endpoint http://localhost:8020/ \
  --public-indexer-url http://localhost:7600/ \
  --indexer-geo-coordinates <YOUR_COORDINATES> \
  --index-node-ids default \
  --indexer-management-port 18000 \
  --metrics-port 7040 \
  --network-subgraph-endpoint https://gateway.network.thegraph.com/network \
  --default-allocation-amount 100 \
  --register true \
  --inject-dai true \
  --postgres-host localhost \
  --postgres-port 5432 \
  --postgres-username <DB_USERNAME> \
  --postgres-password <DB_PASSWORD> \
  --postgres-database indexer \
  --allocation-management auto \
  | pino-pretty
```

#### Indexer Service

```sh
SERVER_HOST=localhost \
SERVER_PORT=5432 \
SERVER_DB_NAME=is_staging \
SERVER_DB_USER=<DB_USERNAME> \
SERVER_DB_PASSWORD=<DB_PASSWORD> \
graph-indexer-service start \
  --ethereum <MAINNET_ETH_ENDPOINT> \
  --ethereum-network mainnet \
  --mnemonic <MNEMONIC> \
  --indexer-address <INDEXER_ADDRESS> \
  --port 7600 \
  --metrics-port 7300 \
  --graph-node-query-endpoint http://localhost:8000/ \
  --graph-node-status-endpoint http://localhost:8030/graphql \
  --postgres-host localhost \
  --postgres-port 5432 \
  --postgres-username <DB_USERNAME> \
  --postgres-password <DB_PASSWORD> \
  --postgres-database is_staging \
  --network-subgraph-endpoint https://gateway.network.thegraph.com/network \
  | pino-pretty
```

#### Indexer CLI

इंडेक्सर सीएलआई [`@graphprotocol/graph-cli`](https://www.npmjs.com/package/@graphprotocol/graph-cli) के लिए एक प्लगइन है, जिसे `ग्राफ इंडेक्सर` पर टर्मिनल में एक्सेस किया जा सकता है।

```sh
graph indexer connect http://localhost:18000
graph indexer status
```

#### इंडेक्सर सीएलआई का उपयोग कर इंडेक्सर प्रबंधन

**इंडेक्सर मैनेजमेंट एपीआई** के साथ इंटरैक्ट करने के लिए सुझाया गया टूल **इंडेक्सर सीएलआई** है, जो **ग्राफ़ सीएलआई** का विस्तार है। इंडेक्सर की ओर से नेटवर्क के साथ स्वायत्तता से इंटरैक्ट करने के लिए इंडेक्सर एजेंट को इंडेक्सर से इनपुट की आवश्यकता होती है। **आवंटन प्रबंधन** मोड और **अनुक्रमण नियम** इंडेक्सर एजेंट के व्यवहार को परिभाषित करने के तंत्र हैं। ऑटो मोड के तहत, एक इंडेक्सर **इंडेक्सिंग नियमों** का उपयोग इंडेक्स के लिए सबग्राफ चुनने और प्रश्नों को प्रस्तुत करने के लिए अपनी विशिष्ट रणनीति को लागू करने के लिए कर सकता है। नियमों को एजेंट द्वारा प्रदत्त ग्राफ़क्यूएल एपीआई के माध्यम से प्रबंधित किया जाता है और इसे इंडेक्सर मैनेजमेंट एपीआई के रूप में जाना जाता है। मैनुअल मोड के तहत, एक इंडेक्सर **कार्रवाई कतार** का उपयोग करके आवंटन क्रियाएं बना सकता है और उन्हें निष्पादित करने से पहले स्पष्ट रूप से अनुमोदित कर सकता है। निरीक्षण मोड के तहत, **अनुक्रमण नियम** का उपयोग **कार्रवाई कतार** को भरने के लिए किया जाता है और निष्पादन के लिए स्पष्ट स्वीकृति की भी आवश्यकता होती है।

#### प्रयोग

**इंडेक्सर सीएलआई** आमतौर पर पोर्ट-फ़ॉरवर्डिंग के माध्यम से इंडेक्सर एजेंट से जुड़ता है, इसलिए सीएलआई को उसी सर्वर या क्लस्टर पर चलाने की आवश्यकता नहीं होती है। आरंभ करने में आपकी मदद करने के लिए, और कुछ संदर्भ प्रदान करने के लिए, सीएलआई का संक्षेप में वर्णन यहाँ किया जाएगा।

- `ग्राफ़ इंडेक्सर कनेक्ट <url>` - इंडेक्सर मैनेजमेंट एपीआई से कनेक्ट करें। आमतौर पर सर्वर से कनेक्शन पोर्ट फ़ॉरवर्डिंग के माध्यम से खोला जाता है, इसलिए सीएलआई को दूर से आसानी से संचालित किया जा सकता है। (उदाहरण: `kubectl port-forward pod/<indexer-agent-pod> 8000:8000`)

- `graph indexer rules get [options] <deployment-id> [<key1> ...]` - Get one or more indexing rules using `all` as the `<deployment-id>` to get all rules, or `global` to get the global defaults. An additional argument `--merged` can be used to specify that deployment specific rules are merged with the global rule. This is how they are applied in the Indexer agent.

- `graph indexer rules set [options] <deployment-id> <key1> <value1> ...` - Set one or more indexing rules.

- `graph indexer rules start [options] <deployment-id>` - Start indexing a subgraph deployment if available and set its `decisionBasis` to `always`, so the Indexer agent will always choose to index it. If the global rule is set to always then all available subgraphs on the network will be indexed.

- `ग्राफ़ इंडेक्सर नियम स्टॉप [विकल्प] <परिनियोजन-आईडी>` - किसी परिनियोजन को अनुक्रमित करना बंद करें और इसके `decisionBasis` को कभी भी सेट न करें, इसलिए यह परिनियोजन पर निर्णय लेते समय इस परिनियोजन को छोड़ देगा अनुक्रमणिका।

- `ग्राफ़ अनुक्रमणिका नियम हो सकता है [विकल्प] <deployment-id>` — परिनियोजन के लिए `निर्णय आधार` को `नियमों` पर सेट करें, ताकि अनुक्रमणिका एजेंट अनुक्रमण नियमों का उपयोग करेगा यह तय करने के लिए कि इस परिनियोजन को अनुक्रमित करना है या नहीं।

- `ग्राफ़ अनुक्रमणिका क्रियाओं को [विकल्प] <कार्रवाई-आईडी>` मिलता है - `सभी` का उपयोग करके एक या अधिक क्रियाएं प्राप्त करें या प्राप्त करने के लिए `कार्रवाई-आईडी` खाली छोड़ दें सभी क्रियाएं। एक अतिरिक्त तर्क `--status` का उपयोग किसी निश्चित स्थिति के सभी कार्यों को प्रिंट करने के लिए किया जा सकता है।

- `ग्राफ इंडेक्सर एक्शन कतार आवंटन <deployment-id> <allocation-amount>` - कतार आवंटन कार्रवाई

- `graph indexer action queue reallocate <deployment-id> <allocation-id> <allocationAmount>` - Queue reallocate action

- `ग्राफ़ अनुक्रमणिका कार्रवाई कतार अनावंटित करें <परिनियोजन-आईडी> <आवंटन-आईडी>` - क्यू अनलोकेट एक्शन

- `ग्राफ इंडेक्सर क्रियाएं रद्द [<action-id> ...]` - यदि आईडी निर्दिष्ट नहीं है तो कतार में सभी क्रियाएं रद्द करें, अन्यथा विभाजक के रूप में स्थान के साथ आईडी की सरणी रद्द करें

- `ग्राफ़ अनुक्रमणिका क्रियाएँ स्वीकृत [<कार्रवाई-आईडी> ...]` - निष्पादन के लिए कई कार्यों को स्वीकृति दें

- `ग्राफ़ अनुक्रमणिका क्रियाएँ स्वीकृत निष्पादित करती हैं` - कार्यकर्ता को स्वीकृत क्रियाओं को तुरंत निष्पादित करने के लिए बाध्य करें

सभी आदेश जो आउटपुट में नियम प्रदर्शित करते हैं, समर्थित आउटपुट स्वरूपों (`तालिका`, `yaml`, और `json`) के बीच ` का उपयोग करके चुन सकते हैं - आउटपुट ` तर्क।

#### Indexing rules

इंडेक्सिंग नियम या तो वैश्विक डिफ़ॉल्ट के रूप में लागू किए जा सकते हैं या विशिष्ट सबग्राफ परिनियोजन के लिए उनकी आईडी का उपयोग कर सकते हैं। `परिनियोजन` और `निर्णय के आधार` फ़ील्ड अनिवार्य हैं, जबकि अन्य सभी फ़ील्ड वैकल्पिक हैं। जब एक इंडेक्सिंग नियम में `नियम` `निर्णय के आधार` के रूप में होते हैं, तो इंडेक्सर एजेंट उस नियम पर गैर-शून्य थ्रेशोल्ड मानों की तुलना संबंधित परिनियोजन के लिए नेटवर्क से प्राप्त मानों से करेगा। यदि सबग्राफ परिनियोजन में किसी भी सीमा के ऊपर (या नीचे) मान हैं, तो इसे अनुक्रमण के लिए चुना जाएगा।

उदाहरण के लिए, यदि वैश्विक नियम में **5** (GRT) का `minStake` है, तो कोई भी सबग्राफ परिनियोजन जिसमें 5 (GRT) से अधिक हिस्सेदारी हो इसे आवंटित अनुक्रमित किया जाएगा। थ्रेशोल्ड नियमों में `maxAllocationPercentage`, `minSignal`, `maxSignal`, `minStake`, और `minAverageQueryFees` शामिल हैं।

डेटा मॉडल:

```graphql
type IndexingRule {
    identifier: string
    identifierType: IdentifierType
    decisionBasis: IndexingDecisionBasis!
    allocationAmount: number | null
    allocationLifetime: number | null
    autoRenewal: boolean
    parallelAllocations: number | null
    maxAllocationPercentage: number | null
    minSignal: string | null
    maxSignal: string | null
    minStake: string | null
    minAverageQueryFees: string | null
    custom: string | null
    requireSupported: boolean | null
  }

IdentifierType {
  deployment
  subgraph
  group
}

IndexingDecisionBasis {
  rules
  never
  always
  offchain
}
```

अनुक्रमण नियम का उदाहरण उपयोग:

```
graph indexer rules offchain QmZfeJYR86UARzp9HiXbURWunYgC9ywvPvoePNbuaATrEK

graph indexer rules set QmZfeJYR86UARzp9HiXbURWunYgC9ywvPvoePNbuaATrEK decisionBasis always allocationAmount 123321 allocationLifetime 14 autoRenewal false requireSupported false

graph indexer rules stop QmZfeJYR86UARzp9HiXbURWunYgC9ywvPvoePNbuaATrEK

graph indexer rules delete QmZfeJYR86UARzp9HiXbURWunYgC9ywvPvoePNbuaATrEK
```

#### Actions queue CLI

इंडेक्सर-क्ली एक्शन क्यू के साथ मैन्युअल रूप से काम करने के लिए `कार्रवाई` मॉड्यूल प्रदान करता है। यह क्रिया क्यू के साथ इंटरैक्ट करने के लिए अनुक्रमणिका प्रबंधन सर्वर द्वारा होस्ट किए गए **Graphql API** का उपयोग करता है।

क्रिया निष्पादन कार्यकर्ता कतार से केवल आइटमों को निष्पादित करने के लिए पकड़ेगा यदि उनके पास `ActionStatus = स्वीकृत` है। अनुशंसित पथ में कार्रवाई कतार में ActionStatus = कतारबद्ध के साथ जोड़ी जाती है, इसलिए उन्हें ऑन-चेन निष्पादित करने के लिए अनुमोदित किया जाना चाहिए। सामान्य प्रवाह इस तरह दिखेगा:

- तृतीय पक्ष ऑप्टिमाइज़र टूल या इंडेक्सर-क्ली उपयोगकर्ता द्वारा कतार में जोड़ी गई कार्रवाई
- सभी कतारबद्ध क्रियाओं को देखने के लिए इंडेक्सर `indexer-cli` का उपयोग कर सकता है
- इंडेक्सर (या अन्य सॉफ़्टवेयर) `इंडेक्सर-क्ली` का उपयोग करके कतार में क्रियाओं को स्वीकृत या रद्द कर सकता है। स्वीकृति और रद्द करने के आदेश इनपुट के रूप में क्रिया आईडी की एक सरणी लेते हैं।
- निष्पादन कार्यकर्ता नियमित रूप से स्वीकृत कार्यों के लिए कतार का चुनाव करता है। यह कतार से `अनुमोदित` कार्यों को पकड़ लेगा, उन्हें निष्पादित करने का प्रयास करेगा, और निष्पादन की स्थिति के आधार पर डीबी में मूल्यों को `सफलता` या `विफल< पर अपडेट करेगा। /0>.</li>
<li>If an action is successful the worker will ensure that there is an indexing rule present that tells the agent how to manage the allocation moving forward, useful when taking manual actions while the agent is in <code>auto` or `oversight` mode.
- अनुक्रमणक क्रिया निष्पादन के इतिहास को देखने के लिए क्रिया कतार की निगरानी कर सकता है और यदि आवश्यक हो तो निष्पादन विफल होने पर क्रिया आइटम को पुन: अनुमोदित और अद्यतन कर सकता है। क्रिया कतार पंक्तिबद्ध और की गई सभी कार्रवाइयों का इतिहास प्रदान करती है।

डेटा मॉडल:

```graphql
Type ActionInput {
    status: ActionStatus
    type: ActionType
    deploymentID: string | null
    allocationID: string | null
    amount: string | null
    poi: string | null
    force: boolean | null
    source: string
    reason: string | null
    priority: number | null
}

ActionStatus {
  queued
  approved
  pending
  success
  failed
  canceled
}

ActionType {
  allocate
  unallocate
  reallocate
  collect
}
```

स्रोत से उदाहरण उपयोग:

```bash
indexer indexer actions get all

indexer indexer actions get --status queued

indexer indexer actions queue allocate QmeqJ6hsdyk9dVbo1tvRgAxWrVS3rkERiEMsxzPShKLco6 5000

indexer indexer actions queue reallocate QmeqJ6hsdyk9dVbo1tvRgAxWrVS3rkERiEMsxzPShKLco6 0x4a58d33e27d3acbaecc92c15101fbc82f47c2ae5 55000

indexer indexer actions queue unallocate QmeqJ6hsdyk9dVbo1tvRgAxWrVS3rkERiEMsxzPShKLco6 0x4a58d33e27d3acbaecc92c15101fbc82f47c2ae

indexer indexer actions cancel

indexer indexer actions approve 1 3 5

indexer indexer actions execute approve
```

ध्यान दें कि आवंटन प्रबंधन के लिए समर्थित क्रिया प्रकारों की अलग-अलग इनपुट आवश्यकताएं होती हैं:

- `आवंटित करें` - एक विशिष्ट सबग्राफ परिनियोजन के लिए हिस्सेदारी आवंटित करें

  - आवश्यक क्रिया पैरामीटर:
    - deploymentID
    - amount

- `Unallocate` - करीब आवंटन, हिस्सेदारी को कहीं और फिर से आवंटित करने के लिए मुक्त करना

  - आवश्यक क्रिया पैरामीटर:
    - allocationID
    - deploymentID
  - वैकल्पिक क्रिया पैरामीटर:
    - poi
    - बल (प्रदान किए गए POI का उपयोग करने पर बल देता है, भले ही वह ग्राफ़-नोड द्वारा प्रदान किए गए मेल से मेल न खाता हो)

- `Reallocate` - परमाणु रूप से आवंटन बंद करें और समान सबग्राफ परिनियोजन के लिए एक नया आवंटन खोलें

  - आवश्यक क्रिया पैरामीटर:
    - allocationID
    - deploymentID
    - amount
  - वैकल्पिक क्रिया पैरामीटर:
    - poi
    - बल (प्रदान किए गए POI का उपयोग करने पर बल देता है, भले ही वह ग्राफ़-नोड द्वारा प्रदान किए गए मेल से मेल न खाता हो)

#### Cost models

लागत मॉडल बाजार और क्वेरी विशेषताओं के आधार पर प्रश्नों के लिए गतिशील मूल्य निर्धारण प्रदान करते हैं। अनुक्रमणिका सेवा प्रत्येक सबग्राफ के लिए गेटवे के साथ एक लागत मॉडल साझा करती है जिसके लिए वे प्रश्नों का उत्तर देना चाहते हैं। गेटवे, बदले में, प्रति प्रश्न अनुक्रमणिका चयन निर्णय लेने और चुने गए अनुक्रमणकों के साथ भुगतान पर बातचीत करने के लिए लागत मॉडल का उपयोग करते हैं।

#### Agora

अगोरा भाषा प्रश्नों के लिए लागत मॉडल घोषित करने के लिए एक लचीला प्रारूप प्रदान करती है। एक एगोरा मूल्य मॉडल बयानों का एक क्रम है जो एक ग्राफक्यूएल क्वेरी में प्रत्येक शीर्ष-स्तरीय क्वेरी के क्रम में निष्पादित होता है। प्रत्येक शीर्ष-स्तरीय क्वेरी के लिए, पहला कथन जो उससे मेल खाता है, उस क्वेरी के लिए मूल्य निर्धारित करता है।

एक कथन में एक विधेय शामिल होता है, जिसका उपयोग ग्राफक्यूएल प्रश्नों के मिलान के लिए किया जाता है, और एक लागत अभिव्यक्ति होती है, जिसका मूल्यांकन दशमलव GRT में लागत को आउटपुट करता है। क्वेरी के नामित तर्क स्थिति में मान विधेय में कैप्चर किए जा सकते हैं और अभिव्यक्ति में उपयोग किए जा सकते हैं। एक अभिव्यक्ति में प्लेसहोल्डर्स के लिए ग्लोबल्स भी सेट और प्रतिस्थापित किए जा सकते हैं।

उदाहरण लागत मॉडल:

```
# This statement captures the skip value,
# uses a boolean expression in the predicate to match specific queries that use `skip`
# and a cost expression to calculate the cost based on the `skip` value and the SYSTEM_LOAD global
query { pairs(skip: $skip) { id } } when $skip > 2000 => 0.0001 * $skip * $SYSTEM_LOAD;

# This default will match any GraphQL expression.
# It uses a Global substituted into the expression to calculate cost
default => 0.1 * $SYSTEM_LOAD;
```

उपरोक्त मॉडल का उपयोग करके उदाहरण क्वेरी लागत:

| जिज्ञासा                                                                     | कीमत    |
| ---------------------------------------------------------------------------- | ------- |
| &#123; pairs(skip: 5000) &#123; id &#125; &#125;                             | 0.5 GRT |
| &#123; tokens &#123; symbol &#125; &#125;                                    | 0.1 GRT |
| &#123; pairs(skip: 5000) &#123; id &#123; tokens &#125; symbol &#125; &#125; | 0.6 GRT |

#### लागत मॉडल लागू करना

लागत मॉडल इंडेक्सर सीएलआई के माध्यम से लागू किए जाते हैं, जो उन्हें डेटाबेस में स्टोर करने के लिए इंडेक्सर एजेंट के इंडेक्सर मैनेजमेंट एपीआई को भेजता है। इंडेक्सर सर्विस तब उन्हें उठाएगी और जब भी वे उनके लिए मांगेंगे, गेटवे को लागत मॉडल की सेवा देगी।

```sh
indexer cost set variables '{ "SYSTEM_LOAD": 1.4 }'
indexer cost set model my_model.agora
```

## नेटवर्क के साथ बातचीत करना

### प्रोटोकॉल में हिस्सेदारी

एक इंडेक्सर के रूप में नेटवर्क में भाग लेने के लिए पहला कदम प्रोटोकॉल, स्टेक फंड्स को मंजूरी देना और (वैकल्पिक रूप से) दिन-प्रतिदिन के प्रोटोकॉल इंटरैक्शन के लिए एक ऑपरेटर एड्रेस सेट करना है। _ **नोट**: इन निर्देशों के प्रयोजनों के लिए रीमिक्स का उपयोग अनुबंध बातचीत के लिए किया जाएगा, लेकिन अपनी पसंद के टूल का बेझिझक उपयोग करें ([OneClickDapp](https://oneclickdapp.com/), [ABItopic](https://abitopic.io/), और [MyCrypto](https://www.mycrypto.com/account) कुछ अन्य ज्ञात उपकरण हैं)।_

एक बार एक इंडेक्सर प्रोटोकॉल में जीआरटी को दांव पर लगा देता है, तो [इंडेक्सर घटक](/network/indexing#indexer-components) को शुरू किया जा सकता है और नेटवर्क के साथ उनकी बातचीत शुरू की जा सकती है।

#### टोकन स्वीकृत करें

1. ब्राउज़र में [रीमिक्स ऐप](https://remix.ethereum.org/) खोलें

2. `फाइल एक्सप्लोरर` में [टोकन एबीआई](https://raw.githubusercontent.com/graphprotocol/contracts/mainnet-deploy-build/build/abis/GraphToken.json) के साथ **GraphToken.abi** नाम की एक फाइल बनाएं।

3. `GraphToken.abi` चुने जाने और संपादक में खुलने के साथ, Remix इंटरफ़ेस में Deploy और `Run Transactions` सेक्शन में स्विच करें।

4. Under environment select `Injected Web3` and under `Account` select your Indexer address.

5. ग्राफटोकन अनुबंध पता सेट करें - `पते पर` के बगल में ग्राफटोकन अनुबंध पता (`0xc944E90C64B2c07662A292be6244BDf05Cda44a7`) पेस्ट करें और आवेदन करने के लिए `पते पर` बटन पर क्लिक करें।

6. स्टेकिंग अनुबंध को स्वीकृत करने के लिए `स्वीकृति (खर्च, राशि)` फ़ंक्शन को कॉल करें। स्टेकिंग अनुबंध पते के साथ `खर्च` भरें (`0xF55041E37E12cD407ad00CE2910B8269B01263b9`) और `राशि` दांव लगाने के लिए टोकन के साथ (वी में)।

#### स्टेक टोकन

1. ब्राउज़र में [रीमिक्स ऐप](https://remix.ethereum.org/) खोलें

2. `फाइल एक्सप्लोरर` में स्टेकिंग एबीआई के साथ **Stakeing.abi** नाम की एक फाइल बनाएं।

3. `Stakeing.abi` चुने जाने और संपादक में खुलने के साथ, रीमिक्स इंटरफ़ेस में `Deploy` और `Run Transactions` सेक्शन पर स्विच करें।

4. Under environment select `Injected Web3` and under `Account` select your Indexer address.

5. स्टेकिंग अनुबंध पता सेट करें - `पते पर` के आगे स्टेकिंग अनुबंध पता (`0xF55041E37E12cD407ad00CE2910B8269B01263b9`) पेस्ट करें और आवेदन करने के लिए `पते पर` बटन पर क्लिक करें।

6. प्रोटोकॉल में GRT को दांव पर लगाने के लिए `दांव()` पर कॉल करें।

7. (वैकल्पिक) इंडेक्सर्स अपने इंडेक्सर इंफ्रास्ट्रक्चर के लिए ऑपरेटर होने के लिए एक और पते को मंजूरी दे सकते हैं ताकि उन कुंजियों को अलग किया जा सके जो उपग्राफों पर आवंटन और सेवा (भुगतान) प्रश्नों को दिन-प्रतिदिन क्रियाएं कर रहे हैं। ऑपरेटर को सेट करने के लिए `setOperator()` को ऑपरेटर के पते के साथ कॉल करें।

8. (वैकल्पिक) पुरस्कारों के वितरण को नियंत्रित करने और प्रतिनिधियों को रणनीतिक रूप से आकर्षित करने के लिए इंडेक्सर्स अपने इंडेक्सिंग रिवार्डकट (पार्ट्स पर मिलियन), queryFeeCut (पार्ट्स प्रति मिलियन), और कूलडाउनब्लॉक्स (ब्लॉक्स की संख्या) को अपडेट करके अपने डेलिगेशन पैरामीटर्स को अपडेट कर सकते हैं। ऐसा करने के लिए `setDelegationParameters()` को कॉल करें। निम्न उदाहरण queryFeeCut को अनुक्रमणिका को 95% क्वेरी छूट और डेलिगेटर को 5% वितरित करने के लिए सेट करता है, indexingRewardCutto को अनुक्रमणिका पुरस्कार का 60% और प्रतिनिधि को 40% वितरित करने के लिए सेट करता है, और `thecooldownBlocks` सेट करता है 500 ब्लॉक की अवधि।

```
setDelegationParameters(950000, 600000, 500)
```

### आवंटन का जीवन

एक इंडेक्सर द्वारा बनाए जाने के बाद एक स्वस्थ आवंटन चार राज्यों से होकर जाता है।

- **एक्टिव** - एक बार चेन पर आवंटन हो जाने के बाद ([allocateFrom()](https://github.com/graphprotocol/contracts/blob/master/contracts/staking/Staking.sol#L873)) इसे **सक्रिय** माना जाता है। इंडेक्सर के अपने और/या प्रत्यायोजित हिस्सेदारी का एक हिस्सा एक सबग्राफ परिनियोजन के लिए आवंटित किया जाता है, जो उन्हें इंडेक्सिंग पुरस्कारों का दावा करने और उस सबग्राफ परिनियोजन के लिए प्रश्नों की सेवा करने की अनुमति देता है। इंडेक्सर एजेंट इंडेक्सर नियमों के आधार पर आवंटन बनाने का प्रबंधन करता है।

- **बंद** - 1 युग बीत जाने के बाद एक अनुक्रमणिका आवंटन को बंद करने के लिए स्वतंत्र है ([closeAllocation()](https://github.com/graphprotocol/contracts/blob/master /contracts/stracting/Shaking.sol#L873)) या उनका इंडेक्सर एजेंट **maxAllocationEpochs** (वर्तमान में 28 दिन) के बाद आवंटन को स्वचालित रूप से बंद कर देगा). जब एक आबंटन इंडेक्सिंग (पीओआई) के वैध प्रमाण के साथ बंद हो जाता है तो उनके इंडेक्सिंग पुरस्कार इंडेक्सर और उसके प्रतिनिधियों को वितरित किए जाते हैं (अधिक जानने के लिए नीचे "पुरस्कार कैसे वितरित किए जाते हैं?" देखें)।

- **अंतिम रूप दिया गया** - एक बार आवंटन बंद हो जाने के बाद विवाद की अवधि होती है जिसके बाद आवंटन को **अंतिम रूप दिया गया** माना जाता है और यह क्वेरी शुल्क छूट दावा किए जाने के लिए उपलब्ध हैं (दावा ())। इंडेक्सर एजेंट **अंतिम रूप दिए गए** आवंटनों का पता लगाने के लिए नेटवर्क की निगरानी करता है और अगर वे कॉन्फ़िगर करने योग्य (और वैकल्पिक) थ्रेशोल्ड, **— से ऊपर हैं, तो उनका दावा करता है— -आवंटन-दावा-दहलीज**।

- **दावा किया गया** - आवंटन की अंतिम स्थिति; इसने एक सक्रिय आवंटन के रूप में अपना पाठ्यक्रम चलाया है, सभी पात्र पुरस्कार वितरित किए गए हैं और इसकी पूछताछ शुल्क छूट का दावा किया गया है।

इंडेक्सर्स को ऑन-चेन आवंटन बनाने से पहले चेनहेड में सबग्राफ परिनियोजन को सिंक करने के लिए ऑफ-चेन सिंकिंग कार्यक्षमता का उपयोग करने की सिफारिश की जाती है। यह सुविधा सबग्राफ के लिए विशेष रूप से उपयोगी है जो सिंक करने के लिए 28 से अधिक समय ले सकती है या अनिश्चित रूप से विफल होने की कुछ संभावनाएं हैं।
