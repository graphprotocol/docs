---
title: "Unit рдкрд░реАрдХреНрд╖рдг рдлреНрд░реЗрдорд╡рд░реНрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛\nрдХрд▓рд╛"
---

рдорд╛рдЪрд┐рд╕ рдПрдХ рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг рдврд╛рдВрдЪрд╛ рд╣реИ, рдЬрд┐рд╕реЗ [LimeChain](https://limechain.tech/) рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рд╕рдмрдЧреНрд░рд╛рдл рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╡рд╛рд▓реЗ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЕрдкрдиреЗ рдореИрдкрд┐рдВрдЧ рддрд░реНрдХ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдФрд░ рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рд╕рдмрдЧреНрд░рд╛рдл рддреИрдирд╛рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИ!

## рд╢реБрд░реВ рдХрд░рдирд╛

### рдирд┐рд░реНрднрд░рддрд╛рдПрдБ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ

рдкрд░реАрдХреНрд╖рдг рд╕рд╣рд╛рдпрдХ рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрднрд░рддрд╛рдУрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

```sh
yarn add --dev matchstick-as
```

тЭЧ `рдЧреНрд░рд╛рдлрд╝-рдиреЛрдб` PostgreSQL рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рдпрд╣ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рд╣рдо рдЕрддреНрдпрдзрд┐рдХ рд╕рд▓рд╛рд╣ рджреЗрддреЗ рд╣реИрдВ рдХрд┐ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЖрджреЗрд╢реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рддрд░реАрдХреЗ рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдЕрдирдкреЗрдХреНрд╖рд┐рдд рддреНрд░реБрдЯрд┐рдпрд╛рдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ!

#### MacOS

рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЬ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХрдорд╛рдВрдб:

```sh
brew install postgresql
```

рдирд╡реАрдирддрдо libpq.5.lib рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд┐рдорд▓рд┐рдВрдХ рдмрдирд╛рдПрдВ _рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдпрд╣ dir рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ_ `/usr/local/opt/postgresql/lib/`

```sh
ln -sf /usr/local/opt/postgresql@14/lib/postgresql@14/libpq.5.dylib /usr/local/opt/postgresql/lib/libpq.5.dylib
```

#### Linux

рдкреЛрд╕реНрдЯрдЧреНрд░реЗрдЬ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХрдорд╛рдВрдб (рдЖрдкрдХреЗ рдбрд┐рд╕реНрдЯреНрд░реЛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ):

```sh
sudo apt install postgresql
```

### WSL (рд▓рд┐рдирдХреНрд╕ рдХреЗ рд▓рд┐рдП рд╡рд┐рдВрдбреЛрдЬ рд╕рдмрд╕рд┐рд╕реНрдЯрдо)

рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ, рдЖрд░реНрдмрд┐рдЯреНрд░рдо рдорд╛рдЗрдЧреНрд░реЗрд╢рди рдкреВрд░рд╛ рд╣реЛрдиреЗ рдкрд░ рдЗрд╕рдореЗрдВ рд╕реБрдзрд╛рд░ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рднрд╛рдЧ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЧреИрд╕ рдХреА рд▓рд╛рдЧрдд рдХрд╛рдлреА рдХрдо рд╣реЛ рдЬрд╛рдПрдЧреАред...

```
static BYTES = Symbol("Bytes") SyntaxError: Unexpected token =
```

рдпрд╛

```
<PROJECT_PATH>/node_modules/gluegun/build/index.js:13 throw up;
```

рдХреГрдкрдпрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк Node.js рдХреЗ рдирдП рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рд╣реИрдВ, рдЧреНрд░рд╛рдл-рдХреНрд▓реА рдЕрдм **v10.19.0** рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдЕрднреА рднреА WSL рдкрд░ рдирдИ Ubuntu рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рдВрд╕реНрдХрд░рдг рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдореИрдЪрд╕реНрдЯрд┐рдХ рдХреЗ WSL рдкрд░ **v18.1.0** рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдкреБрд╖реНрдЯрд┐ рд╣реЛ рдЧрдИ рд╣реИ, рдЖрдк рдЗрд╕реЗ рдпрд╛ рддреЛ **nvm** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рд╡реИрд╢реНрд╡рд┐рдХ Node.js рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВред рдЕрдкрдиреЗ рдиреЛрдбрдЬ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж `node_modules` рдХреЛ рд╣рдЯрд╛рдирд╛ рдФрд░ `npm install` рдлрд┐рд░ рд╕реЗ рдЪрд▓рд╛рдирд╛ рди рднреВрд▓реЗрдВ! рдлрд┐рд░, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **libpq** рд╕реНрдерд╛рдкрд┐рдд рд╣реИ, рдЖрдк рдЗрд╕реЗ рдЪрд▓рд╛рдХрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

```
sudo apt-get install libpq-dev
```

рдФрд░ рдЕрдВрдд рдореЗрдВ, `рдЧреНрд░рд╛рдлрд╝ рдкрд░реАрдХреНрд╖рдг` рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ (рдЬреЛ рдЖрдкрдХреЗ рдЧреНрд░рд╛рдлрд╝-рдХреНрд▓реА рдХреА рд╡реИрд╢реНрд╡рд┐рдХ рд╕реНрдерд╛рдкрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ WSL рдкрд░ рдЯреВрдЯрд╛ рд╣реБрдЖ рд╣реИ), рдЗрд╕рдХреЗ рдмрдЬрд╛рдп `рдпрд╛рд░реНрди рдкрд░реАрдХреНрд╖рдг` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдпрд╛ `npm рд░рди рдЯреЗрд╕реНрдЯ` (рдЬреЛ рдЧреНрд░рд╛рдл-рдХреНрд▓реА рдХреЗ рд╕реНрдерд╛рдиреАрдп, рдкреНрд░реЛрдЬреЗрдХреНрдЯ-рд╕реНрддрд░реАрдп рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рдЬреЛ рдПрдХ рдЖрдХрд░реНрд╖рдг рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ)ред рдЙрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЕрдкрдиреА `package.json` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ `"test"` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдЬреЛ рдХреБрдЫ рд╕рд░рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИ

```json
{
  "name": "demo-subgraph",
  "version": "0.1.0",
  "scripts": {
    "test": "graph test",
    ...
  },
  "dependencies": {
    "@graphprotocol/graph-cli": "^0.30.0",
    "@graphprotocol/graph-ts": "^0.27.0",
    "matchstick-as": "^0.5.0"
  }
```

### рдкреНрд░рдпреЛрдЧ

рдЕрдкрдиреЗ рд╕рдмрдЧреНрд░рд╛рдл рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ **рдорд╛рдЪрд┐рд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╕ рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ, рдЕрдкрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд░реВрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВ рдФрд░ рдмрд╕ `рдЧреНрд░рд╛рдлрд╝ рдЯреЗрд╕реНрдЯ [рд╡рд┐рдХрд▓реНрдк] <рдбреЗрдЯрд╛рд╕реЛрд░реНрд╕> ` - рдпрд╣ рдирд╡реАрдирддрдо **рдореИрдЪрд╕реНрдЯрд┐рдХ** рдмрд╛рдЗрдирд░реА рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдкрд░реАрдХреНрд╖рдг рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкрд░реАрдХреНрд╖рдг рдпрд╛ рд╕рднреА рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рддрд╛ рд╣реИ (рдпрд╛ рд╕рднреА рдореМрдЬреВрджрд╛ рдкрд░реАрдХреНрд╖рдг рдпрджрд┐ рдХреЛрдИ рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдзреНрд╡рдЬ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рд╣реИ)ред

### рд╕реАрдПрд▓рдЖрдИ рд╡рд┐рдХрд▓реНрдк

рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рднреА рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдЧрд╛:

```sh
graph test
```

рдпрд╣ gravity.test.ts рдирд╛рдо рдХрд╛ рдПрдХ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдЧрд╛ рдФрд░/рдпрд╛ рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг рдирд╛рдордХ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдЧрд╛:

```sh
graph test gravity
```

This will run only that specific test file:

```sh
graph test path/to/file.test.ts
```

**рд╡рд┐рдХрд▓реНрдк:**

```sh
-c, --coverage                Run the tests in coverage mode
-d, --docker                  Run the tests in a docker container (Note: Please execute from the root folder of the subgraph)
-f, --force                   Binary: Redownloads the binary. Docker: Redownloads the Dockerfile and rebuilds the docker image.
-h, --help                    Show usage information
-l, --logs                    Logs to the console information about the OS, CPU model and download url (debugging purposes)
-r, --recompile               Forces tests to be recompiled
-v, --version <tag>           Choose the version of the rust binary that you want to be downloaded/used
```

### Docker

`graph-cli 0.25.2` рд╕реЗ, `graph test` рдХрдорд╛рдВрдб `рдорд╛рдЪрд┐рд╕` рдХреЛ `-d</code рдХреЗ рд╕рд╛рде рдПрдХ рдбреЛрдХрд░ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ > рдЭрдВрдбрд╛ред рдбреЙрдХрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди <a href="https://docs.docker.com/storage/bind-mounts/">рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рд╣рд░ рдмрд╛рд░ <code>рдЧреНрд░рд╛рдл рдореЗрдВ рдбреЙрдХрд░ рдЫрд╡рд┐ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдкрд░реАрдХреНрд╖рдг -d ` рдЖрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ рдЖрдк рдбреЙрдХрд░ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП [matchstick](https://github.com/LimeChain/matchstick#docker-) рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

тЭЧ рдпрджрд┐ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ `graph test` рдЪрд▓рд╛рдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдбреЙрдХрд░ рдмрд┐рд▓реНрдб рдХреЗ рджреМрд░рд╛рди рдирд┐рдореНрди рддреНрд░реБрдЯрд┐ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝ рд╕рдХрддрд╛ рд╣реИ:

```sh
  рдкреНрд░реЗрд╖рдХ рд╕реЗ рддреНрд░реБрдЯрд┐: xattr node_modules/рдмрд╛рдЗрдирд░реА-рдЗрдВрд╕реНрдЯреЙрд▓-рд░реЙ/рдмрд┐рди/рдмрд╛рдЗрдирд░реА-<рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо> рдореЗрдВ рд╡рд┐рдлрд▓: рдЕрдиреБрдорддрд┐ рдЕрд╕реНрд╡реАрдХреГрдд
```

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд░реВрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ `.dockerignore` рдмрдирд╛рдПрдВ рдФрд░ `node_modules/binary-install-raw/bin` рдЬреЛрдбрд╝реЗрдВ

### рд╡рд┐рдиреНрдпрд╛рд╕

рдорд╛рдЪрд┐рд╕ рдХреА рддреАрд▓рд┐рдпреЛрдВ рдХреЛ `matchstick.yaml` рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдХрд╕реНрдЯрдо рдкрд░реАрдХреНрд╖рдг, libs рдФрд░ рдореИрдирд┐рдлрд╝реЗрд╕реНрдЯ рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

```yaml
testsFolder: path/to/tests
libsFolder: path/to/libs
manifestPath: path/to/subgraph.yaml
```

### рдбреЗрдореЛ рд╕рдмрдЧреНрд░рд╛рдл

рдЖрдк [рдбреЗрдореЛ рд╕рдмрдЧреНрд░рд╛рдл рд░реЗрдкреЛ](https://github.com/LimeChain/demo-subgraph) рдХреА рдХреНрд▓реЛрдирд┐рдВрдЧ рдХрд░рдХреЗ рдЗрд╕ рдЧрд╛рдЗрдб рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдЖрдЬрдорд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╡реАрдбрд┐рдпреЛ рд╢рд┐рдХреНрд╖рдг

рд╕рд╛рде рд╣реА рдЖрдк ["рдЕрдкрдиреЗ рд╕рдмрдЧреНрд░рд╛рдл рдХреЗ рд▓рд┐рдП рдпреВрдирд┐рдЯ рдЯреЗрд╕реНрдЯ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдЪрд┐рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ"](https://www.youtube.com/playlist?list=PLTqyKgxaGF3SNakGQwczpSGVjS_xvOv3h) рдкрд░ рд╡реАрдбрд┐рдпреЛ рд╢реНрд░реГрдВрдЦрд▓рд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ

## рдЯреЗрд╕реНрдЯ рд╕рдВрд░рдЪрдирд╛ (> = 0.5.0)

_**рдорд╣рддреНрд╡рдкреВрд░реНрдг: matchstick-as >=0.5.0 рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**_

### describe()

`describe(name: String , () => {})` - рдПрдХ рдкрд░реАрдХреНрд╖рдг рд╕рдореВрд╣ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред

**_рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ:_**

- _рд╡рд░реНрдгрди рдЕрдирд┐рд╡рд╛рд░реНрдп рдирд╣реАрдВ рд╣реИрдВред рдЖрдк рдЕрднреА рднреА test() рдкреБрд░рд╛рдиреЗ рддрд░реАрдХреЗ рдХрд╛ рд╡рд░реНрдгрди() рдмреНрд▓реЙрдХ рдХреЗ рдмрд╛рд╣рд░ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ_

рдЙрджрд╛рд╣рд░рдг:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Gravatar entity", () => {
    ...
  })
})
```

рдиреЗрд╕реНрдЯреЗрдб `describe()` рдЙрджрд╛рд╣рд░рдг:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar } from "../../src/gravity"

describe("handleUpdatedGravatar()", () => {
  describe("When entity exists", () => {
    test("updates the entity", () => {
      ...
    })
  })

  describe("When entity does not exists", () => {
    test("it creates a new entity", () => {
      ...
    })
  })
})
```

---

### test()

`test(name: String, () =>, should_fail: bool)` - рдПрдХ рдЯреЗрд╕реНрдЯ рдХреЗрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЖрдк рдкрд░реАрдХреНрд╖рдг () рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрдгрди () рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдпрд╛ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрджрд╛рд╣рд░рдг:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Entity", () => {
    ...
  })
})
```

рдпрд╛

```typescript
test("handleNewGravatar() should create a new entity", () => {
  ...
})


```

---

### beforeAll()

рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рднреА рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд▓рд╛рддрд╛ рд╣реИред рдпрджрд┐ `beforeAll` рдХреЛ `рд╡рд░реНрдгрд┐рдд рдХрд░реЗрдВ` рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрд╕ `рд╡рд░реНрдгрди` рдмреНрд▓реЙрдХ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:

`beforeAll` рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдХреЛрдб рдлрд╝рд╛рдЗрд▓ рдореЗрдВ _рд╕рднреА_ рдкрд░реАрдХреНрд╖рдгреЛрдВ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

beforeAll(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = тАЬFirst GravatarтАЭ
  gravatar.save()
  ...
})

describe("When the entity does not exist", () => {
  test("it should create a new Gravatar with id 0x1", () => {
    ...
  })
})

describe("When entity already exists", () => {
  test("it should update the Gravatar with id 0x0", () => {
    ...
  })
})
```

`beforeAll` рдХреЗ рдЕрдВрджрд░ рдХреЛрдб рдкрд╣рд▓реЗ рд╡рд░реНрдгрди рдмреНрд▓реЙрдХ рдореЗрдВ рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

describe("handleUpdatedGravatar()", () => {
  beforeAll(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = тАЬFirst GravatarтАЭ
    gravatar.save()
    ...
  })

  test("updates Gravatar with id 0x0", () => {
    ...
  })

  test("creates new Gravatar with id 0x1", () => {
    ...
  })
})
```

---

### afterAll()

рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдмрд╛рдж рдПрдХ рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд▓рд╛рддрд╛ рд╣реИред рдЕрдЧрд░ `рдЖрдлреНрдЯрд░рдСрд▓` рдХреЛ `рдбрд┐рд╕реНрдХреНрд░рд╛рдЗрдм` рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрд╕ `рдбрд┐рд╕реНрдХреНрд░рд╛рдЗрдм` рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрдд рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:

`afterAll` рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдХреЛрдб _рд╕рднреА_ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред

```typescript
import { describe, test, afterAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { store } from "@graphprotocol/graph-ts"

afterAll(() => {
  store.remove("Gravatar", "0x0")
  ...
})

describe("handleNewGravatar, () => {
  test("creates Gravatar with id 0x0", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

`afterAll` рдХреЗ рдЕрдВрджрд░ рдХреЛрдб рдкрд╣рд▓реЗ рд╡рд░реНрдгрди рдмреНрд▓реЙрдХ рдореЗрдВ рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдмрд╛рдж рдПрдХ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛

```typescript
import { describe, test, afterAll, clearStore } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
    afterAll(() => {
    store.remove("Gravatar", "0x1")
    ...
    })

  test("It creates a new entity with Id 0x0", () => {
    ...
  })

  test("It creates a new entity with Id 0x1", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

---

### beforeEach()

рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд▓рд╛рддрд╛ рд╣реИред рдЕрдЧрд░ `beforeEach` рдХреЛ `decribe` рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрд╕ `describe` рдмреНрд▓реЙрдХ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдЯреЗрд╕реНрдЯ рд╕реЗ рдкрд╣рд▓реЗ рдЪрд▓рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг: `beforeEach` рдХреЗ рдЕрдВрджрд░ рдХреЛрдб рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред

```typescript
import { describe, test, beforeEach, clearStore } from "matchstick-as/assembly/index"
import { handleNewGravatars } from "./utils"

beforeEach(() => {
  clearStore() // <-- clear the store before each test in the file
})

describe("handleNewGravatars, () => {
  test("A test that requires a clean store", () => {
    ...
  })

  test("Second that requires a clean store", () => {
    ...
  })
})

 ...
```

`beforeEach` рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдХреЛрдб рд╡рд░реНрдгрди рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдкрд╣рд▓реЗ рд╣реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛

```typescript
import { describe, test, beforeEach } from 'matchstick-as/assembly/index'
import { handleUpdatedGravatar, handleNewGravatar } from '../../src/gravity'

describe('handleUpdatedGravatars', () => {
  beforeEach(() => {
    let gravatar = new Gravatar('0x0')
    gravatar.displayName = 'First Gravatar'
    gravatar.imageUrl = ''
    gravatar.save()
  })

  test('Upates the displayName', () => {
    assert.fieldEquals('Gravatar', '0x0', 'displayName', 'First Gravatar')

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals('Gravatar', '0x0', 'displayName', '1st Gravatar')
    store.remove('Gravatar', '0x0')
  })

  test('Updates the imageUrl', () => {
    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', '')

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', 'https://www.gravatar.com/avatar/0x0')
    store.remove('Gravatar', '0x0')
  })
})
```

---

### afterEach()

рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж рдПрдХ рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд▓рд╛рддрд╛ рд╣реИред рдпрджрд┐ `рдХреЗ рдмрд╛рдж` рдХреЛ `рд╡рд░реНрдгрди` рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЙрд╕ `рд╡рд░реНрдгрди` рдмреНрд▓реЙрдХ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж рдЪрд▓рддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг:

рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж ` afterEach ` рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

beforeEach(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = тАЬFirst GravatarтАЭ
  gravatar.save()
})

afterEach(() => {
  store.remove("Gravatar", "0x0")
})

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

рдЙрд╕ рд╡рд░реНрдгрди рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрд░реАрдХреНрд╖рдг рдХреЗ рдмрд╛рдж ` afterEach ` рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  beforeEach(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = "First Gravatar"
    gravatar.imageUrl = ""
    gravatar.save()
  })

  afterEach(() => {
    store.remove("Gravatar", "0x0")
  })

  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

## рдЗрд╕ рдмрд╛рдд рдкрд░ рдЬрд╝реЛрд░

```typescript
fieldEquals(entityType: string, id: string, fieldName: string, expectedVal: string)

equals(expected: ethereum.Value, actual: ethereum.Value)

notInStore(entityType: string, id: string)

addressEquals(address1: Address, address2: Address)

bytesEquals(bytes1: Bytes, bytes2: Bytes)

i32Equals(number1: i32, number2: i32)

bigIntEquals(bigInt1: BigInt, bigInt2: BigInt)

booleanEquals(bool1: boolean, bool2: boolean)

stringEquals(string1: string, string2: string)

arrayEquals(array1: Array<ethereum.Value>, array2: Array<ethereum.Value>)

tupleEquals(tuple1: ethereum.Tuple, tuple2: ethereum.Tuple)

assertTrue(value: boolean)

assertNull<T>(value: T)

assertNotNull<T>(value: T)

entityCount(entityType: string, expectedCount: i32)
```

## рдпреВрдирд┐рдЯ рдЯреЗрд╕реНрдЯ рд▓рд┐рдЦреЗрдВ

[рдбреЗрдореЛ рд╕рдмрдЧреНрд░рд╛рдл](https://github.com/LimeChain/demo-subgraph/blob/main/src/gravity.ts) рдореЗрдВ Gravatar рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг рдХреИрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛ред

рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВрдбрд▓рд░ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ (рд╣рдорд╛рд░реЗ рдЬреАрд╡рди рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рд╕рд╣рд╛рдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╛рде):

```typescript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string,
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters,
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress)),
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```

рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдЕрдкрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдПрдХ рдЯреЗрд╕реНрдЯ рдлрд╛рдЗрд▓ рдмрдирд╛рдиреА рд╣реЛрдЧреАред рдпрд╣ рдХреИрд╕рд╛ рджрд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ:

```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

test('Can call mappings with custom events', () => {
  // Create a test entity and save it in the store as initial state (optional)
  let gravatar = new Gravatar('gravatarId0')
  gravatar.save()

  // Create mock events
  let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')
  let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

  // Call mapping functions passing the events we just created
  handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

  // Assert the state of the store
  assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
  assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
  assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

  // Clear the store in order to start the next test off on a clean slate
  clearStore()
})

test('Next test', () => {
  //...
})
```

рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдмрд╣реБрдд рдХреБрдЫ рд╣реИ! рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдиреЛрдЯрд┐рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо `matchstick-as` рд╕реЗ рдЪреАрдЬреЗрдВ рдЖрдпрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд╣рдорд╛рд░реА рдЕрд╕реЗрдВрдмрд▓реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЗрд▓реНрдкрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА (рдПрдирдкреАрдПрдо рдореЙрдбреНрдпреВрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рддрд░рд┐рдд)ред рдЖрдк рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА [рдпрд╣рд╛рдВ](https://github.com/LimeChain/matchstick-as) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред `matchstick-as` рд╣рдореЗрдВ рдЙрдкрдпреЛрдЧреА рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдзрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ `test()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рднреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдЕрдкрдиреЗ рдкрд░реАрдХреНрд╖рдг рдмреНрд▓реЙрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред рдЗрд╕рдХрд╛ рдмрд╛рдХреА рд╣рд┐рд╕реНрд╕рд╛ рдмрд╣реБрдд рд╕реАрдзрд╛ рд╣реИ - рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ:

- рд╣рдо рдЕрдкрдиреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕реНрдерд┐рддрд┐ рд╕реЗрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдПрдХ рдХрд╕реНрдЯрдо Gravatar рдЗрдХрд╛рдИ рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВ;
- рд╣рдо рджреЛ `NewGravatar` рдИрд╡реЗрдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдЙрдирдХреЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде, `createNewGravatarEvent()` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ;
- рд╣рдо рдЙрди рдШрдЯрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реИрдВрдбрд▓рд░ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░ рд░рд╣реЗ рд╣реИрдВ - `handleNewGravatars()` рдФрд░ рд╣рдорд╛рд░реЗ рдХрд╕реНрдЯрдо рдИрд╡реЗрдВрдЯ рдХреА рд╕реВрдЪреА рдореЗрдВ рдкрд╛рд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ;
- рд╣рдо рд╕реНрдЯреЛрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдкрд░ рдЬреЛрд░ рджреЗрддреЗ рд╣реИрдВред рд╡рд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ? - рд╣рдо рдЗрдХрд╛рдИ рдкреНрд░рдХрд╛рд░ рдФрд░ рдЖрдИрдбреА рдХрд╛ рдПрдХ рдЕрдиреВрдард╛ рд╕рдВрдпреЛрдЬрди рдкрд╛рд░рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдлрд┐рд░ рд╣рдо рдЙрд╕ рдЗрдХрд╛рдИ рдкрд░ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд╖реЗрддреНрд░ рдХреА рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рджрд╛рд╡рд╛ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕рдХрд╛ рд╡рд╣ рдореВрд▓реНрдп рд╣реИ рдЬрд┐рд╕рдХреА рд╣рдо рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВред рд╣рдо рдпрд╣ рджреЛрдиреЛрдВ рдкреНрд░рд╛рд░рдВрднрд┐рдХ Gravatar рдПрдВрдЯрд┐рдЯреА рдХреЗ рд▓рд┐рдП рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рд╕реНрдЯреЛрд░ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рд╣реИ, рд╕рд╛рде рд╣реА рджреЛ Gravatar рдПрдВрдЯрд┐рдЯреА рдЬреЛ рд╣реИрдВрдбрд▓рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдЬреБрдбрд╝ рдЬрд╛рддреА рд╣реИрдВ;
- рдФрд░ рдЕрдВрдд рдореЗрдВ - рд╣рдо `clearStore()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдЯреЛрд░ рдХреА рд╕рдлрд╛рдИ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдорд╛рд░рд╛ рдЕрдЧрд▓рд╛ рдкрд░реАрдХреНрд╖рдг рдПрдХ рдирдП рдФрд░ рдЦрд╛рд▓реА рд╕реНрдЯреЛрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗ рд╢реБрд░реВ рд╣реЛ рд╕рдХреЗред рд╣рдо рдЬрд┐рддрдиреЗ рдЪрд╛рд╣реЗрдВ рдЙрддрдиреЗ рдЯреЗрд╕реНрдЯ рдмреНрд▓реЙрдХ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпреЗ рд░рд╣рд╛ - рд╣рдордиреЗ рдЕрдкрдирд╛ рдкрд╣рд▓рд╛ рдкрд░реАрдХреНрд╖рдг рдмрдирд╛ рд▓рд┐рдпрд╛ рд╣реИ! ЁЯСП

рдЕрдм рд╣рдорд╛рд░реЗ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдмрд╕ рдЕрдкрдиреЗ рд╕рдмрдЧреНрд░рд╛рдл рд░реВрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

`рдЧреНрд░рд╛рдл рдкрд░реАрдХреНрд╖рдг рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг`

рдФрд░ рдЕрдЧрд░ рд╕рдм рдареАрдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдмрдзрд╛рдИ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП:

![рдорд╛рдЪрд┐рд╕ рдХреА рддреАрд▓реА рдХрд╣ рд░рд╣реА рд╣реИ "рд╕рднреА рдкрд░реАрдХреНрд╖рдг рдкрд╛рд╕ рд╣реЛ рдЧрдП!"](/img/matchstick-tests-passed.png)

## рд╕рд╛рдорд╛рдиреНрдп рдкрд░реАрдХреНрд╖рдг рдкрд░рд┐рджреГрд╢реНрдп

### рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЕрд╡рд╕реНрдерд╛ рдХреЗ рд╕рд╛рде рд╕реНрдЯреЛрд░ рдХреЛ рд╣рд╛рдЗрдбреНрд░реЗрдЯ рдХрд░рдирд╛

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрд╕реНрдерд╛рдУрдВ рдХреЗ рдЬреНрдЮрд╛рдд рд╕реЗрдЯ рдХреЗ рд╕рд╛рде рд╕реНрдЯреЛрд░ рдХреЛ рд╣рд╛рдЗрдбреНрд░реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВред рдпрд╣рд╛рдБ рдПрдХ Gravatar рдЗрдХрд╛рдИ рдХреЗ рд╕рд╛рде рд╕реНрдЯреЛрд░ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```

### рдХрд┐рд╕реА рдИрд╡реЗрдВрдЯ рдХреЗ рд╕рд╛рде рдореИрдкрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдХрд╕реНрдЯрдо рдИрд╡реЗрдВрдЯ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдореИрдкрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдкрд╛рд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╕реНрдЯреЛрд░ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ:

```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```

### рдЗрд╡реЗрдВрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░ рдХреЗ рд╕рд╛рде рд╕рднреА рдореИрдкрд┐рдВрдЧ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореИрдкрд┐рдВрдЧ рдХреЛ рдЯреЗрд╕реНрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░ рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```

```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```

### рдирдХрд▓реА рдЕрдиреБрдмрдВрдз рдХреЙрд▓

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдмрдВрдз рдХреЙрд▓ рдХрд╛ рдиреШрд▓ рд╕рдХрддреЗ рд╣реИрдВ:

```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```

рдЬреИрд╕рд╛ рдХрд┐ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдХ рдЕрдиреБрдмрдВрдз рдХреЙрд▓ рдФрд░ рдХрдЯреНрдЯрд░ рд╡рд╛рдкрд╕реА рдореВрд▓реНрдп рдХрд╛ рдордЬрд╛рдХ рдЙрдбрд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдПрдХ рдЕрдиреБрдмрдВрдз рдХрд╛ рдкрддрд╛, рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдирд╛рдо, рдлрд╝рдВрдХреНрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рддрд░реНрдХреЛрдВ рдХреА рдПрдХ рд╕рд░рдгреА рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ - рд╡рд╛рдкрд╕реА рдореВрд▓реНрдп рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝рдВрдХреНрд╢рди рд░рд┐рд╡рд░реНрдЯреНрд╕ рдХрд╛ рдиреШрд▓ рд╕рдХрддреЗ рд╣реИрдВ:

```typescript
let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
  .withArgs([ethereum.Value.fromAddress(contractAddress)])
  .reverts()
```

### рдЖрдИрдкреАрдПрдлрдПрд╕ рдлрд╛рдЗрд▓реЛрдВ рдХрд╛ рдордЬрд╝рд╛рдХ рдЙрдбрд╝рд╛рдирд╛ (рдореИрдЪрд╕реНрдЯрд┐рдХ 0.4.1 рд╕реЗ)

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `mockIpfsFile(hash, filePath)` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ IPFS рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдордЬрд╝рд╛рдХ рдЙрдбрд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдлрд╝рдВрдХреНрд╢рди рджреЛ рддрд░реНрдХреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдкрд╣рд▓рд╛ IPFS рдлрд╝рд╛рдЗрд▓ рд╣реИрд╢/рдкрде рд╣реИ рдФрд░ рджреВрд╕рд░рд╛ рдПрдХ рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдкрде рд╣реИред

рдиреЛрдЯ: `ipfs.map/ipfs.mapJSON` рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╕рдордп, рдХреЙрд▓рдмреИрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдирд┐рд░реНрдпрд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рддрд╛рдХрд┐ matchstck рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗ, рдЬреИрд╕реЗ `processGravatar()` рдлрд╝рдВрдХреНрд╢рди рдиреАрдЪреЗ рдкрд░реАрдХреНрд╖рдг рдЙрджрд╛рд╣рд░рдг рдореЗрдВ:

`.test.ts` рдлрд╝рд╛рдЗрд▓:

```typescript
import { assert, test, mockIpfsFile } from 'matchstick-as/assembly/index'
import { ipfs } from '@graphprotocol/graph-ts'
import { gravatarFromIpfs } from './utils'

// Export ipfs.map() callback in order for matchstck to detect it
export { processGravatar } from './utils'

test('ipfs.cat', () => {
  mockIpfsFile('ipfsCatfileHash', 'tests/ipfs/cat.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  gravatarFromIpfs()

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 1)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'imageUrl', 'https://i.ytimg.com/vi/MELP46s8Cic/maxresdefault.jpg')

  clearStore()
})

test('ipfs.map', () => {
  mockIpfsFile('ipfsMapfileHash', 'tests/ipfs/map.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  ipfs.map('ipfsMapfileHash', 'processGravatar', Value.fromString('Gravatar'), ['json'])

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 3)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'displayName', 'Gravatar1')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '2', 'displayName', 'Gravatar2')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '3', 'displayName', 'Gravatar3')
})
```

`utils.ts` рдлрд╝рд╛рдЗрд▓:

```typescript
import { Address, ethereum, JSONValue, Value, ipfs, json, Bytes } from "@graphprotocol/graph-ts"
import { Gravatar } from "../../generated/schema"

...

// ipfs.map callback
export function processGravatar(value: JSONValue, userData: Value): void {
  // See the JSONValue documentation for details on dealing
  // with JSON values
  let obj = value.toObject()
  let id = obj.get('id')

  if (!id) {
    return
  }

  // Callbacks can also created entities
  let gravatar = new Gravatar(id.toString())
  gravatar.displayName = userData.toString() + id.toString()
  gravatar.save()
}

// function that calls ipfs.cat
export function gravatarFromIpfs(): void {
  let rawData = ipfs.cat("ipfsCatfileHash")

  if (!rawData) {
    return
  }

  let jsonData = json.fromBytes(rawData as Bytes).toObject()

  let id = jsonData.get('id')
  let url = jsonData.get("imageUrl")

  if (!id || !url) {
    return
  }

  let gravatar = new Gravatar(id.toString())
  gravatar.imageUrl = url.toString()
  gravatar.save()
}
```

### Asserting the state of the store

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдВрд╕реНрдерд╛рдУрдВ рдкрд░ рдЬреЛрд░ рджреЗрдХрд░ рд╕реНрдЯреЛрд░ рдХреА рдЕрдВрддрд┐рдо (рдпрд╛ рдорд┐рдбрд╡реЗ) рд╕реНрдерд┐рддрд┐ рдХрд╛ рджрд╛рд╡рд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдПрдХ рдЗрдХрд╛рдИ рдкреНрд░рдХрд╛рд░, рдПрдХ рдЗрдХрд╛рдИ рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдИрдбреА, рдЙрд╕ рдЗрдХрд╛рдИ рдкрд░ рдПрдХ рдлрд╝реАрд▓реНрдб рдХрд╛ рдирд╛рдо рдФрд░ рдлрд╝реАрд▓реНрдб рдХреЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдореВрд▓реНрдп рдХреА рдЖрдкреВрд░реНрддрд┐ рдХрд░рдиреА рд╣реЛрдЧреАред рдпрд╣рд╛рдБ рдПрдХ рддреНрд╡рд░рд┐рдд рдЙрджрд╛рд╣рд░рдг рд╣реИ:

```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```

Assert.fieldEquals() рдлрд╝рдВрдХреНрд╢рди рдЪрд▓рд╛рдиреЗ рд╕реЗ рджрд┐рдП рдЧрдП рдЕрдкреЗрдХреНрд╖рд┐рдд рдорд╛рди рдХреЗ рд╡рд┐рд░реБрджреНрдз рджрд┐рдП рдЧрдП рдлрд╝реАрд▓реНрдб рдХреА рд╕рдорд╛рдирддрд╛ рдХреА рдЬрд╛рдБрдЪ рд╣реЛрдЧреАред рдпрджрд┐ рдорд╛рди **рдирд╣реАрдВ** рдмрд░рд╛рдмрд░ рд╣реИрдВ рддреЛ рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдЖрдЙрдЯрдкреБрдЯ рд╣реЛрдЧрд╛ред рдЕрдиреНрдпрдерд╛ рдкрд░реАрдХреНрд╖рд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЙрддреНрддреАрд░реНрдг рд╣реЛрдЧреАред

### рдЗрд╡реЗрдВрдЯ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдирд╛

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд▓реЗрди-рджреЗрди рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ `newMockEvent()` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдереЗрд░рд┐рдпрдо.рдЗрд╡реЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реМрдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдирд┐рдореНрди рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдИрд╡реЗрдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдЙрди рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЛ рдХреИрд╕реЗ рдкрдврд╝/рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ:

```typescript
// Read
let logType = newGravatarEvent.logType

// Write
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```

### рдЪрд░ рд╕рдорд╛рдирддрд╛ рдкрд░ рдЬреЛрд░ рджреЗрдирд╛

```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```

### рдпрд╣ рджрд╛рд╡рд╛ рдХрд░рдирд╛ рдХрд┐ рдПрдХ рдЗрдХрд╛рдИ рд╕реНрдЯреЛрд░ рдореЗрдВ **рдирд╣реАрдВ** рд╣реИ

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╣ рджрд╛рд╡рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╕реНрдЯреЛрд░ рдореЗрдВ рдХреЛрдИ рдЗрдХрд╛рдИ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИред рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдЗрдХрд╛рдИ рдкреНрд░рдХрд╛рд░ рдФрд░ рдПрдХ рдЖрдИрдбреА рд▓реЗрддрд╛ рд╣реИред рдпрджрд┐ рдЗрдХрд╛рдИ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реНрдЯреЛрд░ рдореЗрдВ рд╣реИ, рддреЛ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рд╕рд╛рде рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ рдЗрд╕рдХрд╛ рдПрдХ рддреНрд╡рд░рд┐рдд рдЙрджрд╛рд╣рд░рдг рдпрд╣рд╛рдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

```typescript
assert.notInStore('Gravatar', '23')
```

### рдкреВрд░реЗ рд╕реНрдЯреЛрд░ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рдирд╛ (рдбрд┐рдмрдЧ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП)

рдЖрдк рдЗрд╕ рд╕рд╣рд╛рдпрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреВрд░реЗ рд╕реНрдЯреЛрд░ рдХреЛ рдХрдВрд╕реЛрд▓ рдкрд░ рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```typescript
import { logStore } from 'matchstick-as/assembly/store'

logStore()
```

### рдЕрдкреЗрдХреНрд╖рд┐рдд рдЕрд╕рдлрд▓рддрд╛

рдкрд░реАрдХреНрд╖рдг () рдлрд╝рдВрдХреНрд╢рдВрд╕ рдкрд░ shouldFail рдлрд╝реНрд▓реИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрд░реАрдХреНрд╖рдг рд╡рд┐рдлрд▓рддрд╛рдПрдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ:

```typescript
test(
  'Should throw an error',
  () => {
    throw new Error()
  },
  true,
)
```

рдпрджрд┐ рдкрд░реАрдХреНрд╖рдг shouldFail = true рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд┐рдлрд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд▓реЙрдЧ рдореЗрдВ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдмреНрд▓реЙрдХ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред рд╕рд╛рде рд╣реА, рдпрджрд┐ рдЗрд╕реЗ shouldFail = false (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдерд┐рддрд┐) рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдкрд░реАрдХреНрд╖рдг рдирд┐рд╖реНрдкрд╛рджрдХ рдХреНрд░реИрд╢ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

### рд▓реЙрдЧрд┐рдВрдЧ

рдпреВрдирд┐рдЯ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ рдХрд╕реНрдЯрдо рд▓реЙрдЧ рд░рдЦрдирд╛ рдореИрдкрд┐рдВрдЧ рдореЗрдВ рд▓реЙрдЧрд┐рдВрдЧ рдХреЗ рд╕рдорд╛рди рд╣реА рд╣реИред рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рд▓реЙрдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЧреНрд░рд╛рдлрд╝-рдЯреАрдПрд╕ рдХреЗ рдмрдЬрд╛рдп рдорд╛рдЪрд┐рд╕ рдХреА рддреАрд▓реА рд╕реЗ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдпрд╣рд╛рдБ рд╕рднреА рдЧреИрд░-рдорд╣рддреНрд╡рдкреВрд░реНрдг рд▓реЙрдЧ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

```typescript
import { test } from "matchstick-as/assembly/index";
import { log } from "matchstick-as/assembly/log";

test("Success", () => {
    log.success("Success!". []);
});
test("Error", () => {
    log.error("Error :( ", []);
});
test("Debug", () => {
    log.debug("Debugging...", []);
});
test("Info", () => {
    log.info("Info!", []);
});
test("Warning", () => {
    log.warning("Warning!", []);
});
```

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдЧрдВрднреАрд░ рд╡рд┐рдлрд▓рддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:

```typescript
test('Blow everything up', () => {
  log.critical('Boom!')
})
```

рдорд╣рддреНрд╡рдкреВрд░реНрдг рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рд▓реЙрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдмрдВрдж рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╕рдм рдХреБрдЫ рдЙрдбрд╝ рдЬрд╛рдПрдЧрд╛ред рдЖрдЦрд┐рд░рдХрд╛рд░ - рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреЗ рдХреЛрдб рдореЗрдВ рдкрд░рд┐рдирд┐рдпреЛрдЬрди рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд▓реЙрдЧ рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ рддреБрд░рдВрдд рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред

### рд╡реНрдпреБрддреНрдкрдиреНрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг

рд╡реНрдпреБрддреНрдкрдиреНрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ (рдЬреИрд╕рд╛ рдХрд┐ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЗрдХрд╛рдИ рдореЗрдВ рдПрдХ рдлрд╝реАрд▓реНрдб рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдФрд░ рджреВрд╕рд░реА рдЗрдХрд╛рдИ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрджрд┐ рдпрд╣ рдкрд╣рд▓реА рдЗрдХрд╛рдИ рд╕реЗ рдЕрдкрдирд╛ рдПрдХ рдХреНрд╖реЗрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдиреЗ рд╡рд╛рд▓реА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдкрд╣рд▓реА рдЗрдХрд╛рдИ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдЯреЛрд░ рдореЗрдВ рд╕реНрд╡рдд: рдЕрдкрдбреЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдПрд╕ рдХреЛрдб рдЕрдЬреНрдЮреЗрдпрд╡рд╛рджреА рд╣реЛрддрд╛ рд╣реИред

```typescript
test('Derived fields example test', () => {
  let mainAccount = new GraphAccount('12')
  mainAccount.save()
  let operatedAccount = new GraphAccount('1')
  operatedAccount.operators = ['12']
  operatedAccount.save()
  let nst = new NameSignalTransaction('1234')
  nst.signer = '12'
  nst.save()

  assert.assertNull(mainAccount.get('nameSignalTransactions'))
  assert.assertNull(mainAccount.get('operatorOf'))

  mainAccount = GraphAccount.load('12')!

  assert.i32Equals(1, mainAccount.nameSignalTransactions.length)
  assert.stringEquals('1', mainAccount.operatorOf[0])
})
```

### рдЧрддрд┐рд╢реАрд▓ рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг

<рдХреЛрдб>рд╕рдВрджрд░реНрдн()</рдХреЛрдб>, <рдХреЛрдб>рдкрддрд╛()</рдХреЛрдб> рдФрд░ <рдХреЛрдб>рдиреЗрдЯрд╡рд░реНрдХ()</рдХреЛрдб> рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╡рд╛рдкрд╕реА рдорд╛рди рдХрд╛ рдордЬрд╝рд╛рдХ рдЙрдбрд╝рд╛рдХрд░ рдЧрддрд┐рд╢реАрд▓ рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдирд╛рдо рд╕реНрдерд╛рдиред рдпреЗ рдлрд╝рдВрдХреНрд╢рди рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ: `context()` - рдПрдХ рдЦрд╛рд▓реА рдЗрдХрд╛рдИ (DataSourceContext), `address()` рд▓реМрдЯрд╛рддрд╛ рд╣реИ - `0x000000000000000000000000000000000000000`, ` рджреЗрддрд╛ рд╣реИ рдиреЗрдЯрд╡рд░реНрдХ () </ рдХреЛрдб> - <рдХреЛрдб> рдореЗрдирдиреЗрдЯ </ рдХреЛрдб> рд▓реМрдЯрд╛рддрд╛ рд╣реИред <code>create(...)` рдФрд░ `createWithContext(...)` рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЛ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрд╝рд╛рдХ рдЙрдбрд╝рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ рдмреБрд▓рд╛рдП рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред `dataSourceMock` рдиреЗрдорд╕реНрдкреЗрд╕ `matchstick-as` (рд╕рдВрд╕реНрдХрд░рдг 0.3.0+) рдореЗрдВ рджрд┐рдП рдЧрдП рдорд╛рдиреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдиреАрдЪреЗ:

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдИрд╡реЗрдВрдЯ рд╣реИрдВрдбрд▓рд░ рд╣реИ (рдЬрд┐рд╕реЗ рдЬрд╛рдирдмреВрдЭрдХрд░ рдбреЗрдЯрд╛рд╕реЛрд░реНрд╕ рдореЙрдХрд┐рдВрдЧ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрдирд░реНрдирд┐рд░реНрдорд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ):

```typescript
export function handleApproveTokenDestinations(event: ApproveTokenDestinations): void {
  let tokenLockWallet = TokenLockWallet.load(dataSource.address().toHexString())!
  if (dataSource.network() == 'rinkeby') {
    tokenLockWallet.tokenDestinationsApproved = true
  }
  let context = dataSource.context()
  if (context.get('contextVal')!.toI32() > 0) {
    tokenLockWallet.setBigInt('tokensReleased', BigInt.fromI32(context.get('contextVal')!.toI32()))
  }
  tokenLockWallet.save()
}
```

рдФрд░ рдлрд┐рд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рднреА рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рд░рд┐рдЯрд░реНрди рд╡реИрд▓реНрдпреВ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рд╕реЛрд░реНрд╕рдореЙрдХ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░реАрдХреНрд╖рдг рд╣реИ:

```typescript
import { assert, test, newMockEvent, dataSourceMock } from 'matchstick-as/assembly/index'
import { BigInt, DataSourceContext, Value } from '@graphprotocol/graph-ts'

import { handleApproveTokenDestinations } from '../../src/token-lock-wallet'
import { ApproveTokenDestinations } from '../../generated/templates/GraphTokenLockWallet/GraphTokenLockWallet'
import { TokenLockWallet } from '../../generated/schema'

test('Data source simple mocking example', () => {
  let addressString = '0xA16081F360e3847006dB660bae1c6d1b2e17eC2A'
  let address = Address.fromString(addressString)

  let wallet = new TokenLockWallet(address.toHexString())
  wallet.save()
  let context = new DataSourceContext()
  context.set('contextVal', Value.fromI32(325))
  dataSourceMock.setReturnValues(addressString, 'rinkeby', context)
  let event = changetype<ApproveTokenDestinations>(newMockEvent())

  assert.assertTrue(!wallet.tokenDestinationsApproved)

  handleApproveTokenDestinations(event)

  wallet = TokenLockWallet.load(address.toHexString())!
  assert.assertTrue(wallet.tokenDestinationsApproved)
  assert.bigIntEquals(wallet.tokensReleased, BigInt.fromI32(325))

  dataSourceMock.resetValues()
})
```

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ dataSourceMock.resetValues() рдХреЛ рдЕрдВрдд рдореЗрдВ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдпрд╛рдж рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рд╡реЗ рдмрджрд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдпрджрд┐ рдЖрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиреЛрдВ рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЙрдиреНрд╣реЗрдВ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

## рдЯреЗрд╕реНрдЯ рдХрд╡рд░реЗрдЬ

Using **Matchstick**, subgraph developers are able to run a script that will calculate the test coverage of the written unit tests.

The test coverage tool takes the compiled test `wasm` binaries and converts them to `wat` files, which can then be easily inspected to see whether or not the handlers defined in `subgraph.yaml` have been called. Since code coverage (and testing as whole) is in very early stages in AssemblyScript and WebAssembly, **Matchstick** cannot check for branch coverage. Instead we rely on the assertion that if a given handler has been called, the event/function for it have been properly mocked.

### рдЖрд╡рд╢реНрдпрдХ рд╢рд░реНрддреЗрдВ

**рдореИрдЪрд╕реНрдЯрд┐рдХ** рдореЗрдВ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдкрд░реАрдХреНрд╖рдг рдХрд╡рд░реЗрдЬ рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреБрдЫ рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

#### рдЕрдкрдиреЗ рд╣реИрдВрдбрд▓рд░ рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдВ

**рдореИрдЪрд╕реНрдЯрд┐рдХ** рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреМрди рд╕реЗ рд╣реИрдВрдбрд▓рд░ рдЪрд▓рд╛рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рдЙрди рд╣реИрдВрдбрд▓рд░ рдХреЛ **рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓** рд╕реЗ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рддреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдорд╛рд░реЗ рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг.test.ts рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВрдбрд▓рд░ рдЖрдпрд╛рдд рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ:

```typescript
import { handleNewGravatar } from '../../src/gravity'
```

рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП (рдЗрд╕реЗ `рд╡рд╛рдЯ` рдлрд╝рд╛рдЗрд▓ **рдирд╛рдо рд╕реЗ** рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рд╣рдореЗрдВ рдЗрд╕реЗ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдпрд╣:

```typescript
export { handleNewGravatar }
```

### рдкреНрд░рдпреЛрдЧ

рдПрдХ рдмрд╛рд░ рдпрд╣ рд╕рдм рд╕реЗрдЯ рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдкрд░реАрдХреНрд╖рдг рдХрд╡рд░реЗрдЬ рдЯреВрд▓ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ рдЪрд▓рд╛рдПрдБ:

```sh
graph test -- -c
```

рдЖрдк рдЕрдкрдиреА `package.json` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХрд╕реНрдЯрдо `рдХрд╡рд░реЗрдЬ` рдХрдорд╛рдВрдб рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:

```typescript
 "scripts": {
    /.../
    "coverage": "graph test -- -c"
  },
```

That will execute the coverage tool and you should see something like this in the terminal:

```sh
$ graph test -c
Skipping download/install step because binary already exists at /Users/petko/work/demo-subgraph/node_modules/binary-install-raw/bin/0.4.0

___  ___      _       _         _   _      _
|  \/  |     | |     | |       | | (_)    | |
| .  . | __ _| |_ ___| |__  ___| |_ _  ___| | __
| |\/| |/ _` | __/ __| '_ \/ __| __| |/ __| |/ /
| |  | | (_| | || (__| | | \__ \ |_| | (__|   <
\_|  |_/\__,_|\__\___|_| |_|___/\__|_|\___|_|\_\

Compiling...

Running in coverage report mode.
 я╕П
Reading generated test modules... ЁЯФОя╕П

Generating coverage report ЁЯУЭ

Handlers for source 'Gravity':
Handler 'handleNewGravatar' is tested.
Handler 'handleUpdatedGravatar' is not tested.
Handler 'handleCreateGravatar' is tested.
Test coverage: 66.7% (2/3 handlers).

Handlers for source 'GraphTokenLockWallet':
Handler 'handleTokensReleased' is not tested.
Handler 'handleTokensWithdrawn' is not tested.
Handler 'handleTokensRevoked' is not tested.
Handler 'handleManagerUpdated' is not tested.
Handler 'handleApproveTokenDestinations' is not tested.
Handler 'handleRevokeTokenDestinations' is not tested.
Test coverage: 0.0% (0/6 handlers).

Global test coverage: 22.2% (2/9 handlers).
```

### рд▓реЙрдЧ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдЯреЗрд╕реНрдЯ рд░рди рдЯрд╛рдЗрдо рдЕрд╡рдзрд┐

рд▓реЙрдЧ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдЯреЗрд╕реНрдЯ рд░рди рдЕрд╡рдзрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИред рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ:

`[рдЧреБрд░реБ, 31 рдорд╛рд░реНрдЪ 2022 13:54:54 +0300] рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд: 42.270msред`

## рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрдХрд▓рдХ рддреНрд░реБрдЯрд┐рдпрд╛рдБ

> рдЧрдВрднреАрд░: рд╕рдВрджрд░реНрдн рдХреЗ рд╕рд╛рде рдорд╛рдиреНрдп рдореЙрдбреНрдпреВрд▓ рд╕реЗ WasmInstance рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрд╛: рдЕрдЬреНрдЮрд╛рдд рдЖрдпрд╛рдд: wasi_snapshot_preview1::fd_write рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ

рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рдЕрдкрдиреЗ рдХреЛрдб рдореЗрдВ `console.log` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдЕрд╕реЗрдВрдмрд▓реАрд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИред рдХреГрдкрдпрд╛ [рд▓реЙрдЧрд┐рдВрдЧ API](/Developing/assemblyscript-api/#logging-api) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ

> рддреНрд░реБрдЯрд┐ TS2554: рдЕрдкреЗрдХреНрд╖рд┐рдд? рддрд░реНрдХ, рд▓реЗрдХрд┐рди рдорд┐рд▓рд╛ ?.
> 
> return new ethereum.Block(defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultAddress, defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(18,12)
> 
> рддреНрд░реБрдЯрд┐ TS2554: рдЕрдкреЗрдХреНрд╖рд┐рдд? рддрд░реНрдХ, рд▓реЗрдХрд┐рди рдорд┐рд▓рд╛ ?.
> 
> return new ethereum.Transaction(defaultAddressBytes, defaultBigInt, defaultAddress, defaultAddress, defaultBigInt, defaultBigInt, defaultBigInt, defaultAddressBytes, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(24,12)

рддрд░реНрдХреЛрдВ рдореЗрдВ рдмреЗрдореЗрд▓ `рдЧреНрд░рд╛рдлрд╝-рдЯреАрдПрд╕` рдФрд░ `рдореИрдЪрд╕реНрдЯрд┐рдХ-рдПрдЬрд╝` рдореЗрдВ рдмреЗрдореЗрд▓ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣ рдХреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рд╕рднреА рдЪреАрдЬрд╝реЛрдВ рдХреЛ рдирд╡реАрдирддрдо рд░рд┐рд▓реАрдЬрд╝ рдХрд┐рдП рдЧрдП рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдЕрдкрдбреЗрдЯ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдП.

## рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдкреНрд░рд╢реНрди, рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛, рдлреАрдЪрд░ рдЕрдиреБрд░реЛрдз рд╣реИ рдпрд╛ рдЖрдк рдмрд╕ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреА рдЬрдЧрд╣ рдж рдЧреНрд░рд╛рдл рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╣реЛрдЧреА рдЬрд╣рд╛рдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдореИрдЪрд╕реНрдЯрд┐рдХ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдорд░реНрдкрд┐рдд рдЪреИрдирд▓ рд╣реИ, рдЬрд┐рд╕реЗ ЁЯФе рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ| рдЗрдХрд╛рдИ рдХрд╛ рдкрд░реАрдХреНрд╖рдгред
