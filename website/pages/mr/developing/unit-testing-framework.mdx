---
title: рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреА рдлреНрд░реЗрдорд╡рд░реНрдХ
---

рдореЕрдЪрд╕реНрдЯрд┐рдХ рд╣реЗ рдПрдХ рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреА рдлреНрд░реЗрдорд╡рд░реНрдХ рдЖрд╣реЗ, рдЬреЗ [LimeChain](https://limechain.tech/) рдиреЗ рд╡рд┐рдХрд╕рд┐рдд рдХреЗрд▓реЗ рдЖрд╣реЗ, рдЬреЗ рд╕рдмрдЧреНрд░рд╛рдл рдбреЗрд╡реНрд╣рд▓рдкрд░рдирд╛ рддреНрдпрд╛рдВрдЪреНрдпрд╛ рдореЕрдкрд┐рдВрдЧ рд▓реЙрдЬрд┐рдХрдЪреА рд╕рдБрдбрдмреЙрдХреНрд╕реНрдб рд╡рд╛рддрд╛рд╡рд░рдгрд╛рдд рдЪрд╛рдЪрдгреА рдШреЗрдгреНрдпрд╛рд╕ рдЖрдгрд┐ рддреНрдпрд╛рдВрдЪреЗ рд╕рдмрдЧреНрд░рд╛рдл рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕рд╛рдиреЗ рддреИрдирд╛рдд рдХрд░рдгреНрдпрд╛рд╕ рд╕рдХреНрд╖рдо рдХрд░рддреЗ!

## рдкреНрд░рд╛рд░рдВрдн рдХрд░рдгреЗ

### рдЕрд╡рд▓рдВрдмрд┐рддреНрд╡ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рд╛

рдЪрд╛рдЪрдгреА рдорджрддрдиреАрд╕ рдкрджреНрдзрддреА рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЖрдгрд┐ рдЪрд╛рдЪрдгреНрдпрд╛ рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА, рддреБрдореНрд╣рд╛рд▓рд╛ рдЦрд╛рд▓реАрд▓ рдЕрд╡рд▓рдВрдмрди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ:

```sh
yarn add --dev matchstick-as
```

тЭЧ `рдЧреНрд░рд╛рдл-рдиреЛрдб` PostgreSQL рд╡рд░ рдЕрд╡рд▓рдВрдмреВрди рдЖрд╣реЗ, рддреНрдпрд╛рдореБрд│реЗ рддреБрдордЪреНрдпрд╛рдХрдбреЗ рддреЗ рдЖрдзреАрдкрд╛рд╕реВрди рдирд╕реЗрд▓, рддрд░ рддреБрдореНрд╣рд╛рд▓рд╛ рддреЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧреЗрд▓. рдЖрдореНрд╣реА рдЦрд╛рд▓реАрд▓ рдЖрджреЗрд╢ рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╕рд▓реНрд▓рд╛ рджреЗрддреЛ рдХрд╛рд░рдг рддреЗ рдЗрддрд░ рдХреЛрдгрддреНрдпрд╛рд╣реА рдкреНрд░рдХрд╛рд░реЗ рдЬреЛрдбрд▓реНрдпрд╛рд╕ рдЕрдирдкреЗрдХреНрд╖рд┐рдд рддреНрд░реБрдЯреА рдпреЗрдК рд╢рдХрддрд╛рдд!

#### MacOS

Postgres рд╕реНрдерд╛рдкрдирд╛ рдЖрджреЗрд╢:

```sh
brew install postgresql
```

рдирд╡реАрдирддрдо libpq.5.lib рд╕рд╛рдареА рдПрдХ рд╕рд┐рдорд▓рд┐рдВрдХ рддрдпрд╛рд░ рдХрд░рд╛ _рддреБрдореНрд╣рд╛рд▓рд╛ рдкреНрд░рдердо рд╣реЗ dir рддрдпрд╛рд░ рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧреЗрд▓_ `/usr/local/opt/postgresql/lib/`

```sh
ln -sf /usr/local/opt/postgresql@14/lib/postgresql@14/libpq.5.dylib /usr/local/opt/postgresql/lib/libpq.5.dylib
```

#### рд▓рд┐рдирдХреНрд╕

рдкреЛрд╕реНрдЯрдЧреНрд░реЗрд╕ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХрдорд╛рдВрдб (рддреБрдордЪреНрдпрд╛ рдбрд┐рд╕реНрдЯреНрд░реЛрд╡рд░ рдЕрд╡рд▓рдВрдмреВрди рдЖрд╣реЗ):

```sh
sudo apt install postgresql
```

### WSL (рд▓рд┐рдирдХреНрд╕рд╕рд╛рдареА рд╡рд┐рдВрдбреЛрдЬ рд╕рдмрд╕рд┐рд╕реНрдЯрдо)

рдбреЙрдХрд░ рджреГрд╖реНрдЯрд┐рдХреЛрди рдЖрдгрд┐ рдмрд╛рдпрдирд░реА рджреГрд╖реНрдЯрд┐рдХреЛрди рд╡рд╛рдкрд░реВрди рддреБрдореНрд╣реА WSL рд╡рд░ рдореЕрдЪрд╕реНрдЯрд┐рдХ рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛. рдбрдмреНрд▓реНрдпреВрдПрд╕рдПрд▓ рдереЛрдбреЗ рдЕрд╡рдШрдб рдЕрд╕реВ рд╢рдХрддреЗ, рдпрд╛рд╕рд╛рд░рдЦреНрдпрд╛ рд╕рдорд╕реНрдпрд╛ рдЖрд▓реНрдпрд╛рд╕ рдпреЗрдереЗ рдХрд╛рд╣реА рдЯрд┐рдкрд╛ рдЖрд╣реЗрдд

```
static BYTES = Symbol("Bytes") SyntaxError: Unexpected token =
```

рдХрд┐рдВрд╡рд╛

```
<PROJECT_PATH>/node_modules/gluegun/build/index.js:13 throw up;
```

рдХреГрдкрдпрд╛ рдЦрд╛рддреНрд░реА рдХрд░рд╛ рдХреА рддреБрдореНрд╣реА Node.js graph-cli рдЪреНрдпрд╛ рдирд╡реАрди рдЖрд╡реГрддреНрддреАрд╡рд░ рдЖрд╣рд╛рдд рдЖрддрд╛ **v10.19.0** рд▓рд╛ рд╕рдкреЛрд░реНрдЯ рдХрд░рдд рдирд╛рд╣реА рдЖрдгрд┐ WSL рд╡рд░реАрд▓ рдирд╡реАрди Ubuntu рдкреНрд░рддрд┐рдорд╛рдВрд╕рд╛рдареА рддреА рдбреАрдлреЙрд▓реНрдЯ рдЖрд╡реГрддреНрддреА рдЖрд╣реЗ. рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде рдореЕрдЪрд╕реНрдЯрд┐рдХ **v18.1.0** рд╕рд╣ WSL рд╡рд░ рдХрд╛рдо рдХрд░рдд рдЕрд╕рд▓реНрдпрд╛рдЪреА рдкреБрд╖реНрдЯреА рдЭрд╛рд▓реА рдЖрд╣реЗ, рддреБрдореНрд╣реА рддреНрдпрд╛рд╡рд░ **nvm** рджреНрд╡рд╛рд░реЗ рдХрд┐рдВрд╡рд╛ рддреБрдореНрд╣реА рддреБрдордЪреЗ рдЧреНрд▓реЛрдмрд▓ Node.js рдЕрдкрдбреЗрдЯ рдХреЗрд▓реНрдпрд╛рд╕ рддреНрдпрд╛рд╡рд░ рд╕реНрд╡рд┐рдЪ рдХрд░реВ рд╢рдХрддрд╛. рддреБрдореНрд╣рд╛рд▓рд╛ рдиреЛрдбрдЬ рдЕрдкрдбреЗрдЯ рдХреЗрд▓реНрдпрд╛рдирдВрддрд░ `node_modules` рд╣рдЯрд╡рд╛рдпрд▓рд╛ рдЖрдгрд┐ `npm install` рдкреБрдиреНрд╣рд╛ рдЪрд╛рд▓рд╡рд╛рдпрд▓рд╛ рд╡рд┐рд╕рд░реВ рдирдХрд╛! рддреНрдпрд╛рдирдВрддрд░, рддреБрдордЪреНрдпрд╛рдХрдбреЗ **libpq** рд╕реНрдерд╛рдкрд┐рдд рдЕрд╕рд▓реНрдпрд╛рдЪреА рдЦрд╛рддреНрд░реА рдХрд░рд╛, рддреБрдореНрд╣реА рддреЗ рдЪрд╛рд▓рд╡реВрди рдХрд░реВ рд╢рдХрддрд╛

```
sudo apt-get install libpq-dev
```

рдЖрдгрд┐ рд╢реЗрд╡рдЯреА, `рдЧреНрд░рд╛рдл рдЪрд╛рдЪрдгреА` рд╡рд╛рдкрд░реВ рдирдХрд╛ (рдЬреЗ рддреБрдордЪреЗ рдЧреНрд░рд╛рдл-рдХреНрд▓реАрдЪреЗ рдЬрд╛рдЧрддрд┐рдХ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╡рд╛рдкрд░рддреЗ рдЖрдгрд┐ рдХрд╛рд╣реА рдХрд╛рд░рдгрд╛рд╕реНрддрд╡ рддреЗ рд╕рдзреНрдпрд╛ WSL рд╡рд░ рддреБрдЯрд▓реЗрд▓реЗ рджрд┐рд╕рддреЗ), рддреНрдпрд╛рдРрд╡рдЬреА `рдпрд╛рд░реНрди рдЯреЗрд╕реНрдЯ` рд╡рд╛рдкрд░рд╛. рдХрд┐рдВрд╡рд╛ `npm рд░рди рдЪрд╛рдЪрдгреА` (рдЬреЗ рдЧреНрд░рд╛рдл-рдХреНрд▓реАрдЪреЗ рд╕реНрдерд╛рдирд┐рдХ, рдкреНрд░рдХрд▓реНрдк-рд╕реНрддрд░реАрдп рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░реЗрд▓, рдЬреЗ рдореЛрд╣рд┐рдиреАрд╕рд╛рд░рдЦреЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ). рддреНрдпрд╛рд╕рд╛рдареА рддреБрдореНрд╣рд╛рд▓рд╛ рддреБрдордЪреНрдпрд╛ `package.json` рдлрд╛рдИрд▓рдордзреНрдпреЗ рдЕрд░реНрдерд╛рддрдЪ рдПрдХ `"test"` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрд╕рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ рдЬреЗ рд╕реЛрдкреЗ рдЕрд╕реВ рд╢рдХрддреЗ

```json
{
  "name": "demo-subgraph",
  "version": "0.1.0",
  "scripts": {
    "test": "graph test",
    ...
  },
  "dependencies": {
    "@graphprotocol/graph-cli": "^0.30.0",
    "@graphprotocol/graph-ts": "^0.27.0",
    "matchstick-as": "^0.5.0"
  }
}
```

### рд╡рд╛рдкрд░

рддреБрдордЪреНрдпрд╛ рд╕рдмрдЧреНрд░рд╛рдл рдкреНрд░реЛрдЬреЗрдХреНрдЯрдордзреНрдпреЗ **Matchstick** рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА рдлрдХреНрдд рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рдЙрдШрдбрд╛, рддреБрдордЪреНрдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯрдЪреНрдпрд╛ рд░реВрдЯ рдлреЛрд▓реНрдбрд░рд╡рд░ рдиреЗрд╡реНрд╣рд┐рдЧреЗрдЯ рдХрд░рд╛ рдЖрдгрд┐ рдлрдХреНрдд `рдЧреНрд░рд╛рдл рдЪрд╛рдЪрдгреА [options] <datasource> ` - рддреЗ рдирд╡реАрдирддрдо **Matchstick** рдмрд╛рдпрдирд░реА рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рдЖрдгрд┐ рдЪрд╛рдЪрдгреА рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЪрд╛рдЪрдгреА рдХрд┐рдВрд╡рд╛ рд╕рд░реНрд╡ рдЪрд╛рдЪрдгреНрдпрд╛ рдЪрд╛рд▓рд╡рддреЗ (рдХрд┐рдВрд╡рд╛ рдХреЛрдгрддрд╛рд╣реА рдбреЗрдЯрд╛рд╕реЛрд░реНрд╕ рдзреНрд╡рдЬ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреЗрд▓реЗрд▓рд╛ рдирд╕рд▓реНрдпрд╛рд╕ рд╕рд░реНрд╡ рд╡рд┐рджреНрдпрдорд╛рди рдЪрд╛рдЪрдгреНрдпрд╛).

### CLI рдкрд░реНрдпрд╛рдп

рд╣реЗ рдЪрд╛рдЪрдгреА рдлреЛрд▓реНрдбрд░рдордзреАрд▓ рд╕рд░реНрд╡ рдЪрд╛рдЪрдгреНрдпрд╛ рдЪрд╛рд▓рд╡реЗрд▓:

```sh
рдЖрд▓реЗрдЦ рдЪрд╛рдЪрдгреА
```

рд╣реЗ gravity.test.ts рдирд╛рд╡рд╛рдЪреА рдЪрд╛рдЪрдгреА рдЖрдгрд┐/рдХрд┐рдВрд╡рд╛ рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг рдирд╛рд╡рд╛рдЪреНрдпрд╛ рдлреЛрд▓реНрдбрд░рдЪреНрдпрд╛ рдЖрдд рд╕рд░реНрд╡ рдЪрд╛рдЪрдгреА рдЪрд╛рд▓рд╡реЗрд▓:

```sh
graph test gravity
```

рд╣реЗ рдлрдХреНрдд рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЪрд╛рдЪрдгреА рдлрд╛рдЗрд▓ рдЪрд╛рд▓рд╡реЗрд▓:

```sh
graph test path/to/file.test.ts
```

**рдкрд░реНрдпрд╛рдп:**

```sh
-c, --coverage рдХрд╡реНрд╣рд░реЗрдЬ рдореЛрдбрдордзреНрдпреЗ рдЪрд╛рдЪрдгреНрдпрд╛ рдЪрд╛рд▓рд╡рд╛
-d, --docker рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░рдордзреНрдпреЗ рдЪрд╛рдЪрдгреНрдпрд╛ рдЪрд╛рд▓рд╡рд╛ (рдЯреАрдк: рдХреГрдкрдпрд╛ рд╕рдмрдЧреНрд░рд╛рдлрдЪреНрдпрд╛ рд░реВрдЯ рдлреЛрд▓реНрдбрд░рдордзреВрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рд╛)
-f --force рдмрд╛рдпрдирд░реА: рдмрд╛рдпрдирд░реА рдкреБрдиреНрд╣рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ. рдбреЙрдХрд░: рдбреЙрдХрд░рдлрд╛рдЗрд▓ рдкреБрдиреНрд╣рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рдЖрдгрд┐ рдбреЙрдХрд░ рдкреНрд░рддрд┐рдорд╛ рдкреБрдиреНрд╣рд╛ рддрдпрд╛рд░ рдХрд░рддреЗ.
-h, --help рд╡рд╛рдкрд░ рдорд╛рд╣рд┐рддреА рджрд╛рдЦрд╡рд╛
-l, --logs OS, CPU рдореЙрдбреЗрд▓ рдЖрдгрд┐ рдбрд╛рдЙрдирд▓реЛрдб url рдмрджреНрджрд▓ рдХрдиреНрд╕реЛрд▓ рдорд╛рд╣рд┐рддреАрд╡рд░ рд▓реЙрдЧ (рдбреАрдмрдЧрд┐рдВрдЧ рд╣реЗрддреВ)
-r, --recompile рдлреЛрд░реНрд╕реЗрд╕ рдЪрд╛рдЪрдгреНрдпрд╛ рдкреБрдиреНрд╣рд╛ рдХрдВрдкрд╛рдЗрд▓ рдХреЗрд▓реНрдпрд╛ рдЬрд╛рддреАрд▓
-v, --version <tag> рддреБрдореНрд╣рд╛рд▓рд╛ рдбрд╛рдЙрдирд▓реЛрдб/рд╡рд╛рдкрд░рд╛рдпрдЪреА рдЕрд╕рд▓реЗрд▓реА рд░рд╕реНрдЯ рдмрд╛рдпрдирд░реАрдЪреА рдЖрд╡реГрддреНрддреА рдирд┐рд╡рдбрд╛
```

### рдбреЙрдХрд░

`graph-cli 0.25.2` рд╡рд░реВрди, `рдЧреНрд░рд╛рдл рдЪрд╛рдЪрдгреА` рдХрдорд╛рдВрдб `-d` рд╕рд╣ рдбреЙрдХрд░ рдХрдВрдЯреЗрдирд░рдордзреНрдпреЗ `matchstick` рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕ рд╕рдорд░реНрдерди рджреЗрддреЗ > рдзреНрд╡рдЬ. рдбреЙрдХрд░ рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА [рдмрд╛рдЗрдВрдб рдорд╛рдЙрдВрдЯ](https://docs.docker.com/storage/bind-mounts/) рд╡рд╛рдкрд░рддреЗ рддреНрдпрд╛рдореБрд│реЗ рдкреНрд░рддреНрдпреЗрдХ рд╡реЗрд│реА `рдЧреНрд░рд╛рдлрд╡рд░ рдбреЙрдХрд░ рдкреНрд░рддрд┐рдорд╛ рдкреБрдиреНрд╣рд╛ рддрдпрд╛рд░ рдХрд░рд╛рд╡реА рд▓рд╛рдЧрдд рдирд╛рд╣реА test -d` рдХрдорд╛рдВрдб рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХреЗрд▓реА рдЖрд╣реЗ. рд╡реИрдХрд▓реНрдкрд┐рдХрд░рд┐рддреНрдпрд╛ рддреБрдореНрд╣реА рдбреЙрдХрд░ рдореЕрдиреНрдпреБрдЕрд▓реА рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА [matchstick](https://github.com/LimeChain/matchstick#docker-) рд░реЗрдкреЙрдЬрд┐рдЯрд░реАрдордзреАрд▓ рд╕реВрдЪрдирд╛рдВрдЪреЗ рдЕрдиреБрд╕рд░рдг рдХрд░реВ рд╢рдХрддрд╛.

тЭЧ рдЬрд░ рддреБрдореНрд╣реА рдпрд╛рдкреВрд░реНрд╡реА `рдЧреНрд░рд╛рдл рдЪрд╛рдЪрдгреА` рдХреЗрд▓реА рдЕрд╕реЗрд▓ рддрд░ рддреБрдореНрд╣рд╛рд▓рд╛ рдбреЙрдХрд░ рдмрд┐рд▓реНрдб рджрд░рдореНрдпрд╛рди рдЦрд╛рд▓реАрд▓ рддреНрд░реБрдЯреА рдпреЗрдК рд╢рдХрддреЗ:

```sh
  рдкреНрд░реЗрд╖рдХрд╛рдХрдбреВрди рддреНрд░реБрдЯреА: xattr node_modules/binary-install-raw/bin/binary рдХрд░рдгреНрдпрд╛рдд рдЕрдпрд╢рд╕реНрд╡реА-<platform>: рдкрд░рд╡рд╛рдирдЧреА рдирд╛рдХрд╛рд░рд▓реА
```

рдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдд рд░реВрдЯ рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ `.dockerignore` рддрдпрд╛рд░ рдХрд░рд╛ рдЖрдгрд┐ `node_modules/binary-install-raw/bin` рдЬреЛрдбрд╛

### рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди

рдореЕрдЪрд╕реНрдЯрд┐рдХ `matchstick.yaml` рдХреЙрдиреНрдлрд┐рдЧрд░ рдлрд╛рдЗрд▓рджреНрд╡рд╛рд░реЗ рд╕рд╛рдиреБрдХреВрд▓ рдЪрд╛рдЪрдгреНрдпрд╛, libs рдЖрдгрд┐ рдореЕрдирд┐рдлреЗрд╕реНрдЯ рдкрде рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЙрдиреНрдлрд┐рдЧрд░ рдХреЗрд▓реЗ рдЬрд╛рдК рд╢рдХрддреЗ:

```yaml
testsFolder: path/to/tests
libsFolder: path/to/libs
manifestPath: path/to/subgraph.yaml
```

### рдбреЗрдореЛ рд╕рдмрдЧреНрд░рд╛рдл

рддреБрдореНрд╣реА [рдбреЗрдореЛ рд╕рдмрдЧреНрд░рд╛рдл рд░реЗрдкреЛ](https://github.com/LimeChain/demo-subgraph) рдХреНрд▓реЛрди рдХрд░реВрди рдпрд╛ рдорд╛рд░реНрдЧрджрд░реНрд╢рдХрд╛рддреАрд▓ рдЙрджрд╛рд╣рд░рдгреЗ рд╡рд╛рдкрд░реВрди рдкрд╛рд╣реВ рд╢рдХрддрд╛ рдЖрдгрд┐ рдЦреЗрд│реВ рд╢рдХрддрд╛

### рд╡реНрд╣рд┐рдбрд┐рдУ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓

рддрд╕реЗрдЪ рддреБрдореНрд╣реА ["рддреБрдордЪреНрдпрд╛ рд╕рдмрдЧреНрд░рд╛рдлрд╕рд╛рдареА рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреНрдпрд╛ рд▓рд┐рд╣рд┐рдгреНрдпрд╛рд╕рд╛рдареА рдореЕрдЪрд╕реНрдЯрд┐рдХ рдХрд╕реЗ рд╡рд╛рдкрд░рд╛рд╡реЗ"](https://www.youtube.com/playlist?list=PLTqyKgxaGF3SNakGQwczpSGVjS_xvOv3h) рд╡рд░ рд╡реНрд╣рд┐рдбрд┐рдУ рдорд╛рд▓рд┐рдХрд╛ рдкрд╛рд╣реВ рд╢рдХрддрд╛

## рдЪрд╛рдЪрдгреА рд╕рдВрд░рдЪрдирд╛ (>=0.5.0)

_**рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ: >=0.5.0 рдореНрд╣рдгреВрди рдореЕрдЪрд╕реНрдЯрд┐рдХ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ**_

### рд╡рд░реНрдгрди рдХрд░рдгреЗ()

`describe(name: String , () => {})` - Defines a test group.

**_рдиреЛрдЯреНрд╕:_**

- _рд╡рд░реНрдгрдиреЗ рдЕрдирд┐рд╡рд╛рд░реНрдп рдирд╛рд╣реАрдд. рддреБрдореНрд╣реА describe() рдмреНрд▓реЙрдХреНрд╕рдЪреНрдпрд╛ рдмрд╛рд╣реЗрд░ test() рдЬреБрдиреНрдпрд╛ рдкрджреНрдзрддреАрдиреЗ рдЕрдЬреВрдирд╣реА рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛_

рдЙрджрд╛рд╣рд░рдг:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Gravatar entity", () => {
    ...
  })
})
```

рдиреЗрд╕реНрдЯреЗрдб `describe()` рдЙрджрд╛рд╣рд░рдг:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar } from "../../src/gravity"

describe("handleUpdatedGravatar()", () => {
  describe("When entity exists", () => {
    test("updates the entity", () => {
      ...
    })
  })

  describe("When entity does not exists", () => {
    test("it creates a new entity", () => {
      ...
    })
  })
})
```

---

### рдЪрд╛рдЪрдгреА()

`test(name: String, () =>, should_fail: bool)` - Defines a test case. You can use test() inside of describe() blocks or independently.

рдЙрджрд╛рд╣рд░рдг:

```typescript
import { describe, test } from "matchstick-as/assembly/index"
import { handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar()", () => {
  test("Should create a new Entity", () => {
    ...
  })
})
```

рдХрд┐рдВрд╡рд╛

```typescript
test("handleNewGravatar() should create a new entity", () => {
  ...
})


```

---

### рдЖрдзреА рд╕рд░реНрд╡()

рдлрд╛рдЗрд▓рдордзреАрд▓ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЪрд╛рдЪрдгреНрдпрд╛рдВрдкреВрд░реНрд╡реА рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд╛рд▓рд╡рддреЗ. `describe` рдмреНрд▓реЙрдХрдЪреНрдпрд╛ рдЖрдд `before All` рдШреЛрд╖рд┐рдд рдХреЗрд▓реЗ рдЕрд╕рд▓реНрдпрд╛рд╕, рддреЗ рддреНрдпрд╛ `describe` рдмреНрд▓реЙрдХрдЪреНрдпрд╛ рд╕реБрд░реБрд╡рд╛рддреАрд▓рд╛ рдЪрд╛рд▓рддреЗ.

рдЙрджрд╛рд╣рд░рдгреЗ:

`рдЖрдзреА рд╕рд░реНрд╡` рдордзреНрдпреЗ рдХреЛрдб рдлрд╛рдЗрд▓рдордзреАрд▓ _рд╕рд░реНрд╡_ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдкреВрд░реНрд╡реА рдПрдХрджрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓.

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

beforeAll(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = тАЬFirst GravatarтАЭ
  gravatar.save()
  ...
})

describe("When the entity does not exist", () => {
  test("it should create a new Gravatar with id 0x1", () => {
    ...
  })
})

describe("When entity already exists", () => {
  test("it should update the Gravatar with id 0x0", () => {
    ...
  })
})
```

`foreAll` рдордзреАрд▓ рдХреЛрдб рдкрд╣рд┐рд▓реНрдпрд╛ рд╡рд░реНрдгрди рдмреНрд▓реЙрдХрдордзреАрд▓ рд╕рд░реНрд╡ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдкреВрд░реНрд╡реА рдПрдХрджрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓

```typescript
import { describe, test, beforeAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { Gravatar } from "../../generated/schema"

describe("handleUpdatedGravatar()", () => {
  beforeAll(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = тАЬFirst GravatarтАЭ
    gravatar.save()
    ...
  })

  test("updates Gravatar with id 0x0", () => {
    ...
  })

  test("creates new Gravatar with id 0x1", () => {
    ...
  })
})
```

---

### рд╢реЗрд╡рдЯреА()

рдлрд╛рдЗрд▓рдордзреАрд▓ рд╕рд░реНрд╡ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдирдВрддрд░ рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд╛рд▓рд╡рддреЗ. `рд╡рд░реНрдгрди` рдмреНрд▓реЙрдХрдЪреНрдпрд╛ рдЖрдд `рдЖрдлреНрдЯрд░рдСрд▓` рдШреЛрд╖рд┐рдд рдХреЗрд▓реЗ рдЕрд╕рд▓реНрдпрд╛рд╕, рддреЗ рддреНрдпрд╛ `рд╡рд░реНрдгрди` рдмреНрд▓реЙрдХрдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА рдЪрд╛рд▓рддреЗ.

рдЙрджрд╛рд╣рд░рдг:

`рдЖрдлреНрдЯрд░рдСрд▓` рдордзреНрдпреЗ рдХреЛрдб рдлрд╛рдЗрд▓рдордзреАрд▓ _рд╕рд░реНрд╡_ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдирдВрддрд░ рдПрдХрджрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓.

```typescript
import { describe, test, afterAll } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"
import { store } from "@graphprotocol/graph-ts"

afterAll(() => {
  store.remove("Gravatar", "0x0")
  ...
})

describe("handleNewGravatar, () => {
  test("creates Gravatar with id 0x0", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

`afterAll` рдордзреАрд▓ рдХреЛрдб рдкрд╣рд┐рд▓реНрдпрд╛ рд╡рд░реНрдгрди рдмреНрд▓реЙрдХрдордзреАрд▓ рд╕рд░реНрд╡ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдирдВрддрд░ рдПрдХрджрд╛рдЪ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓

```typescript
import { describe, test, afterAll, clearStore } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
    afterAll(() => {
    store.remove("Gravatar", "0x1")
    ...
    })

  test("It creates a new entity with Id 0x0", () => {
    ...
  })

  test("It creates a new entity with Id 0x1", () => {
    ...
  })
})

describe("handleUpdatedGravatar", () => {
  test("updates Gravatar with id 0x0", () => {
    ...
  })
})
```

---

### рдкреНрд░рддреНрдпреЗрдХрд╛рдЪреНрдпрд╛ рдЖрдзреА()

рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдкреВрд░реНрд╡реА рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд╛рд▓рд╡рддреЗ. `describe` рдмреНрд▓реЙрдХрдЪреНрдпрд╛ рдЖрдд `beforeEach` рдШреЛрд╖рд┐рдд рдХреЗрд▓реЗ рдЕрд╕рд▓реНрдпрд╛рд╕, рддреЗ рддреНрдпрд╛ `describe` рдмреНрд▓реЙрдХрдордзреАрд▓ рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдкреВрд░реНрд╡реА рдЪрд╛рд▓рддреЗ.

рдЙрджрд╛рд╣рд░рдгреЗ: рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдкреВрд░реНрд╡реА `beforeEach` рдордзреАрд▓ рдХреЛрдб рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓.

```typescript
import { describe, test, beforeEach, clearStore } from "matchstick-as/assembly/index"
import { handleNewGravatars } from "./utils"

beforeEach(() => {
  clearStore() // <-- clear the store before each test in the file
})

describe("handleNewGravatars, () => {
  test("A test that requires a clean store", () => {
    ...
  })

  test("Second that requires a clean store", () => {
    ...
  })
})

 ...
```

`beforeEach` рдордзреАрд▓ рдХреЛрдб рд╡рд░реНрдгрди рдХреЗрд▓реЗрд▓реНрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдкреВрд░реНрд╡реАрдЪ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓

```typescript
import { describe, test, beforeEach } from 'matchstick-as/assembly/index'
import { handleUpdatedGravatar, handleNewGravatar } from '../../src/gravity'

describe('handleUpdatedGravatars', () => {
  beforeEach(() => {
    let gravatar = new Gravatar('0x0')
    gravatar.displayName = 'First Gravatar'
    gravatar.imageUrl = ''
    gravatar.save()
  })

  test('Upates the displayName', () => {
    assert.fieldEquals('Gravatar', '0x0', 'displayName', 'First Gravatar')

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals('Gravatar', '0x0', 'displayName', '1st Gravatar')
    store.remove('Gravatar', '0x0')
  })

  test('Updates the imageUrl', () => {
    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', '')

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals('Gravatar', '0x0', 'imageUrl', 'https://www.gravatar.com/avatar/0x0')
    store.remove('Gravatar', '0x0')
  })
})
```

---

### рдкреНрд░рддреНрдпреЗрдХ рдирдВрддрд░()

рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдирдВрддрд░ рдХреЛрдб рдмреНрд▓реЙрдХ рдЪрд╛рд▓рд╡рддреЗ. `describe` рдмреНрд▓реЙрдХрдордзреНрдпреЗ `afterEach` рдШреЛрд╖рд┐рдд рдХреЗрд▓реЗ рдЕрд╕рд▓реНрдпрд╛рд╕, рддреЗ рддреНрдпрд╛ `describe` рдмреНрд▓реЙрдХрдордзреАрд▓ рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдирдВрддрд░ рдЪрд╛рд▓рддреЗ.

рдЙрджрд╛рд╣рд░рдгреЗ:

рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдирдВрддрд░ `afterEach` рдордзреАрд▓ рдХреЛрдб рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓.

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

beforeEach(() => {
  let gravatar = new Gravatar("0x0")
  gravatar.displayName = тАЬFirst GravatarтАЭ
  gravatar.save()
})

afterEach(() => {
  store.remove("Gravatar", "0x0")
})

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

`afterEach` рдордзреАрд▓ рдХреЛрдб рддреНрдпрд╛ рд╡рд░реНрдгрдирд╛рддреАрд▓ рдкреНрд░рддреНрдпреЗрдХ рдЪрд╛рдЪрдгреАрдирдВрддрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рд╣реЛрдИрд▓

```typescript
import { describe, test, beforeEach, afterEach } from "matchstick-as/assembly/index"
import { handleUpdatedGravatar, handleNewGravatar } from "../../src/gravity"

describe("handleNewGravatar", () => {
  ...
})

describe("handleUpdatedGravatar", () => {
  beforeEach(() => {
    let gravatar = new Gravatar("0x0")
    gravatar.displayName = "First Gravatar"
    gravatar.imageUrl = ""
    gravatar.save()
  })

  afterEach(() => {
    store.remove("Gravatar", "0x0")
  })

  test("Upates the displayName", () => {
     assert.fieldEquals("Gravatar", "0x0", "displayName", "First Gravatar")

    // code that should update the displayName to 1st Gravatar

    assert.fieldEquals("Gravatar", "0x0", "displayName", "1st Gravatar")
  })

  test("Updates the imageUrl", () => {
    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "")

    // code that should changes the imageUrl to https://www.gravatar.com/avatar/0x0

    assert.fieldEquals("Gravatar", "0x0", "imageUrl", "https://www.gravatar.com/avatar/0x0")
  })
})
```

## рдард╛рдордкрдгреЗ рд╕рд╛рдВрдЧрддрд╛рдд

```typescript
fieldEquals(entityType: string, id: string, fieldName: string, expectedVal: string)

equals(expected: ethereum.Value, actual: ethereum.Value)

notInStore(entityType: string, id: string)

addressEquals(address1: Address, address2: Address)

bytesEquals(bytes1: Bytes, bytes2: Bytes)

i32Equals(number1: i32, number2: i32)

bigIntEquals(bigInt1: BigInt, bigInt2: BigInt)

booleanEquals(bool1: boolean, bool2: boolean)

stringEquals(string1: string, string2: string)

arrayEquals(array1: Array<ethereum.Value>, array2: Array<ethereum.Value>)

tupleEquals(tuple1: ethereum.Tuple, tuple2: ethereum.Tuple)

assertTrue(value: boolean)

assertNull<T>(value: T)

assertNotNull<T>(value: T)

entityCount(entityType: string, expectedCount: i32)
```

## рдПрдХ рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреА рд▓рд┐рд╣рд╛

[рдбреЗрдореЛ рд╕рдмрдЧреНрд░рд╛рдл](https://github.com/LimeChain/demo-subgraph/blob/main/src/gravity.ts) рдордзреАрд▓ Gravatar рдЙрджрд╛рд╣рд░рдгреЗ рд╡рд╛рдкрд░реВрди рдПрдХ рд╕рд╛рдзреА рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреА рдХрд╢реА рджрд┐рд╕рддреЗ рддреЗ рдкрд╛рд╣реВ.

рдЕрд╕реЗ рдЧреГрд╣реАрдд рдзрд░реВрди рдХреА рдЖрдордЪреНрдпрд╛рдХрдбреЗ рдЦрд╛рд▓реАрд▓ рд╣рдБрдбрд▓рд░ рдлрдВрдХреНрд╢рди рдЖрд╣реЗ (рдЖрдкрд▓реЗ рдЬреАрд╡рди рд╕реЛрдкреЗ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рджреЛрди рдорджрддрдиреАрд╕ рдХрд╛рд░реНрдпрд╛рдВрд╕рд╣):

```typescript
export function handleNewGravatar(event: NewGravatar): void {
  let gravatar = new Gravatar(event.params.id.toHex())
  gravatar.owner = event.params.owner
  gravatar.displayName = event.params.displayName
  gravatar.imageUrl = event.params.imageUrl
  gravatar.save()
}

export function handleNewGravatars(events: NewGravatar[]): void {
  events.forEach((event) => {
    handleNewGravatar(event)
  })
}

export function createNewGravatarEvent(
  id: i32,
  ownerAddress: string,
  displayName: string,
  imageUrl: string,
): NewGravatar {
  let mockEvent = newMockEvent()
  let newGravatarEvent = new NewGravatar(
    mockEvent.address,
    mockEvent.logIndex,
    mockEvent.transactionLogIndex,
    mockEvent.logType,
    mockEvent.block,
    mockEvent.transaction,
    mockEvent.parameters,
  )
  newGravatarEvent.parameters = new Array()
  let idParam = new ethereum.EventParam('id', ethereum.Value.fromI32(id))
  let addressParam = new ethereum.EventParam(
    'ownderAddress',
    ethereum.Value.fromAddress(Address.fromString(ownerAddress)),
  )
  let displayNameParam = new ethereum.EventParam('displayName', ethereum.Value.fromString(displayName))
  let imageUrlParam = new ethereum.EventParam('imageUrl', ethereum.Value.fromString(imageUrl))

  newGravatarEvent.parameters.push(idParam)
  newGravatarEvent.parameters.push(addressParam)
  newGravatarEvent.parameters.push(displayNameParam)
  newGravatarEvent.parameters.push(imageUrlParam)

  return newGravatarEvent
}
```

рдЖрдореНрд╣рд╛рд▓рд╛ рдЖрдордЪреНрдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯрдордзреНрдпреЗ рдкреНрд░рдердо рдЪрд╛рдЪрдгреА рдлрд╛рдЗрд▓ рддрдпрд╛рд░ рдХрд░рд╛рд╡реА рд▓рд╛рдЧреЗрд▓. рддреЗ рдХрд╕реЗ рджрд┐рд╕реВ рд╢рдХрддреЗ рдпрд╛рдЪреЗ рд╣реЗ рдЙрджрд╛рд╣рд░рдг рдЖрд╣реЗ:

```typescript
import { clearStore, test, assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../../generated/schema'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { createNewGravatarEvent, handleNewGravatars } from '../mappings/gravity'

test('Can call mappings with custom events', () => {
  // Create a test entity and save it in the store as initial state (optional)
  let gravatar = new Gravatar('gravatarId0')
  gravatar.save()

  // Create mock events
  let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')
  let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

  // Call mapping functions passing the events we just created
  handleNewGravatars([newGravatarEvent, anotherGravatarEvent])

  // Assert the state of the store
  assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
  assert.fieldEquals('Gravatar', '12345', 'owner', '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
  assert.fieldEquals('Gravatar', '3546', 'displayName', 'cap')

  // Clear the store in order to start the next test off on a clean slate
  clearStore()
})

test('Next test', () => {
  //...
})
```

рдЕрдирдкреЕрдХ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рддреЗ рдЦреВрдк рдЖрд╣реЗ! рд╕рд░реНрд╡рдкреНрд░рдердо, рд▓рдХреНрд╖рд╛рдд рдШреЗрдгреНрдпрд╛рд╕рд╛рд░рдЦреА рдорд╣рддреНрддреНрд╡рд╛рдЪреА рдЧреЛрд╖реНрдЯ рдореНрд╣рдгрдЬреЗ рдЖрдореНрд╣реА рдЖрдордЪреНрдпрд╛ рдЕрд╕реЗрдВрдмрд▓реАрд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЗрд▓реНрдкрд░ рд▓рд╛рдпрдмреНрд░рд░реА (npm рдореЙрдбреНрдпреВрд▓ рдореНрд╣рдгреВрди рд╡рд┐рддрд░рд┐рдд) `matchstick-as` рдордзреВрди рдЧреЛрд╖реНрдЯреА рдЖрдпрд╛рдд рдХрд░рдд рдЖрд╣реЛрдд. рддреБрдореНрд╣реА [рдпреЗрдереЗ](https://github.com/LimeChain/matchstick-as) рднрд╛рдВрдбрд╛рд░ рд╢реЛрдзреВ рд╢рдХрддрд╛. `matchstick-as` рдЖрдореНрд╣рд╛рд▓рд╛ рдЙрдкрдпреБрдХреНрдд рдЪрд╛рдЪрдгреА рдкрджреНрдзрддреА рдкреНрд░рджрд╛рди рдХрд░рддреЗ рдЖрдгрд┐ `test()` рдлрдВрдХреНрд╢рди рджреЗрдЦреАрд▓ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рдЬреЗ рдЖрдореНрд╣реА рдЖрдордЪреЗ рдЪрд╛рдЪрдгреА рдмреНрд▓реЙрдХ рддрдпрд╛рд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╡рд╛рдкрд░реВ. рдмрд╛рдХреАрдЪреЗ рдЕрдЧрджреА рд╕рд░рд│ рдЖрд╣реЗ - рдХрд╛рдп рд╣реЛрддреЗ рддреЗ рдпреЗрдереЗ рдЖрд╣реЗ:

- рдЖрдореНрд╣реА рдЖрдордЪреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕реНрдерд┐рддреА рд╕реЗрдЯ рдХрд░рдд рдЖрд╣реЛрдд рдЖрдгрд┐ рдПрдХ рдХрд╕реНрдЯрдо Gravatar рдЕрд╕реНрддрд┐рддреНрд╡ рдЬреЛрдбрдд рдЖрд╣реЛрдд;
- рдЖрдореНрд╣реА `createNewGravatarEvent()` рдлрдВрдХреНрд╢рди рд╡рд╛рдкрд░реВрди рджреЛрди `NewGravatar` рдЗрд╡реНрд╣реЗрдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рддреНрдпрд╛рдВрдЪреНрдпрд╛ рдбреЗрдЯрд╛рд╕рд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЛ;
- рдЖрдореНрд╣реА рддреНрдпрд╛ рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╛рдареА рд╣рдБрдбрд▓рд░ рдкрджреНрдзрддреА рдХреЙрд▓ рдХрд░рдд рдЖрд╣реЛрдд - `handleNewGravatars()` рдЖрдгрд┐ рдЖрдордЪреНрдпрд╛ рд╕рд╛рдиреБрдХреВрд▓ рдЗрд╡реНрд╣реЗрдВрдЯрдЪреНрдпрд╛ рд╕реВрдЪреАрдордзреНрдпреЗ рдкрд╛рд╕ рдХрд░рдд рдЖрд╣реЛрдд;
- рдЖрдореНрд╣реА рд╕реНрдЯреЛрдЕрд░рдЪреНрдпрд╛ рд╕реНрдерд┐рддреАрд╡рд░ рдард╛рдо рдЖрд╣реЛрдд. рддреЗ рдХрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ? - рдЖрдореНрд╣реА рдЕрд╕реНрддрд┐рддреНрд╡ рдкреНрд░рдХрд╛рд░ рдЖрдгрд┐ рдЖрдпрдбреАрдЪреЗ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рд╕рдВрдпреЛрдЬрди рдкрд╛рд╕ рдХрд░рдд рдЖрд╣реЛрдд. рдордЧ рдЖрдореНрд╣реА рддреНрдпрд╛ рдШрдЯрдХрд╛рд╡рд░реАрд▓ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлреАрд▓реНрдб рддрдкрд╛рд╕рддреЛ рдЖрдгрд┐ рдЕрд╕реЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд░рддреЛ рдХреА рддрд┐рдЪреНрдпрд╛рдХрдбреЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдореВрд▓реНрдп рдЖрд╣реЗ. рдЖрдореНрд╣реА рд╕реНрдЯреЛрдЕрд░рдордзреНрдпреЗ рдЬреЛрдбрд▓реЗрд▓реНрдпрд╛ рд╕реБрд░реБрд╡рд╛рддреАрдЪреНрдпрд╛ Gravatar рдПрдВрдЯрд┐рдЯреАрд╕рд╛рдареА рддрд╕реЗрдЪ рд╣рдБрдбрд▓рд░ рдлрдВрдХреНрд╢рди рдХреЙрд▓ рдХреЗрд▓реНрдпрд╛рд╡рд░ рдЬреЛрдбрд▓реНрдпрд╛ рдЬрд╛рдгрд╛рд░реНтАНрдпрд╛ рджреЛрди Gravatar рдШрдЯрдХрд╛рдВрд╕рд╛рдареА рдЖрдореНрд╣реА рд╣реЗ рдХрд░рдд рдЖрд╣реЛрдд;
- рдЖрдгрд┐ рд╢реЗрд╡рдЯреА - рдЖрдореНрд╣реА `clearStore()` рд╡рд╛рдкрд░реВрди рд╕реНрдЯреЛрдЕрд░ рд╕рд╛рдл рдХрд░рдд рдЖрд╣реЛрдд рдЬреЗрдгреЗрдХрд░реВрди рдЖрдордЪреА рдкреБрдвреАрд▓ рдЪрд╛рдЪрдгреА рдирд╡реАрди рдЖрдгрд┐ рд░рд┐рдХрд╛рдореНрдпрд╛ рд╕реНрдЯреЛрдЕрд░ рдСрдмреНрдЬреЗрдХреНрдЯрд╕рд╣ рд╕реБрд░реВ рд╣реЛрдИрд▓. рдЖрдореНрд╣рд╛рд▓рд╛ рдкрд╛рд╣рд┐рдЬреЗ рддрд┐рддрдХреЗ рдЪрд╛рдЪрдгреА рдмреНрд▓реЙрдХреНрд╕ рдЖрдореНрд╣реА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реВ рд╢рдХрддреЛ.

рдЖрдореНрд╣реА рддрд┐рдереЗ рдЬрд╛рддреЛ - рдЖрдореНрд╣реА рдЖрдордЪреА рдкрд╣рд┐рд▓реА рдЪрд╛рдЪрдгреА рддрдпрд╛рд░ рдХреЗрд▓реА рдЖрд╣реЗ! ЁЯСП

рдЖрддрд╛ рдЖрдордЪреНрдпрд╛ рдЪрд╛рдЪрдгреНрдпрд╛ рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА рддреБрдореНрд╣рд╛рд▓рд╛ рддреБрдордЪреНрдпрд╛ рд╕рдмрдЧреНрд░рд╛рдл рд░реВрдЯ рдлреЛрд▓реНрдбрд░рдордзреНрдпреЗ рдЦрд╛рд▓реАрд▓ рдЧреЛрд╖реНрдЯреА рдЪрд╛рд▓рд╡рд╛рд╡реНрдпрд╛ рд▓рд╛рдЧрддреАрд▓:

`рдЖрд▓реЗрдЦ рдЪрд╛рдЪрдгреА рдЧреБрд░реБрддреНрд╡рд╛рдХрд░реНрд╖рдг`

рдЖрдгрд┐ рдЬрд░ рд╕рд░реНрд╡ рдХрд╛рд╣реА рдареАрдХ рдЭрд╛рд▓реЗ рддрд░ рддреБрдореНрд╣рд╛рд▓рд╛ рдкреБрдвреАрд▓ рдЧреЛрд╖реНрдЯреАрдВрд╕рд╣ рд╕реНрд╡рд╛рдЧрдд рдХреЗрд▓реЗ рдкрд╛рд╣рд┐рдЬреЗ:

![тАЬрд╕рд░реНрд╡ рдЪрд╛рдЪрдгреНрдпрд╛ рдкрд╛рд╕ рдЭрд╛рд▓реНрдпрд╛!тАЭ рдореНрд╣рдгрдгрд╛рд░реА рдореЕрдЪрд╕реНрдЯрд┐рдХ](/img/matchstick-tests-passed.png)

## рд╕рд╛рдорд╛рдиреНрдп рдЪрд╛рдЪрдгреА рдкрд░рд┐рд╕реНрдерд┐рддреА

### рдПрдХрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдерд┐рддреАрд╕рд╣ рд╕реНрдЯреЛрдЕрд░ рд╣рд╛рдпрдбреНрд░реЗрдЯрд┐рдВрдЧ

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЬреНрдЮрд╛рдд рдШрдЯрдХрд╛рдВрдЪреНрдпрд╛ рд╕рдВрдЪрд╛рд╕рд╣ рд╕реНрдЯреЛрдЕрд░ рд╣рд╛рдпрдбреНрд░реЗрдЯ рдХрд░рдгреНрдпрд╛рд╕ рд╕рдХреНрд╖рдо рдЖрд╣реЗрдд. Gravatar рдШрдЯрдХрд╛рд╕рд╣ рд╕реНрдЯреЛрдЕрд░ рд╕реБрд░реВ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдпреЗрдереЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЖрд╣реЗ:

```typescript
let gravatar = new Gravatar('entryId')
gravatar.save()
```

### рдЗрд╡реНрд╣реЗрдВрдЯрд╕рд╣ рдореЕрдкрд┐рдВрдЧ рдлрдВрдХреНрд╢рди рдХреЙрд▓ рдХрд░рдгреЗ

рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рд╕рд╛рдиреБрдХреВрд▓ рдЗрд╡реНрд╣реЗрдВрдЯ рддрдпрд╛рд░ рдХрд░реВ рд╢рдХрддреЛ рдЖрдгрд┐ рд╕реНрдЯреЛрдЕрд░рд▓рд╛ рдмрд╛рдВрдзреАрд▓ рдЕрд╕рд▓реЗрд▓реНрдпрд╛ рдореЕрдкрд┐рдВрдЧ рдлрдВрдХреНрд╢рдирдордзреНрдпреЗ рдкрд╛рд╕ рдХрд░реВ рд╢рдХрддреЛ:

```typescript
import { store } from 'matchstick-as/assembly/store'
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatar(newGravatarEvent)
```

### рдЗрд╡реНрд╣реЗрдВрдЯ рдлрд┐рдХреНрд╕реНрдЪрд░рд╕рд╣ рд╕рд░реНрд╡ рдореЕрдкрд┐рдВрдЧ рдХреЙрд▓ рдХрд░рдгреЗ

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЪрд╛рдЪрдгреА рдлрд┐рдХреНрд╕реНрдЪрд░рд╕рд╣ рдореЕрдкрд┐рдВрдЧ рдХреЙрд▓ рдХрд░реВ рд╢рдХрддрд╛рдд.

```typescript
import { NewGravatar } from '../../generated/Gravity/Gravity'
import { store } from 'matchstick-as/assembly/store'
import { handleNewGravatars, createNewGravatarEvent } from './mapping'

let newGravatarEvent = createNewGravatarEvent(12345, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

let anotherGravatarEvent = createNewGravatarEvent(3546, '0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7', 'cap', 'pac')

handleNewGravatars([newGravatarEvent, anotherGravatarEvent])
```

```
export function handleNewGravatars(events: NewGravatar[]): void {
    events.forEach(event => {
        handleNewGravatar(event);
    });
}
```

### рдорд╕реНрдХрд░реА рдХреЙрдиреНрдЯреНрд░реЕрдХреНрдЯ рдХреЙрд▓

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдХреЙрдиреНрдЯреНрд░реЕрдХреНрдЯ рдХреЙрд▓рдЪреА рдердЯреНрдЯрд╛ рдХрд░реВ рд╢рдХрддрд╛рдд:

```typescript
import { addMetadata, assert, createMockedFunction, clearStore, test } from 'matchstick-as/assembly/index'
import { Gravity } from '../../generated/Gravity/Gravity'
import { Address, BigInt, ethereum } from '@graphprotocol/graph-ts'

let contractAddress = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
let expectedResult = Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947')
let bigIntParam = BigInt.fromString('1234')
createMockedFunction(contractAddress, 'gravatarToOwner', 'gravatarToOwner(uint256):(address)')
  .withArgs([ethereum.Value.fromSignedBigInt(bigIntParam)])
  .returns([ethereum.Value.fromAddress(Address.fromString('0x90cBa2Bbb19ecc291A12066Fd8329D65FA1f1947'))])

let gravity = Gravity.bind(contractAddress)
let result = gravity.gravatarToOwner(bigIntParam)

assert.equals(ethereum.Value.fromAddress(expectedResult), ethereum.Value.fromAddress(result))
```

рджрд╛рдЦрд╡рд▓реНрдпрд╛рдкреНрд░рдорд╛рдгреЗ, рдХреЙрдиреНрдЯреНрд░реЕрдХреНрдЯ рдХреЙрд▓рдЪреА рдердЯреНрдЯрд╛ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЖрдгрд┐ рд░рд┐рдЯрд░реНрди рд╡реНрд╣реЕрд▓реНрдпреВ рд╣рд╛рд░реНрдбрдХреЛрд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА, рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдиреЗ рдХреЙрдиреНрдЯреНрд░реЕрдХреНрдЯ рдЕреЕрдбреНрд░реЗрд╕, рдлрдВрдХреНрд╢рдирдЪреЗ рдирд╛рд╡, рдлрдВрдХреНрд╢рди рд╕рд┐рдЧреНрдиреЗрдЪрд░, рд╡рд┐рддрд░реНрдХрд╛рдВрдЪреА рдЕреЕрд░реЗ рдЖрдгрд┐ рдЕрд░реНрдерд╛рддрдЪ - рд░рд┐рдЯрд░реНрди рд╡реНрд╣реЕрд▓реНрдпреВ рдкреНрд░рджрд╛рди рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ.

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдлрдВрдХреНрд╢рди рд░рд┐рд╡реНрд╣рд░реНрдЯреНрд╕рдЪреА рдердЯреНрдЯрд╛ рджреЗрдЦреАрд▓ рдХрд░реВ рд╢рдХрддрд╛рдд:

```typescript
рджреНрдпрд╛ рдХреЙрдиреНрдЯреНрд░реЕрдХреНрдЯ рдЕреЕрдбреНрд░реЗрд╕ = Address.fromString('0x89205A3A3b2A69De6Dbf7f01ED13B2108B2c43e7')
createMockedFunction(contractAddress, 'getGravatar', 'getGravatar(address):(string,string)')
   .withArgs([ethereum.Value.fromAddress(contractAddress)])
   .рдкрд░рдд рдХрд░рддреЗ()
```

### IPFS рдлрд╛рдЗрд▓реНрд╕рдЪреА рдердЯреНрдЯрд╛ рдЙрдбрд╡рдгрд╛рд░реА (рдорд╛рдЪрд╕реНрдЯрд┐рдХ реж. рек. рез рд╡рд░реВрди)

рд╡рд╛рдкрд░рдХрд░реНрддреЗ `mockIpfsFile(hash, filePath)` рдлрдВрдХреНрд╢рди рд╡рд╛рдкрд░реВрди IPFS рдлрд╛рдЗрд▓реНрд╕рдЪреА рдердЯреНрдЯрд╛ рдХрд░реВ рд╢рдХрддрд╛рдд. рдлрдВрдХреНрд╢рди рджреЛрди рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯреНрд╕ рд╕реНрд╡реАрдХрд╛рд░рддреЗ, рдкрд╣рд┐рд▓рд╛ рдЖрдпрдкреАрдПрдлрдПрд╕ рдлрд╛рдЗрд▓ рд╣реЕрд╢/рдкрде рдЖрдгрд┐ рджреБрд╕рд░рд╛ рд╕реНрдерд╛рдирд┐рдХ рдлрд╛рдЗрд▓рдЪрд╛ рдорд╛рд░реНрдЧ рдЖрд╣реЗ.

рдЯреАрдк: `ipfs.map/ipfs.mapJSON` рдЪреА рдЪрд╛рдЪрдгреА рдХрд░рддрд╛рдирд╛, рдореЕрдЪрд╕реНрдЯреЕрдХрдиреЗ `processGravatar()` рдлрдВрдХреНрд╢рди рд╕рд╛рд░рдЦреЗ рд╢реЛрдзрдгреНрдпрд╛рд╕рд╛рдареА рдЪрд╛рдЪрдгреА рдлрд╛рдЗрд▓рдордзреВрди рдХреЙрд▓рдмреЕрдХ рдлрдВрдХреНрд╢рди рдПрдХреНрд╕рдкреЛрд░реНрдЯ рдХреЗрд▓реЗ рдкрд╛рд╣рд┐рдЬреЗ. рдЦрд╛рд▓реАрд▓ рдЪрд╛рдЪрдгреА рдЙрджрд╛рд╣рд░рдгрд╛рдордзреНрдпреЗ:

`.test.ts` рдлрд╛рдЗрд▓:

```typescript
import { assert, test, mockIpfsFile } from 'matchstick-as/assembly/index'
import { ipfs } from '@graphprotocol/graph-ts'
import { gravatarFromIpfs } from './utils'

// Export ipfs.map() callback in order for matchstck to detect it
export { processGravatar } from './utils'

test('ipfs.cat', () => {
  mockIpfsFile('ipfsCatfileHash', 'tests/ipfs/cat.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  gravatarFromIpfs()

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 1)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'imageUrl', 'https://i.ytimg.com/vi/MELP46s8Cic/maxresdefault.jpg')

  clearStore()
})

test('ipfs.map', () => {
  mockIpfsFile('ipfsMapfileHash', 'tests/ipfs/map.json')

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 0)

  ipfs.map('ipfsMapfileHash', 'processGravatar', Value.fromString('Gravatar'), ['json'])

  assert.entityCount(GRAVATAR_ENTITY_TYPE, 3)
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '1', 'displayName', 'Gravatar1')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '2', 'displayName', 'Gravatar2')
  assert.fieldEquals(GRAVATAR_ENTITY_TYPE, '3', 'displayName', 'Gravatar3')
})
```

`utils.ts` рдлрд╛рдЗрд▓:

```typescript
import { Address, ethereum, JSONValue, Value, ipfs, json, Bytes } from "@graphprotocol/graph-ts"
import { Gravatar } from "../../generated/schema"

...

// ipfs.map callback
export function processGravatar(value: JSONValue, userData: Value): void {
  // See the JSONValue documentation for details on dealing
  // with JSON values
  let obj = value.toObject()
  let id = obj.get('id')

  if (!id) {
    return
  }

  // Callbacks can also created entities
  let gravatar = new Gravatar(id.toString())
  gravatar.displayName = userData.toString() + id.toString()
  gravatar.save()
}

// function that calls ipfs.cat
export function gravatarFromIpfs(): void {
  let rawData = ipfs.cat("ipfsCatfileHash")

  if (!rawData) {
    return
  }

  let jsonData = json.fromBytes(rawData as Bytes).toObject()

  let id = jsonData.get('id')
  let url = jsonData.get("imageUrl")

  if (!id || !url) {
    return
  }

  let gravatar = new Gravatar(id.toString())
  gravatar.imageUrl = url.toString()
  gravatar.save()
}
```

### рд╕реНрдЯреЛрдЕрд░рдЪреА рд╕реНрдерд┐рддреА рд╕рд╛рдВрдЧреВрди

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рджрд╛рд╡рд╛ рдХрд░рдгрд╛рд░реНтАНрдпрд╛ рд╕рдВрд╕реНрдерд╛рдВрджреНрд╡рд╛рд░реЗ рд╕реНрдЯреЛрдЕрд░рдЪреА рдЕрдВрддрд┐рдо (рдХрд┐рдВрд╡рд╛ рдорд┐рдбрд╡реЗ) рд╕реНрдерд┐рддреА рд╕рд╛рдВрдЧреВ рд╢рдХрддрд╛рдд. рд╣реЗ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА, рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд▓рд╛ рдПрдВрдЯрд┐рдЯреА рдкреНрд░рдХрд╛рд░, рдПрдВрдЯрд┐рдЯреАрдЪрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдпрдбреА, рддреНрдпрд╛ рдШрдЯрдХрд╛рд╡рд░реАрд▓ рдлреАрд▓реНрдбрдЪреЗ рдирд╛рд╡ рдЖрдгрд┐ рдлреАрд▓реНрдбрдЪреЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдореВрд▓реНрдп рдкреБрд░рд╡рд╛рд╡реЗ рд▓рд╛рдЧреЗрд▓. рдпреЗрдереЗ рдПрдХ рджреНрд░реБрдд рдЙрджрд╛рд╣рд░рдг рдЖрд╣реЗ:

```typescript
import { assert } from 'matchstick-as/assembly/index'
import { Gravatar } from '../generated/schema'

let gravatar = new Gravatar('gravatarId0')
gravatar.save()

assert.fieldEquals('Gravatar', 'gravatarId0', 'id', 'gravatarId0')
```

Assert.fieldEquals() рдлрдВрдХреНрд╢рди рдЪрд╛рд▓рд╡рд▓реНрдпрд╛рдиреЗ рджрд┐рд▓реЗрд▓реНрдпрд╛ рдлреАрд▓реНрдбрдЪреА рджрд┐рд▓реЗрд▓реНрдпрд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдореВрд▓реНрдпрд╛рд╡рд┐рд░реБрджреНрдз рд╕рдорд╛рдирддрд╛ рддрдкрд╛рд╕рд▓реА рдЬрд╛рдИрд▓. рдЪрд╛рдЪрдгреА рдЕрдпрд╢рд╕реНрд╡реА рд╣реЛрдИрд▓ рдЖрдгрд┐ рдореВрд▓реНрдпреЗ **рдирд╛рд╣реА** рд╕рдорд╛рди рдЕрд╕рд▓реНрдпрд╛рд╕ рдПрдХ рддреНрд░реБрдЯреА рд╕рдВрджреЗрд╢ рдЖрдЙрдЯрдкреБрдЯ рдХреЗрд▓рд╛ рдЬрд╛рдИрд▓. рдЕрдиреНрдпрдерд╛ рдЪрд╛рдЪрдгреА рдпрд╢рд╕реНрд╡реАрд░рд┐рддреНрдпрд╛ рдЙрддреНрддреАрд░реНрдг рд╣реЛрдИрд▓.

### рдЗрд╡реНрд╣реЗрдВрдЯ рдореЗрдЯрд╛рдбреЗрдЯрд╛рд╕рд╣ рд╕рдВрд╡рд╛рдж рд╕рд╛рдзрдд рдЖрд╣реЗ

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдбреАрдлреЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╡рд╛рдкрд░реВ рд╢рдХрддрд╛рдд, рдЬреЛ рдЗрдерд░рд┐рдпрдо рдореНрд╣рдгреВрди рдкрд░рдд рдХреЗрд▓рд╛ рдЬрд╛рдК рд╢рдХрддреЛ. `newMockEvent()` рдлрдВрдХреНрд╢рди рд╡рд╛рдкрд░реВрди рдЗрд╡реНрд╣реЗрдВрдЯ. рдЦрд╛рд▓реАрд▓ рдЙрджрд╛рд╣рд░рдг рдЗрд╡реНрд╣реЗрдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯрд╡рд░реАрд▓ рддреНрдпрд╛ рдлреАрд▓реНрдбрд╡рд░ рддреБрдореНрд╣реА рдХрд╕реЗ рд╡рд╛рдЪреВ/рд▓рд┐рд╣реВ рд╢рдХрддрд╛ рд╣реЗ рджрд╛рдЦрд╡рддреЗ:

```typescript
// Read
let logType = newGravatarEvent.logType

// Write
let UPDATED_ADDRESS = '0xB16081F360e3847006dB660bae1c6d1b2e17eC2A'
newGravatarEvent.address = Address.fromString(UPDATED_ADDRESS)
```

### рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓ рд╕рдорд╛рдирддреЗрдЪреЗ рдкреНрд░рддрд┐рдкрд╛рджрди

```typescript
assert.equals(ethereum.Value.fromString("hello"); ethereum.Value.fromString("hello"));
```

### рдПрдЦрд╛рджреА рд╕рдВрд╕реНрдерд╛ рд╕реНрдЯреЛрдЕрд░рдордзреНрдпреЗ **рдирд╛рд╣реА** рдЕрд╕рд▓реНрдпрд╛рдЪреЗ рдард╛рд╕реВрди рд╕рд╛рдВрдЧрдгреЗ

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЕрд╕реЗ рдард╛рдордкрдгреЗ рд╕рд╛рдВрдЧреВ рд╢рдХрддрд╛рдд рдХреА рд╕реНрдЯреЛрдЕрд░рдордзреНрдпреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдирд╛рд╣реА. рдлрдВрдХреНрд╢рди рдПрдХ рдЕрд╕реНрддрд┐рддреНрд╡ рдкреНрд░рдХрд╛рд░ рдЖрдгрд┐ рдЖрдпрдбреА рдШреЗрддреЗ. рд╡рд╕реНрддреБрд╕реНрдерд┐рддреА рд╕реНрдЯреЛрдЕрд░рдордзреНрдпреЗ рдЕрд╕рд▓реНрдпрд╛рд╕, рдЪрд╛рдЪрдгреА рд╕рдВрдмрдВрдзрд┐рдд рддреНрд░реБрдЯреА рд╕рдВрджреЗрд╢рд╛рд╕рд╣ рдЕрдпрд╢рд╕реНрд╡реА рд╣реЛрдИрд▓. рд╣реА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╢реА рд╡рд╛рдкрд░рд╛рдпрдЪреА рдпрд╛рдЪреЗ рдПрдХ рджреНрд░реБрдд рдЙрджрд╛рд╣рд░рдг рдпреЗрдереЗ рдЖрд╣реЗ:

```typescript
assert.notInStore('Gravatar', '23')
```

### рд╕рдВрдкреВрд░реНрдг рд╕реНрдЯреЛрдЕрд░ рдореБрджреНрд░рд┐рдд рдХрд░рдгреЗ (рдбреАрдмрдЧ рд╣реЗрддреВрдВрд╕рд╛рдареА)

рд╣реЗ рд╣реЗрд▓реНрдкрд░ рдлрдВрдХреНрд╢рди рд╡рд╛рдкрд░реВрди рддреБрдореНрд╣реА рд╕рдВрдкреВрд░реНрдг рд╕реНрдЯреЛрдЕрд░ рдХрдиреНрд╕реЛрд▓рд╡рд░ рдореБрджреНрд░рд┐рдд рдХрд░реВ рд╢рдХрддрд╛:

```typescript
import { logStore } from 'matchstick-as/assembly/store'

logStore()
```

### рдЕрдкреЗрдХреНрд╖рд┐рдд рдЕрдкрдпрд╢

рдЪрд╛рдЪрдгреА() рдлрдВрдХреНрд╢рдиреНрд╕рд╡рд░ shouldFail рдзреНрд╡рдЬ рд╡рд╛рдкрд░реВрди рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдВрдирд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдЪрд╛рдЪрдгреА рдЕрдкрдпрд╢ рдпреЗрдК рд╢рдХрддреЗ:

```typescript
test(
  'Should throw an error',
  () => {
    throw new Error()
  },
  true,
)
```

рдЬрд░ рдЪрд╛рдЪрдгреА shouldFail = true рд╕рд╣ рдЪрд┐рдиреНрд╣рд╛рдВрдХрд┐рдд рдХреЗрд▓реА рдЕрд╕реЗрд▓ рдкрд░рдВрддреБ рдЕрдпрд╢рд╕реНрд╡реА рд╣реЛрдд рдирд╕реЗрд▓, рддрд░ рддреА рд▓реЙрдЧрдордзреНрдпреЗ рддреНрд░реБрдЯреА рдореНрд╣рдгреВрди рджрд┐рд╕реВрди рдпреЗрдИрд▓ рдЖрдгрд┐ рдЪрд╛рдЪрдгреА рдмреНрд▓реЙрдХ рдЕрдпрд╢рд╕реНрд╡реА рд╣реЛрдИрд▓. рддрд╕реЗрдЪ, рдЬрд░ рд╣реЗ shouldFail = false (рдбрд┐рдлреЙрд▓реНрдЯ рд╕реНрдерд┐рддреА) рдиреЗ рдЪрд┐рдиреНрд╣рд╛рдВрдХрд┐рдд рдХреЗрд▓реЗ рдЕрд╕реЗрд▓, рддрд░ рдЪрд╛рдЪрдгреА рдирд┐рд╖реНрдкрд╛рджрдХ рдХреНрд░реЕрд╢ рд╣реЛрдИрд▓.

### рд▓реЙрдЧрд┐рдВрдЧ

рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдордзреНрдпреЗ рд╕рд╛рдиреБрдХреВрд▓ рд▓реЙрдЧ рдЕрд╕рдгреЗ рд╣реЗ рдореЕрдкрд┐рдВрдЧрдордзреНрдпреЗ рд▓реЙрдЧ рдЗрди рдХрд░рдгреНрдпрд╛рд╕рд╛рд░рдЦреЗрдЪ рдЖрд╣реЗ. рдлрд░рдХ рдЕрд╕рд╛ рдЖрд╣реЗ рдХреА рд▓реЙрдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рдЧреНрд░рд╛рдл-рдЯреАрдПрд╕ рдРрд╡рдЬреА рдореЕрдЪрд╕реНрдЯрд┐рдХ-рдПрдЬ рд╡рд░реВрди рдЖрдпрд╛рдд рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рд╕рд░реНрд╡ рдЧреИрд░-рдЧрдВрднреАрд░ рд▓реЙрдЧ рдкреНрд░рдХрд╛рд░рд╛рдВрд╕рд╣ рдпреЗрдереЗ рдПрдХ рд╕рд╛рдзреЗ рдЙрджрд╛рд╣рд░рдг рдЖрд╣реЗ:

```typescript
import { test } from "matchstick-as/assembly/index";
import { log } from "matchstick-as/assembly/log";

test("Success", () => {
    log.success("Success!". []);
});
test("Error", () => {
    log.error("Error :( ", []);
});
test("Debug", () => {
    log.debug("Debugging...", []);
});
test("Info", () => {
    log.info("Info!", []);
});
test("Warning", () => {
    log.warning("Warning!", []);
});
```

рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЧрдВрднреАрд░ рдЕрдкрдпрд╢рд╛рдЪреЗ рдЕрдиреБрдХрд░рдг рджреЗрдЦреАрд▓ рдХрд░реВ рд╢рдХрддрд╛рдд, рдЬрд╕реЗ рдХреА:

```typescript
test('Blow everything up', () => {
  log.critical('Boom!')
})
```

рдЧрдВрднреАрд░ рддреНрд░реБрдЯреА рд▓реЙрдЧ рдХреЗрд▓реНрдпрд╛рдиреЗ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдЪреА рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА рдерд╛рдВрдмреЗрд▓ рдЖрдгрд┐ рд╕рд░реНрд╡рдХрд╛рд╣реА рдЙрдбреВрди рдЬрд╛рдИрд▓. рд╢реЗрд╡рдЯреА - рдЖрдореНрд╣реА рд╣реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реВ рдЗрдЪреНрдЫрд┐рддреЛ рдХреА рддреБрдордЪреНрдпрд╛ рдХреЛрдбрдордзреНрдпреЗ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯрдордзреНрдпреЗ рдЧрдВрднреАрд░ рдиреЛрдВрджреА рдирд╛рд╣реАрдд, рдЖрдгрд┐ рддрд╕реЗ рдЭрд╛рд▓реНрдпрд╛рд╕ рддреБрдореНрд╣рд╛рд▓рд╛ рд▓рдЧреЗрдЪ рд▓рдХреНрд╖рд╛рдд рдпреЗрдИрд▓.

### рд╡реНрдпреБрддреНрдкрдиреНрди рдлреАрд▓реНрдб рдЪрд╛рдЪрдгреА

рд╡реНрдпреБрддреНрдкрдиреНрди рдлреАрд▓реНрдбрдЪреА рдЪрд╛рдЪрдгреА рдХрд░рдгреЗ рд╣реЗ рдПрдХ рд╡реИрд╢рд┐рд╖реНрдЯреНрдп рдЖрд╣реЗ рдЬреЗ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдШрдЯрдХрд╛рдордзреНрдпреЗ рдлреАрд▓реНрдб рд╕реЗрдЯ рдХрд░рдгреНрдпрд╛рд╕ рдЕрдиреБрдорддреА рджреЗрддреЗ рдЖрдгрд┐ рдЬрд░ рддреА рдкреНрд░рдердо рдШрдЯрдХрд╛рдХрдбреВрди рдлреАрд▓реНрдб рдкреНрд░рд╛рдкреНрдд рдХреЗрд▓реА рдЕрд╕реЗрд▓ рддрд░ рддреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рддрдкрдгреЗ рдЕрджреНрдпрддрдирд┐рдд рдХреЗрд▓реА рдЬрд╛рдИрд▓. рд▓рдХреНрд╖рд╛рдд рдШреЗрдгреНрдпрд╛рдЬреЛрдЧреА рдорд╣рддреНрддреНрд╡рд╛рдЪреА рдЧреЛрд╖реНрдЯ рдЕрд╢реА рдЖрд╣реЗ рдХреА рдкрд╣рд┐рд▓реНрдпрд╛ рдШрдЯрдХрд╛рд▓рд╛ рд░реАрд▓реЛрдб рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ рдХрд╛рд░рдг рд╕реНрдЯреЛрдЕрд░рдордзреНрдпреЗ рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рдЕрдкрдбреЗрдЯ рдЧрдВрдЬрд▓реЗрд▓реНрдпрд╛ рд╕реНрдерд┐рддреАрдд рд╣реЛрддреЗ рдЬреНрдпрд╛рдЪрд╛ AS рдХреЛрдб рдЕрдЬреНрдЮреЗрдпрд╡рд╛рджреА рдЖрд╣реЗ.

```typescript
test('Derived fields example test', () => {
  let mainAccount = new GraphAccount('12')
  mainAccount.save()
  let operatedAccount = new GraphAccount('1')
  operatedAccount.operators = ['12']
  operatedAccount.save()
  let nst = new NameSignalTransaction('1234')
  nst.signer = '12'
  nst.save()

  assert.assertNull(mainAccount.get('nameSignalTransactions'))
  assert.assertNull(mainAccount.get('operatorOf'))

  mainAccount = GraphAccount.load('12')!

  assert.i32Equals(1, mainAccount.nameSignalTransactions.length)
  assert.stringEquals('1', mainAccount.operatorOf[0])
})
```

### рдбрд╛рдпрдиреЕрдорд┐рдХ рдбреЗрдЯрд╛ рд╕реНрд░реЛрддрд╛рдВрдЪреА рдЪрд╛рдЪрдгреА

рдбрд╛рдпрдиреЕрдорд┐рдХ рдбреЗрдЯрд╛ рд╕реНрд░реЛрддрд╛рдВрдЪреА рдЪрд╛рдЪрдгреА `context()`, `address()` рдЖрдгрд┐ `network()` рдлрдВрдХреНрд╢рдиреНрд╕рдЪреНрдпрд╛ рд░рд┐рдЯрд░реНрди рд╡реНрд╣реЕрд▓реНрдпреВрдЪреА рдердЯреНрдЯрд╛ рдХрд░реВрди рдХреЗрд▓реА рдЬрд╛рдК рд╢рдХрддреЗ. рдбреЗрдЯрд╛рд╕реНрд░реЛрдд рдиреЗрдорд╕реНрдкреЗрд╕. рд╣реА рдлрдВрдХреНрд╢рдиреНрд╕ рд╕рдзреНрдпрд╛ рдЦрд╛рд▓реАрд▓ рдЧреЛрд╖реНрдЯреА рдкрд░рдд рдХрд░рддрд╛рдд: `рд╕рдВрджрд░реНрдн()` - рд░рд┐рдХреНрдд рдЕрд╕реНрддрд┐рддреНрд╡ (рдбреЗрдЯрд╛рд╕реНрд░реЛрдд рд╕рдВрджрд░реНрдн), `рдкрддреНрддрд╛()` рдкрд░рдд рдХрд░рддреЗ - `0x00000000000000000000000000000000000000`, `рдиреЗрдЯрд╡рд░реНрдХ() - ` `рдореЗрдирдиреЗрдЯ` рдкрд░рдд рдХрд░рддреЛ.`create(...)` рдЖрдгрд┐ `createWithContext(...)` рдлрдВрдХреНрд╢рдиреНрд╕рдЪреА рдердЯреНрдЯрд╛ рдХреЗрд▓реА рдЬрд╛рддреЗ рдХреА рдХрд╛рд╣реАрд╣реА рдХрд░реВ рдирдпреЗ рдореНрд╣рдгреВрди рддреНрдпрд╛рдВрдирд╛ рдЪрд╛рдЪрдгреАрдордзреНрдпреЗ рдмреЛрд▓рд╛рд╡рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рдирд╛рд╣реА. рд░рд┐рдЯрд░реНрди рд╡реНрд╣реЕрд▓реНрдпреВрдЬрдордзреАрд▓ рдмрджрд▓ `matchstick-as` рдордзреАрд▓ `dataSourceMock` рдиреЗрдорд╕реНрдкреЗрд╕рдЪреНрдпрд╛ рдлрдВрдХреНрд╢рдиреНрд╕рджреНрд╡рд╛рд░реЗ рдХреЗрд▓реЗ рдЬрд╛рдК рд╢рдХрддрд╛рдд (рдЖрд╡реГрддреНрддреА 0.3.0+).

рдЦрд╛рд▓реАрд▓ рдЙрджрд╛рд╣рд░рдг:

рдкреНрд░рдердо рдЖрдордЪреНрдпрд╛рдХрдбреЗ рдЦрд╛рд▓реАрд▓ рдЗрд╡реНрд╣реЗрдВрдЯ рд╣рдБрдбрд▓рд░ рдЖрд╣реЗ (рдЬреЗ рдЬрд╛рдгреВрдирдмреБрдЬреВрди рдбреЗрдЯрд╛рд╕реЛрд░реНрд╕ рдорд╕реНрдХрд░реА рджрд╛рдЦрд╡рдгреНрдпрд╛рд╕рд╛рдареА рдкреБрдиреНрд╣рд╛ рдХреЗрд▓реЗ рдЧреЗрд▓реЗ рдЖрд╣реЗ):

```typescript
export function handleApproveTokenDestinations(event: ApproveTokenDestinations): void {
  let tokenLockWallet = TokenLockWallet.load(dataSource.address().toHexString())!
  if (dataSource.network() == 'rinkeby') {
    tokenLockWallet.tokenDestinationsApproved = true
  }
  let context = dataSource.context()
  if (context.get('contextVal')!.toI32() > 0) {
    tokenLockWallet.setBigInt('tokensReleased', BigInt.fromI32(context.get('contextVal')!.toI32()))
  }
  tokenLockWallet.save()
}
```

рдЖрдгрд┐ рдордЧ рдбреЗрдЯрд╛рд╕реЛрд░реНрд╕рдЪреНрдпрд╛ рд╕рд░реНрд╡ рдлрдВрдХреНрд╢рдиреНрд╕рд╕рд╛рдареА рдирд╡реАрди рд░рд┐рдЯрд░реНрди рд╡реНрд╣реЕрд▓реНрдпреВ рд╕реЗрдЯ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА dataSourceMock рдиреЗрдорд╕реНрдкреЗрд╕рдордзреАрд▓ рдкрджреНрдзрддреАрдВрдкреИрдХреА рдПрдХ рд╡рд╛рдкрд░реВрди рдЖрдордЪреНрдпрд╛рдХрдбреЗ рдЪрд╛рдЪрдгреА рдЖрд╣реЗ:

```typescript
import { assert, test, newMockEvent, dataSourceMock } from 'matchstick-as/assembly/index'
import { BigInt, DataSourceContext, Value } from '@graphprotocol/graph-ts'

import { handleApproveTokenDestinations } from '../../src/token-lock-wallet'
import { ApproveTokenDestinations } from '../../generated/templates/GraphTokenLockWallet/GraphTokenLockWallet'
import { TokenLockWallet } from '../../generated/schema'

test('Data source simple mocking example', () => {
  let addressString = '0xA16081F360e3847006dB660bae1c6d1b2e17eC2A'
  let address = Address.fromString(addressString)

  let wallet = new TokenLockWallet(address.toHexString())
  wallet.save()
  let context = new DataSourceContext()
  context.set('contextVal', Value.fromI32(325))
  dataSourceMock.setReturnValues(addressString, 'rinkeby', context)
  let event = changetype<ApproveTokenDestinations>(newMockEvent())

  assert.assertTrue(!wallet.tokenDestinationsApproved)

  handleApproveTokenDestinations(event)

  wallet = TokenLockWallet.load(address.toHexString())!
  assert.assertTrue(wallet.tokenDestinationsApproved)
  assert.bigIntEquals(wallet.tokensReleased, BigInt.fromI32(325))

  dataSourceMock.resetValues()
})
```

рд▓рдХреНрд╖рд╛рдд рдШреНрдпрд╛ рдХреА рд╢реЗрд╡рдЯреА dataSourceMock.resetValues() рдХреЙрд▓ рдХреЗрд▓рд╛ рдЖрд╣реЗ. рдпрд╛рдЪреЗ рдХрд╛рд░рдг рдЕрд╕реЗ рдХреА рдЬреЗрд╡реНрд╣рд╛ рдореВрд▓реНрдпреЗ рдмрджрд▓рд▓реА рдЬрд╛рддрд╛рдд рддреЗрд╡реНрд╣рд╛ рддреА рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд▓реА рдЬрд╛рддрд╛рдд рдЖрдгрд┐ рдЬрд░ рддреБрдореНрд╣рд╛рд▓рд╛ рдбреАрдлреЙрд▓реНрдЯ рдореВрд▓реНрдпрд╛рдВрд╡рд░ рдкрд░рдд рдЬрд╛рдпрдЪреЗ рдЕрд╕реЗрд▓ рддрд░ рддреЗ рд░реАрд╕реЗрдЯ рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ.

## рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ

**рдореЕрдЪрд╕реНрдЯрд┐рдХ** рд╡рд╛рдкрд░реВрди, рд╕рдмрдЧреНрд░рд╛рдл рдбреЗрд╡реНрд╣рд▓рдкрд░ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕ рд╕рдХреНрд╖рдо рдЖрд╣реЗрдд рдЬреА рд▓рд┐рдЦрд┐рдд рдпреБрдирд┐рдЯ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдЪреНрдпрд╛ рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬрдЪреА рдЧрдгрдирд╛ рдХрд░реЗрд▓.

рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ рдЯреВрд▓ рд╕рдВрдХрд▓рд┐рдд рдЪрд╛рдЪрдгреА `wasm` рдмрд╛рдпрдирд░реА рдШреЗрддреЗ рдЖрдгрд┐ рддреНрдпрд╛рдВрдирд╛ `wat` рдлрд╛рдпрд▓реАрдВрдордзреНрдпреЗ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ, рдЬреЗ рдирдВрддрд░ `рд╕рдмрдЧреНрд░рд╛рдлрдордзреНрдпреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреЗрд▓реЗрд▓реЗ рд╣рдБрдбрд▓рд░реНрд╕ рдЖрд╣реЗрдд рдХреА рдирд╛рд╣реА рд╣реЗ рдкрд╛рд╣рдгреНрдпрд╛рд╕рд╛рдареА рд╕рд╣рдЬрдкрдгреЗ рддрдкрд╛рд╕рд▓реЗ рдЬрд╛рдК рд╢рдХрддреЗ..yaml` рд▓рд╛ рдХреЙрд▓ рдХреЗрд▓реЗ рдЖрд╣реЗ. рдХреЛрдб рдХрд╡реНрд╣рд░реЗрдЬ (рдЖрдгрд┐ рд╕рдВрдкреВрд░реНрдг рдЪрд╛рдЪрдгреА) рдЕрд╕реЗрдВрдмрд▓реАрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЖрдгрд┐ WebAssembly рдордзреНрдпреЗ рдЕрдЧрджреА рд╕реБрд░реБрд╡рд╛рддреАрдЪреНрдпрд╛ рдЯрдкреНрдкреНрдпрд╛рдд рдЕрд╕рд▓реНрдпрд╛рдиреЗ, **Matchstick** рд╢рд╛рдЦрд╛ рдХрд╡реНрд╣рд░реЗрдЬ рддрдкрд╛рд╕реВ рд╢рдХрдд рдирд╛рд╣реА. рддреНрдпрд╛рдРрд╡рдЬреА, рджрд┐рд▓реЗрд▓реНрдпрд╛ рд╣рдБрдбрд▓рд░рд▓рд╛ рдХреЙрд▓ рдХреЗрд▓реНрдпрд╛рд╕, рддреНрдпрд╛рдЪреНрдпрд╛рд╕рд╛рдареА рдЗрд╡реНрд╣реЗрдВрдЯ/рдлрдВрдХреНрд╢рдирдЪреА рдпреЛрдЧреНрдп рдкреНрд░рдХрд╛рд░реЗ рдЦрд┐рд▓реНрд▓реА рдЙрдбрд╡рд▓реА рдЧреЗрд▓реА рдЖрд╣реЗ, рдпрд╛ рдкреНрд░рддрд┐рдкрд╛рджрдирд╛рд╡рд░ рдЖрдореНрд╣реА рдЕрд╡рд▓рдВрдмреВрди рдЖрд╣реЛрдд.

### рдкреВрд░реНрд╡рддрдпрд╛рд░реА

**Matchstick** рдордзреНрдпреЗ рдкреНрд░рджрд╛рди рдХреЗрд▓реЗрд▓реА рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЪрд╛рд▓рд╡рдгреНрдпрд╛рд╕рд╛рдареА, рддреБрдореНрд╣рд╛рд▓рд╛ рдХрд╛рд╣реА рдЧреЛрд╖реНрдЯреА рдЖрдзреАрдЪ рддрдпрд╛рд░ рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ:

#### рддреБрдордЪреЗ рд╣рдБрдбрд▓рд░ рдирд┐рд░реНрдпрд╛рдд рдХрд░рд╛

рдХреЛрдгрддреЗ рд╣рдБрдбрд▓рд░ рдЪрд╛рд▓рд╡рд▓реЗ рдЬрд╛рдд рдЖрд╣реЗрдд рд╣реЗ рддрдкрд╛рд╕рдгреНрдпрд╛рд╕рд╛рдареА **рдореЕрдЪрд╕реНрдЯрд┐рдХ** рд╕рд╛рдареА, рддреНрдпрд╛ рд╣рдБрдбрд▓рд░рдирд╛ **рдЪрд╛рдЪрдгреА рдлрд╛рдЗрд▓** рдордзреВрди рдирд┐рд░реНрдпрд╛рдд рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, рдЖрдордЪреНрдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдд, рдЖрдордЪреНрдпрд╛ gravity.test.ts рдлрд╛рдЗрд▓рдордзреНрдпреЗ рдЖрдордЪреНрдпрд╛рдХрдбреЗ рдЦрд╛рд▓реАрд▓ рд╣рдБрдбрд▓рд░ рдЖрдпрд╛рдд рдХреЗрд▓реЗ рдЬрд╛рдд рдЖрд╣реЗ:

```typescript
'../../src/gravity' рд╡рд░реВрди { handleNewGravatar } рдЖрдпрд╛рдд рдХрд░рд╛
```

рддреЗ рдХрд╛рд░реНрдп рджреГрд╢реНрдпрдорд╛рди рд╣реЛрдгреНрдпрд╛рд╕рд╛рдареА (рддреЗ `wat` рдлрд╛рдЗрд▓ **рдирд╛рд╡рд╛рдиреЗ** рдордзреНрдпреЗ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА) рдЖрдореНрд╣рд╛рд▓рд╛ рддреЗ рдирд┐рд░реНрдпрд╛рдд рджреЗрдЦреАрд▓ рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧреЗрд▓, рдЬрд╕реЗ:

```typescript
рдирд┐рд░реНрдпрд╛рдд { handleNewGravatar }
```

### рд╡рд╛рдкрд░

рдПрдХрджрд╛ рддреЗ рд╕рд░реНрд╡ рд╕реЗрдЯ рдЭрд╛рд▓реНрдпрд╛рдирдВрддрд░, рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ рд╕рд╛рдзрди рдЪрд╛рд▓рд╡рд┐рдгреНрдпрд╛рд╕рд╛рдареА, рдлрдХреНрдд рдЪрд╛рд▓рд╡рд╛:

```sh
рдЖрд▓реЗрдЦ рдЪрд╛рдЪрдгреА-- -c
```

рддреБрдореНрд╣реА рддреБрдордЪреНрдпрд╛ `package.json` рдлрд╛рдИрд▓рдордзреНрдпреЗ рд╕рд╛рдиреБрдХреВрд▓ `рдХрд╡реНрд╣рд░реЗрдЬ` рдХрдорд╛рдВрдб рджреЗрдЦреАрд▓ рдЬреЛрдбреВ рд╢рдХрддрд╛, рдЬрд╕реЗ рдХреА:

```typescript
 "scripts": {
    /.../
    "coverage": "graph test -- -c"
  },
```

рддреЗ рдХрд╡реНрд╣рд░реЗрдЬ рдЯреВрд▓ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрд▓ рдЖрдгрд┐ рддреБрдореНрд╣рд╛рд▓рд╛ рдЯрд░реНрдорд┐рдирд▓рдордзреНрдпреЗ рдЕрд╕реЗ рдХрд╛рд╣реАрддрд░реА рджрд┐рд╕реЗрд▓:

```sh
$ рдЖрд▓реЗрдЦ рдЪрд╛рдЪрдгреА -c
рдбрд╛рдЙрдирд▓реЛрдб/рдЗрдВрд╕реНрдЯреЙрд▓ рдЪрд░рдг рд╡рдЧрд│рдгреЗ рдХрд╛рд░рдг /Users/petko/work/demo-subgraph/node_modules/binary-install-raw/bin/0.4.0 рд╡рд░ рдмрд╛рдпрдирд░реА рдЖрдзреАрдкрд╛рд╕реВрдирдЪ рдЕрд╕реНрддрд┐рддреНрд╡рд╛рдд рдЖрд╣реЗ

___ ___ _ _ _ _ _
| \/ | | | | | | | (_) | |
| . . | __ _| |_ ___| |__ ___| |_ _ ___| | __
| |\/| |/ _` | __/ __| '_ \/ __| __| |/ __| |//
| | | | (_| | || (__| | | \__ \ |_| | (__| <
\_| |_/\__,__|\__\___|__| |_|___/\__|_|\___|_|\_\

рд╕рдВрдХрд▓рд┐рдд рдХрд░рдд рдЖрд╣реЗ...

рдХрд╡реНрд╣рд░реЗрдЬ рд░рд┐рдкреЛрд░реНрдЯ рдореЛрдбрдордзреНрдпреЗ рдЪрд╛рд▓рдд рдЖрд╣реЗ.
 я╕П
рд╡реНрдпреБрддреНрдкрдиреНрди рдЪрд╛рдЪрдгреА рдореЙрдбреНрдпреВрд▓реНрд╕ рд╡рд╛рдЪрдд рдЖрд╣реЗ... ЁЯФОя╕П

рдХрд╡реНрд╣рд░реЗрдЬ рдЕрд╣рд╡рд╛рд▓ рд╡реНрдпреБрддреНрдкрдиреНрди рдХрд░рдд рдЖрд╣реЗ ЁЯУЭ

'рдЧреНрд░реЕрд╡реНрд╣рд┐рдЯреА' рд╕реНрддреНрд░реЛрддрд╛рд╕рд╛рдареА рд╣рдБрдбрд▓рд░:
рд╣рдБрдбрд▓рд░ 'рд╣рдБрдбрд▓рдиреНрдпреВрдЧреНрд░рд╛рд╡рддрд╛рд░' рдЪрд╛рдЪрдгреА рдХреЗрд▓реА рдЬрд╛рддреЗ.
рд╣рдБрдбрд▓рд░ 'handleUpdatedGravatar' рдЪреА рдЪрд╛рдЪрдгреА рдХреЗрд▓реЗрд▓реА рдирд╛рд╣реА.
рд╣рдБрдбрд▓рд░ 'handleCreateGravatar' рдЪрд╛рдЪрдгреА рдХреЗрд▓реА рдЖрд╣реЗ.
рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ: 66.7% (2/3 рд╣рдБрдбрд▓рд░).

'GraphTokenLockWallet' рд╕реНрддреНрд░реЛрддрд╛рд╕рд╛рдареА рд╣рдБрдбрд▓рд░:
рд╣рдБрдбрд▓рд░ 'рд╣рдБрдбрд▓рдЯреЛрдХрдиреНрд╕рд░рд┐рд▓реАрдЭреНрдб' рдЪреА рдЪрд╛рдЪрдгреА рдХреЗрд▓реЗрд▓реА рдирд╛рд╣реА.
рд╣рдБрдбрд▓рд░ 'HandleTokensWithdrawn' рдЪреА рдЪрд╛рдЪрдгреА рдХреЗрд▓реА рдЬрд╛рдд рдирд╛рд╣реА.
рд╣рдБрдбрд▓рд░ 'HandleTokensRevoked' рдЪреА рдЪрд╛рдЪрдгреА рдХреЗрд▓реЗрд▓реА рдирд╛рд╣реА.
рд╣рдБрдбрд▓рд░ 'handleManagerUpdated' рдЪрд╛рдЪрдгреА рдХреЗрд▓реЗрд▓реА рдирд╛рд╣реА.
рд╣рдБрдбрд▓рд░ 'handleApproveTokenDestinations' рдЪреА рдЪрд╛рдЪрдгреА рдХреЗрд▓реЗрд▓реА рдирд╛рд╣реА.
рд╣рдБрдбрд▓рд░ 'handleRevokeTokenDestinations' рдЪреА рдЪрд╛рдЪрдгреА рдХреЗрд▓реЗрд▓реА рдирд╛рд╣реА.
рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ: 0.0% (0/6 рд╣рдБрдбрд▓рд░).

рдЬрд╛рдЧрддрд┐рдХ рдЪрд╛рдЪрдгреА рдХрд╡реНрд╣рд░реЗрдЬ: 22.2% (2/9 рд╣рдБрдбрд▓рд░).
```

### рд▓реЙрдЧ рдЖрдЙрдЯрдкреБрдЯрдордзреНрдпреЗ рдЪрд╛рдЪрдгреА рд░рди рдЯрд╛рдЗрдо рдХрд╛рд▓рд╛рд╡рдзреА

рд▓реЙрдЧ рдЖрдЙрдЯрдкреБрдЯрдордзреНрдпреЗ рдЪрд╛рдЪрдгреА рд░рди рдХрд╛рд▓рд╛рд╡рдзреА рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдЖрд╣реЗ. рдпреЗрдереЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЖрд╣реЗ:

`[рдЧреБрд░реБ, 31 рдорд╛рд░реНрдЪ 2022 13:54:54 +0300] рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЕрдВрдорд▓рд╛рдд рдЖрдгрд▓рд╛: 42.270ms.`

## рд╕рд╛рдорд╛рдиреНрдп рдХрдВрдкрд╛рдЗрд▓рд░ рддреНрд░реБрдЯреА

> рдЧрдВрднреАрд░: рд╕рдВрджрд░реНрднрд╛рд╕рд╣ рд╡реИрдз рдореЙрдбреНрдпреВрд▓рдордзреВрди WasmInstance рддрдпрд╛рд░ рдХрд░реВ рд╢рдХрд▓реЛ рдирд╛рд╣реА: рдЕрдЬреНрдЮрд╛рдд рдЖрдпрд╛рдд: wasi_snapshot_preview1::fd_write рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреЗрд▓реЗ рдЧреЗрд▓реЗ рдирд╛рд╣реА

рдпрд╛рдЪрд╛ рдЕрд░реНрде рддреБрдореНрд╣реА рддреБрдордЪреНрдпрд╛ рдХреЛрдбрдордзреНрдпреЗ `console.log` рд╡рд╛рдкрд░рд▓реЗ рдЖрд╣реЗ, рдЬреЗ рдЕрд╕реЗрдВрдмрд▓реАрд╕реНрдХреНрд░рд┐рдкреНрдЯрджреНрд╡рд╛рд░реЗ рд╕рдорд░реНрдерд┐рдд рдирд╛рд╣реА. рдХреГрдкрдпрд╛ [рд▓реЙрдЧрд┐рдВрдЧ API](/developing/assemblyscript-api/#logging-api) рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рд╛

> ERROR TS2554: Expected ? arguments, but got ?.
> 
> return new ethereum.Block(defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultAddress, defaultAddressBytes, defaultAddressBytes, defaultAddressBytes, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(18,12)
> 
> рддреНрд░реБрдЯреА TS2554: рдЕрдкреЗрдХреНрд╖рд┐рдд рдЖрд╣реЗ? рдпреБрдХреНрддрд┐рд╡рд╛рдж, рдкрдг рдорд┐рд│рд╛рд▓реЗ?.
> 
> рдирд╡реАрди ethereum.Transaction рдкрд░рдд рдХрд░рд╛(defaultAddressBytes, defaultBigInt, defaultAddress, defaultAddress, defaultBigInt, defaultBigInt, defaultBigInt, defaultAddressBytes, defaultBigInt);
> 
> in ~lib/matchstick-as/assembly/defaults.ts(24,12)

`graph-ts` рдЖрдгрд┐ `matchstick-as` рдордзреАрд▓ рдЬреБрд│рдд рдирд╕рд▓реНрдпрд╛рдореБрд│реЗ рд╡рд┐рддрд░реНрдХрд╛рдВрдордзреАрд▓ рдЬреБрд│рдд рдирд╛рд╣реА. рдпрд╛рд╕рд╛рд░рдЦреНрдпрд╛ рд╕рдорд╕реНрдпрд╛рдВрдЪреЗ рдирд┐рд░рд╛рдХрд░рдг рдХрд░рдгреНрдпрд╛рдЪрд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдорд╛рд░реНрдЧ рдореНрд╣рдгрдЬреЗ рдирд╡реАрдирддрдо рд░рд┐рд▓реАрдЭ рдХреЗрд▓реЗрд▓реНрдпрд╛ рдЖрд╡реГрддреНрддреАрд╡рд░ рд╕рд░реНрд╡рдХрд╛рд╣реА рдЕрджреНрдпрддрдирд┐рдд рдХрд░рдгреЗ.

## рдЕрднрд┐рдкреНрд░рд╛рдп

рддреБрдордЪреНрдпрд╛рдХрдбреЗ рдХрд╛рд╣реА рдкреНрд░рд╢реНрди, рдЕрднрд┐рдкреНрд░рд╛рдп, рд╡реИрд╢рд┐рд╖реНрдЯреНрдп рд╡рд┐рдирдВрддреНрдпрд╛ рдЕрд╕рд▓реНрдпрд╛рд╕ рдХрд┐рдВрд╡рд╛ рдлрдХреНрдд рд╕рдВрдкрд░реНрдХ рд╕рд╛рдзрд╛рдпрдЪрд╛ рдЕрд╕рд▓реНрдпрд╛рд╕, рд╕рд░реНрд╡реЛрддреНрддрдо рдард┐рдХрд╛рдг рдореНрд╣рдгрдЬреЗ The Graph Discord рдЬреЗрдереЗ рдЖрдордЪреНрдпрд╛рдХрдбреЗ Matchstick рд╕рд╛рдареА рдПрдХ рд╕рдорд░реНрдкрд┐рдд рдЪреЕрдиреЗрд▓ рдЖрд╣реЗ, рдЬреНрдпрд╛рд▓рд╛ ЁЯФе| рдпреБрдирд┐рдЯ-рдЪрд╛рдЪрдгреА.
