---
title: होस्ट केलेल्या सेवेसाठी सबग्राफ तैनात करणे
---

> होस्ट केलेल्या सेवेवर नेटवर्क समर्थित नसल्यास, तुम्ही ते अनुक्रमित करण्यासाठी तुमचे स्वतःचे [graph-node](https://github.com/graphprotocol/graph-node) चालवू शकता.

होस्ट केलेल्या सेवेसाठी सबग्राफ कसा उपयोजित करायचा हे हे पृष्ठ स्पष्ट करते. सबग्राफ उपयोजित करण्यासाठी तुम्हाला प्रथम [ग्राफ CLI](https://github.com/graphprotocol/graph-cli) स्थापित करणे आवश्यक आहे. जर तुम्ही आधीच सबग्राफ तयार केला नसेल, तर [सबग्राफ तयार करणे](/developing/creating-a-subgraph) पहा.

## होस्ट केलेले सेवा खाते तयार करा

होस्ट केलेली सेवा वापरण्यापूर्वी, आमच्या होस्ट केलेल्या सेवेमध्ये खाते तयार करा. त्यासाठी तुम्हाला [Github](https://github.com/) खात्याची आवश्यकता असेल; जर तुमच्याकडे नसेल, तर तुम्हाला ते प्रथम तयार करावे लागेल. त्यानंतर, [होस्टेड सर्व्हिस](https://thegraph.com/hosted-service/) वर नेव्हिगेट करा, *'Github सह साइन अप करा' वर क्लिक करा *बटण, आणि Github चा अधिकृतता प्रवाह पूर्ण करा.

## प्रवेश टोकन साठवा

खाते तयार केल्यानंतर, तुमच्या [डॅशबोर्ड](https://thegraph.com/hosted-service/dashboard) वर नेव्हिगेट करा. डॅशबोर्डवर प्रदर्शित केलेले प्रवेश टोकन कॉपी करा आणि `graph auth --product hosted-service <ACCESS_TOKEN>` चालवा. हे आपल्या संगणकावर प्रवेश टोकन संचयित करेल. तुम्हाला हे फक्त एकदाच करावे लागेल, किंवा तुम्ही कधीही ऍक्सेस टोकन पुन्हा निर्माण केल्यास.

## होस्ट केलेल्या सेवेवर सबग्राफ तयार करा

सबग्राफ उपयोजित करण्यापूर्वी, तुम्हाला तो ग्राफ एक्सप्लोररमध्ये तयार करणे आवश्यक आहे. [डॅशबोर्ड](https://thegraph.com/hosted-service/dashboard) वर जा आणि _'सबग्राफ जोडा'_ वर क्लिक करा बटण दाबा आणि योग्य ती माहिती भरा:

**प्रतिमा** - पूर्वावलोकन प्रतिमा आणि सबग्राफसाठी लघुप्रतिमा म्हणून वापरण्यासाठी प्रतिमा निवडा.

**सबग्राफ नाव** - सबग्राफ तयार केलेल्या खात्याच्या नावासह, हे `account-name/subgraph-name`-शैली देखील परिभाषित करेल उपयोजन आणि GraphQL एंडपॉइंटसाठी वापरलेले नाव. _हे फील्ड नंतर बदलता येणार नाही._

**खाते** - सबग्राफ अंतर्गत तयार केलेले खाते. हे एखाद्या व्यक्तीचे किंवा संस्थेचे खाते असू शकते. _सबग्राफ नंतर खात्यांमध्ये हलवता येणार नाहीत._

**उपशीर्षक** - सबग्राफ कार्डमध्ये दिसणारा मजकूर.

**वर्णन** - सबग्राफचे वर्णन, सबग्राफ तपशील पृष्ठावर दृश्यमान.

**GitHub URL** - GitHub वरील सबग्राफ रेपॉजिटरीशी लिंक.

**लपवा** - हे चालू केल्याने ग्राफ एक्सप्लोररमधील सबग्राफ लपविला जातो.

नवीन सबग्राफ सेव्ह केल्यानंतर, तुम्हाला ग्राफ सीएलआय कसा स्थापित करायचा, नवीन सबग्राफसाठी मचान कसा तयार करायचा आणि तुमचा सबग्राफ कसा उपयोजित करायचा यावरील मदतीसह स्क्रीन दर्शविली जाते. पहिल्या दोन चरणांचा समावेश [सबग्राफ विभाग परिभाषित करणे](/developing/defining-a-subgraph) मध्ये केला होता.

## होस्ट केलेल्या सेवेवर सबग्राफ तैनात करा

तुमचा सबग्राफ उपयोजित केल्याने तुम्ही `यार्न बिल्ड` सह तयार केलेल्या सबग्राफ फाइल्स IPFS वर अपलोड केल्या जातील आणि ग्राफ एक्सप्लोररला या फाइल्स वापरून तुमचा सबग्राफ अनुक्रमित करण्यास सुरुवात करण्यास सांगेल.

तुम्ही `यार्न डिप्लॉय` चालवून सबग्राफ उपयोजित करता

सबग्राफ उपयोजित केल्यानंतर, ग्राफ एक्सप्लोरर तुमच्या सबग्राफची सिंक्रोनायझेशन स्थिती दर्शवण्यासाठी स्विच करेल. जेनेसिस ब्लॉकपासून सुरुवात करून, ऐतिहासिक ब्लॉक्समधून किती डेटा आणि इव्हेंट काढण्याची आवश्यकता आहे यावर अवलंबून, सिंक होण्यास काही मिनिटांपासून कित्येक तास लागू शकतात.

एकदा ग्राफ नोडने ऐतिहासिक ब्लॉक्समधून सर्व डेटा काढल्यानंतर सबग्राफ स्थिती `सिंक` वर स्विच होते. ग्राफ नोड तुमच्या सबग्राफसाठी ब्लॉक्सची तपासणी करणे सुरू ठेवेल कारण हे ब्लॉक्स खनन केले जातात.

## सबग्राफ पुन्हा तैनात करणे

तुमच्या सबग्राफ व्याख्येमध्ये बदल करताना, उदाहरणार्थ, एंटिटी मॅपिंगमधील समस्येचे निराकरण करण्यासाठी, तुमच्या सबग्राफची अपडेट केलेली आवृत्ती उपयोजित करण्यासाठी वरील `यार्न डिप्लॉय` कमांड पुन्हा चालवा. सबग्राफच्या कोणत्याही अपडेटसाठी आवश्यक आहे की ग्राफ नोड तुमचा संपूर्ण सबग्राफ पुन्हा अनुक्रमित करेल, पुन्हा जेनेसिस ब्लॉकपासून सुरू होईल.

तुमचा पूर्वी तैनात केलेला सबग्राफ अजूनही `सिंक करत आहे` स्थितीत असल्यास, तो ताबडतोब नवीन उपयोजित आवृत्तीसह बदलला जाईल. जर पूर्वी उपयोजित सबग्राफ आधीपासून पूर्णपणे समक्रमित केला असेल, तर ग्राफ नोड नवीन उपयोजित आवृत्तीला `प्रलंबित आवृत्ती` म्हणून चिन्हांकित करेल, पार्श्वभूमीमध्ये समक्रमित करेल आणि एकदा समक्रमित केल्यानंतर फक्त सध्या उपयोजित आवृत्ती नवीनसह पुनर्स्थित करेल. नवीन आवृत्ती पूर्ण झाली. हे सुनिश्चित करते की नवीन आवृत्ती समक्रमित होत असताना आपल्याकडे कार्य करण्यासाठी सबग्राफ आहे.

## एकाधिक नेटवर्कवर सबग्राफ तैनात करणे

काही प्रकरणांमध्ये, तुम्हाला समान सबग्राफ एकाधिक नेटवर्कवर त्याच्या कोडची नक्कल न करता उपयोजित करायचा असेल. यासह येणारे मुख्य आव्हान हे आहे की या नेटवर्कवरील कराराचे पत्ते वेगळे आहेत.

### ग्राफ-क्ली वापरणे

`ग्राफ बिल्ड` (`v0.29.0` पासून) आणि `graph deploy` (`v0.32.0` पासून) दोन नवीन पर्याय स्वीकारतात:

```sh
Options:

      ...
      --network <name>          Network configuration to use from the networks config file
      --network-file <path>     Networks config file path (default: "./networks.json")
```

तुम्‍ही सहज अपडेट करण्‍यासाठी `json` मानक फाइल (डिफॉल्‍ट `networks.json`) वरून नेटवर्क कॉन्फिगरेशन निर्दिष्ट करण्‍यासाठी `--network` पर्याय वापरू शकता विकासादरम्यान सबग्राफ.

**टीप:** `init` कमांड आता प्रदान केलेल्या माहितीवर आधारित `networks.json` स्वयं-व्युत्पन्न करेल. त्यानंतर तुम्ही विद्यमान अद्ययावत करण्यात किंवा अतिरिक्त नेटवर्क जोडण्यास सक्षम असाल.

तुमच्याकडे `networks.json` फाइल नसल्यास, तुम्हाला खालील संरचनेसह मॅन्युअली तयार करणे आवश्यक आहे:

```json
{
    "network1": { // the network name
        "dataSource1": { // the dataSource name
            "address": "0xabc...", // the contract address (optional)
            "startBlock": 123456 // the startBlock (optional)
        },
        "dataSource2": {
            "address": "0x123...",
            "startBlock": 123444
        }
    },
    "network2": {
        "dataSource1": {
            "address": "0x987...",
            "startBlock": 123
        },
        "dataSource2": {
            "address": "0xxyz..",
            "startBlock": 456
        }
    },
    ...
}
```

**टीप:** तुम्हाला कॉन्फिगरेशन फाइलमध्ये कोणतेही `टेम्पलेट` (जर तुमच्याकडे असतील तर) निर्दिष्ट करण्याची गरज नाही, फक्त ` डेटास्रोत`. `subgraph.yaml` फाइलमध्ये घोषित केलेले कोणतेही `टेम्पलेट` असल्यास, त्यांचे नेटवर्क `--network` पर्यायासह निर्दिष्ट केलेल्या नेटवर्कवर स्वयंचलितपणे अद्यतनित केले जाईल.

आता, समजू की तुम्हाला तुमचा सबग्राफ `mainnet` आणि `goerli` नेटवर्कवर उपयोजित करायचा आहे आणि हे तुमचे `subgraph.yaml` आहे:

```yaml
# ...
dataSources:
  - kind: ethereum/contract
    name: Gravity
    network: mainnet
    source:
      address: '0x123...'
      abi: Gravity
    mapping:
      kind: ethereum/events
```

तुमची नेटवर्क कॉन्फिगरेशन फाइल अशी दिसली पाहिजे:

```json
{
  "mainnet": {
    "Gravity": {
      "address": "0x123..."
    }
  },
  "goerli": {
    "Gravity": {
      "address": "0xabc..."
    }
  }
}
```

आता आपण खालीलपैकी एक कमांड रन करू शकतो:

```sh
# डीफॉल्ट networks.json फाइल वापरणे
यार्न बिल्ड --नेटवर्क गोअरली

# सानुकूल नावाची फाइल वापरणे
यार्न बिल्ड --network goerli --network-file path/to/config
```

`build` कमांड तुमचा `subgraph.yaml` `goerli` कॉन्फिगरेशनसह अपडेट करेल आणि नंतर सबग्राफ पुन्हा संकलित करेल. तुमची `subgraph.yaml` फाइल आता यासारखी दिसली पाहिजे:

```yaml
# ...
dataSources:
  - kind: ethereum/contract
    name: Gravity
    network: goerli
    source:
      address: '0xabc...'
      abi: Gravity
    mapping:
      kind: ethereum/events
```

आता तुम्ही `यार्न डिप्लॉय` करण्यासाठी तयार आहात.

**टीप:** आधी सांगितल्याप्रमाणे, `graph-cli 0.32.0` पासून तुम्ही थेट `यार्न डिप्लॉय` चालवू शकता `--नेटवर्क` पर्याय:

```sh
# डीफॉल्ट networks.json फाइल वापरणे
सूत उपयोजित --network goerli

# सानुकूल नावाची फाइल वापरणे
सूत उपयोजित --network goerli --network-file path/to/config
```

### वापरत आहे subgraph.yaml टेम्पलेट

जुन्या ग्राफ-क्ली आवृत्त्यांसाठी एक उपाय जो करार पत्त्यांसारख्या पैलूंचे पॅरामीटराइझ करण्याची परवानगी देतो तो म्हणजे [Mustache](https://mustache.github.io/) किंवा [हँडलबार](https://handlebarsjs.com/).

हा दृष्टिकोन स्पष्ट करण्यासाठी, भिन्न करार पत्ते वापरून मेननेट आणि गोएर्लीमध्ये सबग्राफ तैनात केले जावेत असे गृहीत धरू. त्यानंतर तुम्ही प्रत्येक नेटवर्कसाठी पत्ते प्रदान करणार्‍या दोन कॉन्फिगरेशन फाइल्स परिभाषित करू शकता:

```json
{
  "network": "mainnet",
  "address": "0x123..."
}
```

आणि

```json
{
  "network": "goerli",
  "address": "0xabc..."
}
```

त्यासोबत, तुम्ही मॅनिफेस्टमधील नेटवर्कचे नाव आणि पत्ते बदलून व्हेरिएबल प्लेसहोल्डर्स `{{network}}` आणि `{{address}}` आणि मॅनिफेस्टचे नाव बदलून उदा. `subgraph.template.yaml`:

```yaml
# ...
dataSources:
  - kind: ethereum/contract
    name: Gravity
    network: mainnet
    network: {{network}}
    source:
      address: '0x2E645469f354BB4F5c8a05B3b30A929361cf77eC'
      address: '{{address}}'
      abi: Gravity
    mapping:
      kind: ethereum/events
```

कोणत्याही नेटवर्कवर मॅनिफेस्ट जनरेट करण्‍यासाठी, तुम्ही `package.json` वर `मशी` अवलंबित्वासह दोन अतिरिक्त कमांड जोडू शकता:

```json
{
  ...
  "scripts": {
    ...
    "prepare:mainnet": "mustache config/mainnet.json subgraph.template.yaml > subgraph.yaml",
    "prepare:goerli": "mustache config/goerli.json subgraph.template.yaml > subgraph.yaml"
  },
  "devDependencies": {
    ...
    "mustache": "^3.1.0"
  }
}
```

हा सबग्राफ mainnet किंवा Goerli साठी उपयोजित करण्यासाठी तुम्ही आता खालील दोन कमांडपैकी एक चालवा:

```sh
# Mainnet:
yarn prepare:mainnet && yarn deploy

# Goerli:
yarn prepare:goerli && yarn deploy
```

याचे एक कार्यरत उदाहरण [येथे](https://github.com/graphprotocol/example-subgraph/tree/371232cf68e6d814facf5e5413ad0fef65144759) आढळू शकते.

**टीप:** हा दृष्टीकोन अधिक जटिल परिस्थितींमध्ये देखील लागू केला जाऊ शकतो, जेथे करार पत्ते आणि नेटवर्क नावांपेक्षा अधिक बदलणे आवश्यक आहे किंवा जेथे टेम्पलेट्समधून मॅपिंग किंवा ABI तयार करणे आवश्यक आहे.

## सबग्राफ आरोग्य तपासत आहे

जर सबग्राफ यशस्वीरित्या समक्रमित झाला, तर ते कायमचे चांगले चालत राहण्याचे चांगले चिन्ह आहे. तथापि, नेटवर्कवरील नवीन ट्रिगर्समुळे तुमच्या सबग्राफची चाचणी न केलेली त्रुटी स्थिती येऊ शकते किंवा कार्यप्रदर्शन समस्यांमुळे किंवा नोड ऑपरेटरमधील समस्यांमुळे ते मागे पडू शकते.

ग्राफ नोड एक graphql एंडपॉइंट उघड करतो जो तुम्ही तुमच्या सबग्राफची स्थिती तपासण्यासाठी क्वेरी करू शकता. होस्ट केलेल्या सेवेवर, ते `https://api.thegraph.com/index-node/graphql` वर उपलब्ध आहे. स्थानिक नोडवर, ते डीफॉल्टनुसार `8030/graphql` पोर्टवर उपलब्ध आहे. या एंडपॉइंटसाठी संपूर्ण स्कीमा [येथे](https://github.com/graphprotocol/graph-node/blob/master/server/index-node/src/schema.graphql) आढळू शकते. येथे एक उदाहरण क्वेरी आहे जी सबग्राफच्या वर्तमान आवृत्तीची स्थिती तपासते:

```graphql
{
  indexingStatusForCurrentVersion(subgraphName: "org/subgraph") {
    synced
    health
    fatalError {
      message
      block {
        number
        hash
      }
      handler
    }
    chains {
      chainHeadBlock {
        number
      }
      latestBlock {
        number
      }
    }
  }
}
```

हे तुम्हाला `chainHeadBlock` देईल ज्याची तुलना तुम्ही तुमच्या सबग्राफवरील `latestBlock` शी तुलना करू शकता की ते मागे आहे की नाही हे तपासण्यासाठी. `समक्रमित` सबग्राफ कधीही साखळीत अडकला असेल तर कळवतो. `आरोग्य` सध्या कोणतीही त्रुटी न आल्यास `हेल्दी` ची मूल्ये घेऊ शकते किंवा सबग्राफची प्रगती थांबवणारी त्रुटी असल्यास `अयशस्वी`. या प्रकरणात, या त्रुटीच्या तपशीलांसाठी तुम्ही `fatalError` फील्ड तपासू शकता.

## होस्ट केलेले सेवा सबग्राफ संग्रहण धोरण

होस्ट केलेली सेवा एक विनामूल्य ग्राफ नोड इंडेक्सर आहे. डेव्हलपर नेटवर्कच्या श्रेणीचे अनुक्रमित करणारे सबग्राफ उपयोजित करू शकतात, जे अनुक्रमित केले जातील आणि graphQL द्वारे क्वेरीसाठी उपलब्ध केले जातील.

सक्रिय सबग्राफसाठी सेवेचे कार्यप्रदर्शन सुधारण्यासाठी, होस्ट केलेली सेवा निष्क्रिय असलेले सबग्राफ संग्रहित करेल.

**सबग्राफ "निष्क्रिय" म्हणून परिभाषित केला जातो जर तो होस्ट केलेल्या सेवेमध्ये 45 दिवसांपेक्षा जास्त पूर्वी तैनात केला गेला असेल आणि जर त्याला गेल्या 45 दिवसांत 0 क्वेरी प्राप्त झाल्या असतील.**

विकसकांना ईमेलद्वारे सूचित केले जाईल जर त्यांच्या सबग्राफ्सपैकी एक काढून टाकण्याच्या 7 दिवस आधी निष्क्रिय म्हणून चिन्हांकित केले असेल. जर त्यांना त्यांचा सबग्राफ "सक्रिय" करायचा असेल, तर ते त्यांच्या सबग्राफच्या होस्ट केलेल्या सर्व्हिस ग्राफक्यूएल प्लेग्राउंडमध्ये क्वेरी करून तसे करू शकतात. पुन्हा आवश्यक असल्यास विकसक नेहमी संग्रहित सबग्राफ पुनर्नियुक्त करू शकतात.

## सबग्राफ स्टुडिओ सबग्राफ संग्रहण धोरण

जेव्हा सबग्राफची नवीन आवृत्ती उपयोजित केली जाते, तेव्हा मागील आवृत्ती संग्रहित केली जाते (ग्राफ-नोड DB मधून हटविली जाते). हे केवळ तेव्हाच घडते जेव्हा मागील आवृत्ती The Graph च्या विकेंद्रित नेटवर्कवर प्रकाशित केली जात नाही.

जेव्हा सबग्राफ आवृत्तीची 45 दिवसांपेक्षा जास्त वेळ चौकशी केली जात नाही, तेव्हा ती आवृत्ती संग्रहित केली जाते.

या धोरणामुळे प्रभावित झालेल्या प्रत्येक सबग्राफला प्रश्नातील आवृत्ती परत आणण्याचा पर्याय आहे.
