---
title: Como Atualizar um Subgraph Existente à Graph Network
---

## Introdução

Este guia ensina como atualizar o seu subgraph do serviço hospedado à rede descentralizada do The Graph. Mais de mil subgraphs foram atualizados à Graph Network com êxito, incluindo projetos como Snapshot, Loopring, Audius, Premia, Livepeer, Uma, Curve, Lido e muito mais!

O processo é rápido, e os seus subgraphs só tem a ganhar com a confiabilidade e o desempenho da rede da The Graph Network.

### Pré-requisitos

- You have a subgraph deployed on the hosted service.

## Como Atualizar um Subgraph Existente à Graph Network

<VideoEmbed youtube="hCmX5Dlhdjw" />

If you are logged in to the hosted service, you can access a simple flow to upgrade your subgraphs from [your dashboard](https://thegraph.com/hosted-service/dashboard), or from an individual subgraph page.

> This process typically takes less than five minutes.

1. Select the subgraph(s) you want to upgrade.
2. Connect or enter the receiving wallet (the wallet that will become the owner of the subgraph).
3. Click the "Upgrade" button.

That's it! Your subgraphs will be deployed to Subgraph Studio, and published on The Graph Network. You can access the [Subgraph Studio](https://thegraph.com/studio/) to manage your subgraphs, logging in with the wallet specified during the upgrade process.

You'll be able to view your subgraphs live on the decentralized network via [Graph Explorer](https://thegraph.com/explorer).

### What next?

When your subgraph is upgraded, it will automatically be indexed by the upgrade indexer. If the indexed chain is [fully supported by The Graph Network](/developing/supported-networks), you can add some GRT as "signal", to attract more indexers. It is recommended to curate your subgraph with at least 3,000 GRT to attract 2-3 Indexers for higher quality of service.

You can start to query your subgraph right away on The Graph Network, once you have generated an API key.

### Como criar uma chave API

É possível gerar uma chave API no Subgraph Studio [aqui](https://thegraph.com/studio/apikeys/).

![Página de criação de chave API](/img/api-image.png)

You can use this API key to query subgraphs on The Graph Network. All users start on the Free Plan, which includes 100,000 free queries per month. Developers can sign up for the Growth Plan by connecting a credit or debit card, or by depositing GRT to Subgraph Studio billing system.

> Note: see the [billing documentation](../billing) for more information on plans, and on managing your billing on Subgraph Studio.

### Como proteger a sua chave API

É ideal proteger a API com imposições de limite ao seu uso, em duas maneiras:

1. Subgraphs Autorizados
2. Domínio Autorizado

You can secure your API key [here](https://thegraph.com/studio/apikeys/).

![Página de trancamento de subgraphs](/img/subgraph-lockdown.png)

### Como consultar o seu subgraph na rede descentralizada

Now you can check the indexing status of the Indexers on the network in Graph Explorer (example [here](https://thegraph.com/explorer/subgraphs/Dtj2HicXKpoUjNB7ffdBkMwt3L9Sz3cbENd67AdHu6Vb?view=Indexers&chain=arbitrum-one)). The green line at the top indicates that at the time of posting 7 Indexers successfully indexed that subgraph. Also in the Indexer tab you can see which Indexers picked up your subgraph.

![Subgraph do Rocket Pool](/img/rocket-pool-subgraph.png)

Assim que o primeiro Indexer tiver indexado o seu subgraph por completo, pode começar a consultar o subgraph na rede descentralizada. O URL de consulta para o seu subgraph pode ser copiado e colado com um clique no símbolo próximo ao URL de consulta. Aparecerá algo assim:

`https://gateway.thegraph.com/api/[api-key]/subgraphs/id/S9ihna8D733WTEShJ1KctSTCvY1VJ7gdVwhUujq4Ejo`

Importante: Substitua o `[api-key]` com uma chave API verídica, gerada na seção acima.

Agora, pode usar aquele URL de Consulta no seu dapp para enviar os seus pedidos no GraphQL.

Parabéns! Viraste um pioneiro da descentralização!

> Nota: Devido à natureza distribuída da rede, pode ser que Indexadores diferentes tenham indexado até blocos diferentes. Para receber apenas dados recentes, especifique o bloco mínimo que um indexador deve indexar para servir seu query com o argumento block: `{ number_gte: $minBlock }` como no exemplo abaixo:

```graphql
{
  stakers(block: { number_gte: 14486109 }) {
    id
  }
}
```

Veja mais informações sobre a rede, e como lidar com reorganizações, no artigo da documentação [Sistemas Distribuídos](/querying/distributed-systems/).

## Como Atualizar um Subgraph na Rede

If you would like to update an existing subgraph on the network, you can do this by deploying a new version of your subgraph to Subgraph Studio using the Graph CLI.

1. Make changes to your current subgraph.
2. Lance o seguinte e especifique a nova versão no comando (por ex. v0.0.1, v0.0.2, etc.):

```sh
graph deploy --studio --version <version> <SUBGRAPH_SLUG>
```

3. Test the new version in Subgraph Studio by querying in the playground
4. Publique a nova versão na rede do The Graph. Não esqueça que isto exige gas (como descrito acima).

### Sobre as Taxas de Upgrade para o Dono

> Nota: A curadoria no Arbitrum tem uma bonding curve fixa. Aprenda mais sobre o Arbitrum [aqui](/arbitrum/arbitrum-faq/).

Upgrades exigem GRT para migrar da versão antiga do subgraph à versão nova. Portanto, a cada atualização, será criada uma bonding curve (curva de união; mais sobre bonding curves aqui: [here](/network/curating#bonding-curve-101)).

A nova bonding curve cobra a taxa de curação de 1% sobre todo GRT a ser migrado à nova versão. O titular deve pagar 50% disto, ou 1,25%. Os outros 1,25% são absorvidos por todos os curadores como um tributo. Este incentivo existe para que o dono de um subgraph não possa esvaziar os fundos dos curadores com chamadas recursivas de atualização. Se não houver atividade de curação, é necessário pagar no mínimo 100 GRT para sinalizar seu próprio subgraph.

Vamos fazer um exemplo. Isto só acontece se o seu subgraph for curado ativamente:

- São sinalizados 100.000 GRT com a função de migração automática na v1 de um subgraph
- O dono atualiza à v2. São migrados 100.000 GRT a uma nova bonding curve, sendo que 97,500 GRT entram na curva nova e 2.500 são queimados
- O dono então queima 1.250 GRT para pagar por metade da taxa. O dono deve ter isto na sua carteira antes da atualização; caso contrário, o upgrade falhará. Isto acontece na mesma transação do upgrade.

_Enquanto este mecanismo permanece ao vivo na rede, a comunidade atualmente discute maneiras de reduzir o custo de atualizações para programadores de subgraphs._

### Como Conservar uma Versão Estável de Subgraph

Se for fazer muitas mudanças ao seu subgraph, não é bom atualizá-lo constantemente e afrontar os custos da atualização. É importante conservar uma versão estável e consistente do seu subgraph; não só pelo custo, mas também para que os Indexadores tenham confiança em seus tempos de sincronização. Os Indexadores devem ser avisados dos seus planos de atualização, para que os tempos de sincronização dos Indexadores não sejam afetados. Use à vontade o [canal dos #Indexers](https://discord.gg/JexvtHa7dq) no Discord para avisar aos Indexadores quando for mudar a versão dos seus subgraphs.

Subgraphs são APIs abertas usadas por programadores externos. As APIs abertas devem seguir padrões estritos para não quebrarem os aplicativos de programadores externos. Na The Graph Network (rede do The Graph), um programador de Subgraph deve considerar os Indexadores e o tempo que levam para sincronizar um novo subgraph, **assim como** outros desenvolvedores a usarem seus subgraphs.

### Como Atualizar os Metadados de um Subgraph

You can update the metadata of your subgraphs without having to publish a new version. The metadata includes the subgraph name, image, description, website URL, source code URL, and categories. Developers can do this by updating their subgraph details in Subgraph Studio where you can edit all applicable fields.

Marque a opção **Update Subgraph Details in Explorer\* (Atualizar Detalhes do Subgraph no Explorador) e clique em **Save\*\* (Salvar). Se marcada, será gerada uma transação on-chain que atualiza detalhes do subgraph no Explorer, sem precisar publicar uma nova versão com um novo lançamento.

## As Melhores Práticas para Lançar um Subgraph à Graph Network

1. Use um nome ENS para Desenvolvimento de Subgraph:

- Prepare o seu ENS [aqui](https://app.ens.domains/)
- Adicione o seu nome ENS às suas configurações [aqui](https://thegraph.com/explorer/settings?view=display-name).

2. Quanto mais preenchidos os seus perfis, maiores serão as oportunidades de indexar e curar os seus subgraphs.

## Como Depreciar um Subgraph na The Graph Network

Siga os passos [aqui](/managing/deprecating-a-subgraph) para depreciar o seu subgraph e retirá-lo da The Graph Network.

## Queries em um Subgraph + Cobrança na The Graph Network

O Serviço Hospedado foi preparado para que os programadores lancem os seus subgraphs sem qualquer restrição.

On The Graph Network, query fees have to be paid as a core part of the protocol's incentives. For more information on subscribing to APIs and paying the query fees, check out billing documentation [here](/billing/).

## Outros Recursos

Se ainda tem dúvidas, não tem problema! Confira os seguintes recursos ou assista o nosso guia em vídeo sobre atualizar e migrar subgraphs à rede descentralizada abaixo:

<VideoEmbed youtube="satdwdbvzAQ" />

- [Contratos da Graph Network](https://github.com/graphprotocol/contracts)
- [Contrato de Curadoria](https://github.com/graphprotocol/contracts/blob/dev/contracts/curation/Curation.sol) - o contrato subjacente em qual o GNS se revolve
  - Endereço - `0x8fe00a685bcb3b2cc296ff6ffeab10aca4ce1538`
- [Documentação do Subgraph Studio](/deploying/subgraph-studio)
