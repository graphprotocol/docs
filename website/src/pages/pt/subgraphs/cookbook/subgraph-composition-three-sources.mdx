---
title: Como Agregar Dados com a Composição de Subgraphs
sidebarTitle: Construa um Subgraph Compostável com Múltiplos Subgraphs
---

Otimize o seu Subgraph mesclando dados de três Subgraphs de origem, independentes, num único Subgraph compostável para melhorar a agregação de dados.

> Avisos Importantes:
>
> - A composição de um subgraph está incorporada à CLI, e a implantação é feita com o [Subgraph Studio](https://thegraph.com/studio/).
> - Este recurso requer a versão 1.3.0 de `specVersion`.

## Visão geral

A composição de Subgraphs permite o uso de um Subgraph como fonte de dados para outro, e também permite que ele consuma e responda às mudanças de entidades. Em vez de buscar diretamente os dados na chain, um Subgraph pode procurar atualizações de outro Subgraph e reagir às mudanças. Isso serve para agregar dados de vários Subgraphs ou desencadear ações com base em atualizações externas.

## Pré-requisitos

Para implantar **todos os** Subgraphs localmente, é necessário ter o seguinte:

- Uma instância do [Graph Node](https://github.com/graphprotocol/graph-node) em execução local
- Uma instância de [IPFS](https://docs.ipfs.tech/) em execução local
- [Node.js](https://nodejs.org) e npm

## Como Começar

O guia a seguir fornece exemplos para a definição de três Subgraphs de origem para criar um poderoso Subgraph composto.

### Especificações

- Para fins de simplicidade, todos os Subgraphs de origem usam apenas handlers de blocos. No entanto, num ambiente real, cada Subgraph de origem usará dados de contratos inteligentes diferentes.
- Os exemplos abaixo mostram como importar e estender o schema de outro Subgraph para melhorar a sua funcionalidade.
- Cada Subgraph de origem é otimizado com uma entidade específica.
- Todos os comandos listados instalam as dependências necessárias, geram código baseado no schema da GraphQL, constroem o Subgraph, e o implantam na instância local do Graph Node.

### Passo 1. Implante o Tempo de Bloco do Subgraph de Origem

Este primeiro Subgraph de origem calcula o tempo de bloco para cada bloco.

- Ele importa schemas de outros Subgraphs e adiciona uma entidade `block` com um campo `timestamp`, que representa o tempo em que cada bloco foi minerado.
- Procura eventos de blockchain relacionados ao tempo (por exemplo, data e hora de blocos) e processa esses dados para atualizar as entidades do Subgraph de acordo.

Para implantar este Subgraph localmente, execute os seguintes comandos:

```bash
npm install
npm run codegen
npm run build
npm run create-local
npm run deploy-local
```

### Passo 2. Implante o Custo de Bloco do Subgraph de Origem

Este segundo Subgraph de origem indexa o custo de cada bloco.

#### Funções Importantes

- Importa schemas de outros Subgraphs e adiciona uma entidade `block` com campos relacionados ao custo.
- Procura eventos da blockchain relacionados aos custos (por exemplo, taxas de gás, custos de transação), e processa esses dados para atualizar as entidades do Subgraphs de acordo.

Para implantar este Subgraph localmente, execute os mesmos comandos listados acima.

### Passo 3. Defina o Tamanho dos Blocos do Subgraph de Origem

Este terceiro subgraph de origem indexa o tamanho de cada bloco. Para implantar este Subgraph localmente, execute os mesmos comandos acima.

#### Funções Importantes

- Ele importa schemas de outros Subgraphs e adiciona uma entidade `block` com um campo `size`, que representa o tamanho de cada bloco.
- Procura eventos da blockchain relacionados ao tamanho dos blocos (por exemplo, armazenamento ou volume), e processa esses dados para atualizar as entidades do Subgraph de acordo.

### Passo 4. Combine os Subgraphs em Um Único para Estatísticas de Bloco

Este Subgraph composto combina e agrega as informações dos três Subgraphs de origem acima, fornecendo uma visão unificada das estatísticas dos blocos. Para implantar este Subgraph localmente, execute os mesmos comandos acima.

> Note:
>
> - Qualquer alteração a um Subgraph de origem provavelmente gerará uma nova ID de implantação.
> - Certifique-se de atualizar a ID de implantação no endereço de origem de dados do manifest do Subgraph, para aproveitar as últimas alterações.
> - Todos os Subgraphs de origem devem ser implantados antes de implantar o Subgraph composto.

#### Funções Importantes

- Fornece um modelo consolidado de dados que abrange todas as métricas relevantes de bloco.
- Combina dados de três Subgraphs de origem e fornece uma visão abrangente das estatísticas de blocos, para permitir queries e análises mais complexas.

## Conclusão

- Esta ferramenta poderosa escalará a sua programação de Subgraphs e permitirá a combinação de vários Subgraphs.
- A configuração inclui a implantação de três Subgraphs de origem e uma implantação final do Subgraph composto.
- Esta função tira os limites da escalabilidade e simplifica a eficiência tanto na programação como na manutenção.

## Outros Recursos

- Confira todo o código deste exemplo [neste repositório do GitHub](https://github.com/isum/subgraph-composition-example).
- Para adicionar recursos avançados ao seu Subgraph, confira a página sobre [recursos avançados](/developing/creating/advanced/).
- Para saber mais sobre agregações, confira a página sobre [Séries Temporais e Agregações](/subgraphs/developing/creating/advanced/#timeseries-and-aggregations).
