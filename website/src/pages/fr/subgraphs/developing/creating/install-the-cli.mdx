---
title: Installation du Graph CLI
---

> In order to use your Subgraph on The Graph's decentralized network, you will need to [create an API key](/resources/subgraph-studio-faq/#2-how-do-i-create-an-api-key) in [Subgraph Studio](https://thegraph.com/studio/apikeys/). It is recommended that you add signal to your Subgraph with at least 3,000 GRT to attract 2-3 Indexers. To learn more about signaling, check out [curating](/resources/roles/curating/).

## Aperçu

The [Graph CLI](https://github.com/graphprotocol/graph-tooling/tree/main/packages/cli) is a command-line interface that facilitates developers' commands for The Graph. It processes a [Subgraph manifest](/subgraphs/developing/creating/subgraph-manifest/) and compiles the [mappings](/subgraphs/developing/creating/assemblyscript-mappings/) to create the files you will need to deploy the Subgraph to [Subgraph Studio](https://thegraph.com/studio/) and the network.

## Introduction

### Installation du Graph CLI

L'interface de ligne de commande Graph est écrite en TypeScript et vous devez avoir installé `node` et soit `npm` soit `yarn` pour l'utiliser. Recherchez la version [la plus récente](https://github.com/graphprotocol/graph-tooling/releases?q=%40graphprotocol%2Fgraph-cli&expanded=true) de l'interface de ligne de commande.

Sur votre machine locale, exécutez l'une des commandes suivantes :

#### En utilisant [npm](https://www.npmjs.com/)

```bash
npm install -g @graphprotocol/graph-cli@latest
```

#### En utilisant [yarn](https://yarnpkg.com/)

```bash
yarn global add @graphprotocol/graph-cli
```

The `graph init` command can be used to set up a new Subgraph project, either from an existing contract or from an example Subgraph. If you already have a smart contract deployed to your preferred network, you can bootstrap a new Subgraph from that contract to get started.

## Créer un subgraph

### À partir d'un contrat existant

The following command creates a Subgraph that indexes all events of an existing contract:

```sh
graph init \
  --product subgraph-studio
  --from-contract <ADRESSE_DU_CONTRAT> \
  [--network <RESEAU_ETHEREUM>] \
  [--abi <FICHIER>] \
  <SUBGRAPH_SLUG> [<REPERTOIRE>]
```

- La commande tente de récupérer l'ABI du contrat depuis Etherscan.

  - Graph CLI repose sur un endpoint RPC public. Bien que des échecs occasionnels soient attendus, les réessais résolvent généralement ce problème. Si les échecs persistent, envisagez d'utiliser un ABI local.

- Si certains arguments optionnels manquent, il vous guide à travers un formulaire interactif.

- The `<SUBGRAPH_SLUG>` is the ID of your Subgraph in [Subgraph Studio](https://thegraph.com/studio/). It can be found on your Subgraph details page.

### À partir d'un exemple de subgraph

The following command initializes a new project from an example Subgraph:

```sh
graph init <SUBGRAPH_SLUG> --from-example=example-subgraph
```

- The [example Subgraph](https://github.com/graphprotocol/example-subgraph) is based on the Gravity contract by Dani Grant, which manages user avatars and emits `NewGravatar` or `UpdateGravatar` events whenever avatars are created or updated.

- The Subgraph handles these events by writing `Gravatar` entities to the Graph Node store and ensuring these are updated according to the events.

### Ajouter de nouvelles `sources de données` à un subgraph existant

`dataSources` are key components of Subgraphs. They define the sources of data that the Subgraph indexes and processes. A `dataSource` specifies which smart contract to listen to, which events to process, and how to handle them.

Recent versions of the Graph CLI supports adding new `dataSources` to an existing Subgraph through the `graph add` command:

```sh
graph add <address> [<subgraph-manifest default: "./subgraph.yaml">]

Options:

      --abi <path>              Chemin d'accès à l'ABI du contrat (par défaut : téléchargement à partir d'Etherscan)
      --contract-name           Nom du contrat (par défaut : Contrat)
      --merge-entities          Fusionner ou non les entités portant le même nom (par défaut : false)
      --network-file <path>     Chemin du fichier de configuration du réseau (par défaut: "./networks.json")
```

#### Spécificités⁠

La commande `graph add` récupère l'ABI depuis Etherscan (à moins qu'un chemin ABI ne soit spécifié avec l'option `--abi`) et crée une nouvelle `dataSource`, de la même manière que la commande `graph init` crée une `dataSource` `--from-contract`, en mettant à jour le schéma et les mappages en conséquence. Cela vous permet d'indexer les contrats d'implémentation à partir de leurs contrats proxy.

- L'option `--merge-entities` identifie comment le développeur souhaite gérer les conflits de noms entre `entity` et `event` :

  - Si `true` : la nouvelle `dataSource` doit utiliser les `eventHandlers` et `entities` existants.

  - Si `false` : un nouveau gestionnaire `entity` & `event` doit être créé avec `${dataSourceName}{EventName}`.

- L'adresse du contrat sera écrite dans le fichier `networks.json` pour le réseau concerné.

> Note : Lorsque vous utilisez la CLI interactive, après avoir exécuté `graph init` avec succès, vous serez invité à ajouter une nouvelle `dataSource`.

### Récupération des ABIs

Le(s) fichier(s) ABI doivent correspondre à votre(vos) contrat(s). Il existe plusieurs façons d'obtenir des fichiers ABI :

- Si vous construisez votre propre projet, vous aurez probablement accès à vos ABI les plus récents.
- If you are building a Subgraph for a public project, you can download that project to your computer and get the ABI by using [`npx hardhat compile`](https://hardhat.org/hardhat-runner/docs/guides/compile-contracts#compiling-your-contracts) or using `solc` to compile.
- You can also find the ABI on [Etherscan](https://etherscan.io/), but this isn't always reliable, as the ABI that is uploaded there may be out of date. Make sure you have the right ABI, otherwise running your Subgraph will fail.
